define("question:widget/js/answer-dialog/answer-dialog",function(require,exports,module){var $=require("common:widget/js/util/tangram/tangram"),Submit=require("common:widget/js/logic/submit/submit"),Scrollbar=require("common:widget/js/ui/scrollbar-new/scrollbar-new"),imageScale=require("question:widget/image-scale/image-scale"),AuthCode=require("common:widget/js/logic/authcode/authcode"),Dialog=require("common:widget/js/ui/dialog/dialog"),log=require("common:widget/js/util/log/log"),ec=require("common:widget/js/util/event/event"),answerDialog=function(opt){var me=this;me.tmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<div class="wad-close"><i class="iknow-icons">&#xe603;</i></div><div class="wad-scroll-content scrollbar-inner">    <div class="wad-scroll-inner">        <p class="wad-title">',"undefined"==typeof data.title?"":data.title,'</p>        <div class="wad-con-wp">            '),data.contentTxt.length<120?_template_fun_array.push('                <span class="wad-con">',"undefined"==typeof data.content?"":data.content,"</span>            "):_template_fun_array.push('                <span class="wad-con">',"undefined"==typeof data.contentTxt.substr(0,120)?"":baidu.template._encodeHTML(data.contentTxt.substr(0,120)),'...</span>                <span class="wad-con-all" style="display:none;">',"undefined"==typeof data.content?"":data.content,'</span>                <a href="javascript:void(0)" class="wad-expend">展开<i class="i-incline-down ml-5"></i></a>            '),_template_fun_array.push("        </div>        "),""!=data.supContent&&_template_fun_array.push('        <p class="wad-supply">',"undefined"==typeof data.supContent?"":data.supContent,"</p>        "),_template_fun_array.push("        "),1==data.hasPic){_template_fun_array.push('            <div class="wad-img-wp">                '),data.imgUrl.length>0&&_template_fun_array.push('                <div class="wad-img-prev-wp">                    <div class="wad-img-prev"><i class="iknow-icons">&#xe671;</i></div>                </div>                '),_template_fun_array.push('                <div class="wad-img-con">                    <ul class="wad-img-ul">                        ');for(var i=0;i<data.imgUrl.length;i++)_template_fun_array.push('                            <li class="wad-img-li" data-src="',"undefined"==typeof data.imgUrl[i]?"":baidu.template._encodeHTML(data.imgUrl[i]),'">                                <img class="wad-img-item" src="',"undefined"==typeof data.imgUrl[i]?"":baidu.template._encodeHTML(data.imgUrl[i]),'">                            </li>                        ');_template_fun_array.push("                    </ul>                </div>                "),data.imgUrl.length>0&&_template_fun_array.push('                <div class="wad-img-next-wp">                    <div class="wad-img-next"><i class="iknow-icons">&#xe673;</i></div>                </div>                '),_template_fun_array.push("            </div>        ")}_template_fun_array.push('        <textarea name="wad-textarea" class="wad-textarea" placeholder="填写您的回答"></textarea>    </div></div><div class="wad-button-group">    <div class="wad-button-group-content">        <div class="wad-error-tips"></div>        <span class="wad-authcode"></span>        <div class="wad-submit-btn" data-id="',"undefined"==typeof data.qid?"":baidu.template._encodeHTML(data.qid),'">提交回答</div>        <label for="wad-check" class="wad-label">            <input type="checkbox" name="wad-check" class="wad-check">            <span>匿名</span>        </label>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],opt.data&&(me.renderData={data:opt.data},me.opt=opt,me.authcode=null,me.init())};answerDialog.prototype={init:function(){var a=this;a.bindEvent(),a.initDialog()},bindEvent:function(){var a=this;$.browser.isWebkit?window.addEventListener("beforeunload",a.pageUnload.bind(a)):window.onbeforeunload=function(e){e=e||window.event,a.pageUnload(e)}},initDialog:function(){var a=this;a.dialog=new Dialog({width:800,className:"waiting-answers-dialog opti-font",content:a.tmpl(a.renderData),closeOnEscape:!1,autoDispose:!0,open:function(){$(".wad-scroll-content").scrollbar(),$(".wad-close").click(function(){if(a.hasCon())var e=Dialog.confirm("您的回答还没有提交，确定要离开？",{title:"知道提示",autoDispose:!0,onaccept:function(){e.close(),a.closeDialog()}});else a.closeDialog()}),a.renderData.data.hasPic&&setTimeout(function(){a.initSlider()},1e3),$(".wad-textarea").focus(),$(".wad-textarea").on("focus",function(){$(".wad-error-tips").hide(),a.authcode=a.authcode||new AuthCode({container:$(".wad-authcode"),from:"new_reply",className:"mt-5"})}),$(".wad-expend").on("click",function(){$(this).hasClass("true")?($(this).parent().find(".wad-con").show(),$(this).parent().find(".wad-con-all").hide(),$(this).html('展开<i class="i-incline-down ml-5"></i>').removeClass("true")):($(this).parent().find(".wad-con").hide(),$(this).parent().find(".wad-con-all").show(),$(this).html('收起<i class="i-incline-up ml-5"></i>').addClass("true"))}),$(".wad-submit-btn").click(function(){if(!a.hasCon())return void a.errorTip("请您输入文字内容");var e={cm:100009,qid:a.renderData.data.qid,co:$.trim($(".wad-textarea").val()),entry:a.opt.entry};$(".wad-check").is(":checked")&&(e.anoy=1),a.submitAnswer(e)})}})},closeDialog:function(){var a=this;a.dialog.close(),a.authcode=null,window.removeEventListener("beforeunload",a.pageUnload.bind(a))},submitAnswer:function(a){var e=this;e.authcode&&e.authcode.submitParam(a),$(".wad-error-tips").hide(),ec.fire("login.check",{isLogin:function(){e.submit(a)},noLogin:function(){$(document).unbind("focusin.dialog"),ec.fire("login.log",{onLoginSuccess:function(){e.submit(a)}})}})},submit:function(a){var e=this;new Submit({params:a,hasJump:!1,syncId:"waiting-answer",authcode:e.authcode||null,beforeJump:function(){e.closeDialog(),$.isFunction(e.opt.callback)?e.opt.callback():null}})},initSlider:function(){var a=$(".wad-img-ul"),e=$(".wad-img-con"),t=a.width(),i=e.width();i>=t&&($(".wad-img-prev-wp").remove(),$(".wad-img-next-wp").remove()),$(".wad-img-next").on("click",function(){var e=a.position().left;a.animate(t+e>=2*i?{left:"-"+(i-e)+"px"}:{left:"-"+(t-i)+"px"})}),$(".wad-img-prev").on("click",function(){var e=a.position().left;a.animate(-i>=e?{left:e+i+"px"}:{left:"0px"})}),imageScale.init(".wad-img-item")},pageUnload:function(){if(this.hasCon()){var a="请注意：您的编辑内容还没有进行保存!";return event.returnValue=a,a}return!1},hasCon:function(){return $(".wad-textarea").size()?$.trim($(".wad-textarea").val()).length>0:!1},errorTip:function(a){$(".wad-error-tips").html(a).show()}},module.exports=answerDialog});