STK.register("kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b,c){var d=a.core.util.language(b,$LANG);d=d.replace(/\\}/ig,"}");if(c){d=a.templet(d,c)}return d}});STK.register("kit.dom.parseDOM",function(a){return function(c){for(var b in c){if(c[b]&&(c[b].length==1)){c[b]=c[b][0]}}return c}});STK.register("kit.dom.firstChild",function(b){var a=b.core.dom.next;return function(c){var d=c.firstChild;if(d&&d.nodeType!=1){d=a(d)}return d}});STK.register("common.listener",function(b){var c={};var a={};a.define=function(e,f){if(c[e]!=null){throw"common.listener.define: 频道已被占用"}c[e]=f;var d={};d.register=function(h,g){if(c[e]==null){throw"common.listener.define: 频道未定义"}b.listener.register(e,h,g)};d.fire=function(g,h){if(c[e]==null){throw"commonlistener.define: 频道未定义"}b.listener.fire(e,g,h)};d.remove=function(h,g){b.listener.remove(e,h,g)};d.cache=function(g){return b.listener.cache(e,g)};return d};return a});STK.register("common.channel.page",function(b){var a=["resize"];return b.common.listener.define("common.channel.page",a)});if(typeof scope==="undefined"){scope={}}scope.loginKit=function(){if(window.scope){var c=window.scope.current_user_weibo||window.scope.current_user_sina;if(c){return{uid:c,isLogin:!!c}}}if(window.$CONFIG){var c=window.$CONFIG.current_user_weibo||window.$CONFIG.current_user_sina||window.$CONFIG.uid||window.$CONFIG.$uid;if(c){return{uid:c,isLogin:!!c}}}var b=document.cookie+";";var f=["SUP","=([^;]*)?;"].join("");var a=["(\\?|&)","uid","=([^&]*)(&|$)"].join("");var e=b.match(new RegExp(f,"i"));e=(e)?e[1]||"":"";e=unescape(e);var c=e.match(new RegExp(a));c=(c)?c[2]||"":"";var d=scope["$oid"];return{uid:c,isLogin:!!c,isAdmin:c&&d&&(c==d)}};scope.$isLogin=function(){return scope.loginKit().isLogin};scope.$isAdmin=function(){return scope.loginKit().isAdmin};STK.register("common.editor.getLength",function(a){return function(j){var d=41,l=140,b=20,e=j;var k=j.match(/(http:|https:)?\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];var c=0;for(var f=0,h=k.length;f<h;f++){var g=a.core.str.bLength(k[f]);if(/^(http:\/\/t.cn)|(https:\/\/t.cn)|(\/\/t.cn)/.test(k[f])){continue}else{if(/^(http:\/\/|https:\/\/|\/\/)+(t.sina.com.cn|t.sina.cn)/.test(k[f])||/^(http:\/\/|https:\/\/|\/\/)+(weibo.com|weibo.cn)/.test(k[f])){c+=g<=d?g:(g<=l?b:(g-l+b))}else{c+=g<=l?b:(g-l+b)}}e=e.replace(k[f],"")}var m=Math.ceil((c+a.core.str.bLength(e))/2);return m}});STK.register("common.editor.flashContent",function(a){return function(j,i,p,o){i=i||["#fee","#fdd","#fcc","#fdd","#fee","transparent"];p=p||2;o=o||50;var n=0,k=i.length,m=p*k,l=setInterval(function(){j.style.backgroundColor=i[n%k];n++;n==m&&clearInterval(l)},o)}});STK.register("kit.dom.cssText",function(b){var a=function(f,e){var c=(f+";"+e).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i))){c=c.replace(d[1]+d[2]+d[3],"")}return c};return function(d){d=d||"";var e=[],c={push:function(g,f){e.push(g+":"+f);return c},remove:function(g){for(var f=0;f<e.length;f++){if(e[f].indexOf(g+":")==0){e.splice(f,1)}}return c},getStyleList:function(){return e.slice()},getCss:function(){return a(d,e.join(";"))}};return c}});STK.register("kit.dom.isTurnoff",function(a){return function(b){return !(b.parentNode&&b.parentNode.nodeType!=11&&!b.disabled)}});STK.register("kit.extra.textareaUtils",function(c){var a={},b=document.selection;a.selectionStart=function(f){if(!b){try{return f.selectionStart}catch(j){return 0}}var k=b.createRange(),i,d,h=0;var g=document.body.createTextRange();g.moveToElementText(f);for(h;g.compareEndPoints("StartToStart",k)<0;h++){g.moveStart("character",1)}return h};a.selectionBefore=function(d){return d.value.slice(0,a.selectionStart(d))};a.selectText=function(d,e,f){d.focus();if(!b){d.setSelectionRange(e,f);return}var g=d.createTextRange();g.collapse(1);g.moveStart("character",e);g.moveEnd("character",f-e);g.select()};a.insertText=function(f,e,h,g){f.focus();g=g||0;if(!b){var i=f.value,k=h-g,d=k+e.length;f.value=i.slice(0,k)+e+i.slice(h,i.length);a.selectText(f,d,d);return}var j=b.createRange();j.moveStart("character",-g);j.text=e};a.replaceText=function(g,e){g.focus();var h=g.value;var k=a.getSelectedText(g);var f=k.length;if(k.length==0){a.insertText(g,e,a.getCursorPos(g))}else{var j=a.getCursorPos(g);if(b){var i=b.createRange();i.text=e;a.setCursor(g,j+e.length)}else{var d=j+k.length;g.value=h.slice(0,j)+e+h.slice(j+f,h.length);a.setCursor(g,j+e.length);return}}};a.getCursorPos=function(g){var f=0;if(STK.core.util.browser.IE){g.focus();var d=null;d=b.createRange();var e=d.duplicate();e.moveToElementText(g);e.setEndPoint("EndToEnd",d);g.selectionStart=e.text.length-d.text.length;g.selectionEnd=g.selectionStart+d.text.length;f=g.selectionStart}else{if(g.selectionStart||g.selectionStart=="0"){f=g.selectionStart}}return f};a.getSelectedText=function(e){var f="";var d=function(g){if(g.selectionStart!=undefined&&g.selectionEnd!=undefined){return g.value.substring(g.selectionStart,g.selectionEnd)}else{return""}};if(window.getSelection){f=d(e)}else{f=b.createRange().text}return f};a.setCursor=function(f,g,e){g=g==null?f.value.length:g;e=e==null?0:e;f.focus();if(f.createTextRange){var d=f.createTextRange();d.move("character",g);d.moveEnd("character",e);d.select()}else{f.setSelectionRange(g,g+e)}};a.unCoverInsertText=function(g,i,f){f=(f==null)?{}:f;f.rcs=f.rcs==null?g.value.length:f.rcs*1;f.rccl=f.rccl==null?0:f.rccl*1;var h=g.value,d=h.slice(0,f.rcs),e=h.slice(f.rcs+f.rccl,h==""?0:h.length);g.value=d+i+e;this.setCursor(g,f.rcs+(i==null?0:i.length))};return a});STK.register("module.at",function(g){var o=window,j=document,l=g.core.util.browser,b="font-family:Tahoma,宋体;",n=g.kit.extra.textareaUtils.selectionStart;var p;var c,h,e,k;var f=(function(){var d={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',b,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',b,'"> </span>'].join("")};return function(r){var q=r.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(s){return d[s]});return q}})();var a=function(){var d=[],r=p.textEl.style.cssText,q;g.foreach(["margin","padding","border"],function(s){g.foreach(["Top","Left","Bottom","Right"],function(u){var t;if(s!="border"){t=d.push(s,"-",u.toLowerCase(),":",g.getStyle(p.textEl,s+u),";");return}g.foreach(["Color","Style","Width"],function(v){d.push(s,"-",u.toLowerCase(),"-",v.toLowerCase(),":",g.getStyle(p.textEl,[s,u,v].join("")),";")})})});d.push("font-size:"+g.getStyle(p.textEl,"fontSize")+";");return g.kit.dom.cssText([r,d.join(""),b,"word-wrap: break-word;line-height: 18px;overflow-y:auto;overflow-x:hidden;outline:none;"].join("")).getCss()};var m=(function(){var v=g.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list;var q=v.wrap[0],w=v.flag[0],d=v.after[0],y=v.before[0],u=0,s,r,x;var t=function(z){if(l.MOZ){return -2}if(l.MOBILE&&l.SAFARI&&(l.IPAD||l.ITOUCH||l.IPHONE)){return -2}return 0};return{bind:function(){if(r===p.textEl){return}k=g.position(p.textEl);var z=["left:",k.l,"px;top:",k.t+20,"px;"].join("");r=p.textEl;var A=a();r.style.cssText=A;x=[z,A,"position:absolute;filter:alpha(opacity=0);opacity:0;z-index:-1000;"].join("");q.style.cssText=x;if(!u){u=1;j.body.appendChild(q)}},content:function(z,B,C,A){q.style.cssText=[x,"width:",((r.offsetWidth||parseInt(g.getStyle(r,"width")))+t()),"px;height:",((r.offsetHeight||parseInt(g.getStyle(r,"height")))),"px;overflow-x:hidden;overflow-y:",(/webkit/i.test(navigator.userAgent))?"hidden":g.getStyle(r,"overflowY"),";"].join("");y.innerHTML=f(z);w.innerHTML=f(B)||"&thinsp;";d.innerHTML=f([C,A].join(""));clearTimeout(s);s=setTimeout(function(){var D=g.position(w);g.custEvent.fire(p.eId,"at",{t:(D.t-r.scrollTop)-k.t+5,l:D.l-k.l+5,key:C,flag:B,textarea:p.textEl})},30)},hide:function(){q.style.display="none"},show:function(){q.style.display=""}}})();var i=function(){if(g.kit.dom.isTurnoff(p.textEl)){clearInterval(c);return}var d=p.textEl.value.replace(/\r/g,"");var t=n(p.textEl);if(t<0||t==e){return}e=t;var r=d.slice(0,t);var q=r.match(new RegExp(["(",p.flag,")([a-zA-Z0-9\u4e00-\u9fa5_]{0,20})$"].join("")));if(!q){g.custEvent.fire(p.eId,"hidden");return}var s=d.slice(t);r=r.slice(0,-q[0].length);m.content(r,q[1],q[2],s)};return function(q){if(!q||!q.textEl){return}q=g.parseParam({textEl:null,flag:"@",eId:g.custEvent.define({},["at","hidden"])},q);var r=function(){if(!p){return}clearInterval(c);g.removeEvent(p.textEl,"blur",r);m.hide()};var d=function(){r();p=q;e=null;m.bind();m.show();c=setInterval(i,200);g.addEvent(q.textEl,"blur",r)};g.addEvent(q.textEl,"focus",d);return q.eId}});STK.register("kit.extra.merge",function(a){return function(d,c){var f={};for(var e in d){f[e]=d[e]}for(var e in c){f[e]=c[e]}return f}});STK.register("core.str.trim",function(a){return function(e){if(typeof e!=="string"){throw"trim need a string as parameter"}var b=e.length;var d=0;var c=/(\u3000|\s|\t|\u00A0)/;while(d<b){if(!c.test(e.charAt(d))){break}d+=1}while(b>d){if(!c.test(e.charAt(b-1))){break}b-=1}return e.slice(d,b)}});STK.register("core.json.jsonToQuery",function(a){var b=function(d,c){d=d==null?"":d;d=a.core.str.trim(d.toString());if(c){return encodeURIComponent(d)}else{return d}};return function(g,e){var h=[];if(typeof g=="object"){for(var d in g){if(d==="$nullName"){h=h.concat(g[d]);continue}if(g[d] instanceof Array){for(var f=0,c=g[d].length;f<c;f++){h.push(d+"="+b(g[d][f],e))}}else{if(typeof g[d]!="function"){h.push(d+"="+b(g[d],e))}}}}if(h.length){return h.join("&")}else{return""}}});STK.register("common.log.monitor",function(e){var f=window.location.protocol=="https:"?"https:":"http:";var a=f+"//www.weibojs.com/log/widget.php";var d={refer:document.referrer,title:document.title,ua:window.navigator.userAgent,os:window.navigator.platform+"|"+window.navigator.oscpu};var c=true;var b=function(h){var g=new Image();if(c){g.src=h}else{}g=null};return function(h){var l={};var j=e.kit.extra.merge(d,h);var n=[];for(var g in j){var m=j[g];if(typeof m==="object"){m=e.core.json.jsonToQuery(m)}n.push(g+"="+encodeURIComponent(m))}var i=a+"?"+n.join("&");b(i);l.monitor=b;return l}});STK.register("kit.io.ajax",function(a){return function(i){var h,f,e,g,k,b,c;var j=function(m){a.common.log.monitor({url:document.location.protocol+"//"+document.location.hostname+(h.url.charAt(0)=="/"?h.url:"/"+h.url),param:h.args,method:h.method,result:m&&(m.code||0),httpcode:g.status})};b=function(m){k=false;i.onComplete(m,h.args);setTimeout(l,0)};c=function(m){k=false;i.onFail&&i.onFail(m,h.args);j(m);setTimeout(l,0)};e=[];g=null;k=false;h=a.parseParam({url:"",method:"get",responseType:"json",timeout:30*1000,onTraning:a.funcEmpty,isEncode:true},i);h.onComplete=b;h.onFail=c;var l=function(){if(!e.length){return}if(k===true){return}k=true;h.args=e.shift();g=a.ajax(h)};var d=function(n){while(e.length){e.shift()}k=false;if(g){try{g.abort()}catch(m){}}g=null};f={};f.request=function(m){if(!m){m={}}if(i.noQueue){d()}if(!i.uniqueRequest||!g){e.push(m);m._t=0;l()}};f.abort=d;return f}});STK.register("kit.io.jsonp",function(a){return function(d){var c,f,b,h,e;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:30*1000,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:true},d);b=[];h={};e=false;var g=function(){if(!b.length){return}if(e===true){return}e=true;h.args=b.shift();h.onComplete=function(i){e=false;c.onComplete(i,h.args);setTimeout(g,0)};h.onFail=function(i){e=false;c.onFail(i);setTimeout(g,0)};a.jsonp(a.kit.extra.merge(c,{args:h.args,onComplete:function(i){h.onComplete(i)},onFail:function(i){try{h.onFail(i)}catch(j){}}}))};f={};f.request=function(i){if(!i){i={}}b.push(i);i._t=1;g()};f.abort=function(i){while(b.length){b.shift()}e=false;h=null};return f}});STK.register("kit.io.inter",function(a){return function(){var b,d,c;b={};d={};c={};b.register=function(f,e){if(d[f]!==undefined){throw f+" interface has been registered"}d[f]=e;c[f]={}};b.hookComplete=function(e,g){var f=a.core.util.getUniqueKey();c[e][f]=g;return f};b.removeHook=function(e,f){if(c[e]&&c[e][f]){delete c[e][f]}};b.getTrans=function(g,e){var f=a.kit.extra.merge(d[g],e);f.onComplete=function(i,l){try{e.onComplete(i,l)}catch(j){}if(i.code==="100000"){try{e.onSuccess(i,l)}catch(j){}}else{try{e.onError(i,l)}catch(j){}}for(var h in c[g]){try{c[g][h](i,l)}catch(j){}}};if(d[g]["requestMode"]==="jsonp"){return a.kit.io.jsonp(f)}else{if(d[g]["requestMode"]==="ijax"){return a.kit.io.ijax(f)}else{return a.kit.io.ajax(f)}}};b.request=function(h,e,g){var f=a.core.json.merge(d[h],e);f.onComplete=function(j,m){try{e.onComplete(j,m)}catch(l){}if(j.code==="100000"){try{e.onSuccess(j,m)}catch(l){}}else{try{if(j.code==="100002"){window.location.href=j.data;return}e.onError(j,m)}catch(l){}}for(var i in c[h]){try{c[h][i](j,m)}catch(l){}}};f=a.core.obj.cut(f,["noqueue"]);f.args=g;if(d[h]["requestMode"]==="jsonp"){return a.jsonp(f)}else{if(d[h]["requestMode"]==="ijax"){return a.ijax(f)}else{return a.ajax(f)}}};return b}});STK.register("common.trans.editor",function(c){var d=(location.host=="widget.weibo.com"||location.host=="dev.weibo.com")?"":"/widget";var a=c.kit.io.inter();var b=a.register;b("face",{url:d+"/public/aj_getemotions.php"});b("at",{url:d+"/public/aj_atusers.php"});return a});STK.register("module.suggest",function(j){var h=null,e=j.custEvent,l=e.define,f=e.fire,o=e.add,g=j.addEvent,c=j.removeEvent,m=j.stopEvent;var b=[],a={};var i={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9};var k=function(w){var v=-1,t=[],r=w.textNode,s=w.uiNode;var A=j.core.evt.delegatedEvent(s);var p=l(r,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);p.setFlag=q;var q=function(B){w.flag=B};var y=function(){return j.sizzle(["[action-type=",w.actionType,"]"].join(""),s)};var z=function(){v=-1;c(r,"keydown",u);A.destroy()};var u=function(D){var E,C;if(!(E=D)||!(C=E.keyCode)){return}if(C==i.ENTER){m();f(p,"onSelect",[v,r,w.flag]);return false}if(C==i.UP){m();var B=y().length;v=v<1?B-1:v-1;f(p,"onIndexChange",[v]);return false}if(C==i.DOWN){m();var B=y().length;v=v==(B-1)?0:v+1;f(p,"onIndexChange",[v]);return false}if(C==i.ESC){m();z();f(p,"onClose");return false}if(C==i.TAB){z();f(p,"onClose");return false}};var x=function(B){f(p,"onSelect",[j.core.arr.indexOf(B.el,y()),r,w.flag])};var n=function(B){v=j.core.arr.indexOf(B.el,y());f(p,"onIndexChange",[j.core.arr.indexOf(B.el,y())])};o(p,"open",function(C,B){r=B;z();g(B,"keydown",u);A.add(w.actionType,"mouseover",n);A.add(w.actionType,"click",x);f(p,"onOpen",[w.flag])});o(p,"openSetFlag",function(C,B){q(B)});o(p,"close",function(){z();f(p,"onClose",[w.flag])});o(p,"indexChange",function(B,C){v=C;f(p,"onIndexChange",[v,w.flag])});return p};var d=function(n){var p=n.textNode;var q=j.core.arr.indexOf(p,b);if(!a[q]){b[q=b.length]=p;a[q]=k(n)}return a[q]};return function(n){if(!n.textNode||!n.uiNode){return}n=j.parseParam({textNode:h,uiNode:h,actionType:"item",actionData:"index",flag:""},n);return d(n)}});STK.register("common.channel.at",function(b){var a=["open","close"];return b.common.listener.define("common.channel.at",a)});STK.register("kit.dom.layoutPos",function(a){return function(e,c,b){if(!a.isNode(c)){throw"kit.dom.layerOutElement need element as first parameter"}if(c===document.body){return false}if(!c.parentNode){return false}if(c.style.display==="none"){return false}var g,f,i,k,h,j,d;g=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},b);f=c;if(!f){return false}while(f!==document.body){f=f.parentNode;if(f.style.display==="none"){return false}j=a.getStyle(f,"position");d=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed"){break}if(d==="true"&&j==="relative"){break}}f.appendChild(e);i=a.position(c,{parent:f});k={w:c.offsetWidth,h:c.offsetHeight};h=g.pos.split("-");if(h[0]==="left"){e.style.left=i.l+g.offsetX+"px"}else{if(h[0]==="right"){e.style.left=i.l+k.w+g.offsetX+"px"}else{if(h[0]==="center"){e.style.left=i.l+k.w/2+g.offsetX+"px"}}}if(h[1]==="top"){e.style.top=i.t+g.offsetY+"px"}else{if(h[1]==="bottom"){e.style.top=i.t+k.h+g.offsetY+"px"}else{if(h[1]==="middle"){e.style.top=i.t+k.h/2+g.offsetY+"px"}}}return true}});STK.register("common.editor.plugin.at",function(e){var y=e.kit.extra.language;var l='<div class="WB_tips_smart WB_email"><p class="tipsmt_title" node-type="suggestTitle">想用@提到谁</p><ul class="tipsmt_list" node-type="suggestWrap"></ul></div>';var f={"@":{normalTitle:y("#L{选择昵称或轻敲空格完成输入}"),moreTitle:y("#L{选择最近@的人或直接输入}"),noTilte:y("#L{轻敲空格完成输入}")},"#":{normal:y("#L{想用什么话题？}")}};var n={"@":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="tipsmt_cur" </#if>action-data="value=${list.nickname}" value="${list.nickname}"><a href="#">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'};var i,k,u,g,c,p,x,j=false,m;var t;var s={"@":"at","#":"topicList"};var d=0;var h=function(){setTimeout(function(){e.custEvent.fire(i,"close")},200)};var a=function(){p.style.display="none"};var o=function(){e.custEvent.add(i,"onIndexChange",function(A,z){q(z)});e.custEvent.add(i,"onSelect",function(z,F,J,H){d=0;e.core.evt.stopEvent();var M=t[F].getAttribute("value");M=M.replace(/\(.*\)/,"");try{J.focus()}catch(G){}var L=e.kit.extra.textareaUtils.selectionStart(J)*1;var A=new RegExp(H+"([a-zA-Z0-9\u4e00-\u9fa5_]{0,20})$");var B=J.value.replace(/\r+/g,"").slice(0,L).match(A);var D=J.value.slice(L,L+1);B=(B&&B[1])?B[1].length:0;var I=e.kit.extra.textareaUtils;if(H=="#"){if(typeof D!="undefined"&&D!=H){M=M+H+" "}}else{M=M+" "}I.insertText(J,M,L,B);var C=I.getCursorPos(J);if(H=="#"&&D==H){I.setCursor(J,C+1);I.insertText(J," ",C+1,0)}C=I.getCursorPos(J);var K=I.getSelectedText(J);var E=(K==""||K==null)?0:K.length;J.setAttribute("range",C+"&"+E);e.custEvent.fire(i,"close")});e.addEvent(u.textEl,"blur",h);e.custEvent.add(i,"onClose",a);e.custEvent.add(i,"onOpen",function(A,z){c.style.display="";p.style.display="";j=true;setTimeout(function(){e.custEvent.fire(i,"indexChange",0)},100)})};var w=function(z,B,C){if(z=="@"){if(B.data&&B.data.length>0){B.title=(C==""?f[z]["moreTitle"]:f[z]["normalTitle"])}else{B.title=f[z]["noTilte"]}}else{B.title=f[z]["normalTitle"]}var A=e.core.util.easyTemplate(n[z],B);return A};var v=function(){e.core.evt.custEvent.add(k,"hidden",function(z,A){e.custEvent.fire(i,"close")});e.core.evt.custEvent.add(k,"at",function(B,C){x=C.key;var z=C.flag;if(x.length==0&&z!="@"){e.custEvent.fire(i,"close");return}var A=document.location.host=="widget.weibo.com"?"":"/widget";e.core.io.ajax({url:A+"/public/aj_atusers.php",args:{wsrc:$CONFIG.wsrc||"app_comment_box",appkey:$CONFIG.source_appkey||$CONFIG.appkey||$CONFIG.app_src,q:x},onComplete:function(E){if(E.code=="100000"){var D=w(z,E,x);e.custEvent.fire(i,"openSetFlag",z);e.custEvent.fire(i,"open",C.textarea);var F=e.core.dom.builder(D);var G=F.box;c.innerHTML=G;c.style.display=(E.data.length==0)?"none":"";g.innerHTML=(x.length==0)?f["@"].moreTitle:f["@"].normalTitle;p.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");e.common.channel.at.fire("open");e.kit.dom.layoutPos(p,C.textarea,{pos:"left-top",offsetX:C.l,offsetY:C.t})}else{e.custEvent.fire(i,"close")}},onFail:function(){e.custEvent.fire(i,"close")}})})};var b=function(){m=u.textEl;k=STK.module.at({textEl:m,flag:"@"})};var r=function(A){d=0;p&&(p.style.display="none");p&&(p.innerHTML="");var z=e.builder(l);p=e.kit.dom.firstChild(z.box);p.style.display="none";document.body.appendChild(p);g=z.list.suggestTitle[0];c=z.list.suggestWrap[0];i&&(e.custEvent.fire(i,"close"));i&&(e.custEvent.remove(i));i=e.module.suggest({textNode:A,uiNode:c,actionType:"item",actionData:"value",flag:"@"});o()};var q=function(z){t=e.sizzle("li",c);t&&t[0]&&e.core.dom.removeClassName(t[d],"tipsmt_cur");e.core.dom.addClassName(t[z],"tipsmt_cur");d=z};return function(A,z){u=A.nodeList;var B={};B.init=function(){b();r(u.textEl);v()};return B}});STK.register("common.editor.simpleEditor",function(e){var a=e.core.str.trim,d;var c=e.common.editor.getLength;var b=function(j,h){var i=c(j);var g=Math.abs(h-i);var f;if(i>h||i<1){f={wordsnum:i,vnum:g,overflow:true}}else{if(i==0){f={wordsnum:i,vnum:g,overflow:true}}else{f={wordsnum:i,vnum:g,overflow:false}}}return f};return function(i,k){k=k||{};var g=k.limit||140;if(!i){throw"[easyEditor]: editor is null"}e.custEvent.define(i,"textNum");e.custEvent.define(i,"keyUpCount");var l=e.sizzle('[node-type="editor"]',i)[0];var h=e.sizzle('[node-type="wordNum"]',i)[0];if(k.atSwitch!=null&&k.atSwitch==true){var f=e.common.editor.plugin.at({nodeList:{textEl:l}},k);f.init()}e.addEvent(l,"focus",function(){d=setInterval(function(){j()},200)});e.addEvent(l,"blur",function(){d&&clearInterval(d)});var j=function(){var n=(a(l.value).length==0)?a(l.value):l.value;n=n.replace(/\r\n/g,"\n");var m=b(n,g);if(n.length>=0&&l.focus){if(m.overflow&&m.wordsnum!=0){h.className=k.warnClassName?k.warnClassName:"WB_tipS_numWarn"}else{h.className=k.className?k.className:"WB_tipS_num"}}else{if(n.length===0){h.className=k.className?k.className:"WB_tipS_num"}}if(n.length!==0&&m.overflow){h.innerHTML="-"+(m.vnum>100?"n":m.vnum)}else{h.innerHTML=m.vnum}e.custEvent.fire(i,"textNum",{count:m.wordsnum,isOver:m.overflow})};e.addEvent(l,"keyup",j);e.custEvent.add(i,"keyUpCount",j);j()}});STK.register("common.trans.comment",function(d){var a=(location.host!="widget.weibo.com")?"/widget":"";var b=d.kit.io.inter();var c=b.register;c("publisher",{url:"/distribution/aj_commentbox.php",method:"post"});c("getuserinfo",{url:"/distribution/aj_isopent.php",method:"get"});c("comment",{url:"/distribution/aj_addcomment.php",method:"post"});c("reply",{url:"/distribution/aj_addcomment.php",method:"post"});c("loadmore",{url:"/distribution/aj_getcomments.php",method:"get"});c("face",{url:a+"/public/aj_getemotions.php",method:"get"});c("blockuser",{url:"/distribution/aj_blackuid.php",method:"post"});c("blockcomment",{url:"/distribution/aj_blackcmtid.php",method:"post"});c("commentlist",{url:"/distribution/aj_getsecondcomments.php",method:"get"});c("message",{url:"/distribution/aj_message.php",method:"post"});c("getmsg",{url:"/distribution/aj_message.php",method:"get"});return b});STK.register("kit.extra.count",function(b){function a(k){var e=41,m=140,c=20,f=k;var l=k.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[];var d=0;for(var g=0,j=l.length;g<j;g++){var h=b.core.str.bLength(l[g]);if(/^(http:\/\/t.cn)|(https:\/\/t.cn)|(\/\/t.cn)/.test(l[g])){continue}else{if(/^(http:\/\/|https:\/\/|\/\/)+(t.sina.com.cn|t.sina.cn)/.test(l[g])||/^(http:\/\/|https:\/\/|\/\/)+(weibo.com|weibo.cn)/.test(l[g])){d+=h<=e?h:(h<=m?c:(h-m+c))}else{d+=h<=m?c:(h-m+c)}}f=f.replace(l[g],"")}var n=Math.ceil((d+b.core.str.bLength(f))/2);return n}return function(c){c=c.replace(/\r\n/g,"\n");return num=a(c)}});STK.register("module.editor",function(e){var c=e.core.evt.addEvent;var b=e.core.evt.custEvent;var a=e.core.dom.getStyle;var d=e.core.dom.setStyle;return function(u,l){var n={};var l=l;var t={};var k={reset:function(){t.textEl.value="";e.core.evt.custEvent.fire(n,"changed");t.textEl.removeAttribute("extra")},delWords:function(z){var y=k.getWords();if(y.indexOf(z)>-1){t.textEl.value="";w.textInput(y.replace(z,""))}else{return false}},getWords:function(){return e.core.str.trim(t.textEl.value)},getExtra:function(){var z;var y=t.textEl.getAttribute("extra")||"";if(y!=null){z=e.core.str.trim(y)}return z},focus:function(A,y){if(typeof A!="undefined"){e.kit.extra.textareaUtils.setCursor(t.textEl,A,y)}else{var z=t.textEl.value.length;e.kit.extra.textareaUtils.setCursor(t.textEl,z)}f.cacheCurPos()},blur:function(){t.textEl.blur()},addExtraInfo:function(y){if(typeof y=="string"){t.textEl.setAttribute("extra",y)}},disableEditor:function(y){if(y===true){t.textEl.setAttribute("disabled","disabled")}else{t.textEl.removeAttribute("disabled")}},getCurPos:function(){var y=t.textEl.getAttribute("range")||"0&0";return y.split("&")},count:function(){var y=(e.core.str.trim(t.textEl.value).length==0)?e.core.str.trim(t.textEl.value):t.textEl.value;return e.kit.extra.count(y)}};var f={textElFocus:function(){if(t.recommendTopic){e.core.dom.setStyle(t.recommendTopic,"display","none")}e.custEvent.fire(n,"focus");if(t.num){e.core.dom.setStyle(t.num,"display","block")}if(k.getWords()==l.tipText){k.delWords(l.tipText)}},textElBlur:function(){setTimeout(function(){if(t.textEl.value.length===0){if(t.recommendTopic){e.core.dom.setStyle(t.recommendTopic,"display","block")}if(t.num&&t.recommendTopic){e.core.dom.setStyle(t.num,"display","none")}e.custEvent.fire(n,"blur");if(typeof l.tipText!="undefined"){t.textEl.value=l.tipText}}},50)},cacheCurPos:function(){var z=e.kit.extra.textareaUtils.getSelectedText(t.textEl);var A=(z==""||z==null)?0:z.length;var B=e.kit.extra.textareaUtils.getCursorPos(t.textEl);var y=B+"&"+A;t.textEl.setAttribute("range",y)}};var w={textChanged:function(){e.custEvent.fire(n,"keyUpCount")},textInput:function(z,B){var A=k.getCurPos();var B=A[0];var y=A[1];if(k.getWords()==l.tipText&&z!=l.tipText){k.delWords(l.tipText)}e.kit.extra.textareaUtils.unCoverInsertText(t.textEl,z,{rcs:A[0],rccl:A[1]});f.cacheCurPos();e.core.evt.custEvent.fire(n,"changed")}};var q={};var g=function(){s();h()};var v=function(){m();o();p();i()};var i=function(){if(l.storeWords){if(t.textEl.value.length==0){w.textInput(l.storeWords)}return}if(l.tipText){t.textEl.value=l.tipText}};var s=function(){if(!u){throw"node is not defined in module editor"}};var h=function(){var y=e.core.dom.builder(u).list;t=e.kit.dom.parseDOM(y)};var m=function(){e.core.evt.addEvent(t.textEl,"focus",f.textElFocus);e.core.evt.addEvent(t.textEl,"blur",f.textElBlur);e.core.evt.addEvent(t.textEl,"mouseup",f.cacheCurPos);e.core.evt.addEvent(t.textEl,"keyup",f.cacheCurPos)};var j=function(){e.core.evt.custEvent.define(n,"changed")};var o=function(){j();e.core.evt.custEvent.add(n,"changed",w.textChanged)};var p=function(){};var x=function(){};g();var r={reset:k.reset,getWords:k.getWords,getExtra:k.getExtra,delWords:k.delWords,focus:k.focus,blur:k.blur,insertText:w.textInput,check:w.textChanged,addExtraInfo:k.addExtraInfo,disableEditor:k.disableEditor,getCurPos:k.getCurPos,count:k.count};n.destroy=x;n.API=r;n.nodeList=t;n.init=v;n.opts=l;return n}});STK.register("common.editor.plugin.count",function(e){var b;function d(n){var h=41,p=140,f=20,j=n;var o=n.match(/(http:|https:)?\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];var g=0;for(var k=0,m=o.length;k<m;k++){var l=e.core.str.bLength(o[k]);if(/^(http:\/\/t.cn)|(https:\/\/t.cn)|(\/\/t.cn)/.test(o[k])){continue}else{if(/^(http:\/\/|https:\/\/|\/\/)+(t.sina.com.cn|t.sina.cn)/.test(o[k])||/^(http:\/\/|https:\/\/|\/\/)+(weibo.com|weibo.cn)/.test(o[k])){g+=l<=h?l:(l<=p?f:(l-p+f))}else{g+=l<=p?f:(l-p+f)}}j=j.replace(o[k],"")}var q=Math.ceil((g+e.core.str.bLength(j))/2);return q}function a(i){var h=d(i);var g=Math.abs(b-h);var f;if(h>b||h<1){f={wordsnum:h,vnum:g,overflow:true}}else{if(h==0){f={wordsnum:h,vnum:g,overflow:true}}else{f={wordsnum:h,vnum:g,overflow:false}}}return f}function c(f,g){if(!f.textEl){throw"[editor plugin count]: plz check nodeList"}}return function(i){var f=i.nodeList;var g;var l=i.opts;var k=e.kit.extra.language;b=l.limitNum;c(f);e.custEvent.define(i,"textNum");e.custEvent.define(i,"keyUpCount");var m=f.textEl;var h=f.num;e.addEvent(m,"focus",function(){g=setInterval(function(){j()},200)});e.addEvent(m,"blur",function(){clearInterval(g)});var j=function(){var p=(e.core.str.trim(m.value).length==0)?e.core.str.trim(m.value):m.value;var n=i&&i.opts&&i.opts.extendText;p=p.replace(/\r\n/g,"\n");var o=a(p,l.limitNum);if(p.length>=0&&m.focus){if(o.overflow&&o.wordsnum!=0){h.innerHTML=(n?k(n):"")+k("#L{已经超过}")+'<span class="W_error">'+o.vnum+"</span>字"}else{h.innerHTML=(n?k(n):"")+k("#L{还可以输入}")+"<span>"+o.vnum+"</span>字"}}else{if(p.length===0){h.innerHTML=(n?k(n):"")+k("#L{还可以输入}")+"<span>"+o.vnum+"</span>字"}}e.core.evt.custEvent.fire(i,"textNum",{count:o.wordsnum,isOver:o.overflow})};STK.core.evt.addEvent(m,"keyup",j);e.custEvent.add(i,"keyUpCount",j)}});STK.register("common.editor.base",function(b){var a={limitNum:140};return function(g,c){var h={};var j,i,f,k;j=b.kit.extra.merge(a,c);i=b.module.editor(g,j);f=i.nodeList;k=[];if(typeof c.count=="undefined"||c.count=="enable"){var e=b.common.editor.plugin.count(i,j)}if(j.atSwitch!=null&&j.atSwitch==true){var d=b.common.editor.plugin.at(i,j);d.init()}i.init();i.widget=function(m,n,l){k.push(m);m.init(i,n,l);return i};i.closeWidget=function(){if(k&&k.length!=0){for(var n=0,m=k.length;n<m;n++){k[n].hide()}}};return i}});STK.register("common.editor.plugin.faceSimple",function(f){var c=f.common.trans.comment;var a='<div class="WB_tips_show" style="display:none; z-index:10000;" node-type="faceOuter"><span class="ts_arr"></span><div class="layer_faces"><a href="javascript:;" node-type="close" class="WB_tips_show_close">关闭</a><div class="tipsshow_detail" node-type="inner"></div></div></div></div>';var e='<#et temp data><ul class="faces_list clearfix"><#list data as list><li action-type="expression" action-data="text=${list.value}"><img alt="${list.phrase}" title="${list.phrase.replace("[", "").replace("]", "")}" src="${list.url}" /></li></#list></ul></#et>';var d='<p class="none"><img src="//timg.sjs.sinajs.cn/t35/appstyle/opent/images/widgets/common/loading.gif" alt="" class="loading" />正在加载，请稍候....</p>';var b={};return function(h,n){i=h;var o={};var g,y,s,w,i,j,q,l;var p=f.parseParam({outer:null,url:"",container:document.body},n);f.custEvent.define(o,"insert");var v=function(){var z=f.builder(a);g=z.list.faceOuter[0];y=z.list.inner[0];s=z.list.close[0];p.container.appendChild(g);k()};var k=function(){w=f.delegatedEvent(g);w.add("expression","click",function(z){f.custEvent.fire(o,"insert",{text:z.data.text})});f.addEvent(s,"click",o.hide);f.addEvent(document.body,"click",function(A){var z=f.fixEvent(A);if(!f.contains(g,z.target)){o.hide()}});f.addEvent(i,"click",function(z){f.stopEvent();x(h,p)})};var m=function(){y.innerHTML=d};var t=function(B){var A=f.parseParam({type:"face",language:"cnname"},B);m();if(b.status){u(b.data,b.status)}else{var z=c.getTrans("face",{onComplete:function(C){if(C.code==="100000"){u(C.data.usual.norm,C.code);b.status=C.code;b.data=C.data.usual.norm}else{}}});z.request({wsrc:$CONFIG.wsrc||"app_comment_box",appkey:scope.appkey,type:"face"})}};var r=function(B,E){E=E||"common";var D=[];for(var A=0,z=B.length;A<z;A++){var C=B[A];if(C[E]){D.push(C)}}return D};var u=function(B,z){var C=r(B);var A=f.core.util.easyTemplate(e,C);y.innerHTML=A;f.kit.dom.layoutPos(g,i,{pos:"left-bottom",offsetX:-9,offsetY:5})};var x=function(z,A){if(!l){l=f.sizzle("[node-type=imgOuter]",p.container)[0]}l&&(l.style.display="none");g.style.display="";t()};o.show=x;o.hide=function(){g.style.display="none"};v();return o}});STK.register("common.editor.plugin.textareaUtils",function(c){var a={},b=document.selection;a.selectionStart=function(e){if(!b){return e.selectionStart}var i=b.createRange(),h,d,g=0;var f=document.body.createTextRange();f.moveToElementText(e);for(g;f.compareEndPoints("StartToStart",i)<0;g++){f.moveStart("character",1)}return g};a.selectionBefore=function(d){return d.value.slice(0,a.selectionStart(d))};a.selectText=function(d,e,f){d.focus();if(!b){d.setSelectionRange(e,f);return}var g=d.createTextRange();g.collapse(1);g.moveStart("character",e);g.moveEnd("character",f-e);g.select()};a.insertText=function(f,e,h,g){f.focus();g=g||0;if(!b){var i=f.value,k=h-g,d=k+e.length;f.value=i.slice(0,k)+e+i.slice(h,i.length);a.selectText(f,d,d);return}var j=b.createRange();j.moveStart("character",-g);j.text=e};a.replaceText=function(g,e){g.focus();var h=g.value;var k=a.getSelectedText(g);var f=k.length;if(k.length==0){a.insertText(g,e,a.getCursorPos(g))}else{var j=a.getCursorPos(g);if(b){var i=b.createRange();i.text=e;a.setCursor(g,j+e.length)}else{var d=j+k.length;g.value=h.slice(0,j)+e+h.slice(j+f,h.length);a.setCursor(g,j+e.length);return}}};a.getCursorPos=function(g){var f=0;if(STK.core.util.browser.IE){g.focus();var d=null;d=b.createRange();var e=d.duplicate();e.moveToElementText(g);e.setEndPoint("EndToEnd",d);g.selectionStart=e.text.length-d.text.length;g.selectionEnd=g.selectionStart+d.text.length;f=g.selectionStart}else{if(g.selectionStart||g.selectionStart=="0"){f=g.selectionStart}}return f};a.getSelectedText=function(e){var f="";var d=function(g){if(g.selectionStart!=undefined&&g.selectionEnd!=undefined){return g.value.substring(g.selectionStart,g.selectionEnd)}else{return""}};if(window.getSelection){f=d(e)}else{f=b.createRange().text}return f};a.setCursor=function(f,g,e){g=g==null?f.value.length:g;e=e==null?0:e;f.focus();if(f.createTextRange){var d=f.createTextRange();d.move("character",g);d.moveEnd("character",e);d.select()}else{f.setSelectionRange(g,g+e)}};a.unCoverInsertText=function(g,i,f){f=(f==null)?{}:f;f.rcs=f.rcs==null?g.value.length:f.rcs*1;f.rccl=f.rccl==null?0:f.rccl*1;var h=g.value,d=h.slice(0,f.rcs),e=h.slice(f.rcs+f.rccl,h==""?0:h.length);g.value=d+i+e;this.setCursor(g,f.rcs+(i==null?0:i.length))};return a});STK.register("comp.widget.comment.editor",function(c){var b=c.kit.extra.language,a=c.common.editor.plugin.textareaUtils;return function(f,d){d=d||{};var j={};var k,e;var o={limitNum:140,tipText:b("#L{顺便说点什么吧……}"),count:"disable"};var h;var g=function(){e.tips.style.display="";setTimeout(function(){e.tips.style.display="none"},2000)};var n=function(){i();m()};var i=function(){var q;k=c.common.editor.base(f,o);e=k.nodeList;j.doms=e;var p=c.common.editor.plugin.faceSimple(e.face,{outer:f});c.custEvent.add(p,"insert",function(s,t){if(e.textEl.value==o.tipText){e.textEl.value=""}a.insertText(e.textEl,t.text,a.getCursorPos(e.textEl));p.hide()});c.addEvent(e.textEl,"focus",function(){q=setInterval(function(){m()},200);e.container.className="WB_textarea_auto WB_textarea_foucs"});c.addEvent(e.textEl,"blur",function(){clearInterval(q);e.container.className="WB_textarea_auto"});var r=c.core.util.storage.get("publish_word");if(r!=null&&r!=""&&r!="null"){e.textEl.value=r}m()};var m=function(){if(e.sendBtn.title==b("#L{发私信}")){o.limitNum=300}var r=k.API.count();if(c.trim(e.textEl.value)==b(o.tipText)){r=0}else{d.saveword&&c.core.util.storage.set("publish_word",c.trim(e.textEl.value))}var t;if(r==0){t=false}else{if(r>(e.sendBtn.title==b("#L{发私信}")?300:140)){t=false}else{t=true}}if(h!=t){var p=(e.sendBtn.title==b("#L{回复}")?"WB_btn_reply"+b(" #L{WB_cn}"):e.sendBtn.title==b("#L{评论}")?"WB_btn_comment"+b(" #L{WB_cn}"):"WB_btn_send"+b(" #L{WB_cn}"));e.sendBtn.className=t?p:p.replace(b(" #L{WB_cn}"),"")+"_dis"+b(" #L{WB_cn}")}h=t;var s=o.limitNum-r;var q=s>=0?true:false;if(q){e.wordNum.innerHTML=s;e.wordNum.className="WB_num"}else{e.wordNum.innerHTML=s;!h&&(e.wordNum.className="WB_num WB_numErr")}};var l=function(){};j.getValue=function(){return c.trim(e.textEl.value)};j.setBtnStatus=function(p,q){e.sendBtn.className=q;e.sendBtn.innerHTML=p};j.isSendWB=function(){return e.sendWB.checked?1:0};j.showError=function(q){q=q||b("#L{评论失败，请重试！}");e.tips.innerHTML='<span class="WB_tipB_err"></span><span class="WB_icon_txt">'+q+"</span>";g();var p=(e.sendBtn.title==b("#L{回复}")?"WB_btn_reply"+b(" #L{WB_cn}"):e.sendBtn.title==b("#L{评论}")?"WB_btn_comment"+b(" #L{WB_cn}"):"WB_btn_send"+b(" #L{WB_cn}"));j.setBtnStatus(b("#L{不可评论}"),p)};j.showSuccess=function(q){e.textEl.value="";q=q||b("#L{评论成功！}");e.tips.innerHTML='<span class="WB_tipB_ok"></span><span class="WB_icon_txt">'+q+"</span>";g();var p=(e.sendBtn.title==b("#L{回复}")?"WB_btn_reply"+b(" #L{WB_cn}"):e.sendBtn.title==b("#L{评论}")?"WB_btn_comment"+b(" #L{WB_cn}"):"WB_btn_send"+b(" #L{WB_cn}"));j.setBtnStatus(b("#L{不可评论}"),p.replace(b(" #L{WB_cn}"),"")+"_dis"+b(" #L{WB_cn}"))};n();j.destroy=l;j.editor=k;return j}});STK.register("common.widget.showEditor",function(f){var d=f.kit.extra.language,c=f.addEvent,b=f.common.editor.getLength,e=f.common.editor.flashContent,g=f.removeEvent;var a={type:"repost",template:'<#et temp data><div class="pub_area clearfix"><div class="wbavatar"><img src="${data.upic}" alt="${data.uname}" title="${data.uname}" /></div><div class="wb_cmR wbPubbox"><div class="wb_counter">#L{还可以输入}<em class="WB_num" node-type="wordNum">140</em>#L{字}</div><div class="WB_textarea_auto WB_textarea_foucs"><div class="WB_send_stat" node-type="tips" style="display:none;"></div><textarea class="textarea_inner" node-type="textEl">${data.text}</textarea></div><div class="WB_pubBoxPlus clearfix"><div class="WB_Plus_zone clearfix"><a href="#" onclick="return false;" node-type="face" class="WB_Aemoticons"><span class="WB_icon"></span><span class="WB_icon_txt">#L{表情}</span></a><span class="WB_wordPlus"><label><input type="checkbox" class="WB_checkbox" node-type="sendWB" checked="checked" />#L{同步到微博}</label></span></div><div class="WB_Plus_btn"><a href="#" onclick="return false;" title="#L{回复}" class="WB_btn_reply #L{WB_cn}" node-type="sendBtn">#L{回复}</a></div></div></div></div></#et>',forward:"",uname:"",callback:function(){}};return function(l,h){var n,m,k,p={};var t="";a=f.parseParam(a,h);if(l&&typeof l==="string"){l=f.E(l)}else{if(l.nodeType!==1){throw"[common.widget.showEditor] node.nodeType wrong!"}}var u={text:""};if(a.type==="repost"){a.uname=decodeURIComponent(a.uname);var q=a.forward?"//@"+a.uname+"："+decodeURIComponent(a.forward||""):"";u.text=q}var j=function(){var y=f.trim(k.editor.value),w=b(y);if(w>140||w===0){e(k.editor);return false}var x=k.check.checked;typeof a.callback==="function"&&a.callback.call(p,y,x)};var v=function(){i();o();r()};var r=function(){l.parentNode.appendChild(m.box);k.outer.style.display="block";f.kit.extra.textareaUtils.setCursor(k.editor,0,0);f.common.editor.simpleEditor(k.publisher,{warnClassName:"txt_num err_num",className:"txt_num"})};var i=function(){n=f.core.util.easyTemplate(d(a.template),u).toString();m=f.core.dom.builder(n);k=f.kit.dom.parseDOM(m.list)};var o=function(){if(a.type==="comment"){k.more.innerHTML=d("#L{同时转发}");k.sendBtn.innerHTML=d("<span>#L{评论}</span>")}c(k.back,"click",s);c(k.sendBtn,"click",j);f.core.evt.hotKey.add(k.editor,"ctrl+Enter",j)};var s=function(){k.error.style.display="none";k.editor.value=t};p.showError=function(w){if(w){k.tip_error.innerHTML=w}k.error.style.display="";t=k.editor.value;k.editor.value="";setTimeout(function(){k&&(k.error.style.display="none")},3000)};p.clear=function(){t="";k.editor.value=""};p.showSuccess=function(w){if(w){k.tip_success.innerHTML=w}p.clear();k.success.style.display="";setTimeout(function(){k&&(k.success.style.display="none")},3000)};p.setArrow=function(w){k.arrow.style.marginRight=w+"px"};p.getNodes=function(){return k};p.show=r;p.hide=function(w){k.outer.style.display="none";if(w){this.destroy()}};p.destroy=function(){g(k.back,"click",s);g(k.sendBtn,"click",j);f.core.evt.hotKey.remove(k.editor,"ctrl+Enter",j);f.removeNode(k.outer);for(var w in k){k[w]=null}k=null};v();return p}});STK.register("kit.dom.parentElementBy",function(a){return function(f,b,d){if(!f||!b){throw new Error("传入的参数为空")}var c=0,e;f=f.parentNode;while(f.parentNode){c++;e=d(f);if(e===false){return false}else{if(e===true){return f}else{if(e===b){return null}}}f=f.parentNode;if(c>30000){return false}}return null}});STK.register("kit.dom.lastChild",function(b){var a=b.core.dom.prev;return function(d){var c=d.lastChild;if(c&&c.nodeType!=1){c=a(c)}return c}});STK.register("core.obj.parseParam",function(a){return function(d,c,b){var e,f={};c=c||{};for(e in d){f[e]=d[e];if(c[e]!=null){if(b){if(d.hasOwnProperty[e]){f[e]=c[e]}}else{f[e]=c[e]}}}return f}});STK.register("common.widget.log",function(b){var a={app_sharebutton:1,app_followbutton:2,app_livestream:4,app_listweibo:5,app_weiboshow:6,app_commentbox:7};return function(i){var e=b.core.obj.parseParam({vsrc:"app_weiboshow",refer:"",step:1},i);var g=scope.refer||scope.$refer||e.refer,f=scope.loginKit().uid||"",h=(scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0),c=a[e.vsrc]||"";var j="//rs.sinajs.cn/r.gif?uid="+f+"&appid="+h+"&refer="+g+"&cat="+c+"&step="+e.step+"&rnd="+(+new Date());var d=new Image();d.src=j;d=null}});STK.register("common.widget.login",function(b){var a={vsrc:"app_weiboshow",appsrc:"",showlogo:0,callback:function(){}};if(typeof App==="undefined"){App={}}return function(f){f=b.parseParam(a,f);if(!f.appsrc){f.appsrc=scope?(scope.appsrc?scope.appsrc:(scope.$appsrc?scope.$appsrc:"")):""}var e={};App.loginBackUrlCallBack=function(j){b.custEvent.fire(e,"login",j);f.step=2;b.common.widget.log(f)};var i=function(){g();c();h();d()};var g=function(){};var c=function(){};var h=function(){b.custEvent.define(e,"login")};var d=function(){b.custEvent.add(e,"login",function(j){f.callback(j)})};e.showLogin=function(){var m="&"+b.jsonToQuery(f);var l=navigator.userAgent.indexOf("360 Aphone Browser")>=0;var n=/micromessenger\/(\d+\.\d+\.\d+)/i.test(navigator.userAgent);if(l||n){location.href="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl="+encodeURIComponent(location.href)+m+"&rnd="+(+new Date().valueOf());return}var k="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html"+m+"&rnd="+(+new Date().valueOf());if(/weibo.com/.test(location.host)){k=k.replace(/\/widget/,"")}var j=window.open(k,"miniblog_login",["toolbar=1,status=0,resizable=1,width=620,height=540,left=",(screen.width-620)/2,",top=",(screen.height-450)/2].join(""));j.focus();b.common.widget.log(f)};i();return e}});STK.register("comp.widget.comment.resize",function(a){return function(){var b={page:{width:document.body.clientWidth,height:document.body.clientHeight}};b=a.jsonToQuery(b.page);a.common.channel.page.fire("resize",b)}});STK.register("comp.widget.comment.reply",function(y){var r=y.kit.extra.language,e,a=140,G=y.common.trans.comment,J=y.common.editor.getLength,v=y.common.editor.flashContent,D,f=scope.loginKit().uid;var l;var A=r('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{请登录后回复评论。}<a href="#" action-type="login" onclick="return false;">#L{立即登录}</a></div>');var g=r('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{该帐号尚未开通微博，开通后才能发表评论。}<a href="#" action-type="open" onclick="return false;" target="_blank">&gt;#L{立即开通}</a></div>');var x=r('<div class="pub_area clearfix" node-type="outer"><div class="wbavatar">'+(!!!f?'<a href="#" onclick="return false;" action-type="login"><img src="'+scope.icon+'" node-type="pic" /></a>':'<a href="http://weibo.com/u/'+f+'" '+(/\/0\/50\/0\/1/.test(scope.icon)?'onclick="return false;" action-type="open"':'target="_blank"')+'><img src="'+scope.icon+'" node-type="pic" /></a>')+'</div><div class="wb_cmR wbPubbox" node-type="publisher"><div class="wb_counter">#L{还可以输入}<em class="WB_num" node-type="wordNum">140</em>#L{字}</div><div class="WB_textarea_auto" node-type="container"><div class="WB_send_stat" node-type="tips" style="display:none;"><span class="WB_tipB_err"></span><span class="WB_icon_txt">#L{评论失败，请重试！}</span></div><textarea class="textarea_inner" node-type="textEl" action-data="###data###"></textarea></div><div class="WB_pubBoxPlus clearfix"><div class="WB_Plus_zone clearfix" node-type="widget"><a href="#" onclick="return false;" node-type="face" class="WB_Aemoticons"><span class="WB_icon"></span><span class="WB_icon_txt">#L{表情}</span></a><span class="WB_wordPlus"><label><input type="checkbox" class="WB_checkbox" node-type="sendWB" checked="checked" />#L{同步到微博}</label></span></div><div class="WB_Plus_btn"><a href="#" onclick="return false;" title="#L{回复}" class="WB_btn_reply_dis" node-type="sendBtn" action-type="sendBtn" action-data="###data###">#L{回复}</a></div></div></div></div>');var o=r("#L{加载失败}");var c=r("#L{顺便说点什么吧……}");var H=0;var u={};var F={};var j,E;var s=new RegExp(["^",r("#L{回复}"),"@([^:]*):(.*)"].join(""));var n;function i(L){var K=y.common.widget.login({vsrc:"app_cmtbox",appsrc:scope.appsrc});if(typeof L==="function"){y.custEvent.add(K,"login",function(){L()})}K.showLogin()}function m(O){O=O||{};if(O.data){}else{var M=y.fixEvent();O.data=y.queryToJson(M.target.getAttribute("action-data"))}e=u[O.data.cid].editor;e.doms.textEl.focus();if(!scope.loginKit().isLogin){i(function(){location.reload()});return}else{if(scope.$passport!=""){y.comp.widget.comment.login.open();return}}var N=F[O.data.mid+"_"+O.data.cid].data;var R=e.getValue();var K=J(R);var Q=R.match(s);if(K>a||K===0||(Q&&y.trim(Q[2])=="")||R==c){v(e.doms.textEl);return}var L={appkey:scope.appkey||0,refer:scope.refer||"",shorturl:scope.short_url||"",longurl:scope.long_url||"",content:encodeURIComponent(R||""),issync:e.isSendWB(),language:scope.language||"zh_cn",ralateuid:N.ralateuid||"",uname:N.uname||"",srcuid:N.srcuid||"",mid:N.mid||"",cid:N.cid||""};e.setBtnStatus('<em class="WB_loadingMini"></em>'+r("#L{回复中}"),"WB_btn_replyIng"+r(" #L{WB_cn}"));var P=G.getTrans("comment",{onComplete:function(V){if(V.code==="A00006"){e.showSuccess(r("#L{回复成功！}"));var U=document.createElement("div");U.innserHTML=V.html;var T=e.doms.textEl;var X=y.kit.dom.parentElementBy(T,document.body,function(Y){if(Y.tagName.toLowerCase()=="blockquote"){return true}});var W=y.kit.dom.firstChild(y.core.dom.prev(X));W.innerHTML=r("#L{回复}(")+(1*(W.innerHTML.replace(/\D/g,""))+1)+")";var S=y.kit.dom.lastChild(X);if(S!=null&&S.className=="wc_list child_list"){y.insertHTML(S,V.html,"afterbegin")}else{y.insertHTML(X,'<div class="wc_list child_list" isreal="false">'+V.html+"</div>","afterend")}y.comp.widget.comment.resize();y.core.util.scrollTo(X.parentNode)}else{e.showError(V.msg||r("#L{回复失败，请重试！}"))}e.setBtnStatus(r("#L{回复}"),"WB_btn_reply"+r(" #L{WB_cn}"))},onFail:function(S){}});P.request(L);return false}function d(Y){var M=Y.el;var S=M.parentNode,K,X;var W=S.getAttribute("show"),Z="";if(W){S.removeAttribute("show");y.removeNode(y.sizzle("blockquote.commReply",S.parentNode)[0]);if(u&&u[Y.data.cid]){u[Y.data.cid].desotry&&(u[Y.data.cid].desotry());delete u[Y.data.cid]}var V=y.sizzle("div[isreal=false]",M.parentNode.parentNode);for(var P=0,R=V.length;P<R;P++){y.removeNode(V[P])}y.comp.widget.comment.resize();if(W==1){return}}S.setAttribute("show",1);n=p(Y);var Q=Y.data.mid+"_"+Y.data.cid;F[Q]={};F[Q].data=y.core.json.clone(Y.data);F[Q].el=Y.el;var L=y.C("span");L.className="WB_loadingMini";S.appendChild(L);var O={uid:Y.data.uid||"",page:H||"1",short_url:scope.short_url||"",cid:Y.data.cid||"",appkey:scope.appkey||"",language:scope.language||"zh_cn"};var aa=y.C("blockquote");var N=y.builder(x.replace(/###data###/g,"mid="+Y.data.mid+"&cid="+Y.data.cid)),U;X=N.list.outer[0];aa.className="commReply";if(!scope.loginKit().isLogin){U=y.builder(A);K=U.list.loginOuter[0];aa.appendChild(K)}else{if(scope.$passport!=""){U=y.builder(g);K=U.list.loginOuter[0];aa.appendChild(K)}}aa.appendChild(X);y.insertAfter(aa,S);e=y.comp.widget.comment.editor(N.list.publisher[0],{saveword:false});u[Y.data.cid]=e.editor;u[Y.data.cid].editor=e;C(Y,Z);y.core.evt.hotKey.add(e.doms.textEl,"ctrl+Enter",m);var V=y.sizzle("div[isreal=false]",M.parentNode.parentNode);if(V.length==0){X.style.borderBottom="none"}y.comp.widget.comment.resize();var T=y.core.util.pageSize();y.core.util.scrollTo(M.parentNode.parentNode,{top:parseInt(T.win.height/2)});t(aa,{srcuid:Y.data.srcuid||"",page:"1",cid:Y.data.cid||""},function(){y.removeNode(L)})}function t(L,N,O){var K=G.getTrans("commentlist",{onComplete:function(S){var U,Q;if(L&&typeof L.tagName!="undefined"){U=y.sizzle('div[class="wc_list child_list"]',L);U=(U.length>0)?U[0]:null}var T=y.sizzle("div[isreal=false]",L.parentNode);for(var R=0,P=T.length;R<P;R++){y.removeNode(T[R])}if(S.code=="A00006"){if(U){Q=y.C("BUFFER");Q.innerHTML="<div>json.html</div>";var V=U.parentNode;y.removeNode(U);y.insertHTML(V,S.html,"beforeend")}else{y.insertHTML(L,S.html,"beforeend")}}else{if(U){Q=y.C("BUFFER");Q.innerHTML=o;y.replaceNode(U,Q)}else{y.insertHTML(L,o,"beforeend")}}if(typeof O==="function"){O()}y.comp.widget.comment.resize()}});var M={srcuid:N.srcuid||"",cid:N.cid||"",page:N.page||"",short_url:scope.short_url||"",appkey:scope.appkey||"",language:scope.language||""};K.request(M)}function p(L){var M=L.el,K="";M=y.kit.dom.parentElementBy(M,document.body,function(N){if(N.tagName.toLowerCase()=="div"&&N.className=="wb_cmR comm_main"){return true}});M=y.sizzle('a[class="rl_link"]',M);if(M.length>0){M=M[0]}return M}function z(L){var M=L.el,K="";M=y.kit.dom.parentElementBy(M,document.body,function(N){if(N.tagName.toLowerCase()=="div"&&N.className=="wb_cmR comm_main"){return true}});M=y.sizzle('a[class="user_name"]',M);if(M.length>0){M=M[0]}if(y.isNode(M)){K=M.innerHTML}return K}function C(M,L){var K=z(M);L=L||r("#L{回复}@"+K+":");u[M.data.cid].API.reset();u[M.data.cid].API.insertText(L);u[M.data.cid].API.focus()}function b(K){var L=y.kit.dom.parentElementBy(K.el,document.body,function(M){if(M.tagName.toLowerCase()=="blockquote"){return true}});t(L,K.data,function(){})}function k(K){var L=G.getTrans("blockuser",{onComplete:function(M){if(M.code==="A00006"){q(false,K.data.id);K.el.innerHTML=r("#L{取消禁言}");K.el.setAttribute("action-type","quxiao");K.el.setAttribute("action-data","id="+K.data.id)}else{}}});L.request({appkey:scope.appkey,id:K.data.id||"",action:K.data.action||"add",refer:scope.refer})}function w(K){var L=G.getTrans("blockuser",{onComplete:function(N){if(N.code==="A00006"){q(true,K.data.id);var M=K.el;if(K.el.tagName.toLowerCase()!="a"){var O=y.sizzle('a[action-type="quxiao"]',M.parentNode.parentNode);if(O.length>0){M=O[0]}}if(M.className!="unableIcon"){M.innerHTML=r("#L{禁言}")}M.setAttribute("action-type","jinyan");M.setAttribute("action-data","id="+K.data.id+"&action=add")}else{}}});L.request({appkey:scope.appkey,id:K.data.id||"",action:K.data.action||"del",refer:scope.refer})}function q(L,Q){var N;if(E==null){var P=j.childNodes;for(var M=0,K=P.length;M<K;M++){var O=P[M];if(O.nodeType==1&&O.tagName.toLowerCase()=="div"&&O.className=="wc_list"){E=O}}}if(y.isNode(E)){P=y.sizzle(".wc_list_nod",E);for(M=0,K=P.length;M<K;M++){O=P[M];if(O.nodeType==1&&O.tagName.toLowerCase()=="div"&&O.getAttribute("uid")==Q){O.className="wc_list_nod clearfix"+(L?(O.getAttribute("hide_comment")=="1"?" wc_disableC":""):" wc_disable");O.setAttribute("hide_user",L?"":"1");if(L){N=y.sizzle('a[action-type="quxiao"]',O)}else{N=y.sizzle('a[action-type="jinyan"]',O)}if(N.length>0){N=N[0]}if(L){N.setAttribute("action-type","jinyan");N.setAttribute("action-data","id="+Q+"&action=add");N.innerHTML=r("#L{禁言}")}else{N.setAttribute("action-type","quxiao");N.setAttribute("action-data","id="+Q);N.innerHTML=r("#L{取消禁言}")}}}}}function I(K,M){var L=y.kit.dom.parentElementBy(M,document.body,function(N){if(N.tagName.toLowerCase()=="div"&&N.className.indexOf("wc_list_nod clearfix")!=-1){return true}});if(L&&L.className!="wc_list_nod clearfix wc_disable"){L.className="wc_list_nod clearfix"+(K?"":" wc_disableC")}L.setAttribute("hide_comment",K?"":"1")}function B(K){var L=G.getTrans("blockcomment",{onComplete:function(M){if(M.code==="A00006"){var N=y.kit.dom.parentElementBy(K.el,document.body,function(O){if(O.tagName.toLowerCase()=="div"&&O.className=="wc_list_nod clearfix wc_disable"){return true}});I(true,K.el);K.el.innerHTML=r("#L{屏蔽}");K.el.setAttribute("action-type","pingbi");K.el.setAttribute("action-data","id="+K.data.id+"&action=add")}else{}}});L.request({appkey:scope.appkey,id:K.data.id||"",action:K.data.action||"del",short_url:scope.short_url||"",since_id:scope.since_id||"",refer:scope.refer})}function h(K){var L=G.getTrans("blockcomment",{onComplete:function(M){if(M.code==="A00006"){var N=y.kit.dom.parentElementBy(K.el,document.body,function(O){if(O.tagName.toLowerCase()=="div"&&O.className=="wc_list_nod clearfix wc_disable"){return true}});I(false,K.el);K.el.innerHTML=r("#L{取消屏蔽}");K.el.setAttribute("action-type","huifu");K.el.setAttribute("action-data","id="+K.data.id)}else{}}});L.request({appkey:scope.appkey,id:K.data.id||"",action:K.data.action||"add",short_url:scope.short_url||"",since_id:scope.since_id||"",refer:scope.refer})}return function(N){var M={};j=N;var O=function(){K()};var K=function(){l=y.core.evt.delegatedEvent(N);l.add("reply","click",d);l.add("sendBtn","click",m);l.add("reply_back","click",C);l.add("page","click",b);l.add("jinyan","click",k);l.add("quxiao","click",w);l.add("pingbi","click",h);l.add("huifu","click",B);l.add("load_more","click",y.comp.widget.comment.loadmore)};var L=function(){};O();M.destroy=L;return M}});STK.register("comp.widget.comment.msg",function(d){var p=d.kit.extra.language,i,c=300,q=d.common.trans.comment,b=d.common.editor.getLength,m=d.common.editor.flashContent,e,g=scope.loginKit().uid;var t;var j=p('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{请登录后私信(Ta)。}<a href="#" action-type="login" onclick="return false;">#L{立即登录}</a></div>');var r=p('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{该帐号尚未开通微博，开通后才能私信(Ta)。}<a href="#" action-type="open" onclick="return false;" target="_blank">&gt;#L{立即开通}</a></div>');var x=p('<div class="pub_area clearfix" node-type="outer"><div class="wbavatar">'+(!!!g?'<a href="#" onclick="return false;" action-type="login"><img src="'+scope.icon+'" node-type="pic" /></a>':'<a href="http://weibo.com/u/'+g+'" '+(/\/0\/50\/0\/1/.test(scope.icon)?'onclick="return false;" action-type="open"':'target="_blank"')+'><img src="'+scope.icon+'" node-type="pic" /></a>')+'</div><div class="wb_cmR wbPubbox" node-type="publisher"><div class="wb_counter">#L{还可以输入}<em class="WB_num" node-type="wordNum">300</em>#L{字}</div><div class="WB_textarea_auto" node-type="container"><div class="WB_send_stat" node-type="tips" style="display:none;"><span class="WB_tipB_err"></span><span class="WB_icon_txt">#L{私信(Ta)失败，请重试！}</span></div><textarea class="textarea_inner" node-type="textEl" action-data="###data###"></textarea></div><div class="WB_pubBoxPlus clearfix"><div class="WB_Plus_zone clearfix" node-type="widget"><a href="#" onclick="return false;" node-type="face" class="WB_Aemoticons"><span class="WB_icon"></span><span class="WB_icon_txt">#L{表情}</span></a></div><div class="WB_Plus_btn"><a href="#" onclick="return false;" title="#L{发私信}" class="WB_btn_send_dis #L{WB_cn}" node-type="sendBtn" action-type="sendBtn" action-data="###data###">#L{发私信}</a></div></div></div></div>');var s=p("#L{加载失败}");var a=p("#L{顺便说点什么吧……}");var h=0;var l={};var w={};var o,v;var u=new RegExp(["^",p("#L{回复}"),"@([^:]*):(.*)"].join(""));var f;function z(B){var A=d.common.widget.login({vsrc:"app_cmtbox",appsrc:scope.appsrc});if(typeof B==="function"){d.custEvent.add(A,"login",function(){B()})}A.showLogin()}function n(D){D=D||{};if(D.data){}else{var C=d.fixEvent();D.data=d.queryToJson(C.target.getAttribute("action-data"))}i=l[D.data.uid].editor;i.doms.textEl.focus();if(!scope.loginKit().isLogin){z(function(){location.reload()});return}else{if(scope.$passport!=""){d.comp.widget.comment.login.open();return}}var G=i.getValue();var A=b(G);var F=G.match(u);if(A>c||A===0||(F&&d.trim(F[2])=="")||G==a){m(i.doms.textEl);return}var B={recv_uid:D.data.uid||0,text:G||""};i.setBtnStatus('<em class="WB_loadingMini"></em>'+p("#L{发私信中}"),"WB_btn_sendIng");var E=q.getTrans("message",{onComplete:function(H){if(H.code==="100000"){i.showSuccess(p("#L{发私信成功！}"))}else{i.showError(H.msg||p("#L{发私信失败，请重试！}"))}i.setBtnStatus(p("#L{发私信}"),"WB_btn_send")},onFail:function(H){}});E.request(B);return false}function k(L){var B=L.el;var F=B.parentNode,A,K;var J=F.getAttribute("show"),M="";if(J){F.removeAttribute("show");d.removeNode(d.sizzle("blockquote.commReply",F.parentNode)[0]);if(l&&l[L.data.uid]){l[L.data.uid].desotry&&(l[L.data.uid].desotry());delete l[L.data.uid]}var I=d.sizzle("div[isreal=false]",B.parentNode.parentNode);for(var D=0,E=I.length;D<E;D++){d.removeNode(I[D])}d.comp.widget.comment.resize();if(J==2){return}}F.setAttribute("show",2);var N=d.C("blockquote");var C=d.builder(x.replace(/###data###/g,"uid="+L.data.uid)),H;K=C.list.outer[0];N.className="commReply";if(!scope.loginKit().isLogin){H=d.builder(j);A=H.list.loginOuter[0];N.appendChild(A)}else{if(scope.$passport!=""){H=d.builder(r);A=H.list.loginOuter[0];N.appendChild(A)}}N.appendChild(K);d.insertAfter(N,F);i=d.comp.widget.comment.editor(C.list.publisher[0],{saveword:false});l[L.data.uid]=i.editor;l[L.data.uid].editor=i;y(L,M);d.core.evt.hotKey.add(i.doms.textEl,"ctrl+Enter",n);K.style.borderBottom="none";d.comp.widget.comment.resize();var G=d.core.util.pageSize();d.core.util.scrollTo(B.parentNode.parentNode,{top:parseInt(G.win.height/2)})}function y(B,A){if(scope.message_default_text){A=A||decodeURIComponent("\n"+scope.message_default_text)}l[B.data.uid].API.reset();l[B.data.uid].API.insertText(A);l[B.data.uid].API.focus(0,0)}return function(D){var C={};o=D;var E=function(){A()};var A=function(){t=d.core.evt.delegatedEvent(D);t.add("message","click",k);t.add("sendBtn","click",n)};var B=function(){};E();C.destroy=B;return C}});STK.register("comp.widget.comment.login",function(g){var c=g.kit.extra.language,k=g.common.trans.comment,d="<span></span>";function a(){var m=location.href.split("#")[0];m=m.replace(/&?dpc=\d+/g,"")+"&adminFlag=1";location.href=m}function f(p){if(scope.is_show_message==1){var o=k.getTrans("getmsg",{onComplete:function(q){d=c('<span class="wline">|</span><a href="http://www.weibo.com/messages" target="_blank" class="lgout_link">#L{私信}('+q.data.dm+')</a><span class="wline">|</span><a href="http://www.weibo.com/notesboard" target="_blank" class="lgout_link">#L{未关注人私信}('+q.data.msgbox+")</a>");p.login_info.innerHTML=p.login_info.innerHTML.replace("<span></span>",d)}});o.request({})}if(scope.loginKit().isLogin){var n=k.getTrans("getuserinfo",{onComplete:function(t){var r;if(t.adminFlag){scope.addminFlag=t.addminFlag}t.code=parseInt(t.code);if(t.code===0||t.code===-1){var q=t.nick||"";var s=scope.loginKit().uid;scope.$uid=s;scope.$passport="";if(p.login_info){p.login_info.innerHTML=c('<span class="WB_logo16a">#L{微博}</span><a href="http://weibo.com/u/'+s+'" '+(t.code===-1?'action-type="open" onclick="return false;"':' target="_blank"')+">"+q+"</a>"+d+'<span class="lgHover"><span class="wline">|</span><a href="#" onlick="return false;" class="lgout_link" action-type="logout">#L{退出}</a></span>')}if(p.login_pic&&t.userpic!=null){p.login_pic.innerHTML='<a target="_blank" href="http://weibo.com/u/'+s+'"><img title="'+q+'" alt="'+q+'" src="'+t.userpic+'"></a>'}}if(t.code===-1){scope.$passport=scope.loginKit().uid;p.login_tips&&(p.login_tips.style.display="");r='<a href="http://weibo.com/u/'+s+'" action-type="open" onclick="return false;"><img title="'+q+'" alt="'+q+'" src="//tp1.sinaimg.cn/0/50/0/1"></a>';if(p.login_pic&&r){p.login_pic.innerHTML=r}}else{p.login_tips&&(p.login_tips.style.display="none")}}});n.request({appkey:scope.appkey||"0"})}else{if(p.login_info&&/action-type="login"/.test(p.login_info.innerHTML)==false){p.login_info.innerHTML=c('<span class="WB_logo16a">#L{微博}</span><a href="#" onclick="return false;" action-type="login" class="lg_link">#L{登录}</a><span class="wline">|</span><a href="#" onclick="return false;" action-type="regist" class="rg_link">#L{注册}</a>');var m='<a href="#" action-type="regist" onclick="return false;"><img title="" alt="" src="//tp1.sinaimg.cn/0/50/0/1"></a>';if(p.login_pic&&m){p.login_pic.innerHTML=m}}}}function b(m){window.open("//weibo.com/signup/signup.php?c="+encodeURIComponent(window.location.href)+"&lang=zh-cn","regist")}function j(p){if("WBtopGlobal_loginLayer" in window&&window.WBtopGlobal_loginLayer){window.WBtopGlobal_loginLayer({lang:"zh-cn",loginSuccessUrl:encodeURIComponent(window.location.href),currentTab:"",version:window.$CONFIG&&$CONFIG.version||"20170103"});return}window.App=window.App||{};App.loginBackUrlCallBack=function(){scope.postLogin=1;g.common.widget.log({vsrc:"app_commentbox",step:2});if(p&&typeof p=="function"){p()}else{location.reload()}};var n="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html&vsrc=app_cmtbox&appsrc="+scope.appsrc+"&showlogo=0&rnd="+(new Date().valueOf());if(scope.$spr){n+="&c="+scope.$spr}if(typeof scope.refer!=="undefined"){n+="&refer="+scope.refer}g.common.widget.log({vsrc:"app_commentbox"});var m=window.open(n,"miniblog_login",["toolbar=0,status=0,resizable=1,width=660,height=400,left=",(screen.width-660)/2,",top=",(screen.height-500)/2].join(""));try{m.focus()}catch(o){}}function l(m){window.location.href="//weibo.com/logout.php?backurl="+encodeURIComponent(window.location.href)}function h(n){var o="//weibo.com/signup/full_info.php?appsrc=4uyaHS&backurl=http%3A%2F%2Fwidget.weibo.com%2Fstaticjs%2FloginProxy.html&showlogo=0&diy=&from=zw&c=&refer="+(scope.refer||"http%3A%2F%2F");var m=window.open(o,"miniblog_login",["toolbar=0,status=0,resizable=1,width=950,height=600,left=",(screen.width-660)/2,",top=",(screen.height-660)/2].join(""));try{m.focus()}catch(p){}}function e(){var p=scope.refer||scope.$refer||conf.refer,o=scope.loginKit().uid||"",q=(scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0),m=7;var r="//rs.sinajs.cn/z.gif?uid="+o+"&refer="+p+"&url="+encodeURIComponent(document.referrer)+"&cat="+m+"&login="+(scope.loginKit().isLogin?1:0)+"&rnd="+(+new Date());var n=new Image();n.src=r;n=null}var i={reload:a,getUserInfo:f,regist:b,login:j,logout:l,open:h,log:e};return i});STK.register("comp.widget.comment.admin",function(g){var e=g.kit.extra.language,a=g.common.trans.comment,d=g.comp.widget.comment.login;var c,f,b;return function(k){var j;function l(){c=k;f=g.kit.dom.parseDOM(g.builder(k).list);d.getUserInfo(f);h();d.log()}function h(){b=g.core.evt.delegatedEvent(k);b.add("regist","click",d.regist);b.add("login","click",d.login);b.add("logout","click",d.logout);b.add("open","click",d.open)}function i(){}l();j={destroy:i};return j}});STK.register("comp.widget.comment.loadmore",function(g){var c=g.kit.extra.language,l;var m=c("#L{没有更早的评论了}"),i=c("#L{正在加载}"),j=c("#L{加载失败，请重试}"),k=g.common.trans.comment;var e;function b(o){if(l){if(e==null){e=g.core.dom.prev(l)}g.insertHTML(e,o,"beforeend")}}function f(p){l=p.el;var o={since_id:scope.since_id,adminFlag:scope.adminFlag,appkey:scope.appkey?scope.appkey:0,short_url:scope.short_url,language:scope.language};var q=k.getTrans("loadmore",{onComplete:function(r){if(r.code==="A00006"){b(r.html);g.comp.widget.comment.resize();scope.since_id=r.since_id;a()}else{if(r.code=="A00008"){d()}else{h()}}}});n();q.request(o)}function d(){l.className="WB_noContent";l.innerHTML=m;l.removeAttribute("action-type")}function a(){l.className="WB_loadingLine WB_loadingNow";l.innerHTML=c("<em>#L{更多}</em>")}function n(){l.className="WB_loadingLine";l.innerHTML='<span class="WB_loadingMini"></span><span class="WB_icon_txt">'+i+"</span>"}function h(){l.className="WB_loadingLine";l.innerHTML='<span class="WB_tipS_err"></span><span class="WB_icon_txt">'+j+"</span>"}return f});STK.register("common.xdomain",function(b){var d=window,c=document,a=0;return function(h,g){var f={};if(!(typeof g==="function")){g=function(){}}var e=function(){var i="";if(d.postMessage){if(d.addEventListener){d.addEventListener("message",function(j){g.call(d,j.data)},false)}else{if(d.attachEvent){d.attachEvent("onmessage",function(j){g.call(d,j.data)})}else{throw"[common.xDomain] addEventListener error"}}return function(j){h.postMessage(j,"*")}}else{setInterval(function(){if(d.name!==i){i=d.name;g.call(d,i)}},50);return function(j){h.name=(+new Date)+(a++)+"^"+c.domain+"&"+escape(j)}}};return e()}});STK.register("comp.widget.comment.xdomain",function(b){var a=0;return function(e){var d={setSize:b.common.xdomain(e)};var f=function(){e=e||parent;var g={page:{width:document.body.clientWidth,height:document.body.clientHeight}};g=b.jsonToQuery(g.page);setInterval(function(){if(a<4){d.setSize(g)}a++},200)};d.resize=function(h){if(a<4){setTimeout(function(){d.resize(h)},200);return}var g=h||{page:{width:document.body.clientWidth,height:document.body.clientHeight}};g=b.jsonToQuery(g);d.setSize(g)};var c=function(){};d.destroy=c;f();return d}});STK.register("common.diy.addStyle",function(b){var a=false;if(window.attachEvent){window.attachEvent("onload",function(){a=true})}return function(d){function c(){var e=document.createElement("style");e.type="text/css";if(b.IE){e.styleSheet.cssText=d}else{var f=document.createDocumentFragment();f.appendChild(document.createTextNode(d));e.appendChild(f)}document.getElementsByTagName("head")[0].appendChild(e)}if(!b.IE||a){c()}else{window.attachEvent("onload",function(){a=true;c()})}}});STK.register("comp.widget.comment.style",function(c){var b=c.common.diy.addStyle,a=location.href;var d=function(){var h="",g=/colordiy=(\d+)/.test(a)?RegExp.$1:0;var e=/color=([A-Fa-f\d,]+)/.test(a)?RegExp.$1:"";if(e&&g==1){e=e.split(",");if(e[0]){h+=".weiboComments .wc_box {border-color:#"+e[0]+";}"}if(e[1]){h+="\n .weiboComments{background-color:#"+e[1]+";}"}if(e[2]){h+="\n .weiboComments{color:#"+e[2]+";}"}if(e[3]){h+="\n .weiboComments a{color:#"+e[3]+";}"}if(e[4]){h+="\n .weiboComments .wc_list_nod, .weiboComments .list_title, .weiboComments .wbPubbox, .weiboComments .commReply .pub_area{border-color:#"+e[4]+";}"}if(e[5]){h+="\n .weiboComments .WB_pages .page_btn, .weiboComments .WB_loadingLine{background-color:#"+e[5]+";}"}}var f=/border=(\d+)/.test(a)?RegExp.$1:1;if(f==0){h+="\n.weiboComments .wc_box{border:none}"}h&&b(h)};return function(e){d()}});STK.register("comp.widget.comment.init",function(j){var d=j.kit.extra.language,k=j.common.editor.getLength,c=j.common.editor.flashContent,n=j.comp.widget.comment,l,m=j.common.trans.comment,f=140;var b;var g;var a;var e=d("#L{顺便说点什么吧……}");function i(p){var o=j.common.widget.login({vsrc:"app_cmtbox",appsrc:scope.appsrc});if(typeof p==="function"){j.custEvent.add(o,"login",function(){p()})}o.showLogin()}var h=function(r,u){j.stopEvent(r);var s=a.getValue();var o=k(s);if(!scope.loginKit().isLogin){j.comp.widget.comment.login.login();return}else{if(scope.$passport!=""){j.comp.widget.comment.login.open();return}}a.doms.textEl.focus();if(o>f||o===0||s==e){c(a.doms.textEl);return}var p={ralateuid:scope.ralateuid||"",appkey:scope.appkey||0,refer:scope.refer||"",shorturl:scope.short_url||"",longurl:scope.long_url||"",content:encodeURIComponent(s||""),issync:a.isSendWB(),language:scope.language||"zh_cn"};a.setBtnStatus('<em class="WB_loadingMini"></em>'+d("#L{评论中}"),"WB_btn_commentIng"+d(" #L{WB_cn}"));var q=m.getTrans("publisher",{onComplete:function(v){if(v.code==="A00006"){a.showSuccess();var w=j.kit.dom.firstChild(b.comment_list);var t=j.core.dom.next(w);if(t.className=="wc_list no_comments"){t.className="wc_list";t.innerHTML=v.html}else{j.insertHTML(t,v.html,"afterbegin")}w.innerHTML=(w.innerHTML.replace(/\D/g,"")*1+1)+d("#L{条评论}");b.wordNum.innerHTML="140";b.textEl.value="";j.core.util.storage.del("publish_word");j.comp.widget.comment.resize()}else{a.showError(v.msg)}setTimeout(function(){u&&u()},3000)}});q.request(p);return false};return function(s){var r={};var u=function(){n.style();t();o();g=n.xdomain(window.parent||window.self);p();v()};var t=function(){b=j.builder(s).list;b=j.kit.dom.parseDOM(b)};var p=function(){j.common.channel.page.register("resize",g.setSize)};var v=function(){var x=j.E("feedList");if(x){return}var w=j.pageSize();w.page.height=j.core.dom.getSize(s).height;var y=w.page;g.resize(y)};var o=function(){a=new n.editor(b.publisher,{saveword:true});b.sendWB.checked=true;j.addEvent(a.doms.sendBtn,"click",h);j.core.evt.hotKey.add(a.doms.textEl,"ctrl+Enter",h);n.reply(b.comment_list);n.msg(b.comment_list);l=n.admin(s)};var q=function(){j.removeEvent(a.doms.sendBtn,"click",h);j.core.evt.hotKey.remove(a.doms.textEl,"ctrl+Enter",h);l.destroy();delete a.doms;a=null};u();r.destroy=q;return r}});STK.pageletM.register("pl.widget.comment",function(c){try{var b=c.E("pl_widget_comment");var a=c.comp.widget.comment.init(b);return a}catch(d){}});STK.pageletM.start();