window.___jsl=window.___jsl||{};
(window.___jsl.ci=window.___jsl.ci||[]).push({container:{relayPath:"/developerworks/community/connections/opensocial/gadgets/files/container/rpc_relay.html",enableRpcArbitration:!0},rpc:{passReferrer:"c2p:query",commSwf:"/developerworks/community/connections/opensocial/xpc.swf",useLegacyProtocol:!1,parentRelayUrl:"/container/rpc_relay.html",rpcDelay:1},"core.io":{unparseableCruft:"throw 1; \x3c 'invalid javascript' \x3e",nonceUrl:"//%host%/developerworks/community/connections/opensocial/gadgets/nonceRequest",proxyUrl:"//www.ibm.com/developerworks/community/connections/opensocial/gadgets/proxy%filename%?container\x3d%container%\x26refresh\x3d%refresh%\x26url\x3d%url%\x26stream\x3d%stream%%authz%%rewriteMime%",
jsonProxyUrl:"//%host%/developerworks/community/connections/opensocial/gadgets/makeRequest",appendTokenAlways:!0},"osapi.services":{"gadgets.rpc":["container.listMethods"],"//%host%/developerworks/community/connections/opensocial/rpc":"gadgets.supportedFields gadgets.cajole http.head http.post people.update http.delete activitystreams.delete gadgets.metadata activitystreams.supportedFields gadgets.proxySupportedFields ublog.delete activitystreams.create gadgets.proxy cache.invalidate people.supportedFields http.put gadgets.cajaSupportedFields activitystreams.get gadgets.js http.get gadgets.token ublog.create activitystreams.update system.listMethods gadgets.tokenSupportedFields gadgets.jsSupportedFields people.get ublog.get".split(" ")},
osapi:{endPoints:["//%host%/developerworks/community/connections/opensocial/rpc"]},opensocial:{invalidatePath:"http://%host%/developerworks/community/connections/opensocial/rpc",domain:"shindig",path:"http://%host%/developerworks/community/connections/opensocial/rpc",supportedFields:{activityEntry:"actor content generator icon id object published provider target title updated url verb".split(" "),person:["id",{name:["familyName","givenName","unstructured"]},"thumbnailUrl","profileUrl"],activity:"appId body bodyId externalId id mediaItems postedTime priority streamFaviconUrl streamSourceUrl streamTitle streamUrl templateParams title url userId".split(" ")},
enableCaja:!1},"shindig-container":{serverBase:"/developerworks/community/connections/opensocial/gadgets/"},views:{"default":{urlTemplate:"http://localhost/developerworks/community/connections/opensocial/gadgets/default?{var}",isOnlyVisible:!1,aliases:["home","profile","canvas"]},canvas:{urlTemplate:"http://localhost/developerworks/community/connections/opensocial/gadgets/canvas?{var}",isOnlyVisible:!0,aliases:["FULL_PAGE"]},profile:{urlTemplate:"http://localhost/developerworks/community/connections/opensocial/gadgets/profile?{var}",
isOnlyVisible:!1,aliases:["DASHBOARD","default"]}}});window.___jsl=window.___jsl||{};window['___jsl']['f'] = ['actions','auth-refresh','com.ibm.connections.ee','com.ibm.connections.sharedialog','container','container.nongadget','container.site','container.site.gadget','container.site.url','container.util','core','core.config','core.config.base','core.io','core.json','core.legacy','core.log','core.prefs','core.util','core.util.base','core.util.dom','core.util.event','core.util.onload','core.util.string','core.util.urlparams','cre.config','cre.constants','cre.constants.services','cre.endpoint','cre.globals','cre.iruntime','cre.iwidget','cre.iwidget.event','cre.iwidget.iscopeService','cre.iwidget.itemset','cre.localehelper','cre.messages.en','cre.oah','cre.osgadget','cre.promise','cre.resourcemanager','cre.service.event','cre.service.people','cre.service.people_1.1','cre.service.proxy','cre.service.uri','cre.servicemanager','cre.util','cre.util.array','cre.util.function','cre.util.json','cre.util.json.extended','cre.util.loop','cre.util.object','cre.util.object.extended','cre.util.string','cre.util.token','cre.wire','cre.xhr','domnode','dynamic-height','dynamic-height.height','dynamic-size.util','embedded-experiences','enabler.constants.iwidget','gadgets.json.ext','globals','ibm.connections.ee','ibm.connections.sharedialog','locked-domain','open-views','open-views.common','open-views.ee','open-views.gadget','open-views.results','open-views.url','opensocial','opensocial-base','opensocial-data-context','opensocial-jsonrpc','opensocial-reference','org.openajax.hub-2.0.7','osapi','osapi.base','pubsub-2','rpc','security-token','selection','shared-script-frame','shindig-container','shindig.auth','shindig.sha1','shindig.uri','shindig.uri.ext','taming','views','xmlutil'];gadgets=window.gadgets||{};shindig=window.shindig||{};osapi=window.osapi||{};var DOM_ELEMENT_NODE=1,DOM_ATTRIBUTE_NODE=2,DOM_TEXT_NODE=3,DOM_CDATA_SECTION_NODE=4,DOM_ENTITY_REFERENCE_NODE=5,DOM_ENTITY_NODE=6,DOM_PROCESSING_INSTRUCTION_NODE=7,DOM_COMMENT_NODE=8,DOM_DOCUMENT_NODE=9,DOM_DOCUMENT_TYPE_NODE=10,DOM_DOCUMENT_FRAGMENT_NODE=11,DOM_NOTATION_NODE=12;var safeJSON=window.safeJSON,tamings___=window.tamings___||[],bridge___,caja___=window.caja___,___=window.___;window.gadgets.config||(gadgets.config=function(){function l(a,b){for(var e in b)b.hasOwnProperty(e)&&("object"===typeof a[e]&&"object"===typeof b[e]?l(a[e],b[e]):a[e]=b[e])}function q(a){var b="";if(a.nodeType==DOM_TEXT_NODE||a.nodeType==DOM_CDATA_SECTION_NODE)b=a.nodeValue;else if(a.innerText)b=a.innerText;else if(a.innerHTML)b=a.innerHTML;else if(a.firstChild){b=[];for(a=a.firstChild;a;a=a.nextSibling)b.push(q(a));b=b.join("")}return b}function r(a){var b=(f["core.io"]||{}).jsPath||null,e=[],d=
0,c=document.scripts||document.getElementsByTagName("script");if(c&&0!=c.length){for(var h=0;h<c.length;++h){var g=c[h].src,k=null!=b&&g&&g.indexOf(b)||-1;-1!=k&&/.*[.]js.*[?&]c=[01](#|&|$).*/.test(g.substring(k+b.length))&&(e[d++]=c[h])}e.length||(b=c[c.length-1],b.src&&(e[0]=b))}if(e.length)for(b=0;b<e.length;b++){d=q(e[b]);c=void 0;try{c=(new Function("return ("+d+"\n)"))()}catch(n){}if("object"===typeof c)d=c;else{try{c=(new Function("return ({"+d+"\n})"))()}catch(p){}d="object"===typeof c?c:
{}}m.f&&1==m.f.length&&!d[m.f[0]]&&(c={},c[m.f[0]]=d,d=c);l(a,d);(d=window.___cfg)&&l(a,d)}}function p(a){for(var b in k)if(k.hasOwnProperty(b))for(var e=k[b],d=0,c=e.length;d<c;++d)a(b,e[d])}var m,k={},f={},n=!1;return{register:function(a,b,e,d){var c=k[a];c||(c=[],k[a]=c);c.push({validators:b||{},callback:e,callOnUpdate:d});n&&e&&e(f)},get:function(a){return a?f[a]||{}:f},init:function(a,b){m=window.___jsl||{};l(f,a);r(f);l(f,window.___config||{});p(function(a,d){var c=f[a];if(c&&!b){var h=d.validators,
g;for(g in h)if(h.hasOwnProperty(g)&&!h[g](c[g]))throw Error('Invalid config value "'+c[g]+'" for parameter "'+g+'" in component "'+a+'"');}d.callback&&d.callback(f)});n=!0},update:function(a,b){var e=[];p(function(c,d){(a.hasOwnProperty(c)||b&&f&&f[c])&&d.callback&&d.callOnUpdate&&e.push(d.callback)});f=b?{}:f||{};l(f,a);for(var d=0,c=e.length;d<c;++d)e[d](f)},clear:function(){gadgets.warn("This method is for testing.");m=void 0;f={};n=!1}}}());gadgets.log=function(){function d(a,c){"undefined"===typeof b&&(b=window.console?window.console:window.opera?window.opera.postError:null);!(a<e)&&b&&(2===a&&b.warn?b.warn(c):3===a&&b.error?b.error(c):b.log&&b.log(c))}var c=function(a){d(1,a)};gadgets.warn=function(a){d(2,a)};gadgets.error=function(a){d(3,a)};gadgets.setLogLevel=function(a){e=a};c.INFO=1;c.WARNING=2;c.NONE=4;var e=1,b;return c}();gadgets.util=gadgets.util||{};
(function(){var e=null;gadgets.util.getUrlParameters=function(a){var g="undefined"===typeof a;if(null!==e&&g)return e;var f={};a=a||document.location.href;var d=a.indexOf("?"),b=a.indexOf("#");a=(-1===b?a.substr(d+1):[a.substr(d+1,b-d-1),"\x26",a.substr(b+1)].join("")).split("\x26");for(var d=window.decodeURIComponent?decodeURIComponent:unescape,b=0,h=a.length;b<h;++b){var c=a[b].indexOf("\x3d");if(-1!==c){var k=a[b].substring(0,c),c=a[b].substring(c+1),c=c.replace(/\+/g," ");try{f[k]=d(c)}catch(l){}}}g&&
(e=f);return f}})();gadgets.util.getUrlParameters();(function(){gadgets.config.EnumValidator=function(a){var c=[];if(1<arguments.length)for(var b=0,d;d=arguments[b];++b)c.push(d);else c=a;return function(a){for(var b=0;c[b];++b)if(a===c[b])return!0;return!1}};gadgets.config.RegExValidator=function(a){return function(c){return a.test(c)}};gadgets.config.ExistsValidator=function(a){return"undefined"!==typeof a};gadgets.config.NonEmptyStringValidator=function(a){return"string"===typeof a&&0<a.length};gadgets.config.BooleanValidator=function(a){return"boolean"===
typeof a};gadgets.config.LikeValidator=function(a){return function(c){for(var b in a)if(a.hasOwnProperty(b)&&!(0,a[b])(c[b]))return!1;return!0}}})();gadgets.util=gadgets.util||{};gadgets.util.makeClosure=function(e,c,a){for(var d=[],b=2,f=arguments.length;b<f;++b)d.push(arguments[b]);return function(){for(var a=d.slice(),b=0,f=arguments.length;b<f;++b)a.push(arguments[b]);return c.apply(e,a)}};gadgets.util.makeEnum=function(e){var c,a,d={};for(c=0;a=e[c];++c)d[a]=a;return d};gadgets.util.shouldPollXhrReadyStateChange=function(){return document.all&&!document.querySelector?!0:!1};gadgets.util=gadgets.util||{};
(function(){gadgets.util.createElement=function(a){var b;if(!document.body||document.body.namespaceURI)try{b=document.createElementNS("http://www.w3.org/1999/xhtml",a)}catch(d){}return b||document.createElement(a)};gadgets.util.createIframeElement=function(a){var b=gadgets.util.createElement("iframe");try{var d,c=["\x3c","iframe"],g=a||{},e;for(e in g)g.hasOwnProperty(e)&&(c.push(" "),c.push(e),c.push('\x3d"'),c.push(gadgets.util.escapeString(g[e])),c.push('"'));c.push("\x3e\x3c/");c.push("iframe");
c.push("\x3e");d=c.join("");var f=gadgets.util.createElement(d);if(f&&(!b||f.tagName==b.tagName&&f.namespaceURI==b.namespaceURI))b=f}catch(k){}d=b;a=a||{};for(var h in a)a.hasOwnProperty(h)&&(d[h]=a[h]);return b};gadgets.util.getBodyElement=function(){if(document.body)return document.body;try{var a=document.getElementsByTagNameNS("http://www.w3.org/1999/xhtml","body");if(a&&1==a.length)return a[0]}catch(b){}return document.documentElement||document}})();gadgets.util=gadgets.util||{};gadgets.util.attachBrowserEvent=function(a,b,c,d){"undefined"!=typeof a.addEventListener?a.addEventListener(b,c,d):"undefined"!=typeof a.attachEvent?a.attachEvent("on"+b,c):gadgets.warn("cannot attachBrowserEvent: "+b)};gadgets.util.removeBrowserEvent=function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent?a.detachEvent("on"+b,c):gadgets.warn("cannot removeBrowserEvent: "+b)};gadgets.util=gadgets.util||{};
(function(){var b=[];gadgets.util.registerOnLoadHandler=function(c){b.push(c)};gadgets.util.runOnLoadHandlers=function(){gadgets.util.registerOnLoadHandler=function(a){a()};if(b){for(var c=0,a=b.length;c<a;++c)try{b[c]()}catch(h){gadgets.warn("Could not fire onloadhandler "+h.message)}b=void 0}};(function(){gadgets.util.attachBrowserEvent(document,"DOMContentLoaded",gadgets.util.runOnLoadHandlers,!1);var c=window.onload;window.onload=function(){c&&c();gadgets.util.runOnLoadHandlers()};var a="";window&&
(window.location&&window.location.href)&&(a=gadgets.util.getUrlParameters(window.location.href).libs);if(a=/(?:js\/)([^&|\.]+)/g.exec(a))for(var a=decodeURIComponent(a[1]),b=document.getElementsByTagName("script")||[],d=0;d<b.length;d++){var e=b[d],f=e.src;if(f&&a&&-1!==f.indexOf(a)){var g=e.onload;e.onload=function(){g&&g();gadgets.util.runOnLoadHandlers()}}}})()})();gadgets.util=gadgets.util||{};
(function(){function f(a,d){return String.fromCharCode(d)}var g={"0":!1,10:!0,13:!0,34:!0,39:!0,60:!0,62:!0,92:!0,8232:!0,8233:!0,65282:!0,65287:!0,65308:!0,65310:!0,65340:!0};gadgets.util.escape=function(a,d){if(a){if("string"===typeof a)return gadgets.util.escapeString(a);if("array"===typeof a)for(var b=0,c=a.length;b<c;++b)a[b]=gadgets.util.escape(a[b]);else if("object"===typeof a&&d){b={};for(c in a)a.hasOwnProperty(c)&&(b[gadgets.util.escapeString(c)]=gadgets.util.escape(a[c],!0));return b}}return a};
gadgets.util.escapeString=function(a){if(!a)return a;for(var d=[],b,c,e=0,f=a.length;e<f;++e)b=a.charCodeAt(e),c=g[b],!0===c?d.push("\x26#",b,";"):!1!==c&&d.push(a.charAt(e));return d.join("")};gadgets.util.unescapeString=function(a){return!a?a:a.replace(/&#([0-9]+);/g,f)}})();gadgets.util=gadgets.util||{};
(function(){function f(a){a=(a=a["core.io"])&&a.jsPath;for(var b=document.getElementsByTagName("script"),c=0;a&&c<b.length;c++){var d=b[c].src;if(d&&-1<d.indexOf(a))return e="1"==gadgets.util.getUrlParameters(d).debug}e=!1}function g(a){b=a["core.util"]||{}}var b={},h={},e;gadgets.config&&(gadgets.config.register("core.util",null,g),gadgets.config.register("core.io",void 0,f,f));gadgets.util.getFeatureParameters=function(a){return"undefined"===typeof b[a]?null:b[a]};gadgets.util.hasFeature=function(a){return"undefined"!==
typeof b[a]};gadgets.util.getServices=function(){return h};gadgets.util.isDebug=function(){return e}})();"undefined"===typeof shindig.uri&&(shindig.uri=function(){var E=/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/;return function(k){function r(a){if(null===a.match(E))throw"Malformed URL: "+a;l=RegExp.$1;m=RegExp.$2;p=RegExp.$3;g=RegExp.$4;h=RegExp.$5}function s(a){for(var b=[],d=0,F=a.length;d<F;++d){var n=a[d][0],c=a[d][1];"undefined"!=typeof c&&b.push(t(n)+(null!==c?"\x3d"+t(c):""))}return b.join("\x26")}function u(){c&&(g=s(c),c=null);return g}function v(){f&&(h=s(f),f=null);
return h}function w(a){c=c||q(g);return x(c,a)}function y(a){f=f||q(h);return x(f,a)}function z(a,b){c=A(c||q(g),a,b);return e}function B(a,b){f=A(f||q(h),a,b);return e}function C(){return[l,""!==l?":":"",""!==m?"//":"",m].join("")}function q(a){var b=[];if(""===a)return b;a=a.split("\x26");for(var d=0,c=a.length;d<c;++d){var n=a[d].split("\x3d"),f=n.shift(),e=null;0<n.length&&(e=n.join("").replace(/\+/g," "));b.push([f,null!=e?G(e):null])}return b}function x(a,b){for(var d=0,c=a.length;d<c;++d)if(a[d][0]==
b)return a[d][1]}function A(a,b,d){var c=b;"string"===typeof b&&(c={},c[b]=d);for(var e in c){b=!1;d=0;for(var f=a.length;!b&&d<f;++d)a[d][0]==e&&(a[d][1]=c[e],b=!0);b||a.push([e,c[e]])}return a}function D(a,b){a=a||"";a[0]===b&&(a=a.substr(b.length));return a}var l="",m="",p="",g="",c=null,h="",f=null,G=window.decodeURIComponent?decodeURIComponent:unescape,t=window.encodeURIComponent?encodeURIComponent:escape,e=null;"object"===typeof k&&"function"===typeof k.toString?r(k.toString()):k&&r(k);return e=
{getSchema:function(){return l},getAuthority:function(){return m},getOrigin:C,getPath:function(){return p},getQuery:u,getFragment:v,getQP:w,getFP:y,setSchema:function(a){l=a;return e},setAuthority:function(a){m=a;return e},setPath:function(a){"undefined"!==typeof a&&null!=a&&(p=("/"===a.charAt(0)?"":"/")+a);return e},setQuery:function(a){c=null;g=D(a,"?");return e},setFragment:function(a){f=null;h=D(a,"#");return e},setQP:z,setFP:B,setExistingP:function(a,b){"undefined"!=typeof w(a,b)&&z(a,b);"undefined"!=
typeof y(a,b)&&B(a,b);return e},removePrefix:function(a){return 0==a.indexOf("http://")?a.substr(7):0==a.indexOf("https://")?a.substr(8):0==a.indexOf("//")?a.substr(2):a},toString:function(){var a=u(),b=v();return[C(),p,""!==a?"?":"",a,""!==b?"#":"",b].join("")}}}}());window.JSON&&(window.JSON.parse&&window.JSON.stringify)&&(gadgets.json=function(){function d(a,b){return this[a]}var e=/___$/;return{parse:function(a){try{return window.JSON.parse(a)}catch(b){return!1}},stringify:function(a){function b(a){return c.call(this,a,d)}var c=window.JSON.stringify,f=Array.prototype.toJSON&&'"[{\\"x\\": 1}]"'===c([{x:1}])?b:c;try{return f(a,function(a,b){return!e.test(a)?b:void 0})}catch(g){return null}}}}());if(!window.JSON||!window.JSON.parse||!window.JSON.stringify)gadgets.json=function(){function c(a){return 10>a?"0"+a:a}function e(a){var d,b,c;d=/[\"\\\x00-\x1f\x7f-\x9f]/g;switch(typeof a){case "string":return d.test(a)?'"'+a.replace(d,function(a){var b=f[a];if(b)return b;b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)})+'"':'"'+a+'"';case "number":return isFinite(a)?String(a):"null";case "boolean":case "null":return String(a);case "object":if(!a)return"null";d=[];
if("number"===typeof a.length&&!a.propertyIsEnumerable("length")){c=a.length;for(b=0;b<c;b+=1)d.push(e(a[b])||"null");return"["+d.join(",")+"]"}for(b in a)!/___$/.test(b)&&a.hasOwnProperty(b)&&"string"===typeof b&&(c=e(a[b]))&&d.push(e(b)+":"+c);return"{"+d.join(",")+"}"}return""}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",c(this.getUTCMonth()+1),"-",c(this.getUTCDate()),"T",c(this.getUTCHours()),":",c(this.getUTCMinutes()),":",c(this.getUTCSeconds()),"Z"].join("")};var f={"\b":"\\b",
"\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:e,parse:function(a){return/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?eval("("+a+")"):!1}}}();gadgets.json.flatten=function(a){var c={};if(null===a||"undefined"==typeof a)return c;for(var d in a)if(a.hasOwnProperty(d)){var b=a[d];null===b||"undefined"==typeof b||(c[d]="string"===typeof b?b:gadgets.json.stringify(b))}return c};shindig.Auth=function(){function g(a){for(var b=c.split("\x26"),f=0;f<b.length;f++){var d=b[f].split("\x3d");if(2===d.length){var e=d[0],d=d[1];"$"===d&&(d=encodeURIComponent(a[e]),b[f]=e+"\x3d"+d)}}c=b.join("\x26")}var c=null,e=null;gadgets.config.register("shindig.auth",null,function(a){var b=gadgets.util.getUrlParameters();a=a["shindig.auth"]||{};a.authToken?c=a.authToken:b.st&&(c=b.st);null!==c&&g(b);a.trustedJson&&(e=eval("("+a.trustedJson+")"))});return{getSecurityToken:function(){return c},
updateSecurityToken:function(a){c=a},getTrustedData:function(){return e}}};shindig&&!shindig.auth&&(shindig.auth=new shindig.Auth);gadgets.rpctx=gadgets.rpctx||{};
gadgets.rpctx.wpm||(gadgets.rpctx.wpm=function(){function g(a,b,c){"undefined"!=typeof window.addEventListener?window.addEventListener(a,b,c):"undefined"!=typeof window.attachEvent&&window.attachEvent("on"+a,b)}function h(a){var b=gadgets.json.parse(a.data);if(b&&b.f){var c=gadgets.rpc.getTargetOrigin(b.f);(!e||!("undefined"!==typeof a.origin?a.origin!==c:a.domain!==/^.+:\/\/([^:]+).*/.exec(c)[1]))&&f(b,a.origin)}}var f,d,e=!0;return{getCode:function(){return"wpm"},isParentVerifiable:function(){return!0},
init:function(a,b){gadgets.config.register("rpc",null,function(a){if("true"===String((a?a.rpc:{}).disableForceSecure))e=!1});f=a;d=b;g("message",h,!1);d("..",!0);return!0},setup:function(a,b){d(a,!0);return!0},call:function(a,b,c){var d=gadgets.rpc.getTargetOrigin(a),e=gadgets.rpc._getTargetWin(a);d?window.setTimeout(function(){e.postMessage(gadgets.json.stringify(c),d)},0):gadgets.error("No relay set (used as window.postMessage targetOrigin), cannot send cross-domain message");return!0}}}());gadgets.rpctx=gadgets.rpctx||{};
gadgets.rpctx.flash||(gadgets.rpctx.flash=function(){function k(a,b){p[b]=p[b]||function(){a.apply({},arguments)};return q+"."+b}function r(){if(null===c&&document.body&&l){var a=l+"?cb\x3d"+Math.random()+"\x26origin\x3d"+I+"\x26jsl\x3d1",b=document.createElement("div");b.style.height="1px";b.style.width="1px";a='\x3cobject height\x3d"1" width\x3d"1" id\x3d"'+J+'" type\x3d"application/x-shockwave-flash"\x3e\x3cparam name\x3d"allowScriptAccess" value\x3d"always"\x3e\x3c/param\x3e\x3cparam name\x3d"movie" value\x3d"'+a+
'"\x3e\x3c/param\x3e\x3cembed type\x3d"application/x-shockwave-flash" allowScriptAccess\x3d"always" src\x3d"'+a+'" height\x3d"1" width\x3d"1"\x3e\x3c/embed\x3e\x3c/object\x3e';document.body.appendChild(b);b.innerHTML=a;c=b.firstChild}++s;null!==e&&(null!==c||s>=K)?window.clearTimeout(e):e=window.setTimeout(r,t)}function u(){m[".."]||(v(".."),w++,w>=L&&null!==g?(window.clearTimeout(g),g=null):g=window.setTimeout(u,x))}function n(){if(null!==c&&c.setup){for(;0<h.length;){var a=h.shift(),b=a.targetId,
a=a.token;if(void 0===a||null===a||""===a)a=y;c.setup(a,".."===b?gadgets.rpc.RPC_ID:b,".."===b?"INNER":"OUTER")}null!==f&&(window.clearTimeout(f),f=null)}else 0<h.length&&z<M&&(z++,null!==f&&(window.clearTimeout(f),f=null),f=window.setTimeout(n,N))}function A(){n();null!==e&&window.clearTimeout(e);e=null}function B(){!m[".."]&&null===g&&(g=window.setTimeout(u,x))}function C(a,b,e){if(!c||null===c)return!0;b=gadgets.rpc.getTargetOrigin(a);var d=gadgets.rpc.getAuthToken(a);if(void 0===d||null===d||
""===d)d=y;a="sendMessage_"+(".."===a?gadgets.rpc.RPC_ID:a)+"_"+d+"_"+(".."===a?"INNER":"OUTER");d=c[a];if(!d||null===d)return"undefined"!==typeof console&&(null!==console&&"undefined"!==typeof console.log&&null!==console.log)&&console.log("There isn't message handler was found for the target message and then returning false, handleKey \x3d "+a),!1;d.call(c,gadgets.json.stringify(e),b);return!0}function D(a,b,c){var d=gadgets.json.parse(a);(a=d[E])?(F(a,!0),m[a]=!0,".."!==a&&v(a,!0)):window.setTimeout(function(){G(d,
b)},0)}function v(a,b){var c=gadgets.rpc.RPC_ID,d={};d[E]=b?"..":c;d[O]=c;C(a,c,d)}var J="___xpcswf",l=null,H=!1,G=null,F=null,c=null,t=100,K=200,h=[],f=null,N=500,e=null,s=0,E="_scr",O="_pnt",x=100,L=50,w=0,g=null,m={},I=window.location.protocol+"//"+window.location.host,q,y="NOKEY",z=0,M=30,p=function(){window.___jsl=window.___jsl||{};var a=window.___jsl._fm={};q="___jsl._fm";return a}();gadgets.config.register("rpc",null,function(a){H&&(l=a.rpc.commSwf||"//xpc.googleusercontent.com/gadgets/xpc.swf")});
k(A,"ready");k(B,"setupDone");k(D,"receiveMessage");return{getCode:function(){return"flash"},isParentVerifiable:function(){return!0},init:function(a,b){G=a;F=b;return H=!0},setup:function(a,b){h.push({token:b,targetId:a});null===c&&null===e&&(e=window.setTimeout(r,t));n();return!0},call:C,_receiveMessage:D,_ready:A,_setupDone:B}}());gadgets.rpctx=gadgets.rpctx||{};
gadgets.rpctx.frameElement||(gadgets.rpctx.frameElement=function(){function k(a,l,e){try{if(".."!==l){var d=window.frameElement;if("function"===typeof d[b])return"function"!==typeof d[b][c]&&(d[b][c]=function(a){f(gadgets.json.parse(a))}),d[b](gadgets.json.stringify(e)),!0}else{var g=document.getElementById(a);if("function"===typeof g[b]&&"function"===typeof g[b][c])return g[b][c](gadgets.json.stringify(e)),!0}}catch(h){}return!1}var b="__g2c_rpc",c="__c2g_rpc",f,h;return{getCode:function(){return"fe"},
isParentVerifiable:function(){return!1},init:function(a,b){f=a;h=b;return!0},setup:function(a,c){if(".."!==a)try{document.getElementById(a)[b]=function(a){f(gadgets.json.parse(a))}}catch(e){return!1}".."===a&&(h("..",!0),gadgets.util.registerOnLoadHandler(function(){window.setTimeout(function(){gadgets.rpc.call(a,gadgets.rpc.ACK)},500)}));return!0},call:function(a,b,c){return k(a,b,c)}}}());gadgets.rpctx=gadgets.rpctx||{};
gadgets.rpctx.nix||(gadgets.rpctx.nix=function(){function f(){var a=d[".."];if(!a)if(++g>h)gadgets.warn("Nix transport setup failed, falling back..."),e("..",!1);else{if(!a&&(window.opener&&"GetAuthToken"in window.opener)&&(a=window.opener,a.GetAuthToken()==gadgets.rpc.getAuthToken(".."))){var b=gadgets.rpc.getAuthToken("..");a.CreateChannel(window[c]("..",b),b);d[".."]=a;window.opener=null;e("..",!0);return}window.setTimeout(function(){f()},k)}}var c="GRPC____NIXVBS_get_wrapper",h=10,k=500,d={},
e,g=0;return{getCode:function(){return"nix"},isParentVerifiable:function(){return!1},init:function(a,b){e=b;if("unknown"!==typeof window[c]){window.GRPC____NIXVBS_handle_message=function(b){window.setTimeout(function(){a(gadgets.json.parse(b))},0)};window.GRPC____NIXVBS_create_channel=function(a,b,c){gadgets.rpc.getAuthToken(a)===c&&(d[a]=b,e(a,!0))};var l="Class GRPC____NIXVBS_wrapper\n Private m_Intended\nPrivate m_Auth\nPublic Sub SetIntendedName(name)\n If isEmpty(m_Intended) Then\nm_Intended \x3d name\nEnd If\nEnd Sub\nPublic Sub SetAuth(auth)\n If isEmpty(m_Auth) Then\nm_Auth \x3d auth\nEnd If\nEnd Sub\nPublic Sub SendMessage(data)\n GRPC____NIXVBS_handle_message(data)\nEnd Sub\nPublic Function GetAuthToken()\n GetAuthToken \x3d m_Auth\nEnd Function\nPublic Sub CreateChannel(channel, auth)\n Call GRPC____NIXVBS_create_channel(m_Intended, channel, auth)\nEnd Sub\nEnd Class\nFunction "+
c+"(name, auth)\nDim wrap\nSet wrap \x3d New GRPC____NIXVBS_wrapper\nwrap.SetIntendedName name\nwrap.SetAuth auth\nSet "+c+" \x3d wrap\nEnd Function";try{window.execScript(l,"vbscript")}catch(m){return!1}}return!0},setup:function(a,b){if(".."===a)return f(),!0;try{var d=document.getElementById(a),e=window[c](a,b);d.contentWindow.opener=e}catch(g){return!1}return!0},call:function(a,b,c){try{d[a]&&d[a].SendMessage(gadgets.json.stringify(c))}catch(e){return!1}return!0}}}());gadgets.rpctx=gadgets.rpctx||{};
gadgets.rpctx.rmr||(gadgets.rpctx.rmr=function(){function m(a,b,c,e){var d=function(){document.body.appendChild(a);a.src="about:blank";e&&(a.onload=function(){f(e)});a.src=b+"#"+c};document.body?d():gadgets.util.registerOnLoadHandler(function(){d()})}function n(a){var b=null;g[a].searchCounter++;try{var c=gadgets.rpc._getTargetWin(a),b=".."===a?c.frames["rmrtransport-"+gadgets.rpc.RPC_ID]:c.frames["rmrtransport-.."]}catch(e){}c=!1;b&&(c=t(a,b));!c&&!(g[a].searchCounter>u)&&window.setTimeout(function(){n(a)},
v)}function p(a,b,c,e){var d=null;if(d=".."!==c?g[".."]:g[a]){b!==gadgets.rpc.ACK&&d.queue.push(e);if(d.waiting||0===d.queue.length&&!(b===gadgets.rpc.ACK&&e&&!0===e.ackAlone))return!0;0<d.queue.length&&(d.waiting=!0);a=d.relayUri+"#"+l(a);try{d.frame.contentWindow.location=a;var h=10==d.width?20:10;d.frame.style.width=h+"px";d.width=h}catch(q){return!1}}return!0}function l(a){a=g[a];var b={id:a.sendId};if(a){b.d=Array.prototype.slice.call(a.queue,0);var c={s:gadgets.rpc.ACK,id:a.recvId};a.originVerified||
(c.sendToken=a.verifySendToken);a.verifyRecvToken&&(c.recvToken=a.verifyRecvToken);b.d.push(c)}return gadgets.json.stringify(b)}function f(a){for(var b=g[a],c=b.receiveWindow.location.hash.substring(1),e=gadgets.json.parse(decodeURIComponent(c))||{},c=e.d||[],d=!1,h=!1,q=0,e=b.recvId-e.id,f=0;f<c.length;++f){var k=c[f];if(k.s===gadgets.rpc.ACK){r(a,!0);b.verifyRecvToken=k.sendToken;!b.originVerified&&(k.recvToken&&String(k.recvToken)==String(b.verifySendToken))&&(b.originVerified=!0);b.waiting&&(h=
!0);b.waiting=!1;var l=Math.max(0,k.id-b.sendId);b.queue.splice(0,l);b.sendId=Math.max(b.sendId,k.id||0)}else d=!0,++q<=e||(++b.recvId,s(k,b.originVerified?b.relayOrigin:void 0))}if(d||h&&0<b.queue.length)p(a,gadgets.rpc.ACK,".."===a?gadgets.rpc.RPC_ID:"..",{ackAlone:d})}function t(a,b){function c(){f(a)}var e=g[a];try{var d=!1,d="document"in b;if(!d)return!1;d="object"==typeof b.document;if(!d||"about:blank"===b.location.href)return!1}catch(h){return!1}e.receiveWindow=b;"undefined"===typeof b.attachEvent?
b.onresize=c:b.attachEvent("onresize",c);".."===a?m(e.frame,e.relayUri,l(a),a):f(a);return!0}var v=500,u=10,g={},w=gadgets.util.getUrlParameters().parent,s,r;return{getCode:function(){return"rmr"},isParentVerifiable:function(){return!0},init:function(a,b){s=a;r=b;return!0},setup:function(a,b){try{if("object"!==typeof g[a]){var c=document.createElement("iframe"),e=c.style;e.position="absolute";e.top="0px";e.border="0";e.opacity="0";e.width="10px";e.height="1px";c.id="rmrtransport-"+a;c.name=c.id;var d=
gadgets.rpc.getRelayUrl(a),h=gadgets.rpc.getOrigin(w);d||(d=h+"/robots.txt");g[a]={frame:c,receiveWindow:null,relayUri:d,relayOrigin:h,searchCounter:0,width:10,waiting:!0,queue:[],sendId:0,recvId:0,verifySendToken:String(Math.random()),verifyRecvToken:null,originVerified:!1};".."!==a&&m(c,d,l(a));n(a)}}catch(f){return gadgets.warn("Caught exception setting up RMR: "+f),!1}return!0},call:function(a,b,c){return p(a,c.s,b,c)}}}());gadgets.rpctx=gadgets.rpctx||{};
gadgets.rpctx.ifpc||(gadgets.rpctx.ifpc=function(){function m(d){for(var a=[],c=0,b=d.length;c<b;++c)a.push(encodeURIComponent(gadgets.json.stringify(d[c])));return a.join("\x26")}function n(d){for(var a,c=f.length-1;0<=c;--c){var b=f[c];try{if(b&&(b.recyclable||"complete"===b.readyState))if(b.parentNode.removeChild(b),window.ActiveXObject)f[c]=b=null,f.splice(c,1);else{b.recyclable=!1;a=b;break}}catch(g){}}a||(a=document.createElement("iframe"),a.style.border=a.style.width=a.style.height="0px",a.style.visibility=
"hidden",a.style.position="absolute",a.onload=function(){this.recyclable=!0},f.push(a));a.src=d;window.setTimeout(function(){document.body.appendChild(a)},0)}var f=[],k=0,l,e={};return{getCode:function(){return"ifpc"},isParentVerifiable:function(){return!0},init:function(d,a){l=a;l("..",!0);return!0},setup:function(d,a){l(d,!0);return!0},call:function(d,a,c){var b=gadgets.rpc.getRelayUrl(d);++k;if(!b)return gadgets.warn("No relay file assigned for IFPC"),!1;var g=null,h=[];if(c.l)g=[b,"#",m([a,k,
1,0,m([a,c.s,"","",a].concat(c.a))])].join(""),h.push(g);else{g=[b,"#",d,"\x26",a,"@",k,"\x26"].join("");d=encodeURIComponent(gadgets.json.stringify(c));a=2E3-g.length;c=Math.ceil(d.length/a);for(var b=0,e;0<d.length;)e=d.substring(0,a),d=d.substring(a),h.push([g,c,"\x26",b,"\x26",e].join("")),b+=1}do n(h.shift());while(0<h.length);return!0},_receiveMessage:function(d,a){var c=d[1],b=parseInt(d[2],10),g=parseInt(d[3],10),h=d[d.length-1],f=1===b;if(1<b){e[c]||(e[c]=[]);e[c][g]=h;a:{for(b-=1;0<=b;--b)if("undefined"===
typeof e[c][b]){b=!1;break a}b=!0}b&&(h=e[c].join(""),delete e[c],f=!0)}f&&a(gadgets.json.parse(decodeURIComponent(h)))}}}());window.gadgets.rpc||(gadgets.rpc=function(){function A(a,b){if(!r[a]){var c=k;b||(c=u);r[a]=c;for(var d=s[a]||[],e=0;e<d.length;++e){var h=d[e];h.t=l[a];c.call(a,h.f,h)}s[a]=[]}}function V(){function a(){O=!0}P||("undefined"!=typeof window.addEventListener?window.addEventListener("unload",a,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onunload",a),P=!0)}function W(a,b,c,d,e){if(!l[b]||l[b]!==c)gadgets.error("Invalid auth token. "+l[b]+" vs "+c),v(b,B);e.onunload=function(){m[b]&&
!O&&(v(b,Q),gadgets.rpc.removeReceiver(b))};V();d=gadgets.json.parse(decodeURIComponent(d))}function w(a,b){if(a&&"string"===typeof a.s&&"string"===typeof a.f&&a.a instanceof Array){var c=".."===a.f?a.ta:a.f,d=!0;if(".."===a.f)d=!1;else if(osapi&&osapi.globals_inline)for(var e=1,h=a.a.length;e<h;e++)a.a[e]&&"undefined"!==typeof a.a[e].mid&&osapi.globals_inline[a.a[e].mid]&&".."===a.f&&a.ta===osapi.globals_inline[a.a[e].mid].iframeId&&(d=!1);if(!d||"function"!==typeof arbitrate||arbitrate(a.s,c))if(l[a.f]&&
l[a.f]!==a.t&&(gadgets.error("Invalid auth token. "+l[a.f]+" vs "+a.t),v(a.f,B)),"__ack"===a.s)window.setTimeout(function(){A(a.f,!0)},0);else{a.c&&(a.callback=function(b){gadgets.rpc.call(a.f,"__cb",null,a.c,b)});if(b){c=q(b);a.origin=b;d=a.r;if(!d||q(d)!=c)d=b;a[X]=d}c=(n[a.s]||n[""]).apply(a,a.a);a.c&&"undefined"!==typeof c&&gadgets.rpc.call(a.f,"__cb",null,a.c,c)}}}function q(a){if(a){if("*"===a)return a}else return"";a=a.toLowerCase();0==a.indexOf("//")&&(a=window.location.protocol+a);-1==a.indexOf("://")&&
(a=window.location.protocol+"//"+a);var b=a.substring(a.indexOf("://")+3),c=b.indexOf("/");-1!=c&&(b=b.substring(0,c));a=a.substring(0,a.indexOf("://"));var c="",d=b.indexOf(":");if(-1!=d){var e=b.substring(d+1),b=b.substring(0,d);if("http"===a&&"80"!==e||"https"===a&&"443"!==e)c=":"+e}return a+"://"+b+c}function t(a){if("/"==a.charAt(0)){var b=a.indexOf("|"),c=0<b?a.substring(1,b):a.substring(1);a=0<b?a.substring(b+1):null;return{id:c,origin:a}}return null}function C(a){if("undefined"===typeof a||
".."===a){a=window.parent;if(window.location.hash){var b=window.location.hash.substring(1).split("\x26");if(b){for(var c=b.length,d=0;c--;)if(0===b[c].indexOf("embeddedlevel")){d=b[c].split("\x3d")[1];break}if(0<d)for(;d--&&a;)a=a.parent}}return a?a:window.parent}if(b=t(a)){for(a=window;!a.frames[b.id]&&a!==window.top;)a=a.parent;return a.frames[b.id]}a=String(a);return(b=D(a))&&b.contentWindow?b.contentWindow:(b=window.frames[a])&&!b.closed?b:null}function D(a){var b=document.getElementById(a);if(!b)for(var c=
frames.length;c--;)try{if(b=frames[c].document.getElementById(a))break}catch(d){}return b}function R(a,b){if(!0!==m[a]){"undefined"===typeof m[a]&&(m[a]=0);var c=C(a);(".."===a||null!=c)&&!0===k.setup(a,b)?m[a]=!0:!0!==m[a]&&10>m[a]++?window.setTimeout(function(){R(a,b)},500):(r[a]=u,m[a]=!0)}}function Y(a,b){var c=C(a);try{if(!f[a]||f[a]!==x&&c.Function.prototype!==f[a].constructor.prototype){var d=E(a);if(q(d)!==q(window.location.href))return f[a]=x,!1;try{f[a]=c.gadgets.rpc.receiveSameDomain}catch(e){return f[a]=
x,!1}}}catch(h){return!1}return f[a]&&f[a]!==x?(f[a](b),!0):!1}function E(a){(a=F[a])&&"/"===a.substring(0,1)&&(a="/"===a.substring(1,2)?document.location.protocol+a:document.location.protocol+"//"+document.location.host+a);return a}function G(a,b,c){!/http(s)?:\/\/.+/.test(b)&&"*"!==b&&(0==b.indexOf("//")?b=window.location.protocol+b:"/"==b.charAt(0)?b=window.location.protocol+"//"+window.location.host+b:-1==b.indexOf("://")&&(b=window.location.protocol+"//"+b));F[a]=b;"undefined"!==typeof c&&(y[a]=
!!c)}function H(a,b){b=b||"";l[a]=String(b);R(a,b)}function S(a){a=(a.passReferrer||"").split(":",2);z=a[0]||"none";I=a[1]||"origin"}function T(a){"true"===String(a.useLegacyProtocol)&&(k=gadgets.rpctx.ifpc,k.init(w,A))}function Z(a,b){function c(c){c=c?c.rpc:{};S(c);var e=c.parentRelayUrl||"",e=q(p.parent||b)+e;G("..",e,"true"===String(c.useLegacyProtocol));T(c);H("..",a)}!p.parent&&b?c({}):gadgets.config.register("rpc",null,c)}function J(a,b,c){if(".."===a)Z(c||p.rpctoken||p.ifpctok||"",b);else a:{var d=
null;if("/"!=a.charAt(0)){if(!gadgets.util)break a;d=D(a);if(!d)throw Error("Cannot set up gadgets.rpc receiver with ID: "+a+", element not found.");}d=d&&d.src;b=b||gadgets.rpc.getOrigin(d);G(a,b);b=gadgets.util.getUrlParameters(d);H(a,c||b.rpctoken)}}var X="referer",n={},F={},y={},l={},K=0,L={},m={},f={},p={},r={},s={},z=null,I=null,$=!!gadgets.util.getUrlParameters().parent&&window.top!==window.self,M=window.name,v=function(){},Q=1,B=2,N=window.console,U=N&&N.log?function(a){N.log(a)}:function(){},
u=function(){function a(a){return function(){U(a+": call ignored")}}return{getCode:function(){return"noop"},isParentVerifiable:function(){return!0},init:a("init"),setup:a("setup"),call:a("call")}}();gadgets.util&&(p=gadgets.util.getUrlParameters());var O=!1,P=!1,k="flash"==p.rpctx?gadgets.rpctx.flash:"rmr"==p.rpctx?gadgets.rpctx.rmr:"function"===typeof window.postMessage?gadgets.rpctx.wpm:"object"===typeof window.postMessage?gadgets.rpctx.wpm:window.ActiveXObject?gadgets.rpctx.flash?gadgets.rpctx.flash:
gadgets.rpctx.nix:0<navigator.userAgent.indexOf("WebKit")?gadgets.rpctx.rmr:"Gecko"===navigator.product?gadgets.rpctx.frameElement:gadgets.rpctx.ifpc;n[""]=function(){U("Unknown RPC service: "+this.s)};n.__cb=function(a,b){var c=L[a];c&&(delete L[a],c.call(this,b))};var x={};return{config:function(a){"function"===typeof a.securityCallback&&(v=a.securityCallback);"function"===typeof a.arbitrator&&(arbitrate=a.arbitrator)},register:function(a,b){if("__cb"===a||"__ack"===a)throw Error("Cannot overwrite callback/ack service");
if(""===a)throw Error("Cannot overwrite default service: use registerDefault");var c=n[a];n[a]=b;return c},unregister:function(a){if("__cb"===a||"__ack"===a)throw Error("Cannot delete callback/ack service");if(""===a)throw Error("Cannot delete default service: use unregisterDefault");delete n[a]},registerDefault:function(a){n[""]=a},unregisterDefault:function(){delete n[""]},forceParentVerifiable:function(){k.isParentVerifiable()||(k=gadgets.rpctx.ifpc)},call:function(a,b,c,d){a=a||"..";var e="..";
".."===a?e=M:"/"==a.charAt(0)&&(e=gadgets.rpc.getOrigin(window.location.href),e="/"+M+(e?"|"+e:""));++K;c&&(L[K]=c);var h={s:b,f:e,c:c?K:0,a:Array.prototype.slice.call(arguments,3),t:l[a],l:!!y[a],ta:a},g;a:if("bidir"===z||"c2p"===z&&".."===a||"p2c"===z&&".."!==a){g=window.location.href;var f="?";if("query"===I)f="#";else if("hash"===I)break a;f=g.lastIndexOf(f);f=-1===f?g.length:f;g=g.substring(0,f)}else g=null;g&&(h.r=g);!(".."!==a&&null==t(a)&&!D(a))&&!Y(a,h)&&(g=r[a],!g&&null!==t(a)&&(g=k),g?
(y[a]&&(g=gadgets.rpctx.ifpc),!1===g.call(a,e,h)&&(r[a]=u,k.call(a,e,h))):s[a]?s[a].push(h):s[a]=[h])},getRelayUrl:E,setRelayUrl:G,setAuthToken:H,setupReceiver:J,getAuthToken:function(a){return l[a]},removeReceiver:function(a){delete F[a];delete y[a];delete l[a];delete m[a];delete f[a];delete r[a]},getRelayChannel:function(){return k.getCode()},receive:function(a,b){4<a.length?k._receiveMessage(a,w):W.apply(null,a.concat(b))},receiveSameDomain:function(a){a.a=Array.prototype.slice.call(a.a);window.setTimeout(function(){w(a)},
0)},getOrigin:q,getTargetOrigin:function(a){var b=null,b=E(a);b||(b=(b=t(a))?b.origin:".."==a?p.parent:document.getElementById(a).src);return q(b)},init:function(){!1===k.init(w,A)&&(k=u);$?J(".."):(J(".."),gadgets.config.register("rpc",null,function(a){a=a.rpc||{};S(a);T(a)}))},_getTargetWin:C,_parseSiblingId:t,ACK:"__ack",RPC_ID:M||"..",SEC_ERROR_LOAD_TIMEOUT:0,SEC_ERROR_FRAME_PHISH:Q,SEC_ERROR_FORGED_MSG:B}}(),gadgets.rpc.init());gadgets.io=function(){function C(){var b;if("undefined"!=typeof shindig&&shindig.xhrwrapper&&shindig.xhrwrapper.createXHR)return shindig.xhrwrapper.createXHR();if("undefined"!=typeof ActiveXObject)try{return(b=new ActiveXObject("Msxml2.XMLHTTP"))||(b=new ActiveXObject("Microsoft.XMLHTTP")),b}catch(d){}if("undefined"!=typeof XMLHttpRequest||window.XMLHttpRequest)return new window.XMLHttpRequest;throw"no xhr available";}function A(b,d,c,a,g){if(4!==b.readyState)return!0;var h;try{if(200!==b.status){var l=
b.responseText,f=l;if(l&&c&&a){var k=q.unparseableCruft,e=l.indexOf(k)+k.length;if(e===k.length){var l=l.substr(e),n=eval("("+l+")");n&&(n=n[a])}if(c.AUTHORIZATION===gadgets.io.AuthorizationType.SSO){var p=c.SSO_REAUTH_DETECTOR;401===b.status?(f=b.statusText?b.statusText:"Unauthorized: check login",h=p&&"function"===typeof p):n&&p&&"function"===typeof p?h=p(n.body,n.rc,n.headers):b.getResponseHeader("content-type")&&0===b.getResponseHeader("content-type").indexOf("application/json")&&(p&&"function"===
typeof p)&&(h=p("",b.status,{}))}}var m=""+b.status;f&&(m=m+" "+f);var r={errors:[m],rc:b.status,text:f};"undefined"!==typeof h&&(r.ssoReauthNeeded=h);t(r,c,a,d,g);u(r);d(r);return!0}}catch(s){return r={errors:[s.number+" Error not specified"],rc:s.number,text:s.description},"undefined"!==typeof h&&(r.ssoReauthNeeded=h),t(r,c,a,d,g),u(r),d(r),!0}return!1}function D(b,d,c,a){A(a,d,c,b)||d(w(c,{body:a.responseText}))}function x(b,d,c,a,g){if(!A(a,d,c,b,g)){a=a.responseText;var h=q.unparseableCruft,
l=a.indexOf(h)+h.length;l<h.length||(a=a.substr(l),a=eval("("+a+")"),a=a[b],a.oauthState&&(s=a.oauthState),a.st&&shindig.auth.updateSecurityToken(a.st),a=w(c,a),t(a,c,b,d,g),u(a),d(a))}}function w(b,d){var c={text:d.body,rc:d.rc||200,headers:d.headers,oauthApprovalUrl:d.oauthApprovalUrl,oauthError:d.oauthError,oauthErrorText:d.oauthErrorText,oauthErrorTrace:d.oauthErrorTrace,oauthErrorUri:d.oauthErrorUri,oauthErrorExplanation:d.oauthErrorExplanation,errors:[],samlApprovalUrl:d.samlApprovalUrl};if(200>
c.rc||400<=c.rc)c.errors=[c.rc+" Error"];else if(c.text)switch(300<=c.rc&&400>c.rc&&(b.CONTENT_TYPE="TEXT"),b.CONTENT_TYPE){case "JSON":case "FEED":c.data=gadgets.json.parse(c.text);c.data||(c.errors.push("500 Failed to parse JSON"),c.rc=500,c.data=null);break;case "DOM":var a;E?(a=new ActiveXObject("Microsoft.XMLDOM"),a.async=!1,a.validateOnParse=!1,a.resolveExternals=!1,a.loadXML(c.text)?c.data=a:(c.errors.push("500 Failed to parse XML"),c.rc=500)):"undefined"!=typeof DOMParser?(a=(new DOMParser).parseFromString(c.text,
"text/xml"),"parsererror"===a.documentElement.nodeName?(c.errors.push("500 Failed to parse XML"),c.rc=500):c.data=a):(c.errors.push("500 Failed to parse XML because no DOM parser was available"),c.rc=500);break;default:c.data=c.text}b.AUTHORIZATION===gadgets.io.AuthorizationType.SSO&&b.SSO_REAUTH_DETECTOR&&"function"===typeof b.SSO_REAUTH_DETECTOR&&(c.ssoReauthNeeded=(0,b.SSO_REAUTH_DETECTOR)(d.body,d.rc,d.headers));return c}function y(b,d,c,a,g,h,l,f,k){var e=C();0==d.indexOf("//")&&(d=document.location.protocol+
d);e.open(g,d,!0);c&&(b=gadgets.util.makeClosure(null,l,b,c,h,e,k),gadgets.util.shouldPollXhrReadyStateChange()?F(e,b):e.onreadystatechange=b);"string"===typeof f&&(f={});f=f||{};null!==a&&(f["Content-Type"]||(f["Content-Type"]="application/x-www-form-urlencoded"));for(var n in f)e.setRequestHeader(n,f[n]);e.send(a)}function F(b,d){var c=B;z[c]=window.setInterval(function(){b&&4===b.readyState&&(window.clearInterval(z[c]),delete z[c],d&&d())},q.xhrPollIntervalMs||50);B++}function v(b){return q.securityTokenInCookie?
"":"\x26st\x3d"+encodeURIComponent(b)}function t(b,d,c,a,g){if(b.samlApprovalUrl&&!0==b.ssoReauthNeeded)if(d.SSO_REAUTH_CALLBACK&&"function"===typeof d.SSO_REAUTH_CALLBACK)(0,d.SSO_REAUTH_CALLBACK)(b);else{b=b.samlApprovalUrl;if(null==b||void 0==b||"META_DATA_REAUTH_URL_NOT_SET"==b)b=gadgets.rpc.call("..","_cre_sso_reauth_cb");null==b||void 0==b||"META_DATA_REAUTH_URL_NOT_SET"==b?console.error("Failed to get valid reauth URL to do login for saml reauth."):confirm("Do you want to do reauth for SAML now?")&&
(d=new cre$.sso.ReauthHandler(function(){},function(){gadgets.io.makeRequest(c,a,g)}),d.setReauthURL(b),d.createHandlerOnClick()(),d.renderComplete())}}function u(b){if(null!=b&&void 0!=b){var d;d=null;b=b.headers;null!=b&&(void 0!=b&&""!=b)&&(d=b["set-cookie"]);if(null!=d&&void 0!=d){d=String(d).split("\x26");b=0;for(var c=d.length;b<c;b++){var a=d[b];"prx_saml_"==a.substring(0,9)&&(-1!==a.indexOf("; HttpOnly")&&(a=a.replace("; HttpOnly","")),document.cookie=a)}}}}var B=0,z={},q={},s,E=window.ActiveXObject?
!0:!1;gadgets.config.register("core.io",null,function(b){q=b["core.io"]||{}});return{makeRequest:function(b,d,c){var a=c||{},g=a.METHOD||"GET",h=a.REFRESH_INTERVAL,l,f;a.AUTHORIZATION&&"NONE"!==a.AUTHORIZATION&&(l=a.AUTHORIZATION.toLowerCase(),f=shindig.auth.getSecurityToken());var k=!0;"undefined"!==typeof a.SIGN_OWNER&&(k=a.SIGN_OWNER);var e=!0;"undefined"!==typeof a.SIGN_VIEWER&&(e=a.SIGN_VIEWER);var n=a.HEADERS||{};"POST"===g&&!n["Content-Type"]&&(n["Content-Type"]="application/x-www-form-urlencoded");
var p=gadgets.util.getUrlParameters(),k={url:b,httpMethod:g,headers:gadgets.io.encodeValues(n,!1),postData:a.POST_DATA||"",authz:l||"",st:f||"",contentType:a.CONTENT_TYPE||"TEXT",numEntries:a.NUM_ENTRIES||"3",getSummaries:!!a.GET_SUMMARIES,signOwner:k,signViewer:e,gadget:p.url,container:p.container||p.synd||"default",bypassSpecCache:gadgets.util.getUrlParameters().nocache||"",getFullHeaders:!!a.GET_FULL_HEADERS};if("oauth"===l||"signed"===l||"oauth2"===l){gadgets.io.oauthReceivedCallbackUrl_&&(k.OAUTH_RECEIVED_CALLBACK=
gadgets.io.oauthReceivedCallbackUrl_,gadgets.io.oauthReceivedCallbackUrl_=null);k.oauthState=s||"";for(var m in a)if(a.hasOwnProperty(m)&&(0===m.indexOf("OAUTH_")||"code"===m))k[m]=a[m]}l=(f=f||shindig.auth.getSecurityToken())?{"X-Shindig-ST":f}:{};f=q.jsonProxyUrl.replace("%host%",document.location.host);a:{if(gadgets.io.preloaded_&&"GET"===k.httpMethod)for(m=0;m<gadgets.io.preloaded_.length;m++)if((e=gadgets.io.preloaded_[m])&&e.id===k.url){delete gadgets.io.preloaded_[m];200!==e.rc?d({rc:e.rc,
errors:[e.rc+" Error"]}):(e.oauthState&&(s=e.oauthState),m=w(a,{body:e.body,rc:e.rc,headers:e.headers,oauthApprovalUrl:e.oauthApprovalUrl,oauthError:e.oauthError,oauthErrorText:e.oauthErrorText,oauthErrorTrace:e.oauthErrorTrace,oauthErrorUri:e.oauthErrorUri,oauthErrorExplanation:e.oauthErrorExplanation,errors:[],samlApprovalUrl:e.samlApprovalUrl}),t(m,a,url,d,c),u(m),d(m));m=!0;break a}m=!1}m||("GET"==g&&"undefined"!=typeof h&&(k.refresh=h),"GET"===g&&!k.authz?(g="?"+gadgets.io.encodeValues(k),h=
f+g,-1!=f.indexOf("url\x3d")&&(h=f+encodeURIComponent(g)),y(b,h,d,null,"GET",a,x,l,c)):(g=gadgets.io.encodeValues(k),y(b,f,d,g,"POST",a,x,l,c)))},makeNonProxiedRequest:function(b,d,c,a){c=c||{};y(b,b,d,c.POST_DATA,c.METHOD,c,D,a)},clearOAuthState:function(){s=void 0},encodeValues:function(b,d){var c=!d,a=[],g=!1,h;for(h in b)b.hasOwnProperty(h)&&!/___$/.test(h)&&(g?a.push("\x26"):g=!0,a.push(c?encodeURIComponent(h):h),a.push("\x3d"),a.push(c?encodeURIComponent(b[h]):b[h]));return a.join("")},getProxyUrl:function(b,
d){var c=q.proxyUrl;if(!c)return c;var a=window.__gadgetIdentifier;a&&q.securityTokenInCookie&&(c=c.replace(/proxy/,"proxy/"+a));var g=d||{},a=g.REFRESH_INTERVAL;"undefined"==typeof a&&(a="3600");var h=g.STREAM;"undefined"==typeof h&&(h=!1);var l=gadgets.util.getUrlParameters(),f=shindig.auth.getSecurityToken(),k=g[gadgets.io.RequestParameters.AUTHORIZATION],e=g[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME],g=g.rewriteMime?"\x26rewriteMime\x3d"+encodeURIComponent(g.rewriteMime):"",n="";k?n=k==
gadgets.io.AuthorizationType.OAUTH||k==gadgets.io.AuthorizationType.OAUTH2?"\x26authz\x3d"+k.toLowerCase()+v(f)+"\x26OAUTH_SERVICE_NAME\x3d"+encodeURIComponent(e):k==gadgets.io.AuthorizationType.SSO?"\x26authz\x3d"+k.toLowerCase()+v(f):!0==q.appendTokenAlways?"\x26authz\x3d"+k.toLowerCase()+v(f):"\x26authz\x3d"+k.toLowerCase():!0==q.appendTokenAlways&&(n=v(f));f=shindig.uri(b).getPath();k="";e=f.lastIndexOf("/");-1!==e&&(k=f.substring(e));c=c.replace("%url%",encodeURIComponent(b)).replace("%host%",
document.location.host).replace("%rawurl%",b).replace("%filename%",k).replace("%refresh%",encodeURIComponent(a)).replace("%gadget%",encodeURIComponent(l.url)).replace("%container%",encodeURIComponent(l.container||l.synd||"default")).replace("%stream%",h?1:0).replace("%authz%",n).replace("%rewriteMime%",g);0==c.indexOf("//")&&(c=window.location.protocol+c);return c},processResponse_:x}}();gadgets.io.RequestParameters=gadgets.util.makeEnum("ALIAS METHOD CONTENT_TYPE POST_DATA HEADERS AUTHORIZATION NUM_ENTRIES GET_SUMMARIES GET_FULL_HEADERS REFRESH_INTERVAL STREAM SIGN_OWNER SIGN_VIEWER OAUTH_SERVICE_NAME OAUTH_USE_TOKEN OAUTH_TOKEN_NAME OAUTH_REQUEST_TOKEN OAUTH_REQUEST_TOKEN_SECRET OAUTH_RECEIVED_CALLBACK SSO_REAUTH_DETECTOR".split(" "));
gadgets.io.MethodType=gadgets.util.makeEnum(["GET","POST","PUT","DELETE","HEAD"]);gadgets.io.ContentType=gadgets.util.makeEnum(["TEXT","DOM","JSON","FEED"]);gadgets.io.AuthorizationType=gadgets.util.makeEnum(["NONE","SIGNED","OAUTH","OAUTH2","SSO"]);(function(){osapi.newBatch=function(){var e={},g=[],l=function(b){var c={method:b.request.method,id:b.key};b.request.rpc&&(c.params=b.request.rpc);return c};e.execute=function(b){for(var c={},f={},e=0,k=[],d=0;d<g.length;d++){var a=g[d].request.transport;f[a.name]||(k.push(a),e++);f[a.name]=f[a.name]||[];f[a.name].push(l(g[d]))}d=function(a){a.error&&(c.error=a.error);for(var d=0;d<g.length;d++){var f=g[d].key,h=a[f];h&&(c[f]=h.error?h:h.data||h.result)}e--;0===e&&b(c)};for(a=0;a<k.length;a++)k[a].execute(f[k[a].name],
d);0==e&&window.setTimeout(function(){b(c)},0)};e.add=function(b,c){c&&b&&g.push({key:b,request:c});return e};return e}})();osapi._registerMethod=function(b,d){if("newBatch"!==b){for(var a=b.split("."),c=osapi,f=0;f<a.length-1;f++)c[a[f]]=c[a[f]]||{},c=c[a[f]];var e=a[a.length-1],g;c[e]&&(g=c[e]);c[e]=function(a){a=a||{};a.userId=a.userId||"@viewer";a.groupId=a.groupId||"@self";return new osapi._BoundCall(b,d,a)};"undefined"!==typeof tamings___&&(a=function(){caja___.markFunction(c[e],b)},g&&g.__taming_index?(c[e].__taming_index=g.__taming_index,tamings___[g.__taming_index]=a):(c[e].__taming_index=tamings___.length,tamings___.push(a)))}};
osapi._BoundCall=function(b,d,a){this.method=b;this.transport=d;this.rpc=a};osapi._BoundCall.prototype.execute=function(b){var d="undefined"!==typeof caja___&&caja___.getUseless&&caja___.getUseless(),a=d?caja___.getUseless():this,c=d?caja___.untame(b):b;b=osapi.newBatch();b.add(this.method,this);b.execute(function(b){b.error?c.call(a,{error:b.error}):c.call(a,b[a.method])})};(function(){function k(a,d){var c={POST_DATA:gadgets.json.stringify(a),CONTENT_TYPE:"JSON",METHOD:"POST",AUTHORIZATION:"SIGNED"},e={"Content-Type":"application/json"},f=this.name,g=shindig.auth.getSecurityToken();g&&(h?e.Authorization="OAuth2 "+g:e["X-Shindig-ST"]=g);gadgets.io.makeNonProxiedRequest(f,function(b){if(b.errors[0])d({error:{code:b.rc,message:b.text}});else if(b=b.result||b.data,b.error)d(b);else{for(var c={},a=0;a<b.length;a++)c[b[a].id]=b[a];d(c)}},c,e)}function l(a){var d=a["osapi.services"];
h=a["osapi.useOAuth2"];if(d)for(var c in d)if(d.hasOwnProperty(c)&&(0==c.indexOf("http")||0==c.indexOf("//"))){a={name:c.replace("%host%",document.location.host),execute:k};for(var e=d[c],f=0;f<e.length;f++)osapi._registerMethod(e[f],a)}}var h;gadgets.config&&gadgets.config.register("osapi.services",null,l)})();gadgets.util.registerOnLoadHandler(function(){osapi&&(osapi.people&&osapi.people.get)&&(osapi.people.getViewer=function(a){a=a||{};a.userId="@viewer";a.groupId="@self";return osapi.people.get(a)},osapi.people.getViewerFriends=function(a){a=a||{};a.userId="@viewer";a.groupId="@friends";return osapi.people.get(a)},osapi.people.getOwner=function(a){a=a||{};a.userId="@owner";a.groupId="@self";return osapi.people.get(a)},osapi.people.getOwnerFriends=function(a){a=a||{};a.userId="@owner";a.groupId="@friends";
return osapi.people.get(a)})});shindig._uri=shindig.uri;shindig.uri=function(){var f=shindig._uri;shindig._uri=null;return function(g){var a=f(g);a.hasSameOrigin=function(b){return a.getOrigin()==b.getOrigin()};a.resolve=function(b){""==a.getSchema()&&a.setSchema(b.getSchema());""==a.getAuthority()&&a.setAuthority(b.getAuthority());var c=a.getPath();if(""==c||"/"!=c.charAt(0)){var d=b.getPath(),e=d.lastIndexOf("/");-1!=e&&d.substring(0,e+1);a.setPath(b.getPath()+c)}};return a}}();Function.prototype.inherits=function(b){function a(){}this.superClass_=a.prototype=b.prototype;this.prototype=new a;this.prototype.constructor=this};shindig.cookies={};shindig.cookies.JsType_={UNDEFINED:"undefined"};shindig.cookies.isDef=function(a){return typeof a!=shindig.cookies.JsType_.UNDEFINED};
shindig.cookies.set=function(a,b,c,d,e){if(/;=/g.test(a))throw Error('Invalid cookie name "'+a+'"');if(/;/g.test(b))throw Error('Invalid cookie value "'+b+'"');shindig.cookies.isDef(c)||(c=-1);e=e?";domain\x3d"+e:"";d=d?";path\x3d"+d:"";c=0>c?"":0===c?";expires\x3d"+(new Date(1970,1,1)).toUTCString():";expires\x3d"+(new Date((new Date).getTime()+1E3*c)).toUTCString();document.cookie=a+"\x3d"+b+e+d+c};
shindig.cookies.get=function(a,b){for(var c=a+"\x3d",d=String(document.cookie),e=-1;0<=(e=d.indexOf(c,e+1));){for(var f=e;0<=--f;)if(";"==d.charAt(f)){f=-1;break}if(-1==f)return f=d.indexOf(";",e),0>f&&(f=d.length),d.substring(e+c.length,f)}return b};shindig.cookies.remove=function(a,b,c){var d=shindig.cookies.containsKey(a);shindig.cookies.set(a,"",0,b,c);return d};
shindig.cookies.getKeyValues_=function(){for(var a=String(document.cookie).split(/\s*;\s*/),b=[],c=[],d,e,f=0;e=a[f];f++)d=e.indexOf("\x3d"),-1==d?(b.push(""),c.push(e)):(b.push(e.substring(0,d)),c.push(e.substring(d+1)));return{keys:b,values:c}};shindig.cookies.getKeys=function(){return shindig.cookies.getKeyValues_().keys};shindig.cookies.getValues=function(){return shindig.cookies.getKeyValues_().values};shindig.cookies.isEmpty=function(){return""===document.cookie};
shindig.cookies.getCount=function(){var a=String(document.cookie);return""===a?0:a.split(/\s*;\s*/).length};shindig.cookies.containsKey=function(a){var b={};return shindig.cookies.get(a,b)!==b};shindig.cookies.containsValue=function(a){for(var b=shindig.cookies.getKeyValues_().values,c=0;c<b.length;c++)if(b[c]==a)return!0;return!1};shindig.cookies.clear=function(){for(var a=shindig.cookies.getKeyValues_().keys,b=a.length-1;0<=b;b--)shindig.cookies.remove(a[b])};shindig.cookies.MAX_COOKIE_LENGTH=3950;(function(){function h(a){shindig.Gadget.prototype.setServerBase(a["shindig-container"].serverBase)}shindig.errors={};shindig.errors.SUBCLASS_RESPONSIBILITY="subclass responsibility";shindig.errors.TO_BE_DONE="to be done";shindig.callAsyncAndJoin=function(a,b,c){for(var d=a.length,f=[],e=0;e<a.length;e++)(function(e){var g=a[e];"string"===typeof g&&(g=c[g]);g.call(c,function(a){f[e]=a;0===--d&&b(f)})})(e)};shindig.Extensible=function(){};shindig.Extensible.prototype.setDependencies=function(a){for(var b in a)this[b]=
a[b]};shindig.Extensible.prototype.getDependencies=function(a){return this[a]};shindig.UserPrefStore=function(){};shindig.UserPrefStore.prototype.getPrefs=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.UserPrefStore.prototype.savePrefs=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.DefaultUserPrefStore=function(){shindig.UserPrefStore.call(this)};shindig.DefaultUserPrefStore.inherits(shindig.UserPrefStore);shindig.DefaultUserPrefStore.prototype.getPrefs=
function(a){};shindig.DefaultUserPrefStore.prototype.savePrefs=function(a){};shindig.GadgetService=function(){};shindig.GadgetService.prototype.setHeight=function(a,b){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.GadgetService.prototype.setTitle=function(a,b){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.GadgetService.prototype.setUserPref=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.IfrGadgetService=function(){shindig.GadgetService.call(this);
gadgets.rpc.register("resize_iframe",this.setHeight);gadgets.rpc.register("set_pref",this.setUserPref);gadgets.rpc.register("set_title",this.setTitle);gadgets.rpc.register("requestNavigateTo",this.requestNavigateTo);gadgets.rpc.register("requestSendMessage",this.requestSendMessage)};shindig.IfrGadgetService.inherits(shindig.GadgetService);shindig.IfrGadgetService.prototype.setHeight=function(a){a>shindig.container.maxheight_&&(a=shindig.container.maxheight_);var b=document.getElementById(this.f);
b&&(b.style.height=a+"px")};shindig.IfrGadgetService.prototype.setTitle=function(a){var b=document.getElementById(this.f+"_title");b&&(b.innerHTML=a.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"))};shindig.IfrGadgetService.prototype.setUserPref=function(a,b,c){for(var d=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f),d=shindig.container.getGadget(d),f=1,e=arguments.length;f<e;f+=2)this.userPrefs[arguments[f]].value=arguments[f+1];d.saveUserPrefs()};shindig.IfrGadgetService.prototype.requestSendMessage=
function(a,b,c,d){c&&window.setTimeout(function(){c(new opensocial.ResponseItem(null,null,opensocial.ResponseItem.Error.NOT_IMPLEMENTED,null))},0)};shindig.IfrGadgetService.prototype.requestNavigateTo=function(a,b){shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);var c=shindig.container.gadgetService.getUrlForView(a);if(b){var d=gadgets.json.stringify(b);0<d.length&&(c+="\x26appParams\x3d"+encodeURIComponent(d))}c&&-1==document.location.href.indexOf(c)&&(document.location.href=c)};
shindig.IfrGadgetService.prototype.getUrlForView=function(a){return"canvas"===a?"/canvas":"profile"===a?"/profile":null};shindig.IfrGadgetService.prototype.getGadgetIdFromModuleId=function(a){return parseInt(a.match(/_([0-9]+)$/)[1],10)};shindig.LayoutManager=function(){};shindig.LayoutManager.prototype.getGadgetChrome=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.StaticLayoutManager=function(){shindig.LayoutManager.call(this)};shindig.StaticLayoutManager.inherits(shindig.LayoutManager);
shindig.StaticLayoutManager.prototype.setGadgetChromeIds=function(a){this.gadgetChromeIds_=a};shindig.StaticLayoutManager.prototype.getGadgetChrome=function(a){return(a=this.gadgetChromeIds_[a.id])?document.getElementById(a):null};shindig.FloatLeftLayoutManager=function(a){shindig.LayoutManager.call(this);this.layoutRootId_=a};shindig.FloatLeftLayoutManager.inherits(shindig.LayoutManager);shindig.FloatLeftLayoutManager.prototype.getGadgetChrome=function(a){if(a=document.getElementById(this.layoutRootId_)){var b=
document.createElement("div");b.className="gadgets-gadget-chrome";b.style.cssFloat="left";a.appendChild(b);return b}return null};shindig.Gadget=function(a){this.userPrefs={};if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.secureToken||(this.secureToken="john.doe:john.doe:appid:cont:url:0:default")};shindig.Gadget.prototype.setServerBase=function(a){this.serverBase_=a};shindig.Gadget.prototype.getServerBase=function(){return this.serverBase_};shindig.Gadget.prototype.getUserPrefs=function(){return this.userPrefs};
shindig.Gadget.prototype.saveUserPrefs=function(){shindig.container.userPrefStore.savePrefs(this)};shindig.Gadget.prototype.getUserPrefValue=function(a){a=this.userPrefs[a];return"undefined"!=typeof a.value&&null!=a.value?a.value:a["default"]};shindig.Gadget.prototype.render=function(a){if(a){var b=this;this.getContent(function(c){a.innerHTML=c;b.finishRender(a)})}};shindig.Gadget.prototype.getContent=function(a){shindig.callAsyncAndJoin(["getTitleBarContent","getUserPrefsDialogContent","getMainContent"],
function(b){a(b.join(""))},this)};shindig.Gadget.prototype.getTitleBarContent=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getUserPrefsDialogContent=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getMainContent=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.finishRender=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getAdditionalParams=
function(){return""};shindig.BaseIfrGadget=function(a){shindig.Gadget.call(this,a);this.serverBase_?0>this.serverBase_.indexOf("/gadgets")&&(this.serverBase_+="/gadgets/"):this.serverBase_="/gadgets/";this.queryIfrGadgetType_()};shindig.BaseIfrGadget.inherits(shindig.Gadget);shindig.BaseIfrGadget.prototype.GADGET_IFRAME_PREFIX_="remote_iframe_";shindig.BaseIfrGadget.prototype.CONTAINER="default";shindig.BaseIfrGadget.prototype.cssClassGadget="gadgets-gadget";shindig.BaseIfrGadget.prototype.cssClassTitleBar=
"gadgets-gadget-title-bar";shindig.BaseIfrGadget.prototype.cssClassTitle="gadgets-gadget-title";shindig.BaseIfrGadget.prototype.cssClassTitleButtonBar="gadgets-gadget-title-button-bar";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialog="gadgets-gadget-user-prefs-dialog";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialogActionBar="gadgets-gadget-user-prefs-dialog-action-bar";shindig.BaseIfrGadget.prototype.cssClassTitleButton="gadgets-gadget-title-button";shindig.BaseIfrGadget.prototype.cssClassGadgetContent=
"gadgets-gadget-content";shindig.BaseIfrGadget.prototype.rpcToken=2147483647*Math.random()|0;shindig.BaseIfrGadget.prototype.rpcRelay="../container/rpc_relay.html";shindig.BaseIfrGadget.prototype.getTitleBarContent=function(a){var b=this.hasViewablePrefs_()?'\x3ca href\x3d"#" onclick\x3d"shindig.container.getGadget('+this.id+').handleOpenUserPrefsDialog();return false;" class\x3d"'+this.cssClassTitleButton+'"\x3esettings\x3c/a\x3e ':"";a('\x3cdiv id\x3d"'+this.cssClassTitleBar+"-"+this.id+'" class\x3d"'+
this.cssClassTitleBar+'"\x3e\x3cspan id\x3d"'+this.getIframeId()+'_title" class\x3d"'+this.cssClassTitle+'"\x3e'+(this.title?this.title:"Title")+'\x3c/span\x3e | \x3cspan class\x3d"'+this.cssClassTitleButtonBar+'"\x3e'+b+'\x3ca href\x3d"#" onclick\x3d"shindig.container.getGadget('+this.id+').handleToggle();return false;" class\x3d"'+this.cssClassTitleButton+'"\x3etoggle\x3c/a\x3e\x3c/span\x3e\x3c/div\x3e')};shindig.BaseIfrGadget.prototype.getUserPrefsDialogContent=function(a){a('\x3cdiv id\x3d"'+
this.getUserPrefsDialogId()+'" class\x3d"'+this.cssClassGadgetUserPrefsDialog+'"\x3e\x3c/div\x3e')};shindig.BaseIfrGadget.prototype.getMainContent=function(a){var b=this;window.setTimeout(function(){b.getMainContent(a)},0)};shindig.BaseIfrGadget.prototype.getIframeId=function(){return this.GADGET_IFRAME_PREFIX_+this.id};shindig.BaseIfrGadget.prototype.getUserPrefsDialogId=function(){return this.getIframeId()+"_userPrefsDialog"};shindig.BaseIfrGadget.prototype.getUserPrefsParams=function(){var a="",
b;for(b in this.getUserPrefs())a+="\x26up_"+encodeURIComponent(b)+"\x3d"+encodeURIComponent(this.getUserPrefValue(b));return a};shindig.BaseIfrGadget.prototype.handleToggle=function(){var a=document.getElementById(this.getIframeId());a&&(a=a.parentNode,a.style.display=a.style.display?"":"none")};shindig.BaseIfrGadget.prototype.hasViewablePrefs_=function(){for(var a in this.getUserPrefs())if("hidden"!=this.userPrefs[a].type)return!0;return!1};shindig.BaseIfrGadget.prototype.handleOpenUserPrefsDialog=
function(){if(this.userPrefsDialogContentLoaded)this.showUserPrefsDialog();else{var a=this;window["ig_callback_"+this.id]=function(b){a.userPrefsDialogContentLoaded=!0;a.buildUserPrefsDialog(b);a.showUserPrefsDialog()};var b=document.createElement("script");b.src="http://www.gmodules.com/ig/gadgetsettings?mid\x3d"+this.id+"\x26output\x3djs"+this.getUserPrefsParams()+"\x26url\x3d"+this.specUrl;document.body.appendChild(b)}};shindig.BaseIfrGadget.prototype.buildUserPrefsDialog=function(a){var b=document.getElementById(this.getUserPrefsDialogId());
b.innerHTML=a+'\x3cdiv class\x3d"'+this.cssClassGadgetUserPrefsDialogActionBar+'"\x3e\x3cinput type\x3d"button" value\x3d"Save" onclick\x3d"shindig.container.getGadget('+this.id+').handleSaveUserPrefs()"\x3e \x3cinput type\x3d"button" value\x3d"Cancel" onclick\x3d"shindig.container.getGadget('+this.id+').handleCancelUserPrefs()"\x3e\x3c/div\x3e';b.childNodes[0].style.display=""};shindig.BaseIfrGadget.prototype.showUserPrefsDialog=function(a){document.getElementById(this.getUserPrefsDialogId()).style.display=
a||"undefined"==typeof a?"":"none"};shindig.BaseIfrGadget.prototype.hideUserPrefsDialog=function(){this.showUserPrefsDialog(!1)};shindig.BaseIfrGadget.prototype.handleSaveUserPrefs=function(){this.hideUserPrefsDialog();for(var a=document.getElementById("m_"+this.id+"_numfields").value,b=0;b<a;b++){var c=document.getElementById("m_"+this.id+"_"+b),d=c.name.substring(("m_"+this.id+"_up_").length);this.userPrefs[d].value=c.value}this.saveUserPrefs();this.refresh()};shindig.BaseIfrGadget.prototype.handleCancelUserPrefs=
function(){this.hideUserPrefsDialog()};shindig.BaseIfrGadget.prototype.refresh=function(){var a=this.getIframeId();document.getElementById(a).src=this.getIframeUrl(Math.random())};shindig.BaseIfrGadget.prototype.queryIfrGadgetType_=function(){var a={CONTENT_TYPE:"JSON",METHOD:"POST",POST_DATA:gadgets.json.stringify({context:{country:"default",language:"default",view:"default",container:"default"},gadgets:[{url:this.specUrl,moduleId:1}]})};gadgets.io.makeNonProxiedRequest(this.serverBase_+"metadata?st\x3d"+
this.secureToken,function(a){var d=!1;a=a.data.gadgets[0].features;for(var f=0;f<a.length;f++)if("pubsub-2"===a[f]){d=!0;break}var d=d?shindig.OAAIfrGadget:shindig.IfrGadget,e;for(e in d)d.hasOwnProperty(e)&&(b[e]=d[e])},a,{"Content-Type":"application/javascript"});var b=this};shindig.IfrGadget={getMainContent:function(a){var b=this.getIframeId();gadgets.rpc.setRelayUrl(b,this.serverBase_+this.rpcRelay);gadgets.rpc.setAuthToken(b,this.rpcToken);a('\x3cdiv class\x3d"'+this.cssClassGadgetContent+'"\x3e\x3ciframe id\x3d"'+
b+'" name\x3d"'+b+'" class\x3d"'+this.cssClassGadget+'" src\x3d"about:blank" frameborder\x3d"no" scrolling\x3d"no"'+(this.height?' height\x3d"'+this.height+'"':"")+(this.width?' width\x3d"'+this.width+'"':"")+"\x3e\x3c/iframe\x3e\x3c/div\x3e")},finishRender:function(a){window.frames[this.getIframeId()].location=this.getIframeUrl()},getIframeUrl:function(a){return this.serverBase_+"ifr?container\x3d"+this.CONTAINER+"\x26mid\x3d"+this.id+"\x26nocache\x3d"+shindig.container.nocache_+"\x26country\x3d"+
shindig.container.country_+"\x26lang\x3d"+shindig.container.language_+"\x26view\x3d"+shindig.container.view_+(this.specVersion?"\x26v\x3d"+this.specVersion:"")+(shindig.container.parentUrl_?"\x26parent\x3d"+encodeURIComponent(shindig.container.parentUrl_):"")+(this.debug?"\x26debug\x3d1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"\x26st\x3d"+this.secureToken:"")+"\x26url\x3d"+encodeURIComponent(this.specUrl)+(this.viewParams?"\x26view-params\x3d"+encodeURIComponent(gadgets.json.stringify(this.viewParams)):
"")+(a?"\x26r\x3d"+a:"")+"#rpctoken\x3d"+this.rpcToken+(this.hashData?"\x26"+this.hashData:"")}};shindig.OAAIfrGadget={getMainContent:function(a){a('\x3cdiv id\x3d"'+this.cssClassGadgetContent+"-"+this.id+'" class\x3d"'+this.cssClassGadgetContent+'"\x3e\x3c/div\x3e')},finishRender:function(a){a={className:this.cssClassGadget,frameborder:"no",scrolling:"no"};this.height&&(a.height=this.height);this.width&&(a.width=this.width);new OpenAjax.hub.IframeContainer(gadgets.pubsub2router.hub,this.getIframeId(),
{Container:{onSecurityAlert:function(a,c){gadgets.error("Security error for container "+a.getClientID()+" : "+c);a.getIframe().src="about:blank"}},IframeContainer:{parent:document.getElementById(this.cssClassGadgetContent+"-"+this.id),uri:this.getIframeUrl(),tunnelURI:shindig.uri(this.serverBase_+this.rpcRelay).resolve(shindig.uri(window.location.href)),iframeAttrs:a}})},getIframeUrl:function(a){return this.serverBase_+"ifr?container\x3d"+this.CONTAINER+"\x26mid\x3d"+this.id+"\x26nocache\x3d"+shindig.container.nocache_+
"\x26country\x3d"+shindig.container.country_+"\x26lang\x3d"+shindig.container.language_+"\x26view\x3d"+shindig.container.view_+(this.specVersion?"\x26v\x3d"+this.specVersion:"")+(this.debug?"\x26debug\x3d1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"\x26st\x3d"+this.secureToken:"")+"\x26url\x3d"+encodeURIComponent(this.specUrl)+(this.viewParams?"\x26view-params\x3d"+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(a?"\x26r\x3d"+a:"")+(this.hashData?
"#"+this.hashData:"")}};shindig.Container=function(){this.gadgets_={};this.parentUrl_=document.location.href+"://"+document.location.host;this.language_=this.country_="ALL";this.view_="default";this.nocache_=1;this.maxheight_=2147483647};shindig.Container.inherits(shindig.Extensible);shindig.Container.prototype.gadgetClass=shindig.Gadget;shindig.Container.prototype.userPrefStore=new shindig.DefaultUserPrefStore;shindig.Container.prototype.gadgetService=new shindig.GadgetService;shindig.Container.prototype.layoutManager=
new shindig.StaticLayoutManager;shindig.Container.prototype.setParentUrl=function(a){this.parentUrl_=a};shindig.Container.prototype.setCountry=function(a){this.country_=a};shindig.Container.prototype.setNoCache=function(a){this.nocache_=a};shindig.Container.prototype.setLanguage=function(a){this.language_=a};shindig.Container.prototype.setView=function(a){this.view_=a};shindig.Container.prototype.setMaxHeight=function(a){this.maxheight_=a};shindig.Container.prototype.getGadgetKey_=function(a){return"gadget_"+
a};shindig.Container.prototype.getGadget=function(a){return this.gadgets_[this.getGadgetKey_(a)]};shindig.Container.prototype.createGadget=function(a){return new this.gadgetClass(a)};shindig.Container.prototype.addGadget=function(a){a.id=this.getNextGadgetInstanceId();this.gadgets_[this.getGadgetKey_(a.id)]=a};shindig.Container.prototype.addGadgets=function(a){for(var b=0;b<a.length;b++)this.addGadget(a[b])};shindig.Container.prototype.renderGadgets=function(){for(var a in this.gadgets_)this.renderGadget(this.gadgets_[a])};
shindig.Container.prototype.renderGadget=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Container.prototype.nextGadgetInstanceId_=0;shindig.Container.prototype.getNextGadgetInstanceId=function(){return this.nextGadgetInstanceId_++};shindig.Container.prototype.refreshGadgets=function(){for(var a in this.gadgets_)this.gadgets_[a].refresh()};shindig.IfrContainer=function(){shindig.Container.call(this)};shindig.IfrContainer.inherits(shindig.Container);shindig.IfrContainer.prototype.gadgetClass=
shindig.BaseIfrGadget;shindig.IfrContainer.prototype.gadgetService=new shindig.IfrGadgetService;shindig.IfrContainer.prototype.setParentUrl=function(a){a.match(/^http[s]?:\/\//)||(a=document.location.href.match(/^[^?#]+\//)[0]+a);this.parentUrl_=a};shindig.IfrContainer.prototype.renderGadget=function(a){var b=this.layoutManager.getGadgetChrome(a);a.render(b)};gadgets.config&&gadgets.config.register("shindig-container",null,h);shindig.container=new shindig.IfrContainer})();if(gadgets&&gadgets.rpc){osapi._handleGadgetRpcMethod=function(a){for(var e=Array(a.length),d=0,g=this.callback,b=function(a,b){b({})},c=0;c<a.length;c++){var f=osapi;if(-1==a[c].method.indexOf("_"))for(var k=a[c].method.split("."),h=0;h<k.length;h++)if(f.hasOwnProperty(k[h]))f=f[k[h]];else{f=b;break}else f=b;f(a[c].params,function(b){return function(c){e[b]={id:a[b].id,data:c};d++;d==a.length&&g(e)}}(c))}};osapi.container={};osapi.container.listMethods=function(a,e){var d=[];recurseNames(osapi,"",
5,d);e(d)};var recurseNames=function(a,e,d,g){if(0!=d)for(var b in a)if(a.hasOwnProperty(b)&&-1==b.indexOf("_")){var c=typeof a[b];"function"==c?g.push(e+b):"object"==c&&recurseNames(a[b],e+b+".",d-1,g)}};gadgets.rpc.register("osapi._handleGadgetRpcMethod",osapi._handleGadgetRpcMethod)};osapi.container={};osapi.container.MetadataParam={LOCAL_EXPIRE_TIME:"localExpireTimeMs",URL:"url"};osapi.container.MetadataResponse={IFRAME_URLS:"iframeUrls",NEEDS_TOKEN_REFRESH:"needsTokenRefresh",VIEWS:"views",EXPIRE_TIME_MS:"expireTimeMs",FEATURES:"features",HEIGHT:"height",MODULE_PREFS:"modulePrefs",PREFERRED_HEIGHT:"preferredHeight",PREFERRED_WIDTH:"preferredWidth",RESPONSE_TIME_MS:"responseTimeMs",WIDTH:"width",TOKEN_TTL:"tokenTTL"};
osapi.container.TokenResponse={TOKEN:"token",TOKEN_TTL:"tokenTTL",MODULE_ID:"moduleId"};osapi.container.NavigateTiming={URL:"url",ID:"id",START:"start",XRT:"xrt",SRT:"srt",DL:"dl",OL:"ol",PRT:"prt"};osapi.container.RenderParam={ALLOW_DEFAULT_VIEW:"allowDefaultView",CAJOLE:"cajole",CLASS:"class",DEBUG:"debug",HEIGHT:"height",NO_CACHE:"nocache",REFRESH:"refresh",TEST_MODE:"testmode",USER_PREFS:"userPrefs",VIEW:"view",WIDTH:"width",MODULE_ID:"moduleid"};osapi.container.ViewParam={VIEW:"view"};
osapi.container.CallbackType={ON_BEFORE_PRELOAD:"onBeforePreload",ON_PRELOADED:"onPreloaded",ON_BEFORE_NAVIGATE:"onBeforeNavigate",ON_NAVIGATED:"onNavigated",ON_BEFORE_CLOSE:"onBeforeClose",ON_CLOSED:"onClosed",ON_BEFORE_UNLOAD:"onBeforeUnload",ON_UNLOADED:"onUnloaded",ON_BEFORE_RENDER:"onBeforeRender",ON_RENDER:"onRender",GADGET_ON_LOAD:"__gadgetOnLoad"};
osapi.container.ContainerConfig={ALLOW_DEFAULT_VIEW:"allowDefaultView",RENDER_CAJOLE:"renderCajole",RENDER_DEBUG:"renderDebug",RENDER_DEBUG_PARAM:"renderDebugParam",RENDER_TEST:"renderTest",TOKEN_REFRESH_INTERVAL:"tokenRefreshInterval",NAVIGATE_CALLBACK:"navigateCallback",PRELOAD_REF_TIME:"preloadRefTime",PRELOAD_METADATAS:"preloadMetadatas",PRELOAD_TOKENS:"preloadTokens",GET_LANGUAGE:"GET_LANGUAGE",GET_COUNTRY:"GET_COUNTRY",GET_PREFERENCES:"GET_PREFERENCES",SET_PREFERENCES:"SET_PREFERENCES",RPC_ARBITRATOR:"rpcArbitrator",
GET_GADGET_TOKEN:"GET_GADGET_TOKEN",GET_CONTAINER_TOKEN:"GET_CONTAINER_TOKEN"};osapi.container.ServiceConfig={API_HOST:"apiHost",API_PATH:"apiPath"};osapi.container.util={};osapi.container.util.getSafeJsonValue=function(a,b,c){return"undefined"!=typeof a[b]&&null!=a[b]?a[b]:c};osapi.container.util.mergeJsons=function(a,b){var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c};osapi.container.util.newMetadataRequest=function(a){osapi.container.util.isArray(a)||(a=[a]);return{container:window.__CONTAINER,ids:a,fields:"iframeUrls modulePrefs.* needsTokenRefresh userPrefs.* views.preferredHeight views.preferredWidth expireTimeMs responseTimeMs rpcServiceIds tokenTTL".split(" ")}};
osapi.container.util.newTokenRequest=function(a){osapi.container.util.isArray(a)||(a=[a]);return{container:window.__CONTAINER,ids:a,fields:["token","tokenTTL","moduleId"]}};osapi.container.util.toArrayOfJsonKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};osapi.container.util.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)};osapi.container.util.isEmptyJson=function(a){for(var b in a)return!1;return!0};osapi.container.util.getCurrentTimeMs=function(){return(new Date).getTime()};
osapi.container.util.createIframeHtml=function(a){var b=[],c=0;b[c++]="\x3ciframe ";for(var d in a){var e=a[d];"undefined"!=typeof e&&(b[c++]=d,b[c++]='\x3d"',b[c++]=e,b[c++]='" ')}b[c++]="\x3e\x3c/iframe\x3e";return b.join("")};osapi.container.util.buildTokenRequestUrl=function(a,b){a=shindig.uri(a);b&&a.setFP("moduleId",b);return a.toString()};osapi.container.Site=function(a,b,c,d){this.container_=a;this.service_=b;this.id_=(this.el_=c)&&this.el_.id?this.el_.id:osapi.container.Site.prototype.nextUniqueSiteId_++;this.title_=this.ownerId_=this.parentId_=void 0};osapi.container.Site.DEFAULT_TITLE="default title";osapi.container.Site.prototype.nextUniqueSiteId_=0;osapi.container.Site.prototype.onConstructed=function(){};osapi.container.Site.prototype.getId=function(){return this.id_};
osapi.container.Site.prototype.setWidth=function(a){var b=this.getActiveSiteHolder();if(b&&(b=b.getIframeElement()))b.style.width=a;return this};osapi.container.Site.prototype.setHeight=function(a){var b=this.getActiveSiteHolder();if(b&&(b=b.getIframeElement()))b.style.height=a;return this};osapi.container.Site.prototype.setTitle=function(a){this.title_=a;var b=this.getActiveSiteHolder();b&&b.setTitle(a);return this};
osapi.container.Site.prototype.getTitle=function(){if("undefined"!==typeof this.title_)return this.title_;var a=this.getActiveSiteHolder();return a&&a.gadgetInfo_&&(a=a.gadgetInfo_)&&a.modulePrefs&&a.modulePrefs.title?a.modulePrefs.title:osapi.container.Site.DEFAULT_TITLE};osapi.container.Site.prototype.close=function(){var a=this.getActiveSiteHolder();a&&a.dispose()};osapi.container.Site.prototype.getParentId=function(){return this.parentId_};
osapi.container.Site.prototype.setParentId=function(a){this.parentId_=a;return this};osapi.container.Site.prototype.getActiveSiteHolder=function(){throw Error("This method must be implemented by a subclass.");};osapi.container.Site.prototype.render=function(){throw Error("This method must be implemented by a subclass.");};osapi.container.SiteHolder=function(c,b,a){this.site_=c;this.el_=b;this.onLoad_=a;this.renderParams_=this.iframeId_=void 0;this.onConstructed()};osapi.container.SiteHolder.prototype.onConstructed=function(){};osapi.container.SiteHolder.prototype.getElement=function(){return this.el_};osapi.container.SiteHolder.prototype.getIframeId=function(){return this.iframeId_};osapi.container.SiteHolder.prototype.dispose=function(){this.el_&&this.el_.firstChild&&this.el_.removeChild(this.el_.firstChild)};
osapi.container.SiteHolder.prototype.createIframeHtml=function(c,b){var a=this.createIframeAttributeMap(c,b);a.onload=this.onLoad_?"window."+this.onLoad_+"('"+this.getUrl()+"', '"+this.site_.getId()+"');":void 0;return osapi.container.util.createIframeHtml(a)};
osapi.container.SiteHolder.prototype.createIframeAttributeMap=function(c,b){var a=this.renderParams_||{},a={id:this.iframeId_,name:this.iframeId_,src:c,scrolling:"no",marginwidth:0,marginheight:0,frameborder:0,vspace:0,hspace:0,"class":a[osapi.container.RenderParam.CLASS],height:a[osapi.container.RenderParam.HEIGHT],width:a[osapi.container.RenderParam.WIDTH]};if(b)for(var d in b)a[d]=b[d];return a};
osapi.container.SiteHolder.prototype.setTitle=function(c){var b=this.getIframeElement();b&&(b.title=c)};osapi.container.SiteHolder.prototype.getIframeElement=function(){throw Error("This method must be implemented by a subclass.");};osapi.container.SiteHolder.prototype.render=function(){throw Error("This method must be implemented by a subclass.");};osapi.container.SiteHolder.prototype.getUrl=function(){throw Error("This method must be implemented by a subclass.");};osapi.container.GadgetHolder=function(a,b,c){osapi.container.SiteHolder.call(this,a,b,c);this.securityTokenTTL_=this.securityToken_=this.viewParams_=this.gadgetInfo_=void 0;this.onConstructed()};osapi.container.GadgetHolder.prototype=new osapi.container.SiteHolder;osapi.container.GadgetHolder.prototype.relayPath_=null;osapi.container.GadgetHolder.prototype.getGadgetInfo=function(){return this.gadgetInfo_};
osapi.container.GadgetHolder.prototype.dispose=function(){osapi.container.SiteHolder.prototype.dispose.call(this);this.gadgetInfo_=null};osapi.container.GadgetHolder.prototype.getUrl=function(){return this.gadgetInfo_&&this.gadgetInfo_.url};osapi.container.GadgetHolder.prototype.getView=function(){return this.renderParams_[osapi.container.RenderParam.VIEW]};osapi.container.GadgetHolder.prototype.getIframeElement=function(){return this.el_.getElementsByTagName("iframe")[0]};
osapi.container.GadgetHolder.prototype.setSecurityToken=function(a,b){this.securityToken_=a;this.securityTokenTTL_=b;return this};osapi.container.GadgetHolder.prototype.render=function(a,b,c){this.iframeId_=osapi.container.GadgetHolder.IFRAME_ID_PREFIX_+this.site_.getId();this.gadgetInfo_=a;this.viewParams_=b;this.renderParams_=c;this.hasFeature_(a,"pubsub-2")?this.doOaaIframeHtml_():this.doNormalIframeHtml_()};osapi.container.GadgetHolder.IFRAME_ID_PREFIX_="__gadget_";
osapi.container.GadgetHolder.DEFAULT_GADGET_TITLE="gadget contents";
osapi.container.GadgetHolder.prototype.doNormalIframeHtml_=function(){var a=this.removeStFromIfrAddr(this.getIframeUrl_()),b=null;if(this.el_.ownerDocument&&null!==this.el_.ownerDocument){for(var b=this.el_.ownerDocument.defaultView,c=0;b&&b!==window;)b=b.parent,c++;b=shindig.uri(a);b.setFP("embeddedlevel",c)}else b=shindig.uri(a);a=document.createElement("div");for(a.innerHTML=this.createIframeHtml(b.toString(),{title:this.site_.getTitle(),role:"presentation"});this.el_.firstChild;)this.el_.removeChild(this.el_.firstChild);
this.el_.appendChild(a.children[0]);a=shindig.uri().setSchema(b.getSchema()).setAuthority(b.getAuthority()).setPath(this.relayPath_);gadgets.rpc.setupReceiver(this.iframeId_,a.toString(),b.getFP("rpctoken"))};
osapi.container.GadgetHolder.prototype.doOaaIframeHtml_=function(){this.removeOaaContainer_(this.iframeId_);var a=this.removeStFromIfrAddr(this.getIframeUrl_()),b=this;new OpenAjax.hub.IframeContainer(gadgets.pubsub2router.hub,this.iframeId_,{Container:{onSecurityAlert:function(a,b){gadgets.error(["Security error for container ",a.getClientID()," : ",b].join(""));a.getIframe().src="about:blank"},onConnect:function(a){gadgets.log(["connected: ",a.getClientID()].join(""))}},IframeContainer:{parent:this.el_,
uri:a,tunnelURI:shindig.uri(this.relayPath_).resolve(shindig.uri(window.location.href)),iframeAttrs:this.createIframeAttributeMap(a,{title:this.site_.getTitle(),role:"presentation"}),onGadgetLoad:function(){if(b.onLoad_)window[b.onLoad_](b.getUrl(),b.site_.getId())}}})};osapi.container.GadgetHolder.prototype.removeOaaContainer_=function(a){(a=gadgets.pubsub2router.hub.getContainer(a))&&gadgets.pubsub2router.hub.removeContainer(a)};
osapi.container.GadgetHolder.prototype.hasFeature_=function(a,b){var c=a[osapi.container.MetadataResponse.MODULE_PREFS];return c&&(c=c[osapi.container.MetadataResponse.FEATURES])&&c[b]?!0:!1};
osapi.container.GadgetHolder.prototype.getIframeUrl_=function(){var a=shindig.uri(this.gadgetInfo_[osapi.container.MetadataResponse.IFRAME_URLS][this.getView()]);a.setQP("debug",this.renderParams_[osapi.container.RenderParam.DEBUG]?"1":"0");a.setQP("nocache",this.renderParams_[osapi.container.RenderParam.NO_CACHE]?"1":"0");a.setQP("testmode",this.renderParams_[osapi.container.RenderParam.TEST_MODE]?"1":"0");a.setQP("view",this.getView());if(this.renderParams_[osapi.container.RenderParam.CAJOLE]){var b=
a.getQP("libs");null==b||""==b?a.setQP("libs","caja"):a.setQP("libs",[b,":caja"].join(""));a.setQP("caja","1")}this.renderParams_[osapi.container.RenderParam.REFRESH]&&a.setQP("refresh",this.renderParams_[osapi.container.RenderParam.REFRESH]);this.updateUserPrefParams_(a);a.setQP("parent",window.__CONTAINER_URI.getOrigin());!this.securityTokenInCookie_&&this.securityToken_?a.setExistingP("st",this.securityToken_):this.securityTokenInCookie_&&(b=a.getQP("st"),"undefined"!=typeof b&&(this.securityToken_||
(this.securityToken_=b),a.setQP("st",void 0)));a.setQP("mid",String(this.site_.getModuleId()));osapi.container.util.isEmptyJson(this.viewParams_)||(b=gadgets.json.stringify(this.viewParams_),a.setFP("view-params",b));"undefined"===typeof a.getFP("rpctoken")&&(b=2147483647*Math.random()|0,a.setFP("rpctoken",b));var b=this.site_.service_.getLanguage(),c=this.site_.service_.getCountry(),e=a.getQP("lang"),d=a.getQP("country");-1!=e.indexOf("%")&&a.setQP("lang",b);-1!=d.indexOf("%")&&a.setQP("country",
c);return a.toString()};osapi.container.GadgetHolder.prototype.updateUserPrefParams_=function(a){var b=this.renderParams_[osapi.container.RenderParam.USER_PREFS];if(b)for(var c in b){var e="up_"+c,d=b[c];d instanceof Array&&(d=d.join("|"));a.setExistingP(e,d)}};
osapi.container.GadgetHolder.prototype.removeStFromIfrAddr=function(a){if("string"===typeof a){var b=a,c=a.indexOf("st\x3d"),e=a.indexOf("\x26",c);if(-1!=c){var d;-1!=e?(d=a.substring(c+3,e),b=e+1<a.length?a.substring(0,c)+a.substring(e+1):a.substring(0,c)):(c+3<a.length&&(d=a.substring(c)),b=a.substring(0,c));this.securityToken_=d}return this.securityTokenInCookie_?b:a}return a};
gadgets.config&&gadgets.config.register("container",null,function(a){a.container&&(osapi.container.GadgetHolder.prototype.relayPath_=a.container.relayPath);a["core.io"]&&(osapi.container.GadgetHolder.prototype.securityTokenInCookie_=a["core.io"].securityTokenInCookie)});osapi.container.GadgetSite=function(b,c,d){osapi.container.Site.call(this,b,c,d.gadgetEl);this.navigateCallback_=d.navigateCallback;this.loadingGadgetEl_=d.bufferEl;this.gadgetOnLoad_=d.gadgetOnLoad;this.moduleId_=0;this.loadingGadgetHolder_=this.currentGadgetHolder_=void 0;this.onConstructed()};osapi.container.GadgetSite.prototype=new osapi.container.Site;osapi.container.GadgetSite.prototype.getModuleId=function(){return this.moduleId_};
osapi.container.GadgetSite.prototype.setModuleId_=function(b,c,d){if(c&&this.moduleId_!=c){var a=this;b=osapi.container.util.buildTokenRequestUrl(b,c);if(!a.service_.getCachedGadgetToken(b)){c=osapi.container.util.newTokenRequest([b]);a.service_.getGadgetToken(c,function(c){var e;if(c&&c[b]&&((e=c[b][osapi.container.TokenResponse.TOKEN_TTL])&&a.container_.scheduleRefreshTokens_(e),(c=c[b][osapi.container.TokenResponse.MODULE_ID])||0==c))a.moduleId_=c;d&&d()});return}}d&&d()};
osapi.container.GadgetSite.prototype.getActiveSiteHolder=function(){return this.loadingGadgetHolder_||this.currentGadgetHolder_};osapi.container.GadgetSite.prototype.setTitle=function(b){osapi.container.Site.prototype.setTitle.call(this,b);this.loadingGadgetHolder_&&this.currentGadgetHolder_&&this.currentGadgetHolder_.setTitle(b);return this};
osapi.container.GadgetSite.prototype.getFeature=function(b,c){var d=c||this.getActiveSiteHolder().getGadgetInfo();return d[osapi.container.MetadataResponse.FEATURES]&&d[osapi.container.MetadataResponse.FEATURES][b]};
osapi.container.GadgetSite.prototype.navigateTo=function(b,c,d,a){var f=osapi.container.util.getCurrentTimeMs(),e=this.service_.getCachedGadgetMetadata(b),h=a||function(){};a=osapi.container.util.newMetadataRequest([b]);var g=this;this.service_.getGadgetMetadata(a,function(a){var l=!e?osapi.container.util.getCurrentTimeMs()-f:0,k=a[b];k.error?(a=["Failed to navigate for gadget ",b,"."].join(""),gadgets.warn(a),a=["Detailed error: ",k.error.code||""," ",k.error.message||""].join(""),gadgets.log(a)):
g.setModuleId_(b,d[osapi.container.RenderParam.MODULE_ID]||0,function(){g.container_.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_RENDER,k);g.render(k,c,d)});a={};a[osapi.container.NavigateTiming.URL]=b;a[osapi.container.NavigateTiming.ID]=g.id_;a[osapi.container.NavigateTiming.START]=f;a[osapi.container.NavigateTiming.XRT]=l;g.onNavigateTo(a);h(k)})};
osapi.container.GadgetSite.prototype.onNavigateTo=function(b){if(this.navigateCallback_){var c=window[this.navigateCallback_];"function"===typeof c&&c(b)}};
osapi.container.GadgetSite.prototype.render=function(b,c,d){var a=null;if((this.currentGadgetHolder_?this.currentGadgetHolder_.getUrl():null)==b.url)a=this.currentGadgetHolder_.getView();var f=function(a){if("undefined"!==typeof a&&null!=a){a=a.aliases||[];for(var c=0;c<a.length;c++)if(b[osapi.container.MetadataResponse.VIEWS][a[c]])return{view:a[c],viewInfo:b[osapi.container.MetadataResponse.VIEWS][a[c]]}}return null},a=d[osapi.container.RenderParam.VIEW]||c[osapi.container.ViewParam.VIEW]||a,e=
b[osapi.container.MetadataResponse.VIEWS][a];if(a&&!e){var h=f(gadgets.config.get("views")[a]);h&&(a=h.view,e=h.viewInfo)}if(!e&&(d[osapi.container.RenderParam.ALLOW_DEFAULT_VIEW]&&a!=osapi.container.GadgetSite.DEFAULT_VIEW_)&&(a=osapi.container.GadgetSite.DEFAULT_VIEW_,e=b[osapi.container.MetadataResponse.VIEWS][a],!e&&(h=f(gadgets.config.get("views")[a]))))a=h.view,e=h.viewInfo;if(e){this.currentGadgetHolder_&&!this.loadingGadgetEl_?(this.loadingGadgetHolder_=this.currentGadgetHolder_,this.currentGadgetHolder_=
null):this.loadingGadgetHolder_=new osapi.container.GadgetHolder(this,this.loadingGadgetEl_||this.el_,this.gadgetOnLoad_);var f={},g;for(g in d)f[g]=d[g];f[osapi.container.RenderParam.VIEW]=a;f[osapi.container.RenderParam.HEIGHT]=d[osapi.container.RenderParam.HEIGHT]||e[osapi.container.MetadataResponse.PREFERRED_HEIGHT]||b[osapi.container.MetadataResponse.MODULE_PREFS][osapi.container.MetadataResponse.HEIGHT]||String(osapi.container.GadgetSite.DEFAULT_HEIGHT_);f[osapi.container.RenderParam.WIDTH]=
d[osapi.container.RenderParam.WIDTH]||e[osapi.container.MetadataResponse.PREFERRED_WIDTH]||b[osapi.container.MetadataResponse.MODULE_PREFS][osapi.container.MetadataResponse.WIDTH]||String(osapi.container.GadgetSite.DEFAULT_WIDTH_);this.updateSecurityToken_(b,f);this.loadingGadgetHolder_.render(b,c,f)}else gadgets.warn(["Unsupported view ",a," for gadget ",b.url,"."].join(""))};
osapi.container.GadgetSite.prototype.onRender=function(){this.swapBuffers_();this.currentGadgetHolder_&&this.currentGadgetHolder_.dispose();this.currentGadgetHolder_=this.loadingGadgetHolder_;this.loadingGadgetHolder_=null};osapi.container.GadgetSite.prototype.rpcCall=function(b,c,d){this.currentGadgetHolder_&&gadgets.rpc.call(this.currentGadgetHolder_.getIframeId(),b,c,d)};
osapi.container.GadgetSite.prototype.updateSecurityToken_=function(b,c){var d=osapi.container.util.buildTokenRequestUrl(b.url,this.moduleId_);(d=this.service_.getCachedGadgetToken(d))&&this.loadingGadgetHolder_.setSecurityToken(d[osapi.container.TokenResponse.TOKEN])};osapi.container.GadgetSite.prototype.close=function(){this.loadingGadgetHolder_&&this.loadingGadgetHolder_.dispose();this.currentGadgetHolder_&&this.currentGadgetHolder_.dispose()};
osapi.container.GadgetSite.prototype.swapBuffers_=function(){if(this.loadingGadgetEl_){this.loadingGadgetEl_.style.left="";this.loadingGadgetEl_.style.position="";this.el_.style.position="absolute";this.el_.style.left="-2000px";var b=this.el_;this.el_=this.loadingGadgetEl_;this.loadingGadgetEl_=b}};osapi.container.GadgetSite.RPC_ARG_KEY="gs";osapi.container.GadgetSite.DEFAULT_HEIGHT_=200;osapi.container.GadgetSite.DEFAULT_WIDTH_=320;osapi.container.GadgetSite.DEFAULT_VIEW_="default";osapi.container.UrlHolder=function(a,b,c){osapi.container.SiteHolder.call(this,a,b,c);this.url_=void 0;this.onConstructed()};osapi.container.UrlHolder.prototype=new osapi.container.SiteHolder;osapi.container.UrlHolder.prototype.dispose=function(){osapi.container.SiteHolder.prototype.dispose.call(this);this.url_=null};osapi.container.UrlHolder.prototype.getIframeElement=function(){return this.el_.firstChild};osapi.container.UrlHolder.prototype.getUrl=function(){return this.url_};
osapi.container.UrlHolder.prototype.render=function(a,b){this.iframeId_=osapi.container.UrlHolder.IFRAME_PREFIX_+this.site_.getId();this.renderParams_=b;this.el_.innerHTML=this.createIframeHtml(this.url_=a,{scrolling:"auto",title:this.site_.getTitle(),role:"presentation"})};osapi.container.UrlHolder.IFRAME_PREFIX_="__url_";osapi.container.UrlSite=function(c,a,b){osapi.container.Site.call(this,c,a,b[osapi.container.UrlSite.URL_ELEMENT]);this.url_=this.holder_=void 0;this.onConstructed()};osapi.container.UrlSite.prototype=new osapi.container.Site;osapi.container.UrlSite.prototype.getActiveSiteHolder=function(){return this.holder_};osapi.container.UrlSite.prototype.render=function(c,a){this.holder_=new osapi.container.UrlHolder(this,this.el_);var b={},d;for(d in a)b[d]=a[d];this.holder_.render(c,b)};
osapi.container.UrlSite.URL_ELEMENT="urlEl";osapi.container.Service=function(a){this.container_=a;a=this.config_=a.config_||{};var b=((gadgets.config.get("osapi")||{}).endPoints||[window.__API_URI.getOrigin()+"/rpc"])[0],b=/^([^\/]*\/\/[^\/]+)(.*)$/.exec(b);this.apiHost_=String(osapi.container.util.getSafeJsonValue(a,osapi.container.ServiceConfig.API_HOST,b[1]));this.apiPath_=String(osapi.container.util.getSafeJsonValue(a,osapi.container.ServiceConfig.API_PATH,b[2]));this.cachedMetadatas_={};this.cachedTokens_={};a.GET_LANGUAGE&&(this.getLanguage=
a.GET_LANGUAGE);a.GET_COUNTRY&&(this.getCountry=a.GET_COUNTRY);this.registerOsapiServices();this.onConstructed(a)};osapi.container.Service.prototype.onConstructed=function(a){};
osapi.container.Service.prototype.getGadgetMetadata=function(a,b){var f=b||function(){},d=osapi.container.util.toArrayOfJsonKeys(this.getUncachedDataByRequest_(this.cachedMetadatas_,a)),c=this.getCachedDataByRequest_(this.cachedMetadatas_,a);if(0==d.length)f(c);else{var g=this;a.ids=d;a.language=this.getLanguage();a.country=this.getCountry();this.updateContainerSecurityToken(function(b){if(b){for(var e=0;e<a.ids.length;e++)c[a.ids[e]]={error:b};f(c)}else osapi.gadgets.metadata(a).execute(function(b){if(b.error)for(var e=
0;e<a.ids.length;e++){var d=a.ids[e];c[d]={error:b.error}}else for(d in e=osapi.container.util.getCurrentTimeMs(),b){var h=b[d];g.updateResponse_(h,d,e);g.cachedMetadatas_[d]=h;c[d]=h}f(c)})})}};osapi.container.Service.prototype.addGadgetMetadatas=function(a,b){this.addToCache_(a,b,this.cachedMetadatas_)};osapi.container.Service.prototype.addGadgetTokens=function(a,b){this.addToCache_(a,b,this.cachedTokens_)};
osapi.container.Service.prototype.addToCache_=function(a,b,f){var d=osapi.container.util.getCurrentTimeMs(),c;for(c in a){var g=a[c];this.updateResponse_(g,c,d,b);f[c]=g}};osapi.container.Service.prototype.updateResponse_=function(a,b,f,d){a[osapi.container.MetadataParam.URL]=b;a[osapi.container.MetadataParam.LOCAL_EXPIRE_TIME]=a[osapi.container.MetadataResponse.EXPIRE_TIME_MS]-(null==d?a[osapi.container.MetadataResponse.RESPONSE_TIME_MS]:d)+f};
osapi.container.Service.prototype.getGadgetToken=function(a,b){var f=b||function(){},d=this,c=function(b){var c={};if(b.error)for(var e=0;e<a.ids.length;e++)c[a.ids[e]]={error:b.error};else for(e in b){var m=osapi.container.util.buildTokenRequestUrl(e,b[e][osapi.container.TokenResponse.MODULE_ID]);d.cachedTokens_[m]=b[e];c[e]=b[e]}f(c)};d.updateContainerSecurityToken(function(b){if(b)c({error:b});else if(d.config_[osapi.container.ContainerConfig.GET_GADGET_TOKEN])d.config_[osapi.container.ContainerConfig.GET_GADGET_TOKEN](a,
c);else osapi.gadgets.token(a).execute(c)})};osapi.container.Service.prototype.getCachedGadgetMetadata=function(a){return this.cachedMetadatas_[a]};osapi.container.Service.prototype.getCachedGadgetToken=function(a){return this.cachedTokens_[a]};
osapi.container.Service.prototype.uncacheStaleGadgetMetadataExcept=function(a){for(var b in this.cachedMetadatas_)"undefined"===typeof a[b]&&this.cachedMetadatas_[b][osapi.container.MetadataParam.LOCAL_EXPIRE_TIME]<osapi.container.util.getCurrentTimeMs()&&delete this.cachedMetadatas_[b]};
osapi.container.Service.prototype.registerOsapiServices=function(){var a=this.apiHost_+this.apiPath_,b={"gadgets.rpc":["container.listMethods"]};b[a]=["gadgets.metadata","gadgets.token"];gadgets.config.init({osapi:{endPoints:[a]},"osapi.services":b})};osapi.container.Service.prototype.getCachedDataByRequest_=function(a,b){return this.filterCachedDataByRequest_(a,b,function(a){return"undefined"!==typeof a})};
osapi.container.Service.prototype.getUncachedDataByRequest_=function(a,b){return this.filterCachedDataByRequest_(a,b,function(a){return"undefined"===typeof a})};osapi.container.Service.prototype.filterCachedDataByRequest_=function(a,b,f){for(var d={},c=0;c<b.ids.length;c++){var g=b.ids[c],h=a[g];f(h)&&(d[g]=h)}return d};osapi.container.Service.prototype.getLocale_=function(){var a=window.navigator;return a.userLanguage||a.systemLanguage||a.language};
osapi.container.Service.prototype.getLanguage=function(){try{return this.getLocale_().split("-")[0]||"ALL"}catch(a){return"ALL"}};osapi.container.Service.prototype.getCountry=function(){try{return this.getLocale_().split("-")[1]||"ALL"}catch(a){return"ALL"}};
(function(){function a(a,b){for(;a.length;)a.shift().call(null,b)}function b(e){var m=this;f&&(clearTimeout(f),f=0);(e=e||this.config_[osapi.container.ContainerConfig.GET_CONTAINER_TOKEN])?c||(c=!0,e(function(e,l,k){c=!1;(g="number"==typeof l?800*l:g)&&(f=setTimeout(gadgets.util.makeClosure(m,b,null),g));e?(shindig.auth.updateSecurityToken(e),d=osapi.container.util.getCurrentTimeMs(),a(h)):k&&a(h,k)})):(c=!1,a(h))}var f,d,c,g=144E4,h=[];osapi.container.Service.prototype.updateContainerSecurityToken=
function(a,f,n){var l=osapi.container.util.getCurrentTimeMs(),k="boolean"!=typeof f&&f||void 0;f="boolean"==typeof f&&f;g&&(c||k||!d||l>d+g)?(d&&!(l>d+95*g/80)&&a?a():a&&h.push(a),k?b.call(this,function(a){a(k,n)}):!c&&!f&&b.call(this)):a&&a()}})();osapi.container.Container=function(a){a=this.config_=a||{};this.gadgetLifecycleCallbacks_={};this.preloadedGadgetUrls_={};this.sites_={};this.allowDefaultView_=Boolean(osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.ALLOW_DEFAULT_VIEW,!0));this.renderCajole_=Boolean(osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.RENDER_CAJOLE,!1));this.renderDebugParam_=String(osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.RENDER_DEBUG_PARAM,
osapi.container.ContainerConfig.RENDER_DEBUG));var b=window.__CONTAINER_URI.getQP(this.renderDebugParam_);this.renderDebug_="undefined"===typeof b?Boolean(osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.RENDER_DEBUG,!1)):"1"===b;this.renderTest_=Boolean(osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.RENDER_TEST,!1));this.tokenRefreshInterval_=Number(osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.TOKEN_REFRESH_INTERVAL,0));this.lastRefresh_=
0;this.navigateCallback_=String(osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.NAVIGATE_CALLBACK,null));this.service_=new osapi.container.Service(this);this.tokenRefreshTimer_=null;var c=this;window[osapi.container.CallbackType.GADGET_ON_LOAD]=function(a,b){c.getSiteById(b).onRender();c.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_RENDER,a,b)};this.initializeMixins_();this.setupRpcArbitrator_(a);this.preloadCaches(a);this.registerRpcServices_();this.onConstructed(a)};
osapi.container.Container.prototype.newGadgetSite=function(a,b){if(null===a||void 0===a){var c=["Failed to create gadget site because gadgetEl is ",a,"."].join("");gadgets.error(c);return null}c=new osapi.container.GadgetSite(this,this.service_,{navigateCallback:this.navigateCallback_,gadgetEl:a,bufferEl:b||null,gadgetOnLoad:osapi.container.CallbackType.GADGET_ON_LOAD});return this.sites_[c.getId()]=c};
osapi.container.Container.prototype.navigateGadget=function(a,b,c,d,e){var f=e||function(){};e=osapi.container.ContainerConfig;var g=osapi.container.RenderParam;this.allowDefaultView_&&(d[g.ALLOW_DEFAULT_VIEW]=!0);this.renderCajole_&&(d[g.CAJOLE]=!0);this.renderDebug_&&(d[g.NO_CACHE]=!0,d[g.DEBUG]=!0);this.renderTest_&&(d[g.TEST_MODE]=!0);this.refreshService_();var h=this,k=function(e){d[g.USER_PREFS]=e;h.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_NAVIGATE,b,a.getId());a.navigateTo(b,
c,d,function(c){c.error?gadgets.warn(["Failed to possibly schedule token refresh for gadget ",b,"."].join("")):c[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]&&h.scheduleRefreshTokens_(c[osapi.container.MetadataResponse.TOKEN_TTL]);h.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_NAVIGATED,a);f(c)})};if(this.config_[e.GET_PREFERENCES]&&!d[g.USER_PREFS])this.config_[e.GET_PREFERENCES](a.getId(),b,k);else k(d[g.USER_PREFS])};
osapi.container.Container.prototype.closeGadget=function(a){var b=a.getId();this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_CLOSE,a);a.close();this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_CLOSED,a);delete this.sites_[b];a instanceof osapi.container.GadgetSite&&this.unscheduleRefreshTokens_()};osapi.container.Container.prototype.addGadgetLifecycleCallback=function(a,b){return!this.gadgetLifecycleCallbacks_[a]?(this.gadgetLifecycleCallbacks_[a]=b,!0):!1};
osapi.container.Container.prototype.removeGadgetLifecycleCallback=function(a){delete this.gadgetLifecycleCallbacks_[a]};osapi.container.Container.prototype.preloadGadget=function(a,b){this.preloadGadgets([a],b)};
osapi.container.Container.prototype.preloadGadgets=function(a,b){var c=b||function(){},d=osapi.container.util.newMetadataRequest(a),e=this;this.refreshService_();this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_PRELOAD,a);this.service_.getGadgetMetadata(d,function(a){e.addPreloadGadgets_(a);e.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_PRELOADED,a);c(a)})};osapi.container.Container.prototype.unloadGadget=function(a){this.unloadGadgets([a])};
osapi.container.Container.prototype.unloadGadgets=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_UNLOAD,c);delete this.preloadedGadgetUrls_[c];this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_UNLOADED,c)}};osapi.container.Container.prototype.getGadgetMetadata=function(a,b){var c=osapi.container.util.newMetadataRequest([a]);this.refreshService_();this.service_.getGadgetMetadata(c,b)};
osapi.container.Container.prototype.rpcRegister=function(a,b){var c=this;return gadgets.rpc.register(a,function(){this[osapi.container.GadgetSite.RPC_ARG_KEY]=c.getGadgetSiteByIframeId_(this.f);for(var a=[this],e=0;e<arguments.length;++e)a.push(arguments[e]);return b.apply(c,a)})};osapi.container.Container.prototype.onConstructed=function(a){};
osapi.container.Container.addMixin=function(a,b){var c=osapi.container.Container.prototype.mixins_;if(c[a]){var d=c[a];c[a]=function(a){d.call(this,a);return b.call(this,a)}}else osapi.container.Container.prototype.mixinsOrder_.push(a),c[a]=b};osapi.container.Container.prototype.mixins_={};osapi.container.Container.prototype.mixinsOrder_=[];
osapi.container.Container.prototype.initializeMixins_=function(){for(var a=osapi.container.Container.prototype.mixins_,b=osapi.container.Container.prototype.mixinsOrder_,c=0;c<b.length;c++){var d=b[c];this[d]=new a[d](this)}};
osapi.container.Container.prototype.addPreloadGadgets_=function(a,b){var c=b||{},d;for(d in a)if(a[d].error){var e=["Failed to preload gadget ",d,"."].join("");gadgets.warn(e);e=["Detailed error: ",a[d].error.code||""," ",a[d].error.message||""].join("");gadgets.log(e)}else this.addPreloadedGadgetUrl_(d),a[d][osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]&&this.scheduleRefreshTokens_(c[d]?c[d][osapi.container.TokenResponse.TOKEN_TTL]:a[d][osapi.container.MetadataResponse.TOKEN_TTL])};
osapi.container.Container.prototype.preloadCaches=function(a){var b=osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.PRELOAD_METADATAS,{}),c=osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.PRELOAD_TOKENS,{});a=osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.PRELOAD_REF_TIME,null);var d=[],e;for(e in b)b.hasOwnProperty(e)&&d.push(e);this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_BEFORE_PRELOAD,d);this.service_.addGadgetMetadatas(b,
a);this.service_.addGadgetTokens(c,a);this.addPreloadGadgets_(b,c);this.applyLifecycleCallbacks_(osapi.container.CallbackType.ON_PRELOADED,b)};osapi.container.Container.prototype.refreshService_=function(){var a=this.getActiveGadgetUrls_();this.service_.uncacheStaleGadgetMetadataExcept(a)};osapi.container.Container.prototype.getGadgetSiteByIframeId_=function(a){for(var b in this.sites_){var c=this.sites_[b],d=c.getActiveSiteHolder();if(d&&d.getIframeId()===a)return c}return null};
osapi.container.Container.prototype.getSiteById=function(a){return this.sites_[a]};osapi.container.Container.prototype.updateContainerSecurityToken=function(a,b,c){this.service_.updateContainerSecurityToken(a,b,c)};
osapi.container.Container.prototype.scheduleRefreshTokens_=function(a){var b=this,c=this.tokenRefreshInterval_,d=a?this.setRefreshTokenInterval_(1E3*a):c,e=function(){function a(c){c?setTimeout(gadgets.util.makeClosure(b,b.updateContainerSecurityToken,a,!0),1):(b.lastRefresh_=osapi.container.util.getCurrentTimeMs(),b.tokenRefreshTimer_=setTimeout(e,d),b.refreshTokens_())}b.updateContainerSecurityToken(a)};if(this.isRefreshTokensEnabled_()&&(!this.tokenRefreshTimer_||d!=c))a=osapi.container.util.getCurrentTimeMs(),
this.tokenRefreshTimer_?(c=(this.lastRefresh_||0)+c,c<a&&(c=a+d,d=1),c>a+d&&(clearTimeout(this.tokenRefreshTimer_),this.tokenRefreshTimer_=setTimeout(e,d))):(this.lastRefresh_=a,this.tokenRefreshTimer_=setTimeout(e,d))};osapi.container.Container.prototype.unscheduleRefreshTokens_=function(){this.tokenRefreshTimer_&&0>=this.getTokenRefreshableGadgetUrls_().length&&(clearTimeout(this.tokenRefreshTimer_),this.tokenRefreshTimer_=null)};
osapi.container.Container.prototype.isRefreshTokensEnabled_=function(){return 0<this.tokenRefreshInterval_};osapi.container.Container.prototype.setRefreshTokenInterval_=function(a){if(a){a*=0.8;var b=this.tokenRefreshInterval_;return 0>b?b:this.tokenRefreshInterval_=0==b?a:Math.min(b,a)}};
osapi.container.Container.prototype.registerRpcServices_=function(){var a=this;this.rpcRegister("resize_iframe",function(a,c){var d=a[osapi.container.GadgetSite.RPC_ARG_KEY];d&&d.setHeight(c)});this.rpcRegister("resize_iframe_width",function(a,c){var d=a[osapi.container.GadgetSite.RPC_ARG_KEY];d&&d.setWidth(c);return!0});this.rpcRegister("set_pref",function(b,c,d){var e=b[osapi.container.GadgetSite.RPC_ARG_KEY],f=a.config_[osapi.container.ContainerConfig.SET_PREFERENCES];if(e&&f){for(var g={},h=2,
k=arguments.length;h<k;h+=2)g[arguments[h]]=arguments[h+1];f(e.getId(),e.getActiveSiteHolder().getUrl(),g)}})};
osapi.container.Container.prototype.setupRpcArbitrator_=function(a){var b=gadgets.config.get("container");if("undefined"!==typeof b.enableRpcArbitration&&b.enableRpcArbitration){a=osapi.container.util.getSafeJsonValue(a,osapi.container.ContainerConfig.RPC_ARBITRATOR,null);if(!a){var c=this;a=function(a,b){var f=c.getGadgetSiteByIframeId_(b);if(f&&f.getActiveSiteHolder()&&(f=c.service_.getCachedGadgetMetadata(f.getActiveSiteHolder().getUrl()),!f.error&&f.rpcServiceIds))for(var g=0,h;h=f.rpcServiceIds[g];g++)if(h==
a)return!0;gadgets.warn("RPC call to "+a+" was not allowed.");return!1}}gadgets.rpc.config({arbitrator:a})}};osapi.container.Container.prototype.addPreloadedGadgetUrl_=function(a){this.preloadedGadgetUrls_[a]=null};
osapi.container.Container.prototype.getTokenRefreshableGadgetUrls_=function(){var a={},b;for(b in this.getActiveGadgetUrls_())this.service_.getCachedGadgetMetadata(b)[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]&&(a[b]=1);for(var c in this.sites_){var d=this.sites_[c];if(d instanceof osapi.container.GadgetSite&&(b=d.getActiveSiteHolder()))b=b.getUrl(),mid=d.getModuleId(),a[b]&&(a[osapi.container.util.buildTokenRequestUrl(b,mid)]=1)}return osapi.container.util.toArrayOfJsonKeys(a)};
osapi.container.Container.prototype.getActiveGadgetUrls_=function(){return osapi.container.util.mergeJsons(this.getNavigatedGadgetUrls_(),this.preloadedGadgetUrls_)};osapi.container.Container.prototype.getNavigatedGadgetUrls_=function(){var a={},b;for(b in this.sites_){var c=this.sites_[b];c instanceof osapi.container.GadgetSite&&(c=c.getActiveSiteHolder())&&(a[c.getUrl()]=1)}return a};
osapi.container.Container.prototype.refreshTokens_=function(){var a=this.getTokenRefreshableGadgetUrls_(),a=osapi.container.util.newTokenRequest(a),b=this;this.service_.getGadgetToken(a,function(a){for(var d in b.sites_){var e=b.sites_[d];if(e instanceof osapi.container.GadgetSite){var f=e.getActiveSiteHolder();if(f&&b.service_.getCachedGadgetMetadata(f.getUrl())[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]){var e=e.getModuleId(),e=osapi.container.util.buildTokenRequestUrl(f.getUrl(),e),
g=a[e];g.error?gadgets.warn(["Failed to get token for gadget ",e,"."].join("")):gadgets.rpc.call(f.getIframeId(),"update_security_token",null,g[osapi.container.TokenResponse.TOKEN])}}}})};osapi.container.Container.prototype.invalidateAllTokens_=function(){for(var a in this.sites_){var b=this.sites_[a];b instanceof osapi.container.GadgetSite&&(b=b.getActiveSiteHolder(),this.service_.getCachedGadgetMetadata(b.getUrl())[osapi.container.MetadataResponse.NEEDS_TOKEN_REFRESH]=!0)}};
osapi.container.Container.prototype.forceRefreshAllTokens=function(){this.invalidateAllTokens_();this.refreshTokens_()};osapi.container.Container.prototype.applyLifecycleCallbacks_=function(a){var b=Array.prototype.slice.call(arguments,1);for(name in this.gadgetLifecycleCallbacks_){var c=this.gadgetLifecycleCallbacks_[name][a];c&&c.apply(null,b)}};
osapi.container.Container.prototype.newUrlSite=function(a){var b={};b[osapi.container.UrlSite.URL_ELEMENT]=a;a=new osapi.container.UrlSite(this,this.service_,b);return this.sites_[a.getId()]=a};osapi.container.Container.prototype.navigateUrl=function(a,b,c){a.render(b,c);return a};gadgets.config.register("container",null,function(a){if("undefined"===typeof window.__CONTAINER_URI&&"undefined"===typeof window.__API_URI){var b=null;"undefined"!==typeof a.container&&"undefined"!==typeof a.container.jsPath&&(b=a.container.jsPath);window.__CONTAINER_URI=shindig.uri(window.location.href);a=window.__API_URI=null;if(window.__CONTAINER_SCRIPT_ID)a=document.getElementById(window.__CONTAINER_SCRIPT_ID);else for(var c=document.getElementsByTagName("script"),d=0;c&&d<c.length;d++){var e=
c[d].src,f=null!=b&&e&&e.indexOf(b)||-1;if(-1!=f&&/.*container.*[.]js.*[?&]c=1(#|&|$).*/.test(e.substring(f+b.length))){a=c[d];break}}a&&(window.__API_URI=shindig.uri(a.src),window.__API_URI.resolve(window.__CONTAINER_URI));window.__CONTAINER=window.__API_URI?window.__API_URI.getQP("container"):"default"}},!1);osapi.container.Container.addMixin("views",function(b){var f=this;b.rpcRegister("gadgets.views.close",function(a,d){var e=b.getGadgetSiteByIframeId_(a.f),c="undefined"!=typeof d&&null!=d?b.getSiteById(d):e;c&&(c==e||c.ownerId_==a.f)&&f.destroyElement(c)});b.rpcRegister("gadgets.window.getContainerDimensions",function(a){a=document.documentElement;return{width:a?a.clientWidth:-1,height:a?a.clientHeight:-1}});this.destroyElement=function(a){console.log("container needs to define destroyElement function")}});osapi.container.Container.addMixin("views",function(a){this.resultCallbacks_={};this.returnValues_={};var c=this,f={};f[osapi.container.CallbackType.ON_BEFORE_CLOSE]=function(d){var b=d.getId(),e=c.returnValues_[b],a=c.resultCallbacks_[b];"undefined"!==typeof a&&d.ownerId_&&gadgets.rpc.call(d.ownerId_,"gadgets.views.deliverResult",null,a,e);delete c.returnValues_[b];delete c.resultCallbacks_[b]};a.addGadgetLifecycleCallback("open-views",f);a.rpcRegister("gadgets.views.setReturnValue",function(d,b){var e=
a.getGadgetSiteByIframeId_(d.f);e&&(c.returnValues_[e.getId()]=b)})});osapi.container.ee={};osapi.container.ee.RenderParam={GADGET_RENDER_PARAMS:"gadgetRenderParams",GADGET_VIEW_PARAMS:"gadgetViewParams",URL_RENDER_PARAMS:"urlRenderParams",DATA_MODEL:"eeDataModel",EMBEDDED:"embedded"};osapi.container.ee.DataModel={CONTEXT:"context",GADGET:"gadget",URL:"url",PREVIEW_IMAGE:"previewImage",PREFERRED_EXPERIENCE:"preferredExperience"};osapi.container.ee.PreferredExperience={TARGET:"target",DISPLAY:"display",TYPE:"type",VIEW:"view",VIEW_TARGET:"viewTarget"};
osapi.container.ee.Context={ASSOCIATED_CONTEXT:"associatedContext",OPENSOCIAL:"openSocial"};osapi.container.ee.AssociatedContext={ID:"id",TYPE:"type",OBJECT_REFERENCE:"objectReference"};osapi.container.ee.TargetType={GADGET:"gadget",URL:"url"};osapi.container.ee.DisplayType={IMAGE:"image",TEXT:"text"};osapi.container.ee.ContainerConfig={GET_EE_NAVIGATION_TYPE:"GET_EE_NAVIGATION_TYPE"};(function(){osapi.container.Container.addMixin("ee",function(e){function v(b,a,h,f,l,p){var c=h[osapi.container.ee.RenderParam.GADGET_VIEW_PARAMS]||{},q=h[osapi.container.ee.RenderParam.GADGET_RENDER_PARAMS]||{};q[osapi.container.RenderParam.VIEW]=osapi.container.ee.RenderParam.EMBEDDED;var d=a[g.PREFERRED_EXPERIENCE];d&&(d=d[k.TARGET])&&d[k.TYPE]===w.GADGET&&d[k.VIEW]&&(q[osapi.container.RenderParam.VIEW]=d[k.VIEW]);if(l){var d=a[g.CONTEXT],m=!0;d?"object"!=typeof d&&(m=!1):d={};if(m){m={};m[r.ASSOCIATED_CONTEXT]=
{};for(var s in l)l.hasOwnProperty(s)&&(m[s]=l[s]);d[r.OPENSOCIAL]=m;a[g.CONTEXT]=d}}q[osapi.container.ee.RenderParam.DATA_MODEL]=a;var t=e.newGadgetSite(b,p),n=a[g.GADGET];e.preloadGadget(n,function(d){!d[n]||d[n].error?null!=a[g.URL]?u(b,a,h,f):null!=f&&f(t,d[n]||{error:d}):e.navigateGadget(t,n,c,q,function(a){null!=f&&f(t,a)})})}function u(b,a,h,f){h=h[osapi.container.ee.RenderParam.URL_RENDER_PARAMS]||{};b=e.newUrlSite(b);a=e.navigateUrl(b,a[g.URL],h);f&&f(a,null)}var g=osapi.container.ee.DataModel,
k=osapi.container.ee.PreferredExperience,w=osapi.container.ee.TargetType,r=osapi.container.ee.Context,p=osapi.container.ee.ContainerConfig;e.rpcRegister("ee_gadget_rendered",function(b){return(b=b.gs.getActiveSiteHolder().renderParams_.eeDataModel)?b[g.CONTEXT]:null});return{navigate:function(b,a,h,f,l,r){var c=null;if(e.config_&&e.config_[p.GET_EE_NAVIGATION_TYPE]&&"function"===typeof e.config_[p.GET_EE_NAVIGATION_TYPE])c=e.config_[p.GET_EE_NAVIGATION_TYPE].call(e,a);else a:{if(a[g.PREFERRED_EXPERIENCE]&&
(c=a[g.PREFERRED_EXPERIENCE],c[k.TARGET]&&(c=c[k.TARGET])&&c[k.TYPE]))if(c=c[k.TYPE],osapi.container.ee.TargetType.URL===c&&"undefined"!==typeof a.url||osapi.container.ee.TargetType.GADGET===c&&"undefined"!==typeof a.gadget)break a;c=null}null===c&&(a[g.GADGET]?c=osapi.container.ee.TargetType.GADGET:a[g.URL]&&(c=osapi.container.ee.TargetType.URL));c===osapi.container.ee.TargetType.GADGET?v(b,a,h,f,l,r):c===osapi.container.ee.TargetType.URL&&u(b,a,h,f)},close:function(b){b instanceof osapi.container.GadgetSite&&
e.closeGadget(b);b instanceof osapi.container.UrlSite&&b.close()}}})})();gadgets.json.xml=function(){function l(d,c){for(var f=0;f<d.length;f++){var a=d[f];if(a.nodeType==DOM_TEXT_NODE){var b=a.nodeName,e=c[b];c[b]=null!=e?h(e,a.nodeValue):a.nodeValue}else if(0==a.childNodes.length)if(null!=a.attributes&&0!=a.attributes.length)if(b=a,a=c,e=a[b.nodeName],null==e)a[b.nodeName]={},k(b.attributes,a[b.nodeName]);else{var g={};k(b.attributes,g);a[b.nodeName]=h(e,g)}else c[a.nodeName]=null;else 1==a.childNodes.length&&a.firstChild.nodeType==DOM_TEXT_NODE&&(null==a.attributes||
0==a.attributes.length)?(b=a.nodeName,a=a.firstChild,e=c[b],c[b]=null!=e?h(e,a.nodeValue):a.nodeValue):(b=c,e=b[a.nodeName],null==e?(b[a.nodeName]={},null!=a.attributes&&0!=a.attributes.length&&k(a.attributes,b[a.nodeName]),l(a.childNodes,b[a.nodeName])):(g={},null!=a.attributes&&0!=a.attributes.length&&k(a.attributes,g),l(a.childNodes,g),b[a.nodeName]=h(e,g)))}}function h(d,c){return d instanceof Array?(d[d.length]=c,d):[d,c]}function k(d,c){for(var f=null,a=0;a<d.length;a++)f=d[a],c["@"+f.nodeName]=
f.nodeValue}return{convertXmlToJson:function(d){var c={};l(d.childNodes,c);return c}}}();var opensocial=opensocial||{};opensocial.xmlutil=opensocial.xmlutil||{};opensocial.xmlutil.parser_=null;
opensocial.xmlutil.parseXML=function(b){if("undefined"!=typeof DOMParser){opensocial.xmlutil.parser_=opensocial.xmlutil.parser_||new DOMParser;var a=opensocial.xmlutil.parser_.parseFromString(b,"text/xml");if(a.firstChild&&"parsererror"==a.firstChild.tagName)throw Error(a.firstChild.firstChild.nodeValue);return a}if("undefined"!=typeof ActiveXObject){a=new ActiveXObject("MSXML2.DomDocument");a.validateOnParse=!1;a.loadXML(b);if(a.parseError&&a.parseError.errorCode)throw Error(a.parseError.reason);
return a}throw Error("No XML parser found in this browser.");};opensocial.xmlutil.NSMAP={os:"http://opensocial.org/"};opensocial.xmlutil.getRequiredNamespaces=function(b,a){var c=a?opensocial.xmlutil.getNamespaceDeclarations_(a):{},d;for(d in opensocial.xmlutil.NSMAP)opensocial.xmlutil.NSMAP.hasOwnProperty(d)&&(!c.hasOwnProperty(d)&&0<=b.indexOf("\x3c"+d+":")&&0>b.indexOf("xmlns:"+d+":"))&&(c[d]=opensocial.xmlutil.NSMAP[d]);return opensocial.xmlutil.serializeNamespaces_(c)};
opensocial.xmlutil.serializeNamespaces_=function(b){var a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(" xmlns:",c,'\x3d"',b[c],'"');return a.join("")};opensocial.xmlutil.getNamespaceDeclarations_=function(b){for(var a={},c=0;c<b.attributes.length;c++){var d=b.attributes[c].nodeName;"xmlns:"==d.substring(0,6)&&(a[d.substring(6,d.length)]=b.getAttribute(d))}return a};opensocial.xmlutil.ENTITIES='\x3c!ENTITY nbsp "\x26#160;"\x3e';
opensocial.xmlutil.prepareXML=function(b,a){var c=opensocial.xmlutil.getRequiredNamespaces(b,a);return"\x3c!DOCTYPE root ["+opensocial.xmlutil.ENTITIES+']\x3e\x3croot xml:space\x3d"preserve"'+c+"\x3e"+b+"\x3c/root\x3e"};osapi.container.Container.addMixin("views",function(f){var l=this;f.rpcRegister("gadgets.views.openEmbeddedExperience",function(d,p,c,a){var k=d.callback,m=d.f,b=c.gadget;if("string"==typeof c)if((d=/^<(embed)>/i.exec(c))&&d[1])try{var g=gadgets.json.xml.convertXmlToJson(opensocial.xmlutil.parseXML(c));c=g&&g[d[1]]||c}catch(s){}else try{c=(g=gadgets.json.parse(c))||c}catch(t){}var e=function(h){function d(h){var b={};b[osapi.container.RenderParam.VIEW]=osapi.container.ee.RenderParam.EMBEDDED;b[osapi.container.RenderParam.WIDTH]=
"100%";b[osapi.container.RenderParam.HEIGHT]="100%";var a={};a[osapi.container.RenderParam.WIDTH]="100%";a[osapi.container.RenderParam.HEIGHT]="100%";var e={};e[osapi.container.ee.RenderParam.GADGET_RENDER_PARAMS]=b;e[osapi.container.ee.RenderParam.URL_RENDER_PARAMS]=a;e[osapi.container.ee.RenderParam.GADGET_VIEW_PARAMS]=g;f.ee.navigate(h,c,e,function(b,c){b.ownerId_=m;c&&(l.resultCallbacks_[b.getId()]=p);k&&k([b.getId(),c])},q)}var b="",g={},e;a&&(a.viewTarget&&(b=a.viewTarget),a.viewParams&&(g=
a.viewParams),a.coordinates&&(e=a.coordinates));var n=f.getGadgetSiteByIframeId_(m),r=n.getActiveSiteHolder().getIframeElement(),q=l.getContainerAssociatedContext(c,h);(h=l.createElementForEmbeddedExperience(r,h,b,e,n,d))&&d(h)};b?f.preloadGadget(b,function(a){(!a[b]||a[b].error)&&!c.url?null!=k&&k([null,a[b]||{error:a}]):e(a[b])}):e()});this.createElementForEmbeddedExperience=function(d,f,c,a,k,l){console.log("container needs to define createElementForEmbeddedExperience function")};this.getContainerAssociatedContext=
function(d,f){return null}});osapi.container.Container.addMixin("views",function(e){var k=this;e.rpcRegister("gadgets.views.openGadget",function(d,q,a){var f=d.callback,r=d.f,c="",b=e.getGadgetSiteByIframeId_(d.f);"undefined"!=typeof b&&"undefined"!=typeof b.getActiveSiteHolder()&&(c=b.getActiveSiteHolder().getUrl());var g="",l="",m={},n;a&&(a.view&&(g=a.view),a.viewTarget&&(l=a.viewTarget),a.viewParams&&(m=a.viewParams),a.coordinates&&(n=a.coordinates));var s=e.getGadgetSiteByIframeId_(d.f).getActiveSiteHolder().getIframeElement();
e.preloadGadget(c,function(a){function d(a){var b={},h=e.newGadgetSite(a);h.ownerId_=r;"undefined"!=typeof g&&""!==g&&(b[osapi.container.RenderParam.VIEW]=g);b[osapi.container.RenderParam.WIDTH]="100%";b[osapi.container.RenderParam.HEIGHT]="100%";e.navigateGadget(h,c,m,b,function(a){a&&(k.resultCallbacks_[h.getId()]=q);f&&f([h.getId(),a])})}var p={};if("undefined"!=typeof a&&"undefined"!=typeof a[c]){if(a[c].error){gadgets.error("Failed to preload gadget : "+c);null!=f&&f([null,a[c]]);return}p=a[c]}(a=
k.createElementForGadget(p,s,g,l,n,b,d))&&d(a)})});this.createElementForGadget=function(d,e,a,f,k,c,b){console.log("container needs to define createElementForGadget function")}});osapi.container.Container.addMixin("views",function(b){var k=this;b.rpcRegister("gadgets.views.openUrl",function(d,f,a,g){function e(c){c=b.newUrlSite(c);var a={};a[osapi.container.RenderParam.WIDTH]="100%";a[osapi.container.RenderParam.HEIGHT]="100%";b.navigateUrl(c,f,a);c.ownerId_=d.f;d.callback([c.getId()])}var h=b.getGadgetSiteByIframeId_(d.f),l=h.getActiveSiteHolder().getIframeElement();(a=k.createElementForUrl(l,a,g,h,e))&&e(a)});this.createElementForUrl=function(b,f,a,g,e){console.log("container needs to define createElementForUrl function")}});com=(window||this).com||{};com.ibm=com.ibm||{};com.ibm.cre=com.ibm.cre||{};cre$=com.ibm.cre;cre$.iwidget=cre$.iwidget||{};cre$.services=cre$.services||{};cre$.util=cre$.util||{};"undefined"==typeof __trace&&(__trace={enter:function(){},msg:function(){},evalFunction:function(){return"function() { }"},evalResult:function(){},exit:function(){},assertFunction:function(){return"function() { }"}});"undefined"==typeof __logging&&(__logging={logLevel:{TRACE:500,INFO:800,WARNING:900,SEVERE:1E3},log:function(){}});
if(!window.console){var c=window.console={};c.assert=c.debug=c.error=c.info=c.log=c.trace=c.warn=function(){}}console.debug||(console.debug=console.error);(function(){var a=cre$.util,b=window.dojo,p=Object.prototype.toString;"undefined"===typeof a._scopeMap&&(a._scopeMap=b?b._scopeMap:{});a.global=b?b.global:this;var d="$Rev: 22487 $".match(/\d+/);a.version=b?b.version:{major:1,minor:5,patch:0,flag:"",revision:d?+d[0]:NaN,toString:function(){}};var h,l,k={},e;for(e in{toString:1}){h=[];break}h=b?b._extraNames:h||"hasOwnProperty valueOf isPrototypeOf propertyIsEnumerable toLocaleString toString constructor".split(" ");a._extraNames=h;l=h.length;a._mixin=
b?b._mixin:function(a,b){var c,f,g;for(c in b)if(f=b[c],!(c in a)||a[c]!==f&&(!(c in k)||k[c]!==f))a[c]=f;if(l&&b)for(g=0;g<l;++g)if(c=h[g],f=b[c],!(c in a)||a[c]!==f&&(!(c in k)||k[c]!==f))a[c]=f;return a};a.evalFn=function(a,b){var c;!b&&window.execScript?(a&&window.execScript(a,"JavaScript"),c=""):c=window.eval.call(window,a);return c};a.mixin=b?b.mixin:function(b,d){b||(b={});for(var c=1,f=arguments.length;c<f;c++)a._mixin(b,arguments[c]);return b};a._getProp=b?b._getProp:function(b,d,c){c=c||
a.global;for(var f=0,g;c&&(g=b[f]);f++)0===f&&a._scopeMap[g]&&(g=a._scopeMap[g]),c=g in c?c[g]:d?c[g]={}:void 0;return c};a.setObject=b?b.setObject:function(b,d,c){var f=b.split(".");b=f.pop();return(c=a._getProp(f,!0,c))&&b?c[b]=d:void 0};a.getObject=b?b.getObject:function(b,d,c){return a._getProp(b.split("."),d,c)};a.exists=b?b.exists:function(b,d){return!!a.getObject(b,!1,d)};if(b)a.isBrowser=b.isBrowser,a._name=b._name,a.isOpera=b.isOpera,a.isAIR=b.isAIR,a.isKhtml=b.isKhtml,a.isWebKit=b.isWebKit,
a.isChrome=b.isChrome,a.isMac=b.isMac,a.isSafari=b.isSafari,a.isMozilla=a.isMoz=b.isMozilla,a.isFF=b.isFF,a.isIE=b.isIE;else if("undefined"!==typeof window){a.isBrowser=!0;a._name="browser";e=navigator;d=e.userAgent;e=e.appVersion;var m=parseFloat(e);0<=d.indexOf("Opera")&&(a.isOpera=m);0<=d.indexOf("AdobeAIR")&&(a.isAIR=1);a.isKhtml=0<=e.indexOf("Konqueror")?m:0;a.isWebKit=parseFloat(d.split("WebKit/")[1])||void 0;a.isChrome=parseFloat(d.split("Chrome/")[1])||void 0;a.isMac=0<=e.indexOf("Macintosh");
var n=Math.max(e.indexOf("WebKit"),e.indexOf("Safari"),0);if(n&&!a.isChrome&&(a.isSafari=parseFloat(e.split("Version/")[1]),!a.isSafari||419.3>=parseFloat(e.substr(n+7))))a.isSafari=2;0<=d.indexOf("Gecko")&&(!a.isKhtml&&!a.isWebKit)&&(a.isMozilla=a.isMoz=m);a.isMoz&&(a.isFF=parseFloat(d.split("Firefox/")[1]||d.split("Minefield/")[1])||void 0);if(document.all&&!a.isOpera&&(a.isIE=parseFloat(e.split("MSIE ")[1])||void 0,(d=document.documentMode)&&5!=d&&Math.floor(a.isIE)!=d))a.isIE=d}a.isObject=b?b.isObject:
function(b){return void 0!==b&&(null===b||"object"===typeof b||a.isArray(b)||a.isFunction(b))};a.isFunction=b?b.isFunction:function(a){return"[object Function]"===p.call(a)};a.isArray=b?b.isArray:function(a){return a&&(a instanceof Array||"array"===typeof a)};a.isString=b?b.isString:function(a){return"string"==typeof a||a instanceof String};a.objectToQuery=b?b.objectToQuery:function(b){var d=encodeURIComponent,c=[],f={},g;for(g in b)if(Object.prototype.hasOwnProperty.call(b,g)){var e=b[g];if(e!=f[g]){var h=
d(g)+"\x3d";if(a.isArray(e))for(var k=0;k<e.length;k++)c.push(h+d(e[k]));else c.push(h+d(e))}}return c.join("\x26")}})();(function(){var c=cre$.util,d=window.dojo,k={};c.isArrayLike=d?d.isArrayLike:function(a){return a&&void 0!==a&&!c.isString(a)&&!c.isFunction(a)&&!(a.tagName&&"form"===a.tagName.toLowerCase())&&(c.isArray(a)||isFinite(a.length))};var h=function(a,b,e){return(e||[]).concat(Array.prototype.slice.call(a,b||0))},l=function(a,b,e){e=e||[];for(b=b||0;b<a.length;b++)e.push(a[b]);return e};c._toArray=d?d._toArray:c.isIE?function(a){return(a.item?l:h).apply(this,arguments)}:h;c.filter=d?d.filter:function(a,
b,e){var f=0,c=a&&a.length||0,d=[],g;c&&"string"==typeof a&&(a=a.split(""));"string"==typeof b&&(b=k[b]||buildFn(b));if(e)for(;f<c;++f)g=a[f],b.call(e,g,f,a)&&d.push(g);else for(;f<c;++f)g=a[f],b(g,f,a)&&d.push(g);return d}})();(function(){var a=com.ibm=com.ibm||{},a=a.mm=a.mm||{},a=a.iwidget=a.iwidget||{},a=a.Constants=a.Constants||{};cre$.util.mixin(a,{WIDGETEVENT_PREFIX:"widgetevents.",WILDCARD_PREFIX:"*.",mode:{VIEW:"view",EDIT:"edit",PERSONALIZE:"personalize",CONFIG:"config",HELP:"help"},mode_view:"view",mode_edit:"edit",mode_help:"help",event:{TITLE:"title",DESCRIPTION:"description"},ATTRIBUTES:"attributes",IDESCRIPTOR:"idescriptor",USERPROFILE:"userprofile",windowstate:{NORMAL:"normal",MINIMIZE:"minimize",MAXIMIZE:"maximize"},
status:{SUCCESS:200,TIMEOUT:408,NOTFOUND:404,INTERROR:500,OTHER:303},changeType:{CHANGEDVALUE:"changedValue",NEWITEM:"newItem",REMOVEDITEM:"removedItem"},iDescriptorItems:{title:"title",name:"name",description:"description",defaultHeight:"defaultHeight",defaultWidth:"defaultWidth",displayLocale:"displayLocale",mode:"mode",author:"author",email:"email",website:"website",version:"version",icon:"icon",windowState:"windowState",messageLocale:"messageLocale",availableMessageLocales:"availableMessageLocales",
thumbnail:"thumbnail"},IW_PREFIX:"iw-",IW_DEFINITION_TYPE:"iwidget",OSGADGET_DEFINITION_TYPE:"os-gadget",CSSCLASS_INSTANCE:{iwWidget:"iWidget",iwOSGadget:"OSGadget",iwSandbox:"Sandbox",iwDefinition:"Definition",iwEventDescription:"EventDescription",iwPayloadType:"PayloadType",iwHandled:"Handled",iwPublished:"Published",iwDescription:"Description",iwTitle:"Title",iwEvent:"Event",iwDescRef:"DescRef",iwGlobalid:"Globalid",iwHandler:"Handler",iwNewWire:"NewWire",iwRemoveWire:"RemoveWire",iwReadOnly:"ReadOnly",
iwItemSet:"ItemSet",iwItem:"Item",iwValue:"Value",iwContent:"Content",iwReceivedEvent:"ReceivedEvent",iwSourceEvent:"SourceEvent",iwTargetEvent:"TargetEvent",iwMappedName:"MappedName",iwStandalone:"Standalone"},CSSCLASS_PREFIXED_INSTANCE:{},CSSCLASS_PERSONALIZED:"mm-Personalized",RESOURCE:{src:"src",id:"id",globalid:"globalid",mimeType:"mimeType",callback:"callback",version:"version",blockInit:"blockInit",skipLoad:"skipLoad"},EVENTS:{onLoad:"onLoad",onUnLoad:"onUnload",onModeChanged:"onModeChanged",
onItemSetChanged:"onItemSetChanged",unloadWidget:"/enabler/unloadWidget",unSubscribeWire:"/enabler/unSubscribeWire",modeChanged:"modeChanged",onSizeChanged:"onSizeChanged",onNavStateChanged:"onNavStateChanged",onAttributeSaved:"com.ibm.mashups.iwidget.onAttributeSaved",onWindowStateChanged:"onWindowStateChanged",onIncompleteEventDescription:"onIncompleteEventDescription"},eventservice:{type:{MAIN:"MAIN",IFRAME:"IFRAME"}}});for(var b in a.CSSCLASS_INSTANCE)Object.prototype.hasOwnProperty.call(a.CSSCLASS_INSTANCE,
b)&&(a.CSSCLASS_PREFIXED_INSTANCE[b]=a.IW_PREFIX+a.CSSCLASS_INSTANCE[b])})();iwConstants=com.ibm.mm.iwidget.Constants;(function(){var c=cre$.util,a=window.dojo;c.isAlien=a?a.isAlien:function(b){return b&&!c.isFunction(b)&&/\{\s*\[native code\]\s*\}/.test(String(b))};c.delegate=c._delegate=a?a.delegate:function(){function b(){}return function(d,a){b.prototype=d;var e=new b;b.prototype=null;a&&c._mixin(e,a);return e}}();c._hitchArgs=a?a._hitchArgs:function(b,d){var a=c._toArray(arguments,2),e=c.isString(d);return function(){var g=c._toArray(arguments),f=e?(b||c.global)[d]:d;return f&&f.apply(b||this,a.concat(g))}};
c.hitch=a?a.hitch:function(b,a){if(2<arguments.length)return c._hitchArgs.apply(c,arguments);a||(a=b,b=null);if(c.isString(a)){b=b||c.global;if(!b[a])throw['cu.hitch: scope["',a,'"] is null (scope\x3d"',b,'")'].join("");return function(){return b[a].apply(b,arguments||[])}}return!b?a:function(){return a.apply(b,arguments||[])}};c.partial=a?a.partial:function(a){return c.hitch.apply(c,[null].concat(c._toArray(arguments)))}})();(function(){var e=cre$.util,d=window.dojo;e.forEach=d?d.forEach:function(a,b,c){if(a&&a.length){b=["string"==typeof a?a.split(""):a,c||e.global,"string"==typeof b?new Function("item","index","array",b):b];a=b[0];c=0;for(var d=a.length;c<d;++c)b[2].call(b[1],a[c],c,a)}}})();(function(){var b=cre$.util;b.forIn=function(a,e,c){if(a&&"object"==typeof a){c=c||null;var b,d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(b=a[d],cre$.util.hitch(c,e)(b,d,a))}};b.each=function(a,b,c){a&&(a instanceof Array||"number"===typeof a.length?cre$.util.forEach(a,b,c):cre$.util.forIn(a,b,c))}})();cre$.endpoint=cre$.endpoint||{};
(function(){function f(a){a=decodeURIComponent(a);(a=d[a])&&("/"!==a.charAt(0)&&"http"!==a.substr(0,4))&&(a="/"+a);return a}var e=cre$.endpoint,g=Object.prototype.hasOwnProperty,d={};e.registerEndpoints=function(a){for(var b=a.length;b--;)d[a[b].name]=a[b].url};e.removeEndpoint=function(a){g.call(d,a)&&delete d[a]};e.resolveEndpoint=function(a){if(!a)return null;if(a=a.toString()){var b=a.indexOf("endpoint://",0);if(0===b){var c,b=a.indexOf("/",11);if(0<b){if(c=a.substring(11,b),a=a.substring(b+1),
c=f(c))return a="/"===c.charAt(c.length-1)?c+a:c+"/"+a}else return c=a.substring(11),a=f(c)}else if(0<b&&(c=a.substring(0,b),a=a.substring(b),a=e.resolveEndpoint(a)))return"/"===a.charAt(0)?c+a.substring(1):c+a}return null}})();cre$.constants=cre$.constants||{};cre$.constants.componentType={IWIDGET:iwConstants.CSSCLASS_INSTANCE.iwWidget,GADGET:"gadget"};cre$.constants.renderType={INLINE:"inline",SANDBOX:"sandbox",IFRAME:"iframe",DEFAULT:"default"};
cre$.constants.event={TITLE:iwConstants.event.TITLE,DESCRIPTION:iwConstants.event.DESCRIPTION,topic:{WIDGET_LOADED:"widgetLoaded_",WIDGET_MODECHANGED:"widgetModeChanged",STUB_SYNC:"_stub_sync_",BROADCAST_SHAREABLEITEMSET_CHANGE:"broadcast_shareableitemset_change",BROADCAST_WIRES_CHANGE:"broadcast_wires_change",STUB_SYNC_WIRES:"_stub_sync_wires_",REQUEST_WIRES:"request_wires_",REQUEST_PAGEDATA:"request_pagedata_",SYNC:"sync_",PAGE_DATA_:"page_data_"},payload:{METHODNAME:"methodname",PARAMS:"params"}};
cre$.constants.request={URL:"url",HEADERS:"headers",CONTENT_TYPE:"contentType",PARAM_DATA:"paramData",RESPONSE_TYPE:"responseType",method:{GET:"GET",PUT:"PUT",POST:"POST",DELETE:"DELETE"},header:{CONTENT_TYPE:"Content-Type"},HEADER_CRE_PERSISTENCE_URL:"X-CRE-persistenceurl",CONTAINER:"container",HEADER_SHINDIG_ST:"X-Shindig-ST",contentType:{JSON:"application/json",X_WWW_FORM_URLENCODED:"application/x-www-form-urlencoded"},SYNC:"sync"};
cre$.constants.response={protocol:{HTTP:"http",HTTPS:"https"},type:{XML:"xml",JSON:"json",JSON_COMMENT_OPTIONAL:"json-comment-optional",JSON_COMMENT_FILTERED:"json-comment-filtered",JAVASCRIPT:"javascript"}};
cre$.constants.resource={resourceType:{JAVASCRIPT:"javascript",CSS:"css",IMAGE:"image",UNKNOW:"\x3cunknown\x3e",SRC:iwConstants.RESOURCE.src,ID:iwConstants.RESOURCE.id,GLOBALID:iwConstants.RESOURCE.globalid,MIMETYPE:iwConstants.RESOURCE.mimeType,CALLBACK:iwConstants.RESOURCE.callback,VERSION:iwConstants.RESOURCE.version,BLOCKINIT:iwConstants.RESOURCE.blockInit,SKIPLOAD:iwConstants.RESOURCE.skipLoad},mimeType:{JAVASCRIPT:"text/javascript",CSS:"text/css",IMAGE:"image/"}};
cre$.constants.featureName={IRUNTIME:"cre.iruntime",WIRE:"cre.wire",OSGADGET:"cre.osgadget",ITEMSET:"cre.iwidget.itemset",EVENT:"cre.iwidget.event"};cre$.constants.keys={SHIFT:1,ALT:2,CTRL:4,META:8,CAPSLOCK:16};cre$.constants.windowstate={NORMAL:iwConstants.windowstate.NORMAL,MINIMIZE:iwConstants.windowstate.MINIMIZE,MAXIMIZE:iwConstants.windowstate.MAXIMIZE};
cre$.constants.status={SUCCESS:iwConstants.status.SUCCESS,TIMEOUT:iwConstants.status.TIMEOUT,NOTFOUND:iwConstants.status.NOTFOUND,INTERROR:iwConstants.status.INTERROR,OTHER:iwConstants.status.OTHER};cre$.constants.changeType={CHANGED_VALUE:iwConstants.changeType.CHANGEDVALUE,NEW_ITEM:iwConstants.changeType.NEWITEM,UPDATED_VALUE:"updatedValue",REMOVED_ITEM:iwConstants.changeType.REMOVEDITEM,DELETE_TOKEN:"DELETE_TOKEN",ON_STATESET_CHANGED:"onStateSetChanged"};
cre$.constants.predefinedEvents={onLoad:iwConstants.EVENTS.onLoad,onUnLoad:iwConstants.EVENTS.onUnLoad,onModeChanged:iwConstants.EVENTS.onModeChanged,onWindowStateChanged:iwConstants.EVENTS.onWindowStateChanged,onSizeChanged:iwConstants.EVENTS.onSizeChanged,onNavStateChanged:iwConstants.EVENTS.onNavStateChanged,onItemSetChanged:iwConstants.EVENTS.onItemSetChanged,onRefreshNeeded:"onRefreshNeeded",onNewWire:"onNewWire",onRemoveWire:"onRemoveWire",onIncompleteEventDescription:iwConstants.EVENTS.onIncompleteEventDescription};
cre$.constants.state={ERROR:1,INITIAL:2,PRELOADED:3,LOADED:4};cre$.constants.others={DEFAULT:"default",IW_IWIDGET:"iw-iWidget",IW_DEFINITION:"iw-Definition",GADGET_SITE:"gadget-site-",TRUE:"true",FALSE:"false"};cre$.constants.endpoints={PROXY:"endpoint://creproxyurl",PERSISTENCE:"endpoint://persistence",CRE_SERVER:"endpoint://creserverurl",DATA_FETCH:"endpoint://dataFetch"};
cre$.constants.iDescriptorItems={TITLE:iwConstants.iDescriptorItems.title,NAME:iwConstants.iDescriptorItems.name,DESCRIPTION:iwConstants.iDescriptorItems.description,DEFAULTWIDTH:iwConstants.iDescriptorItems.defaultWidth,DEFAULTHEIGHT:iwConstants.iDescriptorItems.defaultHeight,DISPLAYLOCALE:iwConstants.iDescriptorItems.displayLocale,MODE:iwConstants.iDescriptorItems.mode,AUTHOR:iwConstants.iDescriptorItems.author,EMAIL:iwConstants.iDescriptorItems.email,WEBSITE:iwConstants.iDescriptorItems.website,
VERSION:iwConstants.iDescriptorItems.version,ICON:iwConstants.iDescriptorItems.icon,WINDOWSTATE:iwConstants.iDescriptorItems.windowState,MESSAGELOCALE:iwConstants.iDescriptorItems.messageLocale,AVAILABLEMESSAGELOCALES:iwConstants.iDescriptorItems.availableMessageLocales,THUMBNAIL:iwConstants.iDescriptorItems.thumbnail};
cre$.constants.osgadgetItems={TITLE:iwConstants.iDescriptorItems.title,NAME:iwConstants.iDescriptorItems.name,TOPIC:"topic",SUBSCRIBE:"subscribe",PUBLISH:"publish",ABOUTURL:"aboutUrl",DESCRIPTION:"description",TYPE:"type"};cre$.constants.persistence={PERSISTENCE_URL:"endpoint://persistence"};cre$.promise=cre$.promise||{};
(function(){var g=cre$,h=cre$.util,m=h.isFunction,n=h.mixin,k=h.each,q=h.partial,r=h.hitch;cre$.promise={};var f=cre$.promise,s=0;g.promise=g.promise||{};f.Promise=function(b){__trace.enter("cre$.promise","constructor",arguments);this._cbs=[];this._stat=-1;this._id=b;this._counter=s++;if(!b){var a=arguments.callee;this.id=(a=a?a.caller:null)?a.name&&0<a.name.length?a.name:a.toString():""}__trace.exit("cre$.promise","constructor")};n(g.promise,{isPromise:function(b){__trace.enter("cre$.promise","isPromise",
arguments);var a=b&&m(b.then);__trace.exit("cre$.promise","isPromise",a);return a},resolved:function(b){__trace.enter("cre$.promise","resolved",arguments);var a=new f.Promise("resolved("+b+")["+this._counter+"]");a.resolve(b);__trace.exit("cre$.promise","resolved",a);return a},rejected:function(b){__trace.enter("cre$.promise","rejected",arguments);var a=new f.Promise("rejected("+b+")["+this._counter+"]");a.reject(b);__trace.exit("cre$.promise","rejected",a);return a},join:function(b){__trace.enter("cre$.promise",
"join",arguments);try{eval("("+__trace.assertFunction("arr!\x3dnull")+").call(this);")}catch(a){console.log("cre$.promise.join: Error on asserting 'arr!\x3dnull'.",a)}var c=new f.Promise("join["+this._counter+"]"),d=Array(b.length),e=0,l=!1,p=function(){__trace.msg("cre$.promise","join","finCheck: Verifying whether we are done ++${0} \x3e\x3d ${1}",[e,d.length]);++e>=d.length&&(__trace.msg("cre$.promise","join","finCheck: Calling ${0} as rejected? ${1}",[c,l]),c[l?"reject":"resolve"](d))};0<b.length?
k(b,function(a,b){__trace.msg("cre$.promise","join","For each promise ${0} i:${1}",[a,b]);a.then(function(c){__trace.msg("cre$.promise","join","Resolved promise ${0} - return value: ${1}",[a,c]);d[b]=c;p()},function(c){__trace.msg("cre$.promise","join","Rejected promise ${0} - return value: ${1}",[a,c]);l=!0;d[b]=c;p()})}):(__trace.msg("cre$.promise","join","Empty Array."),c.resolve([]));__trace.exit("cre$.promise","join",c);return c}});n(f,{when:function(b){__trace.enter("cre$.promise","when",arguments);
var a=cre$.promise.isPromise(b)?b:cre$.promise.resolved(b);__trace.exit("cre$.promise","when",a);return a},whenAll:function(b){__trace.enter("cre$.promise","whenAll",arguments);var a=[];k(arguments,function(b){__trace.msg("cre$.promise","whenAll","For each promise: ${0}",[b]);a.push(f.when(b))});var c=g.promise.join(a);__trace.exit("cre$.promise","whenAll",c);return c}});f.Promise.prototype={_fin:function(b,a){__trace.enter("cre$.promise","_fin",arguments);if(-1!==this._stat)throw Error(cre$.LocaleHelper.getLocalizedMessages().ERR_PROMISE_ALREADY_RESOLVED);
this._v=b;this._stat=a;this._cbk();__trace.exit("cre$.promise","_fin",this);return this},_cbk:function(){__trace.enter("cre$.promise","_cbk",arguments);var b=this._stat,a=this._cbs,c=this._v,d;if(0===b&&g.promise.isPromise(c))for(__trace.msg("cre$.promise","_cbk","Recognized promise");0<a.length;)c.then.apply(c,a.shift());for(;0<a.length;)if(d=a.shift()[b]){__trace.msg("cre$.promise","_cbk","Calling function: ${0}",[d]);try{d(c)}catch(e){d=__logging.isLogTrace,__logging.isLogTrace=!0,__logging.log("cre$.promise.Promise",
"_cbk",e),__logging.isLogTrace=d}}__trace.exit("cre$.promise","_cbk")},_delegate:function(b){__trace.enter("cre$.promise","_delegate",arguments);try{eval("("+__trace.assertFunction("fn!\x3dnull")+").call(this);")}catch(a){console.log("cre$.promise._delegate: Error on asserting 'fn!\x3dnull'.",a)}var c=new f.Promise("_delegate["+this._counter+"]");this.then(q(b,c),r(c,"reject"));__trace.exit("cre$.promise","_delegate",c);return c},resolve:function(b){__trace.enter("cre$.promise","resolve",arguments);
var a=arguments.callee;calledBy=(a=a?a.caller:null)?a.name&&0<a.name.length?a.name:a.toString():"";__trace.msg("cre$.promise","resolve","resolve of ${0} called by ${1}",[this,calledBy]);a=this._fin(b,0);__trace.exit("cre$.promise","resolve",a);return a},reject:function(b){__trace.enter("cre$.promise","reject",arguments);var a=arguments.callee;calledBy=(a=a?a.caller:null)?a.name&&0<a.name.length?a.name:a.toString():"";__trace.msg("cre$.promise","reject","reject of ${0} called by ${1}",[this,calledBy]);
a=this._fin(b,1);__trace.exit("cre$.promise","reject",a);return a},progress:function(b){__trace.enter("cre$.promise","progress",arguments);k(this._cbs,function(a){__trace.msg("cre$.promise","progress","For each set ${0}",[a]);if(a[2])a[2](b)});__trace.exit("cre$.promise","progress",this);return this},then:function(b,a,c){__trace.enter("cre$.promise","then",arguments);try{eval("("+__trace.assertFunction("suc!\x3dnull")+").call(this);")}catch(d){console.log("cre$.promise.then: Error on asserting 'suc!\x3dnull'.",
d)}var e=new f.Promise("then["+this._counter+"]");__trace.msg("cre$.promise","then","Promise to execute: ${0}",[e]);this._cbs.push([function(a){__trace.msg("cre$.promise","then","Resolved promise ${0} - return value: ${1}",[e,a]);try{if(b){var c=b(a);void 0!==c&&(a=c)}e.resolve(a)}catch(d){throw __trace.msg("cre$.promise","then","Error while resolving - exception: ${0}",[d]),e.reject(d),d;}},function(b){__trace.msg("cre$.promise","then","Rejected promise ${0} - return value: ${1}",[e,b]);var c=b;
try{a&&(c=a(b),void 0===c&&(c=b)),e.reject(c)}catch(d){throw __trace.msg("cre$.promise","then","Error while rejecting - exception: ${0}",[d]),e.reject(d),d;}},c]);-1!==this._stat&&this._cbk();__trace.exit("cre$.promise","then",e);return e},call:function(b,a){__trace.enter("cre$.promise","call",arguments);try{eval("("+__trace.assertFunction("name!\x3dnull")+").call(this);")}catch(c){console.log("cre$.promise.call: Error on asserting 'name!\x3dnull'.",c)}var d=this._delegate(function(c,d){d&&m(d[b])?
c.resolve(d[b].apply(d,a)):c.reject(Error(b+" "+cre$.LocaleHelper.getLocalizedMessages().ERR_NOT_A_FUNC+" "+d))});__trace.exit("cre$.promise","call",d);return d},get:function(b){__trace.enter("cre$.promise","get",arguments);try{eval("("+__trace.assertFunction("name!\x3dnull")+").call(this);")}catch(a){console.log("cre$.promise.get: Error on asserting 'name!\x3dnull'.",a)}var c=this._delegate(function(a,c){c?a.resolve(c[b]):a.reject(Error(cre$.LocaleHelper.getLocalizedMessages().ERR_IS_NULL_UNDEFINED)+
" "+c)});__trace.exit("cre$.promise","get",c);return c}}})();"undefined"===typeof cre$.config&&(cre$.config={},function(){var e=window.location.protocol,f=e.indexOf(":"),a=cre$.config;a.HOST=window.location.host;a.CONTEXT_ROOT="/cre";a.SCHEME=-1!==f?e.substring(0,f):e;a.APP_VERSION=null;a.PROCESSWIDGETS_URL="/common/processWidgets?format\x3djson";a.SANDBOXWIDGETS_URL="/common/sandboxedWidget";a.REFRESHTOKEN_URL="/common/tokenRefresh";a.MAX_TOKEN_TTL=72E3;a.USERPROFILE_URL="/userprofile";a.SERVERLOG_URL="/common/log";a.SERVERLOG_DELIVER_THRESHOLD=50;a.PERSISTENCE_USE_PATH_PARMS=
!1;a.COMBINE_RESOURCES=!0;a.BROADCASTALLEVENTS=!0;a.SUPPORTED_LOCALES="ar ca cs da de el en es fi fr hu it iw ja kk ko nl no pl pt pt-br ru sl sv th tr zh-cn zh-tw".split(" ");a.isDebug=!1;a.traceConfig=[];a.loadScriptsDefaultRefresh=-1;a.getCREServerUrl=function(b){var c,d=0;b=b?b:"";c=(d=cre$.endpoint.resolveEndpoint(cre$.constants.endpoints.CRE_SERVER))?d:a.SERVER_URL?a.SERVER_URL:a.PORT?a.SCHEME+"://"+a.HOST+":"+a.PORT+a.CONTEXT_ROOT:a.SCHEME+"://"+a.HOST+a.CONTEXT_ROOT;d=c.length;"/"===c.charAt(d-
1)&&(c=c.substring(0,d-1));0<b.length&&("/"!==b.charAt(0)&&(b="/"+b),c+=b);return c};a.CONTAINER="default";a.ServiceManagerCallbacks=[];a.buildLabel="CRE1.4.0_LOCAL_CRE1.4_20150215-1308";a.timestamp=(new Date).valueOf();a.userid=null}());cre$.xhr=cre$.xhr||{};
(function(){var d=cre$.xhr,h=cre$.constants,g=h.request,k=h.response;d.parseToJson=function(b){return/^[\],:{}\s]*$/.test(b.replace(/\\['"\\\/b-ux]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?eval("("+b+")"):!1};d.registerEventHandler=function(b,a,d){void 0!==b.addEventListener?b.addEventListener(a,d,!1):b.attachEvent&&b.attachEvent("on"+a,d)};d.makeXhr=function(){var b;if("undefined"!==typeof XMLHttpRequest||window.XMLHttpRequest)return new window.XMLHttpRequest;
if("undefined"!==typeof ActiveXObject)return(b=new ActiveXObject("Msxml2.XMLHTTP"))||(b=new ActiveXObject("Microsoft.XMLHTTP")),b;throw"no xhr available";};d.xhr=function(b,a){if(!a||!a.url)return null;var f=new cre$.promise.Promise("xhr: "+a.url),c=d.makeXhr(),e=b||g.method.GET,m=a.sync||!1,n=a.responseType||null,h=function(a){if(4===a.readyState)if(200<=a.status&&300>a.status||304==a.status)if(clearTimeout(p),n===k.type.XML&&a.responseXML)f.resolve({data:a.responseXML,xhr:a});else if(n===(k.type.JSON_COMMENT_FILTERED||
k.type.JSON_COMMENT_OPTIONAL)&&a.responseText&&/^[^{\[]*\/\*/.test(a.responseText)){var b=a.responseText,c=b.indexOf("/*"),e=b.lastIndexOf("*/");if(-1==c||-1==e)throw Error("JSON was not comment filtered");f.resolve({data:d.parseToJson(b.substring(c+2,e)),xhr:a})}else n===(k.type.JSON||k.type.JSON_COMMENT_OPTIONAL)?f.resolve({data:d.parseToJson(a.responseText),xhr:a}):f.resolve({data:a.responseText,xhr:a});else f.reject({data:a.status,xhr:a})};"object"===typeof c.onprogress&&m?c.onload=c.onerror=
c.onabort=function(){h(c)}:c.onreadystatechange=function(){4===c.readyState&&h(c)};a.user&&a.password?c.open(e,a.url,!m,a.user,a.password):c.open(e,a.url,!m);if(a.headers)for(var l in a.headers)"content-type"===l.toLowerCase()&&!a.contentType?a.contentType=a.headers[l]:a.headers[l]&&c.setRequestHeader(l,a.headers[l]);e="";a.paramData&&(e+=a.paramData);a.form&&(""!=e&&(e+="\x26"),e+=a.form+"\x3d"+escape(document.getElementById(a.form).value));a.paramData||a.form?(c.setRequestHeader(g.header.CONTENT_TYPE,
a.contentType||g.contentType.X_WWW_FORM_URLENCODED),c.send(e)):c.send(null);var p;a.timeout&&(0!==a.timeout&&0<a.timeout)&&(p=setTimeout(function(){c.abort()},a.timeout));d.registerEventHandler(window,"unload",function(){f&&delete f.xhr;c&&(delete c.onreadystatechange,delete c.responseXML,delete c.responseText,c=null)});f.xhr=c;return f};d.xhrGet=function(b){return d.xhr(g.method.GET,b)};d.xhrPut=function(b){return d.xhr(g.method.PUT,b)};d.xhrPost=function(b){return d.xhr(g.method.POST,b)};d.xhrDelete=
function(b){return d.xhr(g.method.DELETE,b)};cre$.config.ServiceManagerCallbacks.push(function(b){b.setService(cre$.services.XHR,cre$.xhr)})})();(function(){var f=cre$.util,g=window.dojo,h={};f.extend=g?g.extend:function(a,e){for(var c=1,d=arguments.length;c<d;c++)f._mixin(a.prototype,arguments[c]);return a};f.clone=g?g.clone:function(a){if(!a||"object"!=typeof a||f.isFunction(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());var e,c,d,b;if(f.isArray(a)){e=[];c=0;for(d=a.length;c<d;++c)c in a&&e.push(f.clone(a[c]))}else e=a.constructor?new a.constructor:{};for(b in a)if(d=a[b],
!(b in e)||e[b]!==d&&(!(b in h)||h[b]!==d))e[b]=f.clone(d);if(0<f._extraNames.length)for(c=0;c<f._extraNames.length;++c)if(b=f._extraNames[c],d=a[b],!(b in e)||e[b]!==d&&(!(b in h)||h[b]!==d))e[b]=d;return e}})();cre$.constants.ResourceManager=cre$.constants.ResourceManager||{};cre$.constants.ResourceManager.state={ERROR:-1,INIT:1,DOWNLOADED:2,LOADED:3};cre$.ResourceManager=cre$.ResourceManager||{};
(function(){function v(b,f,d,a,g,c){if(!b||!f)throw Error("resourcePromise "+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_PARAM);c=c?c:{};var e=new cre$.promise.Promise("resourcePromise");g=g||n.constants.resourceType.JAVASCRIPT;var h=u[g];switch(g){case n.constants.resourceType.JAVASCRIPT:case n.constants.resourceType.CSS:g="";h&&(g=h.join("::"));req={url:f,sync:a};req[cre$.constants.request.HEADERS]=cre$.internalutil.getCREContainerToken()?{"X-Shindig-ST":cre$.internalutil.getCREContainerToken().token}:{};
""!==g&&(req[cre$.constants.request.HEADERS]["Client-Loaded-Resources"]=g);req[cre$.constants.request.HEADERS]["Client-Loaded-Features"]=n.getLoadedFeatures().join("::");e=cre$.xhr.xhrGet(req).then(function(a){var e=cre$.util.clone(a.xhr.responseText),d=cre$.util.clone(a.xhr.status);delete a.xhr;return cre$.util.mixin(c,{url:f,globalid:b,data:e,status:d})},function(a){var e=cre$.util.clone(a.xhr.responseText),d=cre$.util.clone(a.xhr.status);delete a.xhr;return cre$.util.mixin(c,{url:f,globalid:b,
data:e,status:d})});if(d&&d.length&&0<d.length){g=d.length;var k=h.join();for(a=0;a<g;a++){var l=d[a];0>k.indexOf(l)&&h.push(l)}}break;case n.constants.resourceType.IMAGE:d=!1;h&&0<h.join().indexOf(f)&&(d=!0);d?e.resolve({url:f,globalid:b}):(d=new Image,d.src=f,a&&console.warn(cre$.LocaleHelper.getLocalizedMessages().ERR_CANT_LOAD_IMAGE_SYNC),d.onload=function(){e.resolve({url:f,globalid:b});h.push(f)},d.onerror=function(){e.resolve({url:f,globalid:b})});break;default:throw Error("[resourcePromise]"+
cre$.LocaleHelper.getLocalizedMessages().ERR_CANT_SUPPORT_TYPE+" "+g);}return e}function A(b,f){for(var d=/url\s*\(\s*('[^\s'"]+'|"[^\s'"]+"|[^\s'"]+)\s*\)/gi,a,g="",c=f.lastIndexOf("?"),e=-1===c?f:f.substring(0,c),e=e.substring(0,e.lastIndexOf("/")+1),h=f.substring(0,f.indexOf("/",f.indexOf("://")+3)),c=0;null!==(a=d.exec(b));){g+=b.substring(c,a.index);c=a[1];if("'"===c.charAt(0)||'"'===c.charAt(0))c=c.substring(1,c.length-1);/^http[s]?:\/\/.+/.test(c)||(c="/"===c.charAt(0)?h+c:e+c);g=g+'url("'+
c+'")';c=a.index+a[0].length}c<b.length&&(g+=b.substring(c,b.length));return g}function x(b,f,d){var a="";if(-1===f.indexOf("/gadgets/js/")){var g=cre$.internalutil.parseToJson(d);if(g)for(var c in g[0])Object.prototype.hasOwnProperty.call(g[0],c)&&(d=g[0][c],-1===d.indexOf("ERROR|@|")?a+=d+"\n":b.error={message:"Error fetching '"+requestUrl+"'"});else a=d}else a=d;""===a&&(f="Error fetching "+f+".",b.error={message:f},__logging.log("cre$.ResourceManager","_filterRes",f));return a}function C(b,f){var d=
{};if(!b[0]||!b[0].resourceUris)return[];for(var a="",g=[],c=[],e=0,h=b.length;e<h;e++)a+=b[e].resourceUris.join("|")+"|";g=a.substring(0,a.lastIndexOf("|")).split("|");e=0;for(h=b.length;e<h;e++){if((globalid=b[e].globalid?b[e].globalid:b[e].uri)&&f[e])for(var a=f[e][globalid],k=b[e].type===n.constants.resourceType.JAVASCRIPT?eval(a):[a],l=0,q=g.length;l<q;l++){var p=g[l],a=k&&k[e]?k[e][p]:null;"undefined"!==typeof a&&(null!==a&&"ERROR|@|"===a.replace(/(^\s*)(\s*$)/g,""))&&(a={url:p,type:m[globalid].resource.type},
b[e].error&&(a.error=b[e].error),c.push(a),d[p]=p)}if(0===c.length&&b[e].error&&m[globalid].state===r.state.LOADED)if(k=b[e].error.message.split("|"),l=k.length,1!==l)for(;l--;)k[l]&&(""!==k[l].trim()&&!(k[l]in d))&&(a={url:k[l],type:m[globalid].resource.type},b[e].error&&(a.error=b[e].error),c.push(a));else{k=eval(b[e].data);l=b[e].resourceUris;q=k.length;for(p=l.length;q--;)for(;p--;)"ERROR|@|"===k[q][l[p]]&&(a={url:l[p],type:m[globalid].resource.type},b[e].error&&(a.error=b[e].error),c.push(a))}}return c}
function w(b,f){for(var d=[],a=0,g=b.length;a<g;a++){var c=b[a],e=c.url,h=c.globalid,k=m[h],l=k.resource;if(k.state===r.state.DOWNLOADED){var q="";if(l.type!==n.constants.resourceType.IMAGE){var q=c.data,p={};p[h]=q;d[a]=p}if(l.type===n.constants.resourceType.JAVASCRIPT)if(__trace.msg("cre$.ResourceManager",null,"Injecting for ${0}",[l]),l.isDojoAMD){q=cre$.internalutil.parseToJson(q);p="";if(q){var s={},u=!1,t;for(t in q[0])if(Object.prototype.hasOwnProperty.call(q[0],t)){var v=q[0][t];if(-1===v.indexOf("ERROR|@|")){var w=
c.modules[t];w?(u=!0,s[w]=new Function(v)):p+=t+"|"}else p+=t+"|"}else p+=t+"|"}u?(s["*noref"]=!0,require({cache:s})):(l.error={message:p},__logging.log("cre$.ResourceManager","_injectResources","Failure fetching AMD js from "+e+"."),k.resource=l,m[h]=k)}else{c=null;try{__trace.msg("cre$.ResourceManager",null,"Received: ${0}",[q]);var B=x(k,e,q);__trace.msg("cre$.ResourceManager",null,"Will eval: ${0}",[B]);c=y.evalFn(B)}catch(z){l.error={message:z.message},__logging.log("cre$.ResourceManager","_injectResources",
"An error occurred when evaluating the js, resource url is "+e+".")}(null===c||void 0===c)&&__logging.log("cre$.ResourceManager","_injectResources","",[e])}else l.type===n.constants.resourceType.CSS&&(c=document.createElement("style"),c.setAttribute("type",cre$.constants.resource.mimeType.CSS),c.styleSheet?c.styleSheet.cssText=A(x(k,e,q),e):c.innerHTML=A(x(k,e,q),e),document.getElementsByTagName("head")[0].appendChild(c));n.registerResource(l.uri,h)}else if(k.state===r.state.LOADED)for(e=f.length;e--;)b[a].globalid===
f[e].uri&&b[a].error&&(f[e]=b[a])}return C(f,d)}function z(b,f){if(!y.isArray(b))throw Error(cre$.LocaleHelper.getLocalizedMessages().ERR_RESOURCE_NOT_ARRAY);for(var d=[],a,g=function(a){m[a.globalid].state!==r.state.LOADED&&(m[a.globalid].state=r.state.DOWNLOADED)},c=function(a){var b=m[a.globalid].state;b!==r.state.LOADED&&b!==r.state.DOWNLOADED&&(m[a.globalid].state=r.state.ERROR);a.error={message:"Resource failed to load"}},e=0;e<b.length;e++){var h=b[e],k=h.globalid?h.globalid:h.uri,l=h;if(k){if(s.call(m,
k)){if(h=m[k],a=h.promise,h.state===r.state.INIT&&f||h.state===r.state.ERROR)a=h.resource,a=v(k,a.uri,a.resourceUris,f,a.type,l),m[k].promise=a,a.then(g,c)}else m[k]={resource:h,state:r.state.INIT,promise:null},a=v(k,h.uri,h.resourceUris,f,h.type,l),m[k].promise=a,a.then(g,c);a&&d.push(a)}}return cre$.promise.whenAll.apply(cre$.promise,d).then(function(a){return w(a,b)},function(a){return w(a,b)})}var n=cre$.ResourceManager,s=Object.prototype.hasOwnProperty,y=cre$.util,r=cre$.constants.ResourceManager,
m={};n.constants={resourceType:{JAVASCRIPT:cre$.constants.resource.resourceType.JAVASCRIPT,CSS:cre$.constants.resource.resourceType.CSS,IMAGE:cre$.constants.resource.resourceType.IMAGE}};var u;cre$.ResourceManager.resourcesLoaded?u=cre$.ResourceManager.resourcesLoaded:cre$.ResourceManager.resourcesLoaded=u={javascript:[],css:[],image:[]};n.makeProxyUrl=function(b,f){var d=null,a,d=cre$.services.ServiceManager?getServiceManager().getService(cre$.services.PROXYSERVICE,!0):cre$.promise.rejected("Service Manager is not loaded.");
d.then(function(d){a=d.makeProxyUrl(b,f)},function(b){a=null});return a};n.registerResource=function(b,f){var d=f?f:b;s.call(m,d)||(m[d]={});m[d].state=r.state.LOADED};n.isResourceRegistered=function(b){return b&&s.call(m,b)&&m[b].state===r.state.LOADED?!0:!1};n.isResourceDownloaded=function(b){return b&&s.call(m,b)&&(m[b].state===r.state.DOWNLOADED||m[b].state===r.state.LOADED)?!0:!1};n.loadResources=function(b,f,d){for(var a=0;a<b.length;a++)b[a].uri=n.makeProxyUrl(b[a].uri,d);return z(b,f)};n.isFeatureLoaded=
function(b){if(!window.___jsl)return!1;for(var f=window.___jsl.l||[],d=0,a=f.length;d<a;d++)if(f[d]===b)return!0;return!1};n.getLoadedFeatures=function(){return window.___jsl?window.___jsl.l||[]:[]};n.loadFeatures=function(b,f,d,a){if(!b||0===b.length)throw Error("[loadFeatures]"+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_PARAM);for(var g=b.length,c=!0;g--;)if(!n.isFeatureLoaded(b[g])){c=!1;break}if(c)return cre$.promise.resolved(!0);b=["/gadgets/js/",b.join(":")];d?b.push("!",d.join(":")):
window.___jsl&&b.push("!",(window.___jsl.l||[]).join(":"));b.push(".js");a=y.mixin({},a,{c:"1",debug:cre$.config.isDebug?1:0});b.push("?",function(a){var b=encodeURIComponent,c=[],d={},f;for(f in a)if(s.call(a,f)){var g=a[f];if(g!==d[f]){var m=b(f)+"\x3d";c.push(m+b(g))}}return c.join("\x26")}(a));d=cre$.config.getCREServerUrl(b.join(""));return n.loadResources([{uri:d,type:cre$.constants.resource.resourceType.JAVASCRIPT}],f)}})();(function(){cre$.ResourceManager.getOrigin=function(a){var c={http:80,https:443};if(null===a.match(/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/))throw"Malformed URL: "+a;a=RegExp.$1;var b=RegExp.$2;""!==b&&-1===b.indexOf(":")&&c[a]&&(b+=":"+c[a]);return[a,""!==a?":":"",""!==b?"//":"",b].join("")}})();cre$.services=cre$.services||{};
(function(){var a=cre$.services;a.URI="cre.uri";a.XHR="cre.xhr";a.XHRAGGREGATOR="cre.xhr.aggregator";a.AUTH="cre.auth";a.XML="cre.xml.Xmldoc";a.XPATH="cre.xml.xpath";a.XSLT="cre.xml.xslt";a.LOGGING="cre.logging";a.PEOPLE_11="cre.people_11";a.PEOPLE_11_DATA="cre.people_11.data";a.PEOPLE_11_RENDER="cre.people_11.render";a.CONFIG="cre.services.config";a.EVENTSERVICE="eventService";a.ITEMSETPERSISTENCE="persistenceService.itemSet";a.WIREPERSISTENCE="persistenceService.wire";a.WIDGETPERSISTENCE="persistenceService.widget";
a.PAGEPERSISTENCE="persistenceService.page";a.PROXYSERVICE="proxyURLService";a.IRUNTIME="cre.iRuntime";a.XHRWRAPPER="cre.services.xhrwrapper";a.DATAFETCHSERVICE="cre.services.dataFetch";a.JSONDATAFACTORYSERVICE="cre.services.jsonDataFactory";a.AUTOWIRE="cre.services.AutoWire";a.EVENTMATCHING="cre.services.EventNameMatching";a.NAMEDQUEUE="cre.services.NamedQueue";a.queueNames={};a.queueNames.WIDGETDEF="WIDGETDEF"})();"undefined"===typeof cre$.services.ServiceManager&&(cre$.services.ServiceManager=function(){this._serviceEntries={}},cre$.services.ServiceManager.prototype.getService=function(a,b){var c=this._serviceEntries[a]||null;if(null!==c){var d=c.serviceHandler||null;null===d&&(d=this._createService(c),null===d&&(d=cre$.iRuntime.loadFeatures([c.path],b).then(cre$.util.hitch(this,function(){return this._createService(c)}),function(){throw Error("[getService]"+cre$.LocaleHelper.getLocalizedMessages().ERR_CANT_LOAD_SERVICE+
a);})),this._serviceEntries[a].serviceHandler=cre$.promise.when(d));return this._serviceEntries[a].serviceHandler}return cre$.promise.rejected("service"+a+" is not registered.")},cre$.services.ServiceManager.prototype.setService=function(a,b,c){b=b||null;if(null===b)return null;var d=this._serviceEntries[a];null!==(d||null)&&delete this._serviceEntries[a];this._serviceEntries[a]||(this._serviceEntries[a]={});cre$.util.isString(b)?(this._serviceEntries[a].baseClass=b,this._serviceEntries[a].path=c):
this._serviceEntries[a].serviceHandler=cre$.promise.resolved(b)},cre$.services.ServiceManager.prototype.serviceLoaded=function(a){a=(a=this._serviceEntries[a])||null;return null!==a&&(a=a.serviceHandler,null!==(a||null))?!0:!1},cre$.services.ServiceManager.prototype._createService=function(a){var b=null;try{b=new (cre$.util.getObject(a.baseClass))}catch(c){}return b},function(){var a=null;cre$.services.getServiceManager=function(){if(null===a)try{a=new cre$.services.ServiceManager}catch(b){__logging.log("cre$.services",
"getServiceManager",cre$.LocaleHelper.getLocalizedMessages().ERR_CREATE_SERVICEMGR)}return a};window.getServiceManager=cre$.services.getServiceManager;for(var b=cre$.config.ServiceManagerCallbacks,c=b.length,d=cre$.services.getServiceManager();c--;)b[c].call(null,d)}());(function(){cre$.util.stringify=gadgets&&gadgets.json&&gadgets.json.stringify?gadgets.json.stringify:function(a,d,e){var c,b,f;c=/["\\\x00-\x1f\x7f-\x9f]/g;var g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(a===window)return"#window";e=e?e:0;d=d?d:10;if(e>d)return"#hit_max_depth";switch(typeof a){case "string":return c.test(a)?'"'+a.replace(c,function(a){var b=g[a];if(b)return b;b=a.charCodeAt(0);return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)})+
'"':'"'+a+'"';case "number":return isFinite(a)?String(a):"null";case "boolean":case "null":return String(a);case "object":if(!a)return"null";c=[];if("number"===typeof a.length&&!a.propertyIsEnumerable("length")){f=a.length;for(b=0;b<f;b+=1)c.push(this.stringify(a[b],d,e+1)||"null");return"["+c.join(",")+"]"}for(b in a)!b.match("___$")&&a.hasOwnProperty&&a.hasOwnProperty(b)&&"string"===typeof b&&(f=this.stringify(a[b],d,e+1))&&c.push(this.stringify(b)+":"+f);return"{"+c.join(",")+"}"}return""}})();"undefined"==typeof cre$.Uri&&(shindig&&shindig.uri)&&(cre$.Uri=shindig.uri);cre$.Uri&&getServiceManager().setService(cre$.services.URI,cre$.Uri);shindig.sha1=function(){function s(){d[0]=1732584193;d[1]=4023233417;d[2]=2562383102;d[3]=271733878;d[4]=3285377520;g=e=0}function m(b){for(var c=u,a=0;64>a;a+=4)c[a/4]=b[a]<<24|b[a+1]<<16|b[a+2]<<8|b[a+3];for(a=16;80>a;a++)c[a]=((c[a-3]^c[a-8]^c[a-14]^c[a-16])<<1|(c[a-3]^c[a-8]^c[a-14]^c[a-16])>>>31)&4294967295;b=d[0];for(var f=d[1],h=d[2],e=d[3],g=d[4],k,l,a=0;80>a;a++)40>a?20>a?(k=e^f&(h^e),l=1518500249):(k=f^h^e,l=1859775393):60>a?(k=f&h|e&(f|h),l=2400959708):(k=f^h^e,l=3395469782),k=((b<<5|b>>>
27)&4294967295)+k+g+l+c[a]&4294967295,g=e,e=h,h=(f<<30|f>>>2)&4294967295,f=b,b=k;d[0]=d[0]+b&4294967295;d[1]=d[1]+f&4294967295;d[2]=d[2]+h&4294967295;d[3]=d[3]+e&4294967295;d[4]=d[4]+g&4294967295}function p(b,c){if("string"===typeof b){b=unescape(encodeURIComponent(b));for(var a=[],d=0,h=b.length;d<h;++d)a.push(b.charCodeAt(d));b=a}c||(c=b.length);a=0;if(0==e)for(;a+64<c;)m(b.slice(a,a+64)),a+=64,g+=64;for(;a<c;)if(n[e++]=b[a++],g++,64==e){e=0;for(m(n);a+64<c;)m(b.slice(a,a+64)),a+=64,g+=64}}function t(){var b=
[],c=8*g;56>e?p(q,56-e):p(q,64-(e-56));for(var a=63;56<=a;a--)n[a]=c&255,c>>>=8;m(n);for(a=c=0;5>a;a++)for(var f=24;0<=f;f-=8)b[c++]=d[a]>>f&255;return b}for(var d=[],n=[],u=[],q=[128],r=1;64>r;++r)q[r]=0;var e,g;s();return{reset:s,update:p,digest:t,digestString:function(){for(var b=t(),c="",a=0;a<b.length;a++)c+="0123456789ABCDEF".charAt(Math.floor(b[a]/16))+"0123456789ABCDEF".charAt(b[a]%16);return c}}};var OpenAjax=OpenAjax||{};
OpenAjax.hub||(OpenAjax.hub=function(){var a={};return{implementer:"http://openajax.org",implVersion:"2.0.7",specVersion:"2.0",implExtraData:{},libraries:a,registerLibrary:function(b,c,d,e){a[b]={prefix:b,namespaceURI:c,version:d,extraData:e};this.publish("org.openajax.hub.registerLibrary",a[b])},unregisterLibrary:function(b){this.publish("org.openajax.hub.unregisterLibrary",a[b]);delete a[b]}}}(),OpenAjax.hub.Error={BadParameters:"OpenAjax.hub.Error.BadParameters",Disconnected:"OpenAjax.hub.Error.Disconnected",Duplicate:"OpenAjax.hub.Error.Duplicate",
NoContainer:"OpenAjax.hub.Error.NoContainer",NoSubscription:"OpenAjax.hub.Error.NoSubscription",NotAllowed:"OpenAjax.hub.Error.NotAllowed",WrongProtocol:"OpenAjax.hub.Error.WrongProtocol",IncompatBrowser:"OpenAjax.hub.Error.IncompatBrowser"},OpenAjax.hub.SecurityAlert={LoadTimeout:"OpenAjax.hub.SecurityAlert.LoadTimeout",FramePhish:"OpenAjax.hub.SecurityAlert.FramePhish",ForgedMsg:"OpenAjax.hub.SecurityAlert.ForgedMsg"},OpenAjax.hub._debugger=function(){},OpenAjax.hub.ManagedHub=function(a){if(!a||
!a.onPublish||!a.onSubscribe)throw Error(OpenAjax.hub.Error.BadParameters);this._p=a;this._onUnsubscribe=a.onUnsubscribe?a.onUnsubscribe:null;this._scope=a.scope||window;if(a.log){var b=this;this._log=function(c){try{a.log.call(b._scope,"ManagedHub: "+c)}catch(d){OpenAjax.hub._debugger()}}}else this._log=function(){};this._subscriptions={c:{},s:null};this._containers={};this._seq=0;this._active=!0;this._isPublishing=!1;this._pubQ=[]},OpenAjax.hub.ManagedHub.prototype.subscribeForClient=function(a,
b,c){this._assertConn();if(this._invokeOnSubscribe(b,a))return this._subscribe(b,this._sendToClient,this,{c:a,sid:c});throw Error(OpenAjax.hub.Error.NotAllowed);},OpenAjax.hub.ManagedHub.prototype.unsubscribeForClient=function(a,b){this._unsubscribe(b);this._invokeOnUnsubscribe(a,b)},OpenAjax.hub.ManagedHub.prototype.publishForClient=function(a,b,c){this._assertConn();this._publish(b,c,a)},OpenAjax.hub.ManagedHub.prototype.disconnect=function(){this._active=!1;for(var a in this._containers)this.removeContainer(this._containers[a])},
OpenAjax.hub.ManagedHub.prototype.getContainer=function(a){return(a=this._containers[a])?a:null},OpenAjax.hub.ManagedHub.prototype.listContainers=function(){var a=[],b;for(b in this._containers)a.push(this._containers[b]);return a},OpenAjax.hub.ManagedHub.prototype.addContainer=function(a){this._assertConn();var b=a.getClientID();if(this._containers[b])throw Error(OpenAjax.hub.Error.Duplicate);this._containers[b]=a},OpenAjax.hub.ManagedHub.prototype.removeContainer=function(a){var b=a.getClientID();
if(!this._containers[b])throw Error(OpenAjax.hub.Error.NoContainer);a.remove();delete this._containers[b]},OpenAjax.hub.ManagedHub.prototype.subscribe=function(a,b,c,d,e){function f(a,d,f,h){if(g._invokeOnPublish(a,d,h,null))try{b.call(c,a,d,e)}catch(k){OpenAjax.hub._debugger(),g._log("caught error from onData callback to Hub.subscribe(): "+k.message)}}this._assertConn();this._assertSubTopic(a);if(!b)throw Error(OpenAjax.hub.Error.BadParameters);c=c||window;if(this._invokeOnSubscribe(a,null)){var g=
this;a=this._subscribe(a,f,c,e);this._invokeOnComplete(d,c,a,!0);return a}this._invokeOnComplete(d,c,null,!1,OpenAjax.hub.Error.NotAllowed)},OpenAjax.hub.ManagedHub.prototype.publish=function(a,b){this._assertConn();this._assertPubTopic(a);this._publish(a,b,null)},OpenAjax.hub.ManagedHub.prototype.unsubscribe=function(a,b,c){this._assertConn();if(!a)throw Error(OpenAjax.hub.Error.BadParameters);this._unsubscribe(a);this._invokeOnUnsubscribe(null,a);this._invokeOnComplete(b,c,a,!0)},OpenAjax.hub.ManagedHub.prototype.isConnected=
function(){return this._active},OpenAjax.hub.ManagedHub.prototype.getScope=function(){return this._scope},OpenAjax.hub.ManagedHub.prototype.getSubscriberData=function(a){this._assertConn();a=a.split(".");var b=a.pop();if(a=this._getSubscriptionObject(this._subscriptions,a,0,b))return a.data;throw Error(OpenAjax.hub.Error.NoSubscription);},OpenAjax.hub.ManagedHub.prototype.getSubscriberScope=function(a){this._assertConn();a=a.split(".");var b=a.pop();if(a=this._getSubscriptionObject(this._subscriptions,
a,0,b))return a.scope;throw Error(OpenAjax.hub.Error.NoSubscription);},OpenAjax.hub.ManagedHub.prototype.getParameters=function(){return this._p},OpenAjax.hub.ManagedHub.prototype._sendToClient=function(a,b,c,d){this.isConnected()&&this._invokeOnPublish(a,b,d,c.c)&&c.c.sendToClient(a,b,c.sid)},OpenAjax.hub.ManagedHub.prototype._assertConn=function(){if(!this.isConnected())throw Error(OpenAjax.hub.Error.Disconnected);},OpenAjax.hub.ManagedHub.prototype._assertPubTopic=function(a){if(!a||""===a||-1!=
a.indexOf("*")||-1!=a.indexOf("..")||"."==a.charAt(0)||"."==a.charAt(a.length-1))throw Error(OpenAjax.hub.Error.BadParameters);},OpenAjax.hub.ManagedHub.prototype._assertSubTopic=function(a){if(!a)throw Error(OpenAjax.hub.Error.BadParameters);a=a.split(".");for(var b=a.length,c=0;c<b;c++){var d=a[c];if(""===d||-1!=d.indexOf("*")&&"*"!=d&&"**"!=d)throw Error(OpenAjax.hub.Error.BadParameters);if("**"==d&&c<b-1)throw Error(OpenAjax.hub.Error.BadParameters);}},OpenAjax.hub.ManagedHub.prototype._invokeOnComplete=
function(a,b,c,d,e){if(a)try{b=b||window,a.call(b,c,d,e)}catch(f){OpenAjax.hub._debugger(),this._log("caught error from onComplete callback: "+f.message)}},OpenAjax.hub.ManagedHub.prototype._invokeOnPublish=function(a,b,c,d){try{return this._p.onPublish.call(this._scope,a,b,c,d)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onPublish callback to constructor: "+e.message)}return!1},OpenAjax.hub.ManagedHub.prototype._invokeOnSubscribe=function(a,b){try{return this._p.onSubscribe.call(this._scope,
a,b)}catch(c){OpenAjax.hub._debugger(),this._log("caught error from onSubscribe callback to constructor: "+c.message)}return!1},OpenAjax.hub.ManagedHub.prototype._invokeOnUnsubscribe=function(a,b){if(this._onUnsubscribe){var c=b.slice(0,b.lastIndexOf("."));try{this._onUnsubscribe.call(this._scope,c,a)}catch(d){OpenAjax.hub._debugger(),this._log("caught error from onUnsubscribe callback to constructor: "+d.message)}}},OpenAjax.hub.ManagedHub.prototype._subscribe=function(a,b,c,d){var e=a+"."+this._seq;
b={scope:c,cb:b,data:d,sid:this._seq++};a=a.split(".");this._recursiveSubscribe(this._subscriptions,a,0,b);return e},OpenAjax.hub.ManagedHub.prototype._recursiveSubscribe=function(a,b,c,d){var e=b[c];c==b.length?(d.next=a.s,a.s=d):("undefined"==typeof a.c&&(a.c={}),"undefined"==typeof a.c[e]&&(a.c[e]={c:{},s:null}),this._recursiveSubscribe(a.c[e],b,c+1,d))},OpenAjax.hub.ManagedHub.prototype._publish=function(a,b,c){if(this._isPublishing)this._pubQ.push({t:a,d:b,p:c});else for(this._safePublish(a,
b,c);0<this._pubQ.length;)a=this._pubQ.shift(),this._safePublish(a.t,a.d,a.p)},OpenAjax.hub.ManagedHub.prototype._safePublish=function(a,b,c){this._isPublishing=!0;var d=a.split(".");this._recursivePublish(this._subscriptions,d,0,a,b,c);this._isPublishing=!1},OpenAjax.hub.ManagedHub.prototype._recursivePublish=function(a,b,c,d,e,f){if("undefined"!=typeof a&&(c!=b.length&&(this._recursivePublish(a.c[b[c]],b,c+1,d,e,f),this._recursivePublish(a.c["*"],b,c+1,d,e,f),a=a.c["**"]),"undefined"!=typeof a))for(a=
a.s;a;){b=a.scope;c=a.cb;var g=a.data;"string"==typeof c&&(c=b[c]);c.call(b,d,e,g,f);a=a.next}},OpenAjax.hub.ManagedHub.prototype._unsubscribe=function(a){a=a.split(".");var b=a.pop();if(!this._recursiveUnsubscribe(this._subscriptions,a,0,b))throw Error(OpenAjax.hub.Error.NoSubscription);},OpenAjax.hub.ManagedHub.prototype._recursiveUnsubscribe=function(a,b,c,d){if("undefined"==typeof a)return!1;if(c<b.length){var e=a.c[b[c]];if(!e)return!1;this._recursiveUnsubscribe(e,b,c+1,d);if(!e.s){for(var f in e.c)return!0;
delete a.c[b[c]]}}else{b=a.s;c=null;for(e=!1;b;){if(d==b.sid){e=!0;b==a.s?a.s=b.next:c.next=b.next;break}c=b;b=b.next}if(!e)return!1}return!0},OpenAjax.hub.ManagedHub.prototype._getSubscriptionObject=function(a,b,c,d){if("undefined"!=typeof a){if(c<b.length)return this._getSubscriptionObject(a.c[b[c]],b,c+1,d);for(a=a.s;a;){if(d==a.sid)return a;a=a.next}}return null},OpenAjax.hub._hub=new OpenAjax.hub.ManagedHub({onSubscribe:function(a,b){return!0},onPublish:function(a,b,c,d){return!0}}),OpenAjax.hub.subscribe=
function(a,b,c,d){"string"===typeof b&&(c=c||window,b=c[b]||null);return OpenAjax.hub._hub.subscribe(a,b,c,null,d)},OpenAjax.hub.unsubscribe=function(a){return OpenAjax.hub._hub.unsubscribe(a)},OpenAjax.hub.publish=function(a,b){OpenAjax.hub._hub.publish(a,b)},OpenAjax.hub.registerLibrary("OpenAjax","http://openajax.org/hub","2.0",{}));var OpenAjax=OpenAjax||{};OpenAjax.hub=OpenAjax.hub||{};OpenAjax.gadgets="object"===typeof OpenAjax.gadgets?OpenAjax.gadgets:"object"===typeof gadgets?gadgets:{};OpenAjax.gadgets.rpctx=OpenAjax.gadgets.rpctx||{};
(function(){if("undefined"===typeof gadgets){if("undefined"===typeof oaaConfig)for(var q=document.getElementsByTagName("script"),f=/openajax(?:managedhub-(?:all|core).*|-mashup)\.js$/i,h=q.length-1;0<=h;h--){var b=q[h].getAttribute("src");if(b&&b.match(f)){if(q=q[h].getAttribute("oaaConfig"))try{oaaConfig=eval("({ "+q+" })")}catch(e){}break}}"undefined"!==typeof oaaConfig&&oaaConfig.gadgetsGlobal&&(gadgets=OpenAjax.gadgets)}})();
OpenAjax.hub.IframeContainer||function(){OpenAjax.hub.IframeContainer=function(f,h,b){function e(){OpenAjax.gadgets.rpc.call(c,"openajax.pubsub",function(a){if(a&&(l=!0,clearTimeout(w),u.getElementById(c).style.visibility="visible",b.Container.onConnect))try{b.Container.onConnect.call(r,m)}catch(s){OpenAjax.hub._debugger(),t("caught error from onConnect callback to constructor: "+s.message)}},"cmd","con")}function v(){if(l){l=!1;u.getElementById(c).style.visibility="hidden";for(var x in a)f.unsubscribeForClient(m,
a[x]);a={}}}function d(a){try{b.Container.onSecurityAlert.call(r,m,a)}catch(c){OpenAjax.hub._debugger(),t("caught error from onSecurityAlert callback to constructor: "+c.message)}}function k(){w=setTimeout(function(){d(OpenAjax.hub.SecurityAlert.LoadTimeout);m._handleIncomingRPC=function(){}},g)}(function(a){var b=a[1],c=a[2];if(!a[0]||!b||!c||!c.Container||!c.Container.onSecurityAlert||!c.IframeContainer||!c.IframeContainer.parent||!c.IframeContainer.uri)throw Error(OpenAjax.hub.Error.BadParameters);
})(arguments);var m=this,r=b.Container.scope||window,l=!1,a={},s,c,g=b.IframeContainer.timeout||15E3,w,u=b.IframeContainer.parent.ownerDocument,t=b.Container.log?function(a){try{b.Container.log.call(r,"IframeContainer::"+h+": "+a)}catch(c){OpenAjax.hub._debugger()}}:function(){};this._init=function(){f.addContainer(this);c=OpenAjax.hub.IframeContainer._rpcRouter.add(h,this);var a=b,g=r,n=t;if(!OpenAjax.hub.IframeContainer._prng){var d=(new Date).getTime()+Math.random()+document.cookie;OpenAjax.hub.IframeContainer._prng=
OpenAjax._smash.crypto.newPRNG(d)}if((a=a.IframeContainer||a.IframeHubClient)&&a.seed)try{var p=a.seed.call(g);OpenAjax.hub.IframeContainer._prng.addSeed(p)}catch(e){OpenAjax.hub._debugger(),n("caught error from 'seed' callback: "+e.message)}s=OpenAjax.hub.IframeContainer._prng.nextRandomB64Str(a&&a.tokenLength||6);g=b.IframeContainer.clientRelay;n=OpenAjax.gadgets.rpc.getRelayChannel();if(b.IframeContainer.tunnelURI){if("wpm"!==n&&"ifpc"!==n&&"flash"!==n)throw Error(OpenAjax.hub.Error.IncompatBrowser);
}else t("WARNING: Parameter 'IframeContaienr.tunnelURI' not specified. Connection will not be fully secure."),"rmr"===n&&!g&&(g=OpenAjax.gadgets.rpc.getOrigin(b.IframeContainer.uri)+"/robots.txt");n=document.createElement("span");b.IframeContainer.parent.appendChild(n);p='\x3ciframe id\x3d"'+c+'" name\x3d"'+c+'" src\x3d"javascript:\'\x3chtml\x3e\x3c/html\x3e\'"';a="";if(d=b.IframeContainer.iframeAttrs)for(var m in d)switch(m){case "style":for(var l in d.style)a+=l+":"+d.style[l]+";";break;case "className":p+=
' class\x3d"'+d[m]+'"';break;default:p+=" "+m+'\x3d"'+d[m]+'"'}p+=' style\x3d"'+(a+"visibility:hidden;")+'"\x3e\x3c/iframe\x3e';n.innerHTML=p;m=b.IframeContainer.tunnelURI?"\x26parent\x3d"+encodeURIComponent(b.IframeContainer.tunnelURI)+"\x26forcesecure\x3dtrue":"\x26oahParent\x3d"+encodeURIComponent(OpenAjax.gadgets.rpc.getOrigin(window.location.href));l="";c!==h&&(l="\x26oahId\x3d"+c.substring(c.lastIndexOf("_")+1));n=u.getElementById(c);b.IframeContainer.onGadgetLoad&&(n.attachEvent?n.attachEvent("onload",
b.IframeContainer.onGadgetLoad):n.onload=b.IframeContainer.onGadgetLoad);b.IframeContainer.uri.indexOf("#");p=b.IframeContainer.parent.ownerDocument.defaultView;for(a=0;p&&p!==window;)p=p.parent,a++;n.src=b.IframeContainer.uri+"#rpctoken\x3d"+s+m+l+"\x26embeddedlevel\x3d"+a;OpenAjax.gadgets.rpc.setupReceiver(c,g);"undefined"!==typeof b.nonGadget&&"true"===b.nonGadget&&OpenAjax.gadgets.rpc.setUpRpcIdsForNonGadgetIframe(h,h,b.IframeContainer.uri,["openajax.pubsub","__cb"]);k()};this.sendToClient=function(a,
b,s){OpenAjax.gadgets.rpc.call(c,"openajax.pubsub",null,"pub",a,b,s)};this.remove=function(){v();clearTimeout(w);OpenAjax.gadgets.rpc.removeReceiver(c);var a=document.getElementById(c);a.parentNode.removeChild(a);OpenAjax.hub.IframeContainer._rpcRouter.remove(c)};this.isConnected=function(){return l};this.getClientID=function(){return h};this.getPartnerOrigin=function(){if(l){var a=OpenAjax.gadgets.rpc.getReceiverOrigin(c);if(a)return/^([a-zA-Z]+:\/\/[^:]+).*/.exec(a)[1]}return null};this.getParameters=
function(){return b};this.getHub=function(){return f};this.getIframe=function(){return u.getElementById(c)};this._handleIncomingRPC=function(c,s,g){switch(c){case "pub":f.publishForClient(m,s,g);break;case "sub":c="";try{a[g]=f.subscribeForClient(m,s,g)}catch(d){c=d.message}return c;case "uns":return f.unsubscribeForClient(m,a[g]),delete a[g],g;case "con":return e(),!0;case "dis":k();v();if(b.Container.onDisconnect)try{b.Container.onDisconnect.call(r,m)}catch(h){OpenAjax.hub._debugger(),t("caught error from onDisconnect callback to constructor: "+
h.message)}return!0}};this._onSecurityAlert=function(a){d(q[a])};this._init()};OpenAjax.hub.IframeHubClient=function(f){function h(){if(!d)throw Error(OpenAjax.hub.Error.Disconnected);}function b(a){if(!a)throw Error(OpenAjax.hub.Error.BadParameters);a=a.split(".");for(var b=a.length,c=0;c<b;c++){var g=a[c];if(""===g||-1!=g.indexOf("*")&&"*"!=g&&"**"!=g)throw Error(OpenAjax.hub.Error.BadParameters);if("**"==g&&c<b-1)throw Error(OpenAjax.hub.Error.BadParameters);}}if(!f||!f.HubClient||!f.HubClient.onSecurityAlert)throw Error(OpenAjax.hub.Error.BadParameters);
var e=this,q=f.HubClient.scope||window,d=!1,k={},m=0,r,l=f.HubClient.log?function(a){try{f.HubClient.log.call(q,"IframeHubClient::"+r+": "+a)}catch(b){OpenAjax.hub._debugger()}}:function(){};this._init=function(){var a=OpenAjax.gadgets,b=a.util.getUrlParameters();b.parent||a.rpc.setupReceiver("..",b.oahParent+"/robots.txt");if(f.IframeHubClient&&f.IframeHubClient.requireParentVerifiable&&null===a.rpc.getReceiverOrigin(".."))throw a.rpc.removeReceiver(".."),Error(OpenAjax.hub.Error.IncompatBrowser);
OpenAjax.hub.IframeContainer._rpcRouter.add("..",this);r=OpenAjax.gadgets.rpc.RPC_ID;b.oahId&&(r=r.substring(0,r.lastIndexOf("_")))};this.connect=function(a,b){if(d)throw Error(OpenAjax.hub.Error.Duplicate);OpenAjax.gadgets.rpc.call("..","openajax.pubsub",function(c){if(c&&(d=!0,a))try{a.call(b||window,e,!0)}catch(g){OpenAjax.hub._debugger(),l("caught error from onComplete callback to connect(): "+g.message)}},"con")};this.disconnect=function(a,b){if(!d)throw Error(OpenAjax.hub.Error.Disconnected);
d=!1;var c=null;a&&(c=function(c){try{a.call(b||window,e,!0)}catch(d){OpenAjax.hub._debugger(),l("caught error from onComplete callback to disconnect(): "+d.message)}});OpenAjax.gadgets.rpc.call("..","openajax.pubsub",c,"dis")};this.getPartnerOrigin=function(){if(d){var a=OpenAjax.gadgets.rpc.getReceiverOrigin("..");if(a)return/^([a-zA-Z]+:\/\/[^:]+).*/.exec(a)[1]}return null};this.getClientID=function(){return r};this.subscribe=function(a,d,c,g,f){h();b(a);if(!d)throw Error(OpenAjax.hub.Error.BadParameters);
c=c||window;var e=""+m++;k[e]={cb:d,sc:c,d:f};OpenAjax.gadgets.rpc.call("..","openajax.pubsub",function(a){""!==a&&delete k[e];if(g)try{g.call(c,e,""===a,a)}catch(b){OpenAjax.hub._debugger(),l("caught error from onComplete callback to subscribe(): "+b.message)}},"sub",a,e);return e};this.publish=function(a,b){h();if(!a||""===a||-1!=a.indexOf("*")||-1!=a.indexOf("..")||"."==a.charAt(0)||"."==a.charAt(a.length-1))throw Error(OpenAjax.hub.Error.BadParameters);OpenAjax.gadgets.rpc.call("..","openajax.pubsub",
null,"pub",a,b)};this.unsubscribe=function(a,b,c){h();if(!a)throw Error(OpenAjax.hub.Error.BadParameters);if(!k[a]||k[a].uns)throw Error(OpenAjax.hub.Error.NoSubscription);k[a].uns=!0;OpenAjax.gadgets.rpc.call("..","openajax.pubsub",function(d){delete k[a];if(b)try{b.call(c||window,a,!0)}catch(e){OpenAjax.hub._debugger(),l("caught error from onComplete callback to unsubscribe(): "+e.message)}},"uns",null,a)};this.isConnected=function(){return d};this.getScope=function(){return q};this.getSubscriberData=
function(a){h();if(k[a])return k[a].d;throw Error(OpenAjax.hub.Error.NoSubscription);};this.getSubscriberScope=function(a){h();if(k[a])return k[a].sc;throw Error(OpenAjax.hub.Error.NoSubscription);};this.getParameters=function(){return f};this._handleIncomingRPC=function(a,b,c,d){if("pub"===a&&k[d]&&!k[d].uns)try{k[d].cb.call(k[d].sc,b,c,k[d].d)}catch(e){OpenAjax.hub._debugger(),l("caught error from onData callback to subscribe(): "+e.message)}return"con"===b?!0:!1};this._init()};OpenAjax.hub.IframeContainer._rpcRouter=
function(){function f(){var e=b[this.f];if(e)return e._handleIncomingRPC.apply(e,arguments)}function h(e,f){var d=b[e];d&&d._onSecurityAlert.call(d,f)}var b={};return{add:function(e,v){function d(d,e){if(".."===d)b[".."]||(b[".."]=e);else{for(var f=d;document.getElementById(f);)f=d+"_"+(32767*Math.random()|0).toString(16);b[f]=e;return f}}OpenAjax.gadgets.rpc.register("openajax.pubsub",f);OpenAjax.gadgets.rpc.config({securityCallback:h});q[OpenAjax.gadgets.rpc.SEC_ERROR_LOAD_TIMEOUT]=OpenAjax.hub.SecurityAlert.LoadTimeout;
q[OpenAjax.gadgets.rpc.SEC_ERROR_FRAME_PHISH]=OpenAjax.hub.SecurityAlert.FramePhish;q[OpenAjax.gadgets.rpc.SEC_ERROR_FORGED_MSG]=OpenAjax.hub.SecurityAlert.ForgedMsg;this.add=d;return d(e,v)},remove:function(e){delete b[e]}}}();var q={}}();OpenAjax.hub.InlineContainer=function(a,c,d){function f(b,f,a,c,d){if(b)try{f=f||window,b.call(f,a,c,d)}catch(e){OpenAjax.hub._debugger(),r._log("caught error from onComplete callback: "+e.message)}}function e(){for(var b in l)a.unsubscribeForClient(this,l[b].h);l=[];s=0;g=!1}function m(){if(!g)throw Error(OpenAjax.hub.Error.Disconnected);}function p(b){if(b=l[b])return b;throw Error(OpenAjax.hub.Error.NoSubscription);}if(!a||!c||!d||!d.Container||!d.Container.onSecurityAlert)throw Error(OpenAjax.hub.Error.BadParameters);
var h=d.Container.scope||window,g=!1,l=[],s=0,r=null,t=d.Container.log?function(b){try{d.Container.log.call(h,"InlineContainer::"+c+": "+b)}catch(f){OpenAjax.hub._debugger()}}:function(){};this._init=function(){a.addContainer(this)};this.getHub=function(){return a};this.sendToClient=function(b,f,a){if(g){a=l[a];try{a.cb.call(a.sc,b,f,a.d)}catch(c){OpenAjax.hub._debugger(),r._log("caught error from onData callback to HubClient.subscribe(): "+c.message)}}};this.remove=function(){g&&e()};this.isConnected=
function(){return g};this.getClientID=function(){return c};this.getPartnerOrigin=function(){return g?window.location.protocol+"//"+window.location.hostname:null};this.getParameters=function(){return d};this.connect=function(b,a,c){if(g)throw Error(OpenAjax.hub.Error.Duplicate);g=!0;r=b;if(d.Container.onConnect)try{d.Container.onConnect.call(h,this)}catch(e){OpenAjax.hub._debugger(),t("caught error from onConnect callback to constructor: "+e.message)}f(a,c,b,!0)};this.disconnect=function(b,a,c){if(!g)throw Error(OpenAjax.hub.Error.Disconnected);
e();if(d.Container.onDisconnect)try{d.Container.onDisconnect.call(h,this)}catch(m){OpenAjax.hub._debugger(),t("caught error from onDisconnect callback to constructor: "+m.message)}f(a,c,b,!0)};this.subscribe=function(b,c,e,d,g){m();if(!b)throw Error(OpenAjax.hub.Error.BadParameters);for(var k=b.split("."),q=k.length,n=0;n<q;n++){var h=k[n];if(""===h||-1!=h.indexOf("*")&&"*"!=h&&"**"!=h)throw Error(OpenAjax.hub.Error.BadParameters);if("**"==h&&n<q-1)throw Error(OpenAjax.hub.Error.BadParameters);}if(!c)throw Error(OpenAjax.hub.Error.BadParameters);
k=""+s++;q=!1;n=null;try{var p=a.subscribeForClient(this,b,k),q=!0}catch(r){k=null,n=r.message}e=e||window;q&&(l[k]={h:p,cb:c,sc:e,d:g});f(d,e,k,q,n);return k};this.publish=function(b,f){m();if(null==b||""===b||-1!=b.indexOf("*")||-1!=b.indexOf("..")||"."==b.charAt(0)||"."==b.charAt(b.length-1))throw Error(OpenAjax.hub.Error.BadParameters);a.publishForClient(this,b,f)};this.unsubscribe=function(b,c,e){m();if("undefined"===typeof b||null===b)throw Error(OpenAjax.hub.Error.BadParameters);var d=l[b];
if(!d)throw Error(OpenAjax.hub.Error.NoSubscription);a.unsubscribeForClient(this,d.h);delete l[b];f(c,e,b,!0)};this.getSubscriberData=function(b){m();return p(b).d};this.getSubscriberScope=function(b){m();return p(b).sc};this._init()};
OpenAjax.hub.InlineHubClient=function(a){if(!a||!a.HubClient||!a.HubClient.onSecurityAlert||!a.InlineHubClient||!a.InlineHubClient.container)throw Error(OpenAjax.hub.Error.BadParameters);var c=a.InlineHubClient.container,d=a.HubClient.scope||window;this._log=a.HubClient.log?function(f){try{a.HubClient.log.call(d,"InlineHubClient::"+c.getClientID()+": "+f)}catch(e){OpenAjax.hub._debugger()}}:function(){};this.connect=function(a,e){c.connect(this,a,e)};this.disconnect=function(a,e){c.disconnect(this,
a,e)};this.getPartnerOrigin=function(){return c.getPartnerOrigin()};this.getClientID=function(){return c.getClientID()};this.subscribe=function(a,e,d,p,h){return c.subscribe(a,e,d,p,h)};this.publish=function(a,e){c.publish(a,e)};this.unsubscribe=function(a,e,d){c.unsubscribe(a,e,d)};this.isConnected=function(){return c.isConnected()};this.getScope=function(){return d};this.getSubscriberData=function(a){return c.getSubscriberData(a)};this.getSubscriberScope=function(a){return c.getSubscriberScope(a)};
this.getParameters=function(){return a}};"undefined"==typeof OpenAjax._smash&&(OpenAjax._smash={});
OpenAjax._smash.crypto={strToWA:function(a,b){for(var f=[],c=(1<<b)-1,d=0;d<a.length*b;d+=b)f[d>>5]|=(a.charCodeAt(d/b)&c)<<32-b-d%32;return f},hmac_sha1:function(a,b,f){for(var c=Array(16),d=Array(16),g=0;16>g;g++)c[g]=a[g]^909522486,d[g]=a[g]^1549556828;a=this.sha1(c.concat(this.strToWA(b,f)),512+b.length*f);return this.sha1(d.concat(a),672)},newPRNG:function(a){function b(a){a=f.hmac_sha1(c,a,8);for(var b=0;5>b;b++)d[b]^=a[b]}var f=this;("string"!=typeof a||12>a.length)&&alert("WARNING: Seed length too short ...");
var c=[43417,15926,18182,33130,9585,30800,49772,40144,47678,55453,4659,38181,65340,6787,54417,65301],d=[],g=0;b(a);return{addSeed:function(a){b(a)},nextRandomOctets:function(a){for(var b=[];0<a;){g+=1;var c=f.hmac_sha1(d,g.toString(16),8);for(i=0;20>i&0<a;i++,a--)b.push((c[i>>2]>>i%4)%256)}return b},nextRandomB64Str:function(a){for(var b=this.nextRandomOctets(a),c="",d=0;d<a;d++)c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(b[d]&63);return c}}},sha1:function(){var a=
function(a,f){var c=(a&65535)+(f&65535);return(a>>16)+(f>>16)+(c>>16)<<16|c&65535};return function(b,f){b[f>>5]|=128<<24-f%32;b[(f+64>>9<<4)+15]=f;for(var c=Array(80),d=1732584193,g=-271733879,n=-1732584194,p=271733878,q=-1009589776,r=0;r<b.length;r+=16){for(var m=d,h=g,k=n,l=p,s=q,e=0;80>e;e++){c[e]=16>e?b[r+e]:(c[e-3]^c[e-8]^c[e-14]^c[e-16])<<1|(c[e-3]^c[e-8]^c[e-14]^c[e-16])>>>31;var t=m<<5|m>>>27,u;u=20>e?h&k|~h&l:40>e?h^k^l:60>e?h&k|h&l|k&l:h^k^l;t=a(a(t,u),a(a(s,c[e]),20>e?1518500249:40>e?1859775393:
60>e?-1894007588:-899497514));s=l;l=k;k=h<<30|h>>>2;h=m;m=t}d=a(m,d);g=a(h,g);n=a(k,n);p=a(l,p);q=a(s,q)}return[d,g,n,p,q]}}()};(function(){var b=cre$.util,d=window.dojo;b.toJsonIndentStr="\t";b.serializeJson=function(a){return null===a?null:window.JSON&&window.JSON.parse&&window.JSON.stringify?window.JSON.stringify(a):b.stringify(a)};b._escapeString=d?d._escapeString:function(a){return('"'+a.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};b.map=d?d.map:function(a,c,b,e){c=_getParts(a,b,c);a=c[0];e=e?new e:[];b=0;for(var f=
a.length;b<f;++b)e.push(c[2].call(c[1],a[b],b,a));return e};b.toJson=d?d.toJson:function(a,c,d){if(void 0===a)return"undefined";var e=typeof a;if("number"==e||"boolean"==e)return a+"";if(null===a)return"null";if(b.isString(a))return b._escapeString(a);var f=arguments.callee,g;d=d||"";var k=c?d+b.toJsonIndentStr:"";g=a.__json__||a.json;if(b.isFunction(g)&&(g=g.call(a),a!==g))return f(g,c,k);if(a.nodeType&&a.cloneNode)throw Error("Can't serialize DOM nodes");g=c?" ":"";var l=c?"\n":"";if(b.isArray(a))return"["+
b.map(a,function(a){a=f(a,c,k);"string"!=typeof a&&(a="undefined");return l+k+a}).join(","+g)+l+d+"]";if("function"==e)return null;var e=[],h;for(h in a){var m,n;if("number"==typeof h)m='"'+h+'"';else if("string"==typeof h)m=b._escapeString(h);else continue;n=f(a[h],c,k);"string"==typeof n&&e.push(l+k+m+":"+g+n)}return"{"+e.join(","+g)+l+d+"}"};b.fromJson=d?d.fromJson:function(a){return eval("("+a+")")};b.queryToObject=d?d.queryToObject:function(a){var c={};a=a.split("\x26");var d=decodeURIComponent;
b.forEach(a,function(a){if(a.length){var f=a.split("\x3d");a=d(f.shift());f=d(f.join("\x3d"));"string"==typeof c[a]&&(c[a]=[c[a]]);b.isArray(c[a])?c[a].push(f):c[a]=f}});return c}})();(function(){var e=cre$.util;e._tokenRefreshers={};e.registerTokenRefresher=function(a,c){cre$.util._tokenRefreshers[a]=c};e.getTokenRefresher=function(a){return cre$.util._tokenRefreshers[a]};e.applyTokenToUrl=function(a,c,b){if(a&&c)return cre$.config.getCREServerUrl(),cre$.iRuntime.makeProxyUrl(a),c=cre$.iRuntime.getProxyUrl().replace("%host%",document.location.host),0<c.indexOf("?")&&(c=c.substring(0,c.indexOf("?"))),0<a.indexOf(c)&&b&&(a=shindig.uri(a),b=a.getPath()+"/"+b,a.setPath(b),a=a.toString()),
a};e._injectFirstParamToUrl=function(a,c,b){a=shindig.uri(a);var d=a.getQuery();null!==d?(a.setQuery(""),a.setQP(c,b),a=shindig.uri(a.toString()+"\x26"+d)):a.setQP(c,b);return a.toString()};e._hasSTinUrl=function(a){return"undefined"!==typeof shindig.uri(a).getQP("st")?!0:!1};e.removeSTIfExist=function(a){a=shindig.uri(a);if("undefined"!==typeof a.getQP("st"))return a.getQP("st")};e.refreshToken=function(a,c){var b=cre$.config.getCREServerUrl()+cre$.config.REFRESHTOKEN_URL,b=b+"?type\x3d"+c;if(cre$.config.userid){var d=
shindig.sha1();d.update(cre$.config.userid);d=d.digestString();b=b+"\x26u\x3d"+d}else b=b+"\x26u\x3d"+cre$.config.timestamp;b=cre$.iRuntime.makeProxyUrl(b);d={};d.url=b;d.headers={"Cache-control":"no-cache"};null!==cre$.internalutil.getCREContainerToken()&&(d.headers["X-Shindig-ST"]=cre$.internalutil.getCREContainerToken().token,b=cre$.util.applyTokenToUrl(b,cre$.internalutil.getCREContainerToken()));"container"!==c&&(d.headers.token=a);d.headers.container=cre$.config.CONTAINER;return cre$.xhr.xhrGet(d).then(function(a){delete a.xhr;
a=cre$.internalutil.parseToJson(a.data);return a.containerToken?a.containerToken:a.errors?a.errors[0]:null},function(a){delete a.xhr;return null})};e.scheduleTokenRefresher=function(a,c,b,d){var e=1E3*cre$.config.MAX_TOKEN_TTL,g=this,f=function(){if(c&&cre$.util._tokenRefreshers[c])cre$.util._tokenRefreshers[c](b);else g.refreshToken(a,c).then(b);d(setTimeout(f,e))};d(setTimeout(f,e))};e.unscheduleTokenRefresher=function(a){clearTimeout(a)}})();cre$.LocaleHelper=cre$.LocaleHelper||{};
(function(){function f(b){__trace.enter("cre$.LocaleHelper","_isSupportedLocale",arguments);for(var a=!1,d=cre$.config.SUPPORTED_LOCALES.length,c=0;c<d;c++)if(b===cre$.config.SUPPORTED_LOCALES[c]){a=!0;break}__trace.exit("cre$.LocaleHelper","_isSupportedLocale",a);return a}var e=cre$.LocaleHelper;e.getLocale=function(){__trace.enter("cre$.LocaleHelper","getLocale",arguments);var b="en",a=null,a=cre$.config.locales&&cre$.util.isArray(cre$.config.locales)&&0<cre$.config.locales.length?cre$.config.locales:
[(navigator.userLanguage?navigator.userLanguage:navigator.language).toLowerCase()];if(null!==a&&cre$.util.isArray(a))for(var d=a.length,c=0;c<d;c++)if(f(a[c])){b=a[c];break}__trace.exit("cre$.LocaleHelper","getLocale",b);return b};e.getLocalizedMessages=function(){__trace.enter("cre$.LocaleHelper","getLocalizedMessages",arguments);var b=null,a=!0;cre$.messages||(a=cre$.iRuntime.loadFeatures(["cre.messages."+e.getLocale()],!0));cre$.promise.when(a).then(function(a){b=cre$.messages});__trace.exit("cre$.LocaleHelper",
"getLocalizedMessages",b);return b}})();cre$.ProxyService=function(){this._iu=cre$.ProxyInternalUtil};cre$.ProxyService.prototype.makeProxyUrl=function(a,b){return"undefined"===typeof a||null===a?null:this._iu.makeProxyUrl(a,b)};cre$.ProxyService.prototype.getProxyUrl=function(){return this._iu.getProxyUrl()};cre$.ProxyInternalUtil=cre$.ProxyInternalUtil||{};
(function(){function g(){return cre$.endpoint.resolveEndpoint(cre$.constants.endpoints.PROXY)||"//%host%"+cre$.config.CONTEXT_ROOT+"/common/proxy?refresh\x3d%refresh%\x26url\x3d%url%%rewriteMime%"}var e=cre$.ProxyInternalUtil;e.getProxyUrl=function(){return g().replace("%host%",document.location.host)};e.makeProxyUrl=function(a,e){var d=e||{},c=a,f=d.isXhr;"undefined"===typeof f&&(f=!0);var h=function(a,c){var b=a.refreshInterval;void 0===b&&(b="3600");var d=a.rewriteMime?"\x26rewriteMime\x3d"+encodeURIComponent(a.rewriteMime):
"",b=g().replace("%url%",encodeURIComponent(c)).replace("%host%",document.location.host).replace("%rawurl%",c).replace("%refresh%",encodeURIComponent(b)).replace("%container%",encodeURIComponent(a.container||a.synd||"default")).replace("%rewriteMime%",d);0===b.indexOf("//")&&(b=window.location.protocol+b);cre$.ResourceManager.getOrigin(b)===cre$.ResourceManager.getOrigin(c)&&(b=c);a.pst&&(b=b+"\x26pst\x3d"+a.pst);return b};-1===a.indexOf(":/")?0===a.indexOf("/")?c=window.location.protocol+"//"+window.location.host+
a:d.widgetBaseUri&&(a=d.widgetBaseUri+a,c=window.location.protocol+"//"+window.location.host,c=cre$.ResourceManager.getOrigin(a)!==cre$.ResourceManager.getOrigin(c)?h(d,a):a):f&&(c=h(d,a));return c}})();cre$.oah=cre$.oah||{};cre$.oah.ManagedHub=function(){this._inlineHubClients={};this.PREFIX_INLINE="_inline_";this.PREFIX_IFRAME="_iframe_";var a=function(a,b,c,d){c&&c.getClientID();d&&d.getClientID();return!0},b=function(a,b){b&&b.getClientID();return!0},c=function(a,b){};this.managedHubInstance||(this.managedHubInstance=new OpenAjax.hub.ManagedHub({onPublish:a,onSubscribe:b,onSecurityAlert:c}))};var _dummycallback=function(){};
cre$.oah.ManagedHub.prototype={createInlineHubContainer:function(a){return new OpenAjax.hub.InlineContainer(this.managedHubInstance,this.PREFIX_INLINE+a,{Container:{onConnect:function(a){},onDisconnect:function(a){},onSecurityAlert:function(a,c){},onError:function(a,c){}}})},createInlineHubClient:function(a){a=this.PREFIX_INLINE+a;var b=this.getContainer(a),b=new OpenAjax.hub.InlineHubClient({HubClient:{onSecurityAlert:function(a,b){}},InlineHubClient:{container:b}});b.connect(function(a,b,g){});
return this._inlineHubClients[a]=b},createIframeHubContainer:function(a,b,c,m,g,n){a=this.PREFIX_IFRAME+a;var d=cre$.config.CONTEXT_ROOT+"/container/rpc_relay.html",h=window.location.protocol,e=window.location.hostname,f=window.location.port,p=h+"//"+e+":"+f+d;""===f&&(p=h+"//"+e+d);d=function(a){};h=function(a){};e=function(a,b){};f=null;try{var k,l;l=k="100%";m&&(k=m);g&&(l=g);n&&(e=n);f=new OpenAjax.hub.IframeContainer(this.managedHubInstance,a,{Container:{onConnect:d,onDisconnect:h,onSecurityAlert:e},
IframeContainer:{uri:b,tunnelURI:p,parent:c,iframeAttrs:{title:"iframe",style:{width:k,height:l,border:"0px",overflow:"auto"}},onGadgetLoad:_dummycallback,timeout:12E5}})}catch(q){__logging.log("cre$.oah.ManagedHub","createIframeHubContainer",cre$.LocaleHelper.getLocalizedMessages().EXCEPTION_CREATE_IFR_CONTAINER,[q.message])}return f},_getInlineHubClient:function(a){if(!a)return null;a=this._inlineHubClients[this.PREFIX_INLINE+a];"undefined"===typeof a&&(a=null);return a},getInlineHubClient:function(a){return!a?
this.managedHubInstance:(a=this._getInlineHubClient(a))?a:this.managedHubInstance},removeInlineHubClient:function(a){var b=this._getInlineHubClient(a);a=this.PREFIX_INLINE+a;b&&(b.disconnect(function(a,b,g){}),delete this._inlineHubClients[a],(b=this.managedHubInstance.getContainer(a))&&this.managedHubInstance.removeContainer(b))},getContainer:function(a){return this.managedHubInstance.getContainer(a)},getManagedHubInstance:function(){return this.managedHubInstance}};cre$.oah.isManagedHub=!0;
cre$.oah.managedHub=new cre$.oah.ManagedHub;cre$.WidgetRef=function(a){this._iRuntime=cre$.iRuntime;this._stateConstants=cre$.constants.state;this.widgetObject=a;a.widgetRef=this;this.notificationHandlers=[]};cre$.WidgetRef.prototype.getEvents=function(a){var d=this;return getServiceManager().getService(this.widgetObject.componentType).then(function(b){return b.getEvents(d,a)})};cre$.WidgetRef.prototype.getWidgetId=function(){return cre$.iRuntime.getWidgetIdByDomId(this.widgetObject.domId)};
cre$.WidgetRef.prototype.changeMode=function(a){var d=this._iRuntime.getWidgetIdByDomId(this.widgetObject.domId),b=this.widgetObject.componentType;getServiceManager().getService(b).then(function(c){c.changeMode?c.changeMode(d,a):__logging.log("cre$.WidgetRef","changeMode",cre$.LocaleHelper.getLocalizedMessages().ERR_CANT_CHANGE_MODE,[b])})};cre$.WidgetRef.prototype.load=function(){return this._iRuntime.loadWidgets([this._getParam()])};cre$.WidgetRef.prototype.preload=function(){return this._iRuntime.preloadWidgets([this._getParam()])};
cre$.WidgetRef.prototype.unload=function(){var a=this._iRuntime.getWidgetIdByDomId(this.widgetObject.domId);return this._iRuntime.unLoadWidgets([a],!0)};cre$.WidgetRef.prototype.unpreload=function(){var a=this._iRuntime.getWidgetIdByDomId(this.widgetObject.domId);return this._iRuntime.unLoadWidgets([a])};
cre$.WidgetRef.prototype.clone=function(a,d,b){if(this._getState()===this._stateConstants.ERROR)throw Error("the widget state is error.");b=b||{};var c={};c.domId=d;c.definition=this.widgetObject.definition;c.componentType=this.widgetObject.componentType;c.instanceMetaData={};c.instanceMetaData.moduleId=a;this.widgetObject.componentType===cre$.constants.componentType.IWIDGET?(c.instanceMetaData.receivedEvents=b.wires||[],c.instanceMetaData.itemSet=b.itemSet||[],c.renderType=b.renderType):this.widgetObject.componentType===
cre$.constants.componentType.GADGET&&(c.renderParams=b.renderParams,c.renderType=b.renderType,c.viewParams=b.viewParams,c.callback=b.callback,c.eeDataModel=b.eeDataModel);c.state=cre$.constants.state.INITIAL;return new cre$.WidgetRef(c)};cre$.WidgetRef.prototype.getMetadata=function(){return this.widgetObject.widgetMetadata};cre$.WidgetRef.prototype.registerNotificationHandler=function(a){this.notificationHandlers.push(a)};
cre$.WidgetRef.prototype.getContainer=function(){if(this._getState()===this._stateConstants.LOADED){if(this.widgetObject.componentType===cre$.constants.componentType.IWIDGET){var a=this._iRuntime.getWidgetById(this.widgetObject.instanceMetaData.moduleId);return a&&a._iContext?cre$.promise.resolved(a._iContext):cre$.promise.rejected(null)}if(this.widgetObject.componentType===cre$.constants.componentType.GADGET)return this._iRuntime.getCommonContainer()}else return cre$.promise.rejected(null)};
cre$.WidgetRef.prototype.getScopingInstance=function(){if(this._getState()===this._stateConstants.LOADED&&this.widgetObject.componentType===cre$.constants.componentType.IWIDGET){var a=this._iRuntime.getWidgetById(this.widgetObject.instanceMetaData.moduleId);if(a&&a._iContext&&a._iContext._iScope)return a._iContext._iScope}return null};
cre$.WidgetRef.prototype.getError=function(){if(this._getState()===this._stateConstants.ERROR)return this.widgetObject.error;console.warn("widget's state is "+this.widgetObject.state+", can't get error info.");return null};cre$.WidgetRef.prototype._getState=function(){return this.widgetObject.state};cre$.WidgetRef.prototype._changeState=function(a){var d=this._getState();if(a!==d){for(var b=this.notificationHandlers.length;b--;)this.notificationHandlers[b](a,d);this.widgetObject.state=a}};
cre$.WidgetRef.prototype._getParam=function(){var a={};a.placement=this.widgetObject.domId;a.definitionUrl=this.widgetObject.definition;a.componentType=this.widgetObject.componentType;this._getState()!==cre$.constants.state.ERROR&&(a.moduleId=this.widgetObject.instanceMetaData.moduleId,this.widgetObject.componentType===cre$.constants.componentType.IWIDGET?a.instanceData={wires:this.widgetObject.instanceMetaData.receivedEvents,renderType:this.widgetObject.renderType,itemSet:this.widgetObject.instanceMetaData.itemSet}:
this.widgetObject.componentType===cre$.constants.componentType.GADGET&&(a.instanceData={renderParams:this.widgetObject.renderParams,renderType:this.widgetObject.renderType,viewParams:this.widgetObject.viewParams,callback:this.widgetObject.callback,eeDataModel:this.widgetObject.eeDataModel}));if(this._getState()===cre$.constants.state.ERROR||this._getState()===cre$.constants.state.INITIAL)a.widgetRef=this;return a};cre$.WidgetRef.prototype.isError=function(){return this._getState()===this._stateConstants.ERROR};
cre$.WidgetRef.prototype.isPreloaded=function(){return this._getState()===this._stateConstants.PRELOADED};cre$.WidgetRef.prototype.isLoaded=function(){return this._getState()===this._stateConstants.LOADED};cre$.WidgetRefArr=cre$.WidgetRefArr||{};cre$.WidgetRefArr.load=function(){for(var a=this.length,b=[];a--;)b.push(this[a]._getParam());return cre$.iRuntime.loadWidgets(b)};cre$.WidgetRefArr.preload=function(){for(var a=this.length,b=[];a--;)b.push(this[a]._getParam());return cre$.iRuntime.preloadWidgets(b)};cre$.WidgetRefArr.unload=function(){return cre$.iRuntime.unLoadWidgets(this._getUnloadIdArr(),!0)};cre$.WidgetRefArr.unpreload=function(){return cre$.iRuntime.unLoadWidgets(this._getUnloadIdArr())};
cre$.WidgetRefArr.registerNotificationHandler=function(a){for(var b=this.length;b--;)this[b].registerNotificationHandler(a)};cre$.WidgetRefArr.getWidgetRefByDomId=function(a){for(var b=this.length;b--;)if(this[b].widgetObject.domId===a)return this[b];return null};cre$.WidgetRefArr._getUnloadIdArr=function(){for(var a=[],b,c=this.length;c--;)b=this[c],a.push(cre$.iRuntime.getWidgetIdByDomId(b.widgetObject.domId));return a};
cre$.WidgetRefArr.getWidgetRefArr=function(){var a=[];a.push.apply(a,arguments);a.load=cre$.WidgetRefArr.load;a.preload=cre$.WidgetRefArr.preload;a.unload=cre$.WidgetRefArr.unload;a.unpreload=cre$.WidgetRefArr.unpreload;a.registerNotificationHandler=cre$.WidgetRefArr.registerNotificationHandler;a.getWidgetRefByDomId=cre$.WidgetRefArr.getWidgetRefByDomId;a._getUnloadIdArr=cre$.WidgetRefArr._getUnloadIdArr;return a};cre$.constants.iRuntime=cre$.constants.iRuntime||{};cre$.constants.iRuntime.resourceScope={SITE:"site",PAGE:"page"};cre$.constants.iRuntime.url={GADGETS_JS:"/gadgets/js"};cre$.constants.iRuntime.pageData={USERPROFILE:"userProfile",WIDGETMETADATA:"widgetMetadata",INSTANCEDATA:"instanceData",ITEMSET:"itemSet",DOMID_MAX:1000000001};cre$.constants.iRuntime.field={INSTANCEDATA:"instanceData",METADATA:"metadata"};
cre$.constants.mode={VIEW:iwConstants.mode.VIEW,EDIT:iwConstants.mode.EDIT,PERSONALIZE:iwConstants.mode.PERSONALIZE,CONFIG:iwConstants.mode.CONFIG,HELP:iwConstants.mode.HELP};cre$.constants.itemSet={USERPROFILE:"userProfile",IDESCRIPTOR:iwConstants.IDESCRIPTOR,ATTRIBUTES:iwConstants.ATTRIBUTES,ONITEMSETCHANGED:iwConstants.EVENTS.onItemSetChanged,ONPERSISTENCERESPONSE:"onPersistenceResponse"};cre$.internalutil=cre$.internalutil||{};
(function(){function u(b){__trace.enter("cre$.internalutil","_normalizeRenderType",arguments);var c=b.renderType,a=b.componentType,c=c?c:h.DEFAULT;if(a===t.IWIDGET)switch(c){case h.INLINE:case h.DEFAULT:b.renderType=h.INLINE;break;case h.SANDBOX:case h.IFRAME:b.renderType=h.SANDBOX;break;default:throw Error("[_normalizeRenderType]"+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_RENDER_TYPE+c);}else if(a===t.GADGET)switch(c){case h.INLINE:case h.SANDBOX:case h.IFRAME:case h.DEFAULT:b.renderType=h.DEFAULT;
break;default:throw Error("[_normalizeRenderType]"+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_RENDER_TYPE+c);}__trace.exit("cre$.internalutil","_normalizeRenderType","Enter: "+c+", Exit: "+b.renderType);return b}function v(b){__trace.enter("cre$.internalutil","_generateSiteResources",arguments);for(var c=0,a=b.length,d,f=[],c=0;c<a;c++)d=b[c],(d.scope===r.resourceScope.SITE||d.scope===r.resourceScope.PAGE)&&(-1===d.uri.indexOf(p.featureName.IRUNTIME)&&-1===d.uri.indexOf(r.url.GADGETS_JS))&&
f.push(d);__trace.exit("cre$.internalutil","_generateSiteResources",f);return f}var e=cre$.internalutil,l=cre$.util,p=cre$.constants,h=p.renderType,t=p.componentType,r=p.iRuntime,k=null,s=null;e.setCREContainerToken=function(b){__trace.enter("cre$.internalutil","setCREContainerToken",arguments);if(b){k=b;shindig.auth&&shindig.auth.updateSecurityToken(b.token);var c=function(a){s=a},a=function(a){k=a;shindig.auth&&shindig.auth.updateSecurityToken(b.token)};k&&(k.needsTokenRefresh?s?(e.clearContainerTokenRefresher(),
cre$.util.scheduleTokenRefresher(k.token,"container",a,c)):(cre$.util.scheduleTokenRefresher(k.token,"container",a,c),e.registerEventHandler(window,"unload",e.clearContainerTokenRefresher)):s&&e.clearContainerTokenRefresher())}__trace.exit("cre$.internalutil","setCREContainerToken")};e.clearContainerTokenRefresher=function(){__trace.enter("cre$.internalutil","clearContainerTokenRefresher",arguments);s&&cre$.util.unscheduleTokenRefresher(s)};e.getCREContainerToken=function(){return k};e.checkContainerToken=
function(b){var c=null;"undefined"!==typeof b&&b.containerToken&&e.setCREContainerToken(b.containerToken);c=null===k?(b=l.getTokenRefresher("container"))?b(function(a){e.setCREContainerToken(a)}):cre$.util.refreshToken("","container").then(function(a){e.setCREContainerToken(a)}):cre$.promise.resolved("container token already exist");__trace.exit("cre$.internalutil",null,c);return c};e.registerEventHandler=function(b,c,a){__trace.enter("cre$.internalutil","registerEventHandler",arguments);void 0!==
b.addEventListener?b.addEventListener(c,a,!1):b.attachEvent&&b.attachEvent("on"+c,a);__trace.exit("cre$.internalutil","registerEventHandler")};e.checkWire=function(b){__trace.enter("cre$.internalutil","checkWire",arguments);for(var c=!1,a=0;a<b.length;a++){if(b[a].instanceMetaData&&b[a].instanceMetaData.receivedEvents&&0<b[a].instanceMetaData.receivedEvents.length){c=!0;break}if(b[a].widgetMetadata&&b[a].widgetMetadata.event&&0<b[a].widgetMetadata.event.length){c=!0;break}}__trace.exit("cre$.internalutil",
"checkWire",c);return c};e.createWiresForWidgetRef=function(b){__trace.enter("cre$.internalutil","createWiresForWidgetRef",arguments);for(var c=cre$.iRuntime.getWires(),a=b?b.widgetObject:{},a=a.loadInstanceData?a.loadInstanceData:a.instanceMetadata?a.instanceMetadata:{},a=a.wires?a.wires:a.receivedEvents?a.receivedEvents:[],d=a.length;d--;){var f=a[d];c.createWire(f.sourceWidget,f.sourceEvent,f.targetWidget,f.targetEvent)}return a};e.combineInstanceData=function(b,c){if(c&&c.instanceData){var a=
c.instanceData,d=b.instanceMetaData;a.itemSet&&(this.createNewObjIfNotExisting(d.itemSet,!0),d.itemSet=d.itemSet.concat(a.itemSet));a.wires&&0<a.wires.length&&(this.createNewObjIfNotExisting(d.receivedEvents,!0),d.receivedEvents=d.receivedEvents.concat(a.wires));a.renderType&&(b.renderType=a.renderType);a.eeDataModel&&(b.eeDataModel=a.eeDataModel);a.viewParams&&(b.viewParams=a.viewParams);a.renderParams&&(b.renderParams=a.renderParams);a.callback&&(b.callback=a.callback)}};e.createNewObjIfNotExisting=
function(b,c){};e.composeWidgetObject=function(b,c){__trace.enter("cre$.internalutil","_composeWidgetObject",arguments);var a=b[r.pageData.WIDGETMETADATA],d=b[r.pageData.INSTANCEDATA],f={widgets:{},errorArr:[]};if(a&&d){for(var e=a.length,m={},g,k=null;e--;)(g=a[e].definitionUrl)&&(m[g]=a[e]);for(e=d.length;e--;){a=d[e];g=a.definition;if(c)for(var n in c)if(Object.prototype.hasOwnProperty.call(c,n)){var l=c[n],q=l.definitionUrl;0==q.indexOf("/")&&(q=q.substring(1,q.length));if(a.domId===l.placement&&
(g===l.definitionUrl||g.substring(g.length-q.length)===q))l.definitionUrl=g,this.combineInstanceData(a,l)}g&&m[g]&&m[g].error?f.errorArr.push({domId:a.domId,error:m[g].error,state:p.state.ERROR}):(g?(a.widgetMetadata=cre$.iRuntime.getMetadata()[g].metadata,a.componentType=a.widgetMetadata.componentType):a.componentType=t.GADGET,u(a),a.componentType===t.IWIDGET&&a.renderType===h.SANDBOX&&(null===k&&(k=v(b.resourceList)),0<k.length&&(a.siteResources=k),a.userProfile=b.userProfile||cre$.iRuntime.getStateSet(null,
p.itemSet.USERPROFILE).userProfile),f.widgets[a.componentType]||(f.widgets[a.componentType]=[]),f.widgets[a.componentType].push(a));g&&m[g]&&delete m[g]}for(n in m)Object.prototype.hasOwnProperty.call(m,n)&&(d=m[n].componentType,f.widgets[d]||(f.widgets[d]=[]),f.widgets[d].push({widgetMetadata:m[n],componentType:d,definition:m[n].definitionUrl}))}__trace.exit("cre$.internalutil","_composeWidgetObject",f);return f};e.createUPStateSet=function(b){__trace.enter("cre$.internalutil","createUPStateSet",
arguments);var c={id:b.id,widgetIds:["*"],userProfile:b};b.onItemSetChanged&&(c.onStateSetChanged=b.onItemSetChanged);c.items={};if(b.item)for(var a=b.item.length;a--;){var d=new cre$.StateItem(b.item[a]);c.items[d.id]=d}__trace.exit("cre$.internalutil","createUPStateSet",c);return new cre$.StateSet(c)};e.contains=function(b,c){__trace.enter("cre$.internalutil","contains",arguments);for(var a=!1,d=0;d<b.length;d++)if(c===b[d]){a=!0;break}__trace.exit("cre$.internalutil","contains",a);return a};e.encodePath=
function(b,c){__trace.enter("cre$.internalutil","encodePath",arguments);if(0===b.length)return b;for(var a=b.split("/"),d=0;d<a.length;++d)a[d]=c?unescape(a[d]):escape(unescape(a[d]));a=a.join("/");__trace.exit("cre$.internalutil","encodePath",a);return a};e.destroyNode=function(b){__trace.enter("cre$.internalutil","destroyNode",arguments);var c=document.getElementById("IELeakGarbageBin");c||(c=document.createElement("DIV"),c.setAttribute("id","IELeakGarbageBin"),c.style.display="none",document.body.appendChild(c));
c.appendChild(b);c.innerHTML="";3!==b.nodeType&&(l.isIE&&10>Math.floor(l.isIE))&&(b.outerHTML="");__trace.exit("cre$.internalutil","destroyNode")};e.convertDomToString=function(b,c){__trace.enter("cre$.internalutil","convertDomToString",arguments);if(!b)return"";var a=null,d=document.createElement("div");d.appendChild(b);a=l.isIE&&10>Math.floor(l.isIE)?d.innerHTML.replace(/=([^\s\">\/]+)(\s|>|\/)/gi,'\x3d"$1"$2').replace(/(<\s*\w+)|(<\/\s*\w+)/gi,function(a){return a.toLowerCase()}):d.innerHTML;c&&
this.destroyNode(d);__trace.exit("cre$.internalutil","convertDomToString",a);return a};e.getElementsByClass=function(b,c){__trace.enter("cre$.internalutil","getElementsByClass",arguments);var a=[];if(b.getElementsByClassName)for(var d=b.getElementsByClassName(c),e=0;e<d.length;e++)a[e]=d[e];else for(var d=b.getElementsByTagName("*"),h=0,k=RegExp("(\\S+\\s+|^\\s*)"+c+"(\\s+\\S+|\\s*$)"),g=d.length,e=0;e<g;e++){var l=d[e];k.test(l.className)&&(a[h++]=l)}__trace.exit("cre$.internalutil","getElementsByClass",
a);return a}})();cre$.internalutil=cre$.internalutil||{};(function(){cre$.internalutil.parseToJson=function(a){return/^[\],:{}\s]*$/.test(a.replace(/\\['"\\\/b-ux]/g,"@").replace(/"[^"\\\n\r]*"|'[^'\\\n\r]*'|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?eval("("+a+")"):!1}})();"undefined"===typeof cre$.iRuntime&&(cre$.iRuntime=function(){function Q(a){__trace.enter("cre$.iRuntime","_updateUserProfile",arguments);for(var b=h.length;b--;)if(h[b].id===n.itemSet.USERPROFILE){h.splice(b,1);break}h.push(a);__trace.exit("cre$.iRuntime","_updateUserProfile")}function W(){__trace.enter("cre$.iRuntime","_isUserProfileAdded",arguments);for(var a=!1,b=0;b<h.length;b++)if(h[b].id===n.itemSet.USERPROFILE){a=!0;break}__trace.exit("cre$.iRuntime","_isUserProfileAdded",a);return a}function X(a){__trace.enter("cre$.iRuntime",
"_getDomId",arguments);var b=null;1===a.nodeType?b=a.id:"string"===typeof a&&(b=a);__trace.exit("cre$.iRuntime","_getDomId",b);return b}function Y(a,b){__trace.enter("cre$.iRuntime","_combinePreloadGadgetsResult",arguments);var d=a.length;return 0===d?b:b.then(function(b){for(var e=new cre$.promise.Promise("combinePreloadGadgetsResult"),f;d--;){var c=a[d];(f=c.definition)?B[f]?B[f].error?(c.error=B[f].error,c.state=cre$.constants.state.ERROR,b.errorArr.push(c)):c.domId&&(c.response=B[f],b.widgetArr.push(c)):
(c.error={message:"No response from preloadGadgets"},c.state=cre$.constants.state.ERROR,b.errorArr.push(c)):b.widgetArr.push(c)}0<b.errorArr.length?e.reject(b):e.resolve(b);return e})}function R(a,b,d,g){__trace.enter("cre$.iRuntime","_processPreloadResponse",arguments);var e=a[n.iRuntime.pageData.WIDGETMETADATA],f=null;if(e&&0<e.length)for(var c=e.length,D;c--;)(D=e[c].definitionUrl)&&!e[c].error&&(E[D]={metadata:e[c],instanceNum:0});var h=new cre$.promise.Promise("_processPreloadResponse"),c=q.composeWidgetObject(a,
g),x=c.errorArr,F=c.widgets,k=function(a){for(var b=a.length,d=[],e=[],c=null,f;b--;)d=d.concat(a[b].widgetArr),e=e.concat(a[b].errorArr);e=e.concat(x);for(b=d.length;b--;)a=d[b],(f=a.definition)&&E[f].instanceNum++,a.state=C.INITIAL,a.domnode=S[a.domId],y[a.domId]=a;!H&&q.checkWire(d)&&(c=cre$.iRuntime.loadFeatures([cre$.constants.featureName.WIRE]).then(function(){Z()}));cre$.promise.when(c).then(function(){0<e.length?h.reject(d.concat(e)):h.resolve(d)})},s=function(a,b,e){var c=[];N.call(a,n.itemSet.USERPROFILE)&&
Q(q.createUPStateSet(a[n.itemSet.USERPROFILE]));for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&c.push(l.getService(f).then(u.partial(function(a,e){if(a===G.GADGET){for(var c=b[a],f=c.length,g=[],m=[];f--;)B[c[f].definition]?m.push(c[f]):g.push(c[f]);return Y(m,e.preload(g,d))}return e.preload(b[a],d)},f)));cre$.promise.whenAll.apply(cre$.promise,c).then(e,e)},L=function(a){__trace.enter("cre$.iRuntime","_updateResStateForWidget",arguments);var b=cre$.iRuntime._jsFailedToLoad;if("undefined"!==
typeof b&&0<b.length){var e=b.length;a||(a=[]);for(var c=0;c<e;c++)a.push({url:b[c],type:v.constants.resourceType.JAVASCRIPT})}if(a&&0<a.length)for(b=a.length;b--;)if(e=a[b],e.error)for(var c=F.iWidget,d=c.length;d--;)for(var f=c[d],g=f.widgetMetadata.resource,g=g?g:[],m=g.length;m--;)e.url===g[m].fullUri&&(f.failedResources=f.failedResources?f.failedResources:[],f.failedResources.push(e));__trace.exit("cre$.iRuntime","_updateResStateForWidget")},c=function(a){__trace.enter("cre$.iRuntime","_matchWidgetResource",
arguments);var b=null,c=!1;if(e)for(var d=e.length;d--&&!c;){var f=e[d],g=f.resource;if(g)for(var m=g.length;m--;)if(g[m].fullUri==a){b=f;c=!0;break}}__trace.exit("cre$.iRuntime","_matchWidgetResource");return b};D=[];f=[];if(b)for(var m=a.resourceList,t=m.length,r,I;t--;){r=m[t].skipLoad;I=!1;if(r)try{I=window.eval(r)}catch(w){__trace.msg("cre$.iRuntime","_processPreloadResponse","Eval exception ${0}",[w]),I=!1}m[t].type!==n.resource.resourceType.IMAGE&&(-1!==m[t].uri.lastIndexOf("\x26")?m[t].uri+=
"\x26isClientInjection\x3dtrue":m[t].uri+="?isClientInjection\x3dtrue");if(!I){var p=m[t];r=p.resourceUris;r||(r=p.uri);if(r&&0<r.length){r=r[0];var z=c(r);if(z){I=z.componentType;var A=new cre$.promise.Promise("augmentedResourcePromise: "+r);D.push(A);l.getService(I).then(function(a){a.augmentResource(p,z,A)})}f.push(p)}}}cre$.promise.whenAll.apply(cre$.promise,D).then(function(b){(f&&0<f.length?v.loadResources(f,""):cre$.promise.resolved(null)).then(function(b){L(b);s(a,F,k)},function(b){L(b);s(a,
F,k)})},function(a){for(var b=F.iWidget,c=[],e=[],d=b.length,f=a.length;d--;){for(var g=[];f--;)a[f]&&a[f].definitionUrl===b[d].definition&&g.push({definitionUrl:a[f].definitionUrl,message:a[f].message});0<g.length?(b[d].error=g,e.push(b[d])):c.push(b[d])}k([{errorArr:e,widgetArr:c}])});__trace.exit("cre$.iRuntime","_processPreloadResponse",h);return h}function $(a){__trace.enter("cre$.iRuntime","_getRequestObject",arguments);var b={},d;for(d in a)N.call(a,d)&&(b[d]=a[d]);a.placement.id?b.placement=
a.placement.id:(d="_widget_"+Math.floor(Math.random()*T.DOMID_MAX),a.placement.id=d,b.placement=d);S[a.placement.id]=a.placement;__trace.exit("cre$.iRuntime","_getRequestObject",b);return b}function aa(a){__trace.enter("cre$.iRuntime","_buildPWRequest",arguments);var b={},d=cre$.config.getCREServerUrl()+cre$.config.PROCESSWIDGETS_URL,g={},e=[],f,c=a.length,D;g.loadedFeatures=v.getLoadedFeatures();for(g.combineResources=cre$.config.COMBINE_RESOURCES;c--;)f={fields:{}},"string"===typeof a[c]?(f.format=
"dom",f.widget=a[c],f.fields[J.INSTANCEDATA]=!0,f.fields[J.METADATA]=!0):1===a[c].nodeType?(D=q.getElementsByClass(a[c],n.others.IW_DEFINITION)[0].href,f.format="dom",f.widget=q.convertDomToString(a[c]),f.fields[J.INSTANCEDATA]=!0,E[D]||(f.fields[J.METADATA]=!0)):(f.format="json",f.widget=cre$.util.clone(a[c]),delete f.widget.instanceData,a[c].placement&&(f.fields[J.INSTANCEDATA]=!0),E[a[c].definitionUrl]||(f.fields[J.METADATA]=!0)),e.push(f);g.widgets=e;g.requireUserProfile=!W();b[w.PARAM_DATA]=
u.serializeJson(g);b[w.URL]=u.applyTokenToUrl(v.makeProxyUrl(d),q.getCREContainerToken());d={};q.getCREContainerToken()&&(d[w.HEADER_SHINDIG_ST]=q.getCREContainerToken().token);d[w.HEADER_CRE_PERSISTENCE_URL]=cre$.endpoint.resolveEndpoint(cre$.constants.persistence.PERSISTENCE_URL);d[w.CONTAINER]=cre$.config.CONTAINER;b[w.HEADERS]=d;b[w.CONTENT_TYPE]=w.contentType.JSON;b[w.RESPONSE_TYPE]=n.response.type.JSON;__trace.exit("cre$.iRuntime","_buildPWRequest");return b}function ba(a,b,d){__trace.enter("cre$.iRuntime",
"_publishEvent",arguments);l.serviceLoaded(cre$.services.EVENTSERVICE)&&l.getService(cre$.services.EVENTSERVICE).then(function(g){g.publishEvent(a,b,d)});__trace.exit("cre$.iRuntime","_publishEvent")}function ca(a){__trace.enter("cre$.iRuntime","_renderWidget",arguments);var b=a.widgetObject,d=new cre$.promise.Promise("_renderWidget: "+b.definition);cre$.WidgetParser.parse(b,h);d=l.getService(b.componentType).then(function(b){return b.render(a).then(function(a){a._changeState(C.LOADED);q.createWiresForWidgetRef(a);
return a},function(a){delete y[a.widgetObject.domId];a._changeState(C.ERROR);return a})});__trace.exit("cre$.iRuntime","_renderWidget",d);return d}function Z(){__trace.enter("cre$.iRuntime","_initWire",arguments);H||(H=new cre$.Wire(cre$.oah.isManagedHub,cre$.oah.managedHub));H.init(y);if(0<p.length)for(var a=p.length,b=0;b<a;b++)p[b].object[p[b].callback].call(p[b].object);__trace.exit("cre$.iRuntime","_initWire")}function da(a,b){__trace.enter("cre$.iRuntime","_preloadWidgets",arguments);var d=
new cre$.promise.Promise("_preloadWidgets"),g=K;K=d;var e=function(){P(a,b).then(function(a){d.resolve(a)},function(a){d.reject(a)})};g.then(e,e);__trace.exit("cre$.iRuntime","_preloadWidgets",d);return d}function U(a){__trace.enter("cre$.iRuntime","_loadWidgets",arguments);var b=new cre$.promise.Promise("_loadWidgets"),d=u.isArray(a)&&0<a.length&&1===a[0].nodeType,g=K;K=b;u.isObject(a)&&a[n.itemSet.USERPROFILE]&&Q(q.createUPStateSet(a[n.itemSet.USERPROFILE]));var e=function(){if(u.isArray(a)&&0<
a.length){for(var d=a.length;d--;)z.push(a[d]);P(a,!1).then(c,c)}else if(u.isObject(a)&&a.instanceData&&a.instanceData.length&&0<a.instanceData.length){for(var d=a.instanceData,e=d.length;e--;){var f=d[e];f.placement=f.domId;z.push(f)}P(a,!1).then(c,c)}else b.resolve([])},f=function(a){for(var b=cre$.WidgetRefArr.getWidgetRefArr(),d=a.length;d--;)b.push(a[d]);return b},c=function(a){for(var c=[],e,g=[],k,h=a.length,L=function(){__trace.enter("cre$.iRuntime","_renderWidgets",arguments);if(d||!k.parentId)e=
ca(a[h]).then(function(a){a=a.widgetObject.instanceMetaData.moduleId;ba(n.event.topic.WIDGET_LOADED+a,a)}),c.push(e);__trace.exit("cre$.iRuntime","_renderWidgets")};h--;){k=a[h].widgetObject;var m,t,r=!1;for(t=z.length;0<t;){m=z.shift();if(k.domId==m.placement){if(m.isAbandon){m.toPreloadState||a[h]._changeState(C.INITIAL);r=!0;break}}else z.push(m);t--}if(!r)if(k.failedResources&&0<k.failedResources.length){t=m="";for(r=0;r<k.failedResources.length;r++)__logging.log("cre$.iRuntime","renderWidgets",
"fail to load "+k.failedResources[r].url+" for widget "+k.definition+".","",__logging.logLevel.WARNING),m+=k.failedResources[r].type+"|",t+=k.failedResources[r].url+" \n ";-1!==m.indexOf(cre$.constants.resource.resourceType.JAVASCRIPT)?(a[h].widgetObject.state=C.ERROR,a[h].widgetObject.error={message:"can not load resources : "+t+" for widget "+k.definition},g.push(a[h])):L()}else L()}cre$.promise.whenAll.apply(cre$.promise,c).then(function(a){0<g.length?b.reject(f(g)):b.resolve(f(a))},function(a){b.reject(f(a.concat(g)))})};
g.then(e,e);__trace.exit("cre$.iRuntime","_loadWidgets",b);return b}function P(a,b){__trace.enter("cre$.iRuntime","_preload",arguments);var d=new cre$.promise.Promise("_preload"),g=[],e=[],f={},c,h,l=[],x={},F=function(a){for(var b=cre$.WidgetRefArr.getWidgetRefArr(),d=a.length,c;d--;)(c=f[a[d].domId])?(c.widgetObject=a[d],a[d].widgetRef=c):c=new cre$.WidgetRef(a[d]),c._getState()===C.INITIAL?c._changeState(C.PRELOADED):c._getState()===C.ERROR&&delete c.widgetObject.widgetRef,b.push(c);for(d=g.length;d--;)b.push(g[d]);
return b},k=function(a){var b=a.placement||a.id;b?y[b]?(a.instanceData?y[b].loadInstanceData=a.instanceData:delete y[b].loadInstanceData,g.push(y[b].widgetRef)):(x[a.definitionUrl+a.placement]=a,e.push(a)):E[a.definitionUrl]||e.push(a)};if(u.isArray(a)){for(c=a.length;c--;)if(1===a[c].nodeType){h=q.getElementsByClass(a[c],n.others.IW_IWIDGET);for(var s=h.length;s--;)k(h[s])}else"string"===typeof a[c]?e.push(a[c]):(a[c].widgetRef&&(f[a[c].widgetRef.widgetObject.domId]=a[c].widgetRef,delete a[c].widgetRef),
a[c].componentType===G.GADGET&&("undefined"!==typeof a[c].instanceData&&"function"===typeof a[c].instanceData.callback)&&(h=X(a[c].placement),null!==h&&(V[h]=a[c].instanceData.callback)),h=a[c].placement&&1===a[c].placement.nodeType?$(a[c]):a[c],k(h));0<e.length&&(l=cre$.xhr.xhrPost(aa(e)).then(function(a){delete a.xhr;return R(a.data,!0,b,x)},function(a){delete a.xhr;for(var b=e.length,d=[];b--;)d.push({domId:e[b].placement||e[b].id,error:{message:"send xhr error.",code:a.data},state:C.ERROR});return d}))}else l=
R(a,a.loadResource,b);cre$.promise.when(l).then(function(a){d.resolve(F(a))},function(a){d.reject(F(a))});__trace.exit("cre$.iRuntime","_preload",d);return d}var E={},y={},B={},A={},h=[],S={},H=null,p=[],M=null,V={},O,K=cre$.promise.resolved(),u=cre$.util,N=Object.prototype.hasOwnProperty,q=cre$.internalutil,v=cre$.ResourceManager,l=getServiceManager(),n=cre$.constants,G=n.componentType,T=n.iRuntime.pageData,J=n.iRuntime.field,w=n.request,C=n.state,z=[];q.registerEventHandler(window,"beforeunload",
function(a){__trace.enter("cre$.iRuntime","_handleBeforeUnload",arguments);for(var b in A)if(N.call(A,b)){var d=A[b]._iContext;if(d&&d._widgetObject.state===cre$.constants.state.LOADED&&d.canNavigateAway&&!d.canNavigateAway())return a.returnValue=cre$.LocaleHelper.getLocalizedMessages().LOG_NAVAIGATE_AWAY,""}__trace.exit("cre$.iRuntime","_handleBeforeUnload")});O={inIFrame:!1,init:function(a,b){__trace.enter("cre$.iRuntime","init",arguments);if(!u.isObject(a))throw Error("[init]"+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_PARAM_OBJ);
a.loadResource=b;a.containerToken&&q.setCREContainerToken(a.containerToken);var d=U(a);__trace.exit("cre$.iRuntime","init",d);return d},loadWidgets:function(a){__trace.enter("cre$.iRuntime","loadWidgets",arguments);if(!u.isArray(a))throw Error("[loadWidgets]"+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_PARAM_OBJ);var b=q.checkContainerToken(a).then(function(){return U(a)});__trace.exit("cre$.iRuntime","loadWidgets",b);return b},preloadWidgets:function(a){__trace.enter("cre$.iRuntime","preloadWidgets",
arguments);if((!u.isObject(a)||!N.call(a,T.WIDGETMETADATA))&&!u.isArray(a))throw Error("[preloadWidgets]"+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_PARAM_OBJ);var b;0<a.length||a.widgetMetadata?b=q.checkContainerToken(a).then(function(){return da(a,!0)}):(b=new cre$.promise.Promise("preloadWidgets"),b.resolve(a));__trace.exit("cre$.iRuntime","preloadWidgets",b);return b},commonContainerPreloadCallback:function(a){for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&(B[b]={},a[b].error?
(B[b].error=a[b].error,B[b].state=cre$.constants.state.ERROR):B[b]=a[b])},getCREServerUrl:cre$.config.getCREServerUrl,getStateSet:function(a,b,d){__trace.enter("cre$.iRuntime","getStateSet",arguments);for(var g=!1,e={},f=h.length;f--;){var c=h[f];if(b===c.id){var l=c.widgetIds;if("*"===l[0]){g=!0;e=c;break}else for(var p=l.length;p--;)if(a===l[p]){g=!0;e=c;break}}}!g&&b===n.itemSet.USERPROFILE&&(f=v.makeProxyUrl(cre$.config.USERPROFILE_URL),c={},c[w.URL]=u.applyTokenToUrl(f,q.getCREContainerToken()),
c[w.HEADERS]=q.getCREContainerToken()?{"X-Shindig-ST":q.getCREContainerToken().token}:{},cre$.xhr.xhrGet(c).then(function(a){delete a.xhr;a=q.parseToJson(a.data);h.push(q.createUPStateSet(a.userProfile))},function(a){delete a.xhr;throw Error("[getStateSet]"+cre$.LocaleHelper.getLocalizedMessages().ERR_CANT_SET_USERPROFILE+"xhr.status: "+a.data);}));!g&&d&&(b==n.itemSet.ATTRIBUTES?(e=n.mode,e=new cre$.StateSetHierarchy(b,[e.CONFIG,e.EDIT,e.PERSONALIZE],{}),e.widgetIds=[a]):(e={id:b,widgetIds:[a],items:{}},
e=u.mixin(e,d),e=new cre$.StateSet(e)),h.push(e));f=h.length;g=[];for(c={};f--;)if(e.definitionUrl&&h[f].definitionUrl===e.definitionUrl)if(h[f].sets.config._dirty){l=h[f].sets.config.items;c.config={};for(var x in l)l.hasOwnProperty(x)&&(c.config[x]=l[x].value);c.config.stateSet=h[f].sets.config}else g.push(f);for(f=g.length;f--;)if(c.config){for(x in c.config)c.config.hasOwnProperty(x)&&(h[g[f]].setItemValue(x,c.config[x]),e.setItemValue(x,c.config[x]));e.sets.config=h[g[f]].sets.config=c.config.stateSet}return e},
getShareableStateSet:function(a,b){__trace.enter("cre$.iRuntime","getShareableStateSet",arguments);for(var d=null,g=h.length;g--;){var e=h[g];if(!0===e.shareable&&!0!==e.global&&(b===e.id||b===e.alias)){var f=e.widgetIds;if("*"===f[0]){d=e;break}else for(var c=f.length;c--;)if(a===f[c]){d=e;break}}}__trace.exit("cre$.iRuntime","getShareableStateSet",d);return d},getGlobalShareableStateSet:function(a){__trace.enter("cre$.iRuntime","getGlobalShareableStateSet",arguments);for(var b=!1,d=null,g=h.length;g--;){var e=
h[g];if(!0===e.shareable&&!0===e.global&&(a===e.id||a===e.alias)){b=!0;d=e;break}}b||(d=new cre$.StateSet({id:a,shareable:!0,global:!0,items:{}}),h.push(d));__trace.exit("cre$.iRuntime","getGlobalShareableStateSet",d);return d},loadFeatures:function(a,b,d,g){__trace.enter("cre$.iRuntime","loadFeatures",arguments);var e=cre$.config.APP_VERSION;e&&(g||(g={}),g.ver=e);__trace.exit("cre$.iRuntime","loadFeatures",g);return v.loadFeatures(a,b,d,g)},isFeatureLoaded:v.isFeatureLoaded,getLoadedFeatures:v.getLoadedFeatures,
makeProxyUrl:v.makeProxyUrl,getProxyUrl:function(){var a=null,b,a=cre$.services.ServiceManager?getServiceManager().getService(cre$.services.PROXYSERVICE,!0):cre$.promise.rejected("Service Manager is not loaded.");a.then(function(a){b=a.getProxyUrl()},function(a){b=null});return b},unLoadWidgets:function(a,b){__trace.enter("cre$.iRuntime","unLoadWidgets",arguments);if(a&&!u.isArray(a))throw Error("[unLoadWidgets]"+cre$.LocaleHelper.getLocalizedMessages().ERR_INVALID_PARAM_TYPE);b="undefined"===typeof b?
!0:b;var d=new cre$.promise.Promise("unLoadWidgets"),g=[],e=[],f,c,h=K;K=d;var n=function(){for(var a=g.length,f;a--;)c=O.getWidgetIdByDomId(g[a].domId),f=l.getService(g[a].componentType).then(u.partial(function(a,b){return b.canUnload(a)},c)),e.push(f);cre$.promise.whenAll.apply(cre$.promise,e).then(function(){p(g,b)},function(){confirm(cre$.LocaleHelper.getLocalizedMessages().WARN_DATA_NOT_SAVED)?p(g,b):d.reject([])})},p=function(a,b){for(var c=a.length,e=[],f;c--;)f=l.getService(a[c].componentType).then(cre$.util.partial(function(c,
d){return d.unload(cre$.iRuntime.getWidgetIdByDomId(a[c].domId),b)},c)),e.push(f);cre$.promise.whenAll.apply(cre$.promise,e).then(function(a){d.resolve(v(a))},function(a){d.reject(v(a))})},v=function(a){for(var b=cre$.WidgetRefArr.getWidgetRefArr(),c=a.length,d;c--;)for(d=a[c].length;d--;)b.push(a[c][d]);return b};for(f in y)Object.prototype.hasOwnProperty.call(y,f)&&(c=this.getWidgetIdByDomId(f),(!a||q.contains(a,c))&&g.push(y[f]));if(a){var k,s,w=!1;for(f=a.length-1;0<=f;){unLoadId=a[f];for(k=g.length-
1;0<=k;){s=g[k];s=this.getWidgetIdByDomId(s.domId);if(unLoadId==s){w=!0;break}k--}if(!w)for(s=z.length-1;0<=s;)k=z[s],k.moduleId&&unLoadId==k.moduleId&&(k.isAbandon=!0,k.toPreloadState=b),s--;f--}}else for(s=z.length-1;0<=s;)k=z[s],k.isAbandon=!0,k.toPreloadState=b,s--;h.then(n,n);__trace.exit("cre$.iRuntime","unLoadWidgets",d);return d},registerWireLoadedCallbacks:function(a){__trace.enter("cre$.iRuntime","registerWireLoadedCallbacks",arguments);for(var b=0,d=p.length;b<d;b++)if(p[b].id===a.id)return __trace.exit("cre$.iRuntime",
"registerWireLoadedCallbacks",!1),!1;p.push(a);__trace.exit("cre$.iRuntime","registerWireLoadedCallbacks",!0);return!0},removeWireLoadedCallbackById:function(a){__trace.enter("cre$.iRuntime","removeWireLoadedCallbackById",arguments);for(var b=p.length;b--;)if(p[b].id===a)return p.splice(b,1),__trace.exit("cre$.iRuntime","removeWireLoadedCallbackById",!0),!0;__trace.exit("cre$.iRuntime","removeWireLoadedCallbackById",!1);return!1},getWidgetIdByDomId:function(a){__trace.enter("cre$.iRuntime","getWidgetIdByDomId",
arguments);if(y[a]){var b=y[a];if(b.componentType&&G.IWIDGET===b.componentType)return __trace.exit("cre$.iRuntime","getWidgetIdByDomId",b.instanceMetaData.moduleId),b.instanceMetaData.moduleId;if(b.componentType&&G.GADGET===b.componentType)if(this.getCommonContainer()){var d=null;if(0===b.domId.indexOf(n.others.GADGET_SITE))d=document.getElementById(b.domId);else if((b=document.getElementById(b.domId))&&1===b.nodeType)(b=b.childNodes[0])&&(b.id&&0===b.id.indexOf(n.others.GADGET_SITE))&&(d=b);var g;
this.getCommonContainer().then(function(a){g=a.sites_});for(var e in g)if(g[e].el_===d)return __trace.exit("cre$.iRuntime","getWidgetIdByDomId",e),e}else __logging.log("cre$.iRuntime","getWidgetIdByDomId",cre$.LocaleHelper.getLocalizedMessages().ERR_CC_NOT_LOADED)}else __logging.log("cre$.iRuntime","getWidgetIdByDomId",cre$.LocaleHelper.getLocalizedMessages().ERR_WIDGET_NOT_EXIST);__trace.exit("cre$.iRuntime","getWidgetIdByDomId")},getWidgetMetadata:function(a){__trace.enter("cre$.iRuntime","getWidgetMetadata",
arguments);var b=E[a];return retPromise=b?b.metadata.content?cre$.promise.resolved(b.metadata):l.getService(b.metadata.componentType).then(function(b){return b.getMetadata(a)}):cre$.promise.rejected("Can not get metadata of a widget that is not preloaded.")},getWidgetById:function(a){__trace.enter("cre$.iRuntime","getWidgetById",arguments);var b=A[a]?A[a]:null;__trace.exit("cre$.iRuntime","getWidgetById",b);return b},initResourceRegistry:function(){},loadResources:v.loadResources,registerResource:v.registerResource,
isResourceRegistered:v.isResourceRegistered,isResourceDownloaded:v.isResourceDownloaded,registerEndpoints:cre$.endpoint.registerEndpoints,removeEndpoint:cre$.endpoint.removeEndpoint,resolveEndpoint:cre$.endpoint.resolveEndpoint,config:cre$.config,getWires:function(){__trace.enter("cre$.iRuntime","getWires",arguments);__trace.exit("cre$.iRuntime","getWires",H);return H},_getGadgetLoadedCallbacks:function(){return V},getOAH:function(){__trace.enter("cre$.iRuntime","getOAH",arguments);__trace.exit("cre$.iRuntime",
"getOAH",cre$.oah);return cre$.oah},getCommonContainer:function(){__trace.enter("cre$.iRuntime","getCommonContainer",arguments);if(null===M)if(cre$.commoncontainer)M=cre$.commoncontainer.getCommonContainer();else return __logging.log("cre$.iRuntime","getCommonContainer",cre$.LocaleHelper.getLocalizedMessages().ERR_CC_NOT_LOADED),cre$.promise.rejected(cre$.LocaleHelper.getLocalizedMessages().ERR_CC_NOT_LOADED);__trace.exit("cre$.iRuntime","getCommonContainer",M);return M},setCommonContainer:function(a,
b){__trace.enter("cre$.iRuntime","setCommonContainer",arguments);M=l.getService(G.GADGET).then(function(d){return d.configCommonContainer(a,b)});__trace.exit("cre$.iRuntime","setCommonContainer")},getWidgetObjects:function(){__trace.enter("cre$.iRuntime","getWidgetObjects",arguments);__trace.exit("cre$.iRuntime","getWidgetObjects",y);return y},getWidgets:function(){__trace.enter("cre$.iRuntime","getWidgets",arguments);__trace.exit("cre$.iRuntime","getWidgets",A);return A},getMetadata:function(){__trace.enter("cre$.iRuntime",
"getMetadatas",arguments);return E},getStateSets:function(){__trace.enter("cre$.iRuntime","getStateSets",arguments);__trace.exit("cre$.iRuntime","getStateSets",h);return h},getServiceManager:cre$.services.getServiceManager};l.setService(cre$.services.EVENTSERVICE,"com.ibm.cre.EventService","cre.service.event");l.setService(cre$.services.PAGEPERSISTENCE,"com.ibm.cre.PagePersistenceService","cre.service.persistence.page");l.setService(cre$.services.WIDGETPERSISTENCE,"com.ibm.cre.WidgetPersistenceService",
"cre.service.persistence.widget");l.setService(cre$.services.WIREPERSISTENCE,"com.ibm.cre.WirePersistenceService","cre.service.persistence.wire");l.setService(cre$.services.ITEMSETPERSISTENCE,"com.ibm.cre.ItemSetPersistenceService","cre.service.persistence.itemset");l.setService(cre$.services.PROXYSERVICE,"com.ibm.cre.ProxyService","cre.service.proxy");l.setService(cre$.services.JSONDATAFACTORYSERVICE,"com.ibm.cre.jsonDataFactory","cre.service.jsonData");l.setService(G.GADGET,"com.ibm.cre.osgadget.gadgetService",
"cre.osgadget");l.setService(G.IWIDGET,"com.ibm.cre.iwidget.iwidgetService","cre.iwidget");l.setService(cre$.services.IRUNTIME,O);return O}());(function(){function m(a,d,c,g,e){var h=a._dirty;h||(a._dirty=!0);var b=a._change?a._change:{};b.id=d;e?h&&b.changeType&&b.changeType==f.NEW_ITEM?(a._dirty=!1,delete a._change):h?b.changeType=f.REMOVED_ITEM:(a._change.changeType=f.REMOVED_ITEM,a._change.oldVal=c):(h&&b.changeType?(b.changeType!=f.NEW_ITEM&&(b.changeType=f.UPDATED_VALUE),b.newVal=g):(b.changeType=f.NEW_ITEM,"undefined"!==typeof c&&null!==c&&(b.oldVal=c,b.changeType=f.UPDATED_VALUE),"undefined"!==typeof g&&null!==g&&(b.newVal=g)),a._change=
b)}var n=Object.prototype.hasOwnProperty,p=cre$.constants,f=p.changeType;cre$.StateSetPrototype=function(){this.addListener=function(a,d){var c;"undefined"==typeof count?count=0:count++;c=count;var g=cre$.util;this.listeners[c]=function(c){c.payload||(c={name:f.ON_STATESET_CHANGED,type:null,payload:c,source:null});var b=c.payload,l=c.name;if(!(l===cre$.constants.itemSet.ONITEMSETCHANGED||l===f.ON_STATESET_CHANGED)||b&&b.changes&&0<b.changes.length){if(g.isString(a)){b=this.widgetIds?this.widgetIds[0]:
null;d&&(b=d);var l=a,k=window["_"+b+"_"+l];"undefined"==typeof k&&(widgetScope=window["_"+b+"_iContext"].iScope())&&widgetScope[l]&&(k=widgetScope);if("undefined"==typeof k||null===k)k=window[l];b="undefined"==typeof k||null===k?null:k;b&&(a=g.hitch(b,a))}g.isFunction(a)&&g.partial(a)(c)}};return c};this.getListeners=function(){return!this.listeners?null:this.listeners};this.removeListener=function(a){return this.listeners[a]?(delete this.listeners[a],!0):!1}};cre$.StateSet=function(a){this.listeners=
{};for(var d in a)n.call(a,d)&&(this[d]=cre$.util.clone(a[d]));n.call(this,f.ON_STATESET_CHANGED)&&this.addListener(this.onStateSetChanged)};var b=cre$.StateSet;b.prototype=new cre$.StateSetPrototype;b.prototype.getItemValue=function(a){if(!(a in this.items))return null;a=this.items[a].getValue();return a==f.DELETE_TOKEN?null:a};b.prototype.getLocalizedItemValue=function(a,d){if(a&&d){if(!(a in this.items))return null;var c=this.items[a].getLocalValue(d);return c==f.DELETE_TOKEN?null:c}};b.prototype.setItemValue=
function(a,d){if(!a||"undefined"==typeof d||null===d)return null;var c={};if(a in this.items){var g=this.items[a];if(g.isReadOnly())throw"The specified item ["+a+"] is readOnly!";c=g.value;g.value=d;m(g,a,c,d);g._dirty&&(this._dirty=!0,this.parent&&(this.parent._dirty=!0))}else c={},c.id=a,c.value=d,this.items[a]=new cre$.StateItem(c),m(c,a,null,d),c._dirty&&(this._dirty=!0,this.parent&&(this.parent._dirty=!0));return this};b.prototype.setLocalizedItemValue=function(a,d,c){if(!a||!d)return null;var g=
{},e={},e=cre$.util,b=null;c.replace(/-/g,"_");if(a in this.items){b=this.items[a];if(b.isReadOnly())throw"The specified item ["+a+"] is readOnly!";b.alt&&(g=e.clone(b.alt));b.setLocalValue(d,c);e=e.clone(b.alt);m(b,a,g,e);b._dirty&&(this._dirty=!0,this.parent&&(this.parent._dirty=!0));return this}b={};b.id=a;b.setLocalValue(d,c);this.items[a]=new cre$.StateItem(b);e=e.clone(b.alt);m(b,a,null,e);b._dirty&&(this._dirty=!0,this.parent&&(this.parent._dirty=!0));return this};b.prototype.removeItemValue=
function(a){this.removeLocalizedItemValue(a,"")};b.prototype.removeLocalizedItemValue=function(a,d){d||(d="");var c=d.replace(/-/g,"_"),b=!1;if(a in this.items){var e=this.items[a];if(e._dirty){var h=e._change?e._change:{};if(h.changeType===f.REMOVED_ITEM)return null;h.changeType==f.NEW_ITEM?(""===c&&(e.value&&e.value!=f.DELETE_TOKEN)&&(delete this.items[a].value,e._change.newVal[""]&&delete e._change.newVal[""],b=!0),""!=c&&e.getLocalValue(c)&&(e.deleteLocalValue(c),e._change.newVal[c]&&delete e._change.newVal[c],
b=!0)):(""==c&&(e.value&&e.value!=f.DELETE_TOKEN)&&(delete e.value,e._change.newVal[""]&&delete e._change.newVal[""],b=!0),e.getLocalValue(c)&&(e.deleteLocalValue(c),e._change.newVal[c]&&delete e._change.newVal[c],b=!0))}else""==c&&e.value?(e._change={id:a,changeType:f.REMOVED_ITEM,oldVal:e.getValue()},delete e.value):(e._change={id:a,changeType:f.REMOVED_ITEM,oldVal:e.getLocalValue(c)},e.deleteLocalValue(c)),b=e._dirty=!0}return b?(this._dirty=!0,this.parent&&(this.parent._dirty=!0),this):null};
b.prototype.removeItem=function(a){var d={},d=!1;if(a in this.items){d=this.items[a];if(d.isReadOnly())throw"The specified item ["+a+"] is readOnly!";if(d._dirty){d.value=f.DELETE_TOKEN;d=d._change?d._change:{};if(d.changeType==f.NEW_ITEM)return delete this.items[a],this;d.changeType=f.REMOVED_ITEM}else d._change={changeType:f.REMOVED_ITEM,itemName:a,oldVal:d.getValue()},d.value=f.DELETE_TOKEN,d._dirty=!0;d=!0}return d?(this._dirty=!0,this.parent&&(this.parent._dirty=!0),this):null};b.prototype.getAllItemNames=
function(){var a=[],d;for(d in this.items)n.call(this.items,d)&&a.push(d);return a};b.prototype.getItem=function(a){return!(a in this.items)?null:this.items[a]};b.prototype._setItemDirty=function(a,d){a&&this.items[a]&&(this.items[a]._dirty=d,"undefined"!=typeof d&&!d&&(delete this.items[a]._dirty,delete this.items[a]._change),this.items[a].value&&this.items[a].value==f.DELETE_TOKEN&&delete this.items[a].value,"undefined"==typeof this.items[a].value&&delete this.items[a])};cre$.StateSetHierarchy=
function(a,d,c){this.id=a;this.computed=new cre$.StateSet({id:a,items:{}});this.computed.parent=this;this.levelDef=d;this.sets={};this.listeners={};for(d=this.levelDef.length;d--;){var b=this.levelDef[d],e=c[b];e||(e={id:a,items:{}});e=new cre$.StateSet(e);e.mode=b;e.parent=this;this.sets[b]=e;for(var f in e.items)this.computed.items.hasOwnProperty(f)||(this.computed.items[f]=cre$.util.clone(e.items[f]))}this.getListeners=function(){__trace.enter(null,"getListeners",arguments);var a=this.listeners?
this.listeners:{},d;for(d in this.sets)cre$.util.mixin(a,this.sets[d].listeners);__trace.exit(null,"getListeners",a);return a}};b=cre$.StateSetHierarchy;b.prototype=new cre$.StateSetPrototype;b.prototype.setItemValue=function(a,d,c){var b=this.levelDef.length;if(c){for(var e=0;e<b&&c!=this.levelDef[e];e++);e==b&&(c=this.levelDef[b-1])}else c=this.levelDef[b-1];if(this.isReadOnly(a,c))throw"The specified item ["+a+"] is readOnly!";this.sets[c].setItemValue(a,d);for(d=this.levelDef.length;d--;)if(c=
this.sets[this.levelDef[d]].getItem(a)){this.computed.setItemValue(a,c.getValue());break}return this};b.prototype.getItemValue=function(a,d,c){if(d){if(!0===c||p.others.TRUE==c)return this.sets[d].getItemValue(a);c=!1;for(var b=null,e=this.levelDef.length;e--;)if(this.levelDef[e]==d&&(c=!0),c&&(b=this.sets[this.levelDef[e]].getItem(a))&&b.getValue()!=f.DELETE_TOKEN)return b.getValue();return!c?this.computed.getItemValue(a):null}return this.computed.getItemValue(a)};b.prototype.removeItem=function(a,
d){var c=this.levelDef.length,b;if(d){for(b=0;b<c&&d!=this.levelDef[b];b++);b==c&&(d=this.levelDef[c-1])}else d=this.levelDef[c-1];if(this.isReadOnly(a,d))throw"The specified item ["+a+"] is readOnly!";c=null;this.sets[d].removeItem(a);for(b=this.levelDef.length;b--;)if((c=this.sets[this.levelDef[b]].getItem(a))&&c.getValue()!=f.DELETE_TOKEN){this.computed.setItemValue(a,c.getValue());break}(null===c||c.getValue()==f.DELETE_TOKEN)&&this.computed.removeItem(a);return this};b.prototype.getAllItemNames=
function(a){return a?this.sets[a].getAllNames():this.computed.getAllItemNames()};b.prototype.isReadOnly=function(a,b){for(var c=!1,f=b?!1:!0,e=this.levelDef.length;e--;)if(!f&&this.levelDef[e]==b&&(f=!0),f){var h=this.sets[this.levelDef[e]].getItem(a);h&&h.isReadOnly()&&(c=!0)}return c};b.prototype.getItem=function(a){return this.computed.getItem(a)};b.prototype.clone=function(){};cre$.StateItem=function(a){for(var b in a)n.call(a,b)&&(this[b]=a[b])};b=cre$.StateItem;b.prototype.getName=function(){return this.id};
b.prototype.getValue=function(){return this.value};b.prototype.isReadOnly=function(){var a=!1,b=this.readOnly;"boolean"===typeof b&&(a=b);"string"===typeof b&&b===p.others.TRUE&&(a=!0);return a};b.prototype.getLocalsWithValues=function(){if(!this.alt)return null;var a=[];this.value&&a.push("");for(var b=this.alt.length;b--;){var c=this.alt[b];c.value&&c.lang&&a.push(c.lang)}return a};b.prototype.getLocalValue=function(a){if(!this.alt)return null;for(var b=this.alt.length;b--;){var c=this.alt[b];if(a===
c.lang)return c.value}return null};b.prototype.deleteLocalValue=function(a){if(!this.alt)return null;for(var b=this.alt.length;b--;){var c=this.alt[b];a===c.lang&&delete c.value}return null};b.prototype.setLocalValue=function(a,b){if(!this.alt)return null;for(var c=this.alt.length;c--;){var f=this.alt[c];if(b===f.lang)return f.value=a,this}return null}})();cre$.WidgetParser={parse:function(n,k){if(cre$.constants.componentType.IWIDGET===n.componentType)return cre$.IWidgetParser.parse(n,k);if(cre$.constants.componentType.GADGET===n.componentType)return cre$.OSGadgetParser.parse(n,k)}};
cre$.IWidgetParser=function(){function n(a,h,b,e,d){a.shareable=a["private"]===q.others.FALSE?!0:!1;if(a.shareable){for(var g=!1,c=e.length;c--;){var f=e[c],l=a.alias||a.id;if(!0===f.global&&f.shareable&&(l===f.id||l===f.alias)){g=!0;break}}g||e.push(s(a,h,b))}e.push(t(a,h,b,d))}function k(a){var h={id:a.id,items:{}};if(a.item)for(var b=a.item.length;b--;){var e=a.item[b],d=new cre$.StateItem(cre$.util.clone(e));h.items[e.id]=d}a.mode&&(h.mode=a.mode);a.itemSetId&&(h.itemSetId=a.itemSetId);return new cre$.StateSet(h)}
function t(a,h,b,e){var d=null,g;if(a.id===q.itemSet.IDESCRIPTOR)d=k(a);else if(a.id===q.itemSet.ATTRIBUTES){for(var c={},f,d=b.length;d--;)f=b[d],f.mode=f.mode||p.PERSONALIZE,c[f.mode]=k(f);c.config||(c.config=k(a));d=new cre$.StateSetHierarchy(a.id,[p.CONFIG,p.EDIT,p.PERSONALIZE],c);d.definitionUrl=e;c[p.PERSONALIZE]&&c[p.PERSONALIZE].itemSetId&&(d.itemSetId=c[p.PERSONALIZE].itemSetId)}else{e=cre$.util.clone(a);var c=e.item,l;f={};for(d=b.length;d--;){l=b[d].item;for(g=l.length;g--;)f[l[g].id]=
l[g].value}if(void 0!==c&&null!==c)for(d=c.length;d--;)b=c[d],b.readOnly===q.others.FALSE&&void 0!==f[b.id]&&(b.value=f[b.id]);d=k(e)}d.id=a.id;d.shareable=a.shareable;d.alias=a.alias;a.onItemSetChanged&&d.addListener(a.onItemSetChanged,h);d.widgetIds=[h];return d}function s(a,h,b){b=k(a);var e=a.alias||a.id;b.id=e;b.shareable=!0;b.global=!0;b.alias=e;a.onItemSetChanged&&b.addListener(a.onItemSetChanged,h);b.widgetIds=["*"];return b}function r(a,h){var b=[];if(a)for(var e=a.length;e--;){var d=a[e];
d.id===h&&b.push(d)}return b}var q=cre$.constants,p=q.mode;return{parse:function(a,h){if(a&&a.widgetMetadata){a.widgetMetadata.itemSet||(a.widgetMetadata.itemSet={});var b=a.widgetMetadata.itemSet,e=a.instanceMetaData.itemSet,d=a.instanceMetaData.moduleId,g=b.length,c,f=a.loadInstanceData,l;"undefined"!==typeof f&&null!==f&&(l=f.itemSet);var m=null;c=!1;f=[];for(c=m=null;g--;)c=b[g],m=r(l,c.id),0===m.length&&(m=r(e,c.id)),f.push(c.id),n(c,d,m,h,a.widgetMetadata.definitionUrl);if(e)for(b=e.length;b--;){var k=
e[b];c=!1;for(g=f.length;g--;)if(m=f[g],k.id===m){c=!0;break}c||(g=[],m=r(l,k.id),0===m.length&&(m=r(e,k.id)),f.push(k.id),c={},c.id=k.id,n(c,d,m,h,a.widgetMetadata.definitionUrl))}if(l)for(e=l.length;e--;){b=l[e];c=!1;for(g=f.length;g--;)if(m=f[g],b.id===m){c=!0;break}c||(g=[],g.push(b),c={},c.id=b.id,n(c,d,g,h,a.widgetMetadata.definitionUrl))}}return h}}}();cre$.OSGadgetParser=function(){return{parse:function(n){return new cre$.StateSet}}}();cre$.WidgetEvent=function(a){this.name=a.name;this.type=a.type;this.isHandled=a.isHandled;this.isPublished=a.isPublished;this.description=a.description};cre$.EventService=function(){this.isManagedHub=cre$.oah.isManagedHub;this.managedHub=cre$.oah.managedHub};
cre$.EventService.prototype={fireEvent:function(a,c,d,g,e){(a=window["_"+a+"_iContext"])&&a.iEvents.fireEvent(c,g,d)},broadcastEvent:function(a,c,d,g,e,f,k){__trace.enter("cre$.EventService","broadcastEvent",arguments);var b={};b.targetEvent=a;b.payload=c;b.payloadType=d;this.broadcastEvents([b],g,e,f,k);__trace.exit("cre$.EventService","broadcastEvent")},broadcastEvents:function(a,c,d,g,e){__trace.enter("cre$.EventService","broadcastEvents",arguments);for(var f=a.length,k=0;k<f;k++){var b=a[k],h=
{};h.name=b.targetEvent;h.payload=b.payload;h.type=b.payloadType;this.publishEvent(b.targetEvent,h);e&&(h=cre$.iRuntime.getWires())&&h.addQueuedEvent(null,b.targetEvent,{payload:b.payload,payloadType:b.payloadType})}__trace.exit("cre$.EventService","broadcastEvents")},publishEvent:function(a,c,d,g){__trace.enter("cre$.EventService","publishEvent",arguments);if(this.isManagedHub){var e=this.managedHub.getInlineHubClient(g);e&&("undefined"===typeof c||null===c?e.publish(a):e.publish(a,c))}else OpenAjax.hub.publish(a,
c);__trace.exit("cre$.EventService","publishEvent")},subscribeEvent:function(a,c,d,g){__trace.enter("cre$.EventService","subscribeEvent",arguments);var e,f;e=this.isManagedHub?this.managedHub.getInlineHubClient(g).subscribe(a,function(a,b,e){f=d;c&&d&&(f=cre$.util.hitch(c,d));f&&f(b)},null,function(a,b,c){b||(__trace.msg("cre$.EventService","subscribeEvent","subscription for ${0} failed",[a]),__trace.exit("cre$.EventService","subscribeEvent"))}):OpenAjax.hub.subscribe(a,function(a,b){c&&d&&(f=cre$.util.hitch(c,
d));f&&f(b)});__trace.exit("cre$.EventService","subscribeEvent",e);return e},unsubscribeEvent:function(a,c){__trace.enter("cre$.EventService","unsubscribeEvent",arguments);if(a)if(this.isManagedHub){var d=this.managedHub.getInlineHubClient(c);try{d&&d.unsubscribe(a)}catch(g){__trace.msg("cre$.EventService","unsubscribeEvent","unsubscribe failure: ${0}",[g])}}else OpenAjax.hub.unsubscribe(a);else __trace.msg("cre$.EventService","unsubscribeEvent","subscriptionHandler is missing");__trace.exit("cre$.EventService",
"unsubscribeEvent")}};cre$.EventService&&getServiceManager().setService(cre$.services.EVENTSERVICE,new cre$.EventService);cre$.IfrEventService=function(){this.queuedSubEvents=[];this.queuedPubEvents=[];this.queuedBroadcastEvents=[];this.queuedUnsubEvents=[];this.isManagedHub=cre$.oah.isManagedHub;this.managedHub=cre$.oah.managedHub;this.hubClient=this.createIframeHubClient()};
cre$.IfrEventService.prototype={createIframeHubClient:function(){__trace.enter("cre$.IfrEventService","createIframeHubClient",arguments);if(this.hubClient)return this.hubClient;var a=new OpenAjax.hub.IframeHubClient({HubClient:{onSecurityAlert:function(b,a){}}}),b=this;a.connect(function(a,g,e){b.hubClient=a;for(var c in b.queuedSubEvents)Object.prototype.hasOwnProperty.call(b.queuedSubEvents,c)&&(a=b.queuedSubEvents[c],b.subscribeEvent.apply(b,a));for(c in b.queuedPubEvents)Object.prototype.hasOwnProperty.call(b.queuedPubEvents,
c)&&(a=b.queuedPubEvents[c],b.publishEvent.apply(b,a));for(c in b.queuedBroadcastEvents)Object.prototype.hasOwnProperty.call(b.queuedBroadcastEvents,c)&&(a=b.queuedBroadcastEvents[c],b.broadcastEvents.apply(b,a));for(c in b.queuedUnsubEvents)Object.prototype.hasOwnProperty.call(b.queuedUnsubEvents,c)&&(a=b.queuedUnsubEvents[c],b.unsubscribeEvent.apply(b,a))});this.hubClient=a;__trace.exit("cre$.IfrEventService","createIframeHubClient")},fireEvent:function(a,b,d,g,e){(a=window["_"+a+"_iContext"])&&
a.iEvents.fireEvent(b,g,g)},broadcastEvent:function(a,b,d,g,e,c){__trace.enter("cre$.IfrEventService","broadcastEvent",arguments);var f={};f.targetEvent=a;f.payload=b;f.payloadType=d;this.broadcastEvents([f],g,e,c);__trace.exit("cre$.IfrEventService","broadcastEvent")},broadcastEvents:function(a,b,d,g){__trace.enter("cre$.IfrEventService","broadcastEvents",arguments);if(this.hubClient){for(var e=a.length,c=0;c<e;c++){var f=a[c],h={};h.name=f.targetEvent;h.payload=f.payload;h.type=f.payloadType;this.publishEvent(f.targetEvent,
h);(h=cre$.iRuntime.getWires())&&h.addQueuedEvent(null,f.targetEvent,{payload:f.payload,payloadType:f.payloadType})}__trace.exit("cre$.IfrEventService","broadcastEvents")}else this.queuedBroadcastEvents.push(arguments)},publishEvent:function(a,b,d,g){__trace.enter("cre$.IfrEventService","publishEvent",arguments);this.hubClient?this.hubClient&&("undefined"===typeof b||null===b?this.hubClient.publish(a):this.hubClient.publish(a,b)):(this.queuedPubEvents.push(arguments),__trace.msg("cre$.IfrEventService",
"publishEvent","hubClient not ready, put the event into queue"));__trace.exit("cre$.IfrEventService","publishEvent")},subscribeEvent:function(a,b,d,g,e){__trace.enter("cre$.IfrEventService","subscribeEvent",arguments);if(this.hubClient){var c=null;this.hubClient&&(c=this.hubClient.subscribe(a,function(a,c,e){a=d;b&&d&&(a=cre$.util.hitch(b,d));a&&a(c)},null,function(a,c,d){b&&e&&(e=cre$.util.hitch(b,e));e&&e.apply(this,[a,c,d]);c||(__trace.msg("cre$.IfrEventService","subscribeEvent","subscribe event failed"),
__trace.exit("cre$.IfrEventService","subscribeEvent"))}));__trace.exit("cre$.IfrEventService","subscribeEvent",c);return c}this.queuedSubEvents.push(arguments);__trace.msg("cre$.IfrEventService","subscribeEvent","hubClient not ready, put the event into queue");__trace.exit("cre$.IfrEventService","subscribeEvent")},unsubscribeEvent:function(a,b){__trace.enter("cre$.IfrEventService","unsubscribeEvent",arguments);if(this.hubClient)if(a)try{this.hubClient&&this.hubClient.unsubscribe(a)}catch(d){__trace.msg("cre$.IfrEventService",
"unsubscribeEvent","unsubscribe failure: ${0}",[d])}else __trace.msg("cre$.IfrEventService","unsubscribeEvent","subscriptionHandler is missing");else this.queuedUnsubEvents.push(arguments),__trace.msg("cre$.IfrEventService","unsubscribeEvent","hubClient not ready, put the event into queue");__trace.exit("cre$.IfrEventService","unsubscribeEvent")}};cre$.Wire=function(a,b){this.isManagedHub=!0;"undefined"!==typeof a&&!a&&(this.isManagedHub=!1);this.wires=[];this._createWireDelegators=[];this._newWireCallbacks=[];this._removeWireCallbacks=[];this._widgetObjects={};this._managedHub=b;this._queuedEvents=[]};
cre$.Wire.prototype={init:function(a){__trace.enter("cre$.Wire","init",arguments);this._widgetObjects=a;if(this.isManagedHub)for(var b in this._widgetObjects)if(Object.prototype.hasOwnProperty.call(this._widgetObjects,b)){var c=this._widgetObjects[b].instanceMetaData;c&&c.moduleId&&this._verifyHubClientCreated(c.moduleId)}__trace.exit("cre$.Wire","init")},createWire:function(a,b,c,d){__trace.enter("cre$.Wire","createWire",arguments);var e=null,f=null,h=cre$.constants.event;if(this._isWireExist(a,
b,c,d))return cre$.promise.resolved();if(cre$.iRuntime.inIFrame||this._isCompatible(a,b,c,d)){this._verifyHubClientCreated(a);this._verifyHubClientCreated(c);var g=this.getCreateWireDelegator(c);g?e=g.object[g.createWireDelegator].call(g.object,a,b,c,d):(__trace.msg("cre$.Wire","createWire","target widget not ready, can't create wire!"),f=cre$.promise.rejected("target widget not ready, can't create wire!"))}else __trace.msg("cre$.Wire","createWire","fail to create wire: the payload type is not compatible");
e?(f=cre$.util.hitch(this,function(e){if(e){this.wires.push(e);var f=getServiceManager().getService(cre$.services.EVENTSERVICE),g={};cre$.iRuntime.inIFrame?f.then(function(a){g[h.payload.METHODNAME]="_syncWiresDone";g[h.payload.PARAMS]=[e];a.publishEvent("sync_"+c,g)}):f.then(function(a){g[h.payload.METHODNAME]="_syncWiresCreated";g[h.payload.PARAMS]=[e];a.publishEvent(h.topic.BROADCAST_WIRES_CHANGE,g)})}this.invokeOnNewWire(a,b,c,d);for(var k in this._widgetObjects)if(this._widgetObjects[k].instanceMetaData&&
this._widgetObjects[k].instanceMetaData.moduleId===c){if(this._widgetObjects[k].instanceMetaData.receivedEvents){f=this._widgetObjects[k].instanceMetaData.receivedEvents;k=this._widgetObjects[k].instanceMetaData.receivedEvents.length;for(var p=!1,l=0;l<k;l++){var m=f[l];m.sourceEvent===b&&(m.sourceWidget===a&&m.targetEvent===d)&&(p=!0,__trace.msg("cre$.Wire","createWire","exactly the same wire, no need to add into instanceData."))}p||f.push({sourceWidget:a,sourceEvent:b,targetEvent:d})}else this._widgetObjects[k].instanceMetaData.receivedEvents=
[{sourceWidget:a,sourceEvent:b,targetEvent:d}];break}}),f=e.then(f)):__trace.msg("cre$.Wire","createWire","fail to create wire!");__trace.exit("cre$.Wire","createWire");return f},invokeOnNewWire:function(a,b,c,d){__trace.enter("cre$.Wire","invokeOnNewWire",arguments);for(var e=this._newWireCallbacks.length,f=0;f<e;f++){var h=this._newWireCallbacks[f],g=h.object,n=h.callback;if(h.widgetId===a&&h.eventId===b||h.widgetId===c&&h.eventId===d)"function"===typeof g[n]?g[n].call(g,{targetWidget:c,targetEvent:d,
sourceWidget:a,sourceEvent:b}):__trace.msg("cre$.Wire","invokeOnNewWire","fail to trigger onNewWire callback, the specified function doesn't exist.")}__trace.exit("cre$.Wire","invokeOnNewWire")},updateWire:function(a){__trace.enter("cre$.Wire","updateWire",arguments);for(var b=this.wires.length,c=0;c<b;c++){var d=this.wires[c];if(d&&this._matched(d,a.sourceWidget,a.sourceEvent,a.targetWidget,a.targetEvent))break}__trace.exit("cre$.Wire","updateWire")},removeWire:function(a,b,c,d){__trace.enter("cre$.Wire",
"removeWire",arguments);for(var e=null,f=this.wires.length,h=0;h<f;h++){var g=this.wires[h];if(g&&this._matched(g,a,b,c,d)){e=g;break}}this._removeWire(e);__trace.exit("cre$.Wire","removeWire")},removeWireBySourceWidget:function(a){this.removeQueuedEvent(a);var b=this.wires.length;if(0<b)for(;b--;){var c=this.wires[b];c&&c.sourceWidget===a&&this._removeWire(c)}},removeWireByTargetWidget:function(a){var b=this.wires.length;if(0<b)for(;b--;){var c=this.wires[b];c&&c.targetWidget===a&&this._removeWire(c)}},
_verifyHubClientCreated:function(a){var b=cre$.iRuntime.getWidgetObjects(),c=cre$.constants.componentType.IWIDGET,d=null,e;for(e in b)if(b[e].componentType===c&&b[e].instanceMetaData.moduleId===a){d=b[e];break}d&&(d.componentType===c&&d.renderType!==cre$.constants.renderType.SANDBOX)&&!this._managedHub._getInlineHubClient(a)&&(this._managedHub.createInlineHubContainer(a),this._managedHub.createInlineHubClient(a))},_removeWire:function(a){var b=this.wires.length,c=cre$.constants.event;if(a){var d=
getServiceManager().getService(cre$.services.EVENTSERVICE);if(a.wireId){d.then(cre$.util.partial(function(a,b){b.unsubscribeEvent(a.wireId)},a));for(var d=this._removeWireCallbacks.length,e=0;e<d;e++){var f=this._removeWireCallbacks[e].object,h=this._removeWireCallbacks[e].callback;if(this._removeWireCallbacks[e].widgetId===a.sourceWidget&&this._removeWireCallbacks[e].eventId===a.sourceEvent||this._removeWireCallbacks[e].widgetId===a.targetWidget&&this._removeWireCallbacks[e].eventId===a.targetEvent)"function"===
typeof f[h]?f[h].call(f,{targetWidget:a.targetWidget,targetEvent:a.targetEvent,sourceWidget:a.sourceWidget,sourceEvent:a.sourceEvent}):__trace.msg("cre$.Wire",null,"fail to trigger onRemoveWire callback, the specified function doesn't exist.")}for(var g in this._widgetObjects)if(this._widgetObjects[g].instanceMetaData&&this._widgetObjects[g].instanceMetaData.moduleId===a.targetWidget){if(this._widgetObjects[g].instanceMetaData.receivedEvents){d=this._widgetObjects[g].instanceMetaData.receivedEvents;
for(g=this._widgetObjects[g].instanceMetaData.receivedEvents.length;g--;)if(e=d[g],e.sourceEvent===a.sourceEvent&&e.sourceWidget===a.sourceWidget&&e.targetEvent===a.targetEvent){d.splice(g,1);break}}break}for(;b--;)this.wires[b]===a&&this.wires.splice(b,1)}else for(d.then(cre$.util.partial(function(a,b,d){var e={};e[c.payload.METHODNAME]="_syncRemoveWire";e[c.payload.PARAMS]=b;d.publishEvent(a,e)},cre$.iRuntime.inIFrame?c.topic.SYNC+a.targetWidget:c.topic.STUB_SYNC+a.targetWidget,[a]));b--;)this.wires[b]===
a&&(this.wires.splice(b,1),cre$.iRuntime.inIFrame||d.then(function(b){var d={};d[c.payload.METHODNAME]="_syncWiresRemoved";d[c.payload.PARAMS]=[a];b.publishEvent(c.topic.BROADCAST_WIRES_CHANGE,d)}))}},getWireByTargetWidget:function(a){for(var b=[],c=this.wires.length,d=0;d<c;d++){var e=this.wires[d];e&&e.targetWidget===a&&b.push(e)}return b},_isWireExist:function(a,b,c,d){for(var e=this.wires.length,f=0;f<e;f++)if(this._matched(this.wires[f],a,b,c,d))return this.wires[f];return null},_matched:function(a,
b,c,d,e){return a.sourceWidget===b&&a.sourceEvent===c&&a.targetWidget===d&&a.targetEvent===e},_getWidgetObject:function(a){for(var b in this._widgetObjects)if(this._widgetObjects[b].instanceMetaData&&this._widgetObjects[b].instanceMetaData.moduleId===a)return this._widgetObjects[b];return null},_findEventObj:function(a,b){var c,d,e=b.widgetMetadata.event;if(e){c=e.length;for(d=0;d<c;d++){var f=e[d];if(f.id===a)return f}}if(e=b.instanceMetaData.dynamicEvents){c=e.length;for(d=0;d<c;d++)if(f=e[d],f.name===
a)return f}return null},_findEventPayload:function(a,b){var c,d;if(a.eventDescName){var e=b.widgetMetadata.eventDescription;c=e.length;for(d=0;d<c;d++){var f=e[d];if(f.id===a.eventDescName)return f.payloadType}}else if(a.name)return a.type;return null},_isCompatible:function(a,b,c,d){__trace.enter("cre$.Wire","_isCompatible",arguments);var e=this._getWidgetObject(a),f=this._getWidgetObject(c);if(e&&f){if(!this._findEventObj(d,f))return __trace.exit("cre$.Wire","_isCompatible",!1),!1;__trace.exit("cre$.Wire",
"_isCompatible",!0);return!0}__trace.msg("cre$.Wire","_isCompatible","widget id not existed");__trace.exit("cre$.Wire","_isCompatible",!1);return!1},_isRegistered:function(a,b,c){for(var d=c.length,e=0;e<d;e++){var f=c[e];if(f.widgetId===a&&f.eventId===b)return!0}return!1},_isDelegatorRegistered:function(a,b){for(var c=b.length,d=0;d<c;d++)if(b[d].widgetId===a)return!0;return!1},registerNewWireCallback:function(a,b,c,d){this._isRegistered(a,b,this._newWireCallbacks)||this._newWireCallbacks.push({widgetId:a,
eventId:b,callback:c,object:d})},registerRemoveWireCallback:function(a,b,c,d){this._isRegistered(a,b,this._removeWireCallbacks)||this._removeWireCallbacks.push({widgetId:a,eventId:b,callback:c,object:d})},getCreateWireDelegator:function(a){for(var b=this._createWireDelegators.length;b--;){var c=this._createWireDelegators[b];if(c.widgetId===a)return c}return null},registerCreateWireDelegators:function(a,b,c){this._isDelegatorRegistered(a,this._createWireDelegators)||this._createWireDelegators.push({widgetId:a,
createWireDelegator:b,object:c})},removeWireDelegator:function(a){for(var b=this._createWireDelegators.length;b--;)if(this._createWireDelegators[b].widgetId===a)return this._createWireDelegators.splice(b,1),!0;return!1},addQueuedEvent:function(a,b,c){var d=this._queuedEvents.length;null===a&&(a="broadcast");for(var e=0;e<d;e++){var f=this._queuedEvents[e];if(f.widgetId===a&&f.eventId===b){f.payload=c;return}}this._queuedEvents.push({widgetId:a,eventId:b,payload:c})},removeQueuedEvent:function(a){var b=
this._queuedEvents.length;if(0<b)for(;b--;)(!a||this._queuedEvents[b].widgetId===a)&&this._queuedEvents.splice(b,1)}};void 0==cre$.constants.iWidget&&(cre$.constants.iWidget={});cre$.constants.iWidget.ISCOPETYPES={dojoAMD:"_dojoAMDWrapper"};
(function(){void 0==cre$.iwidget.iwidgetService&&(cre$.iwidget.iwidgetService=function(){});cre$.iwidget.iscopeService=function(){};cre$.iwidget.iscopeService.prototype._dojoAMDWrapper=function(a){__trace.enter("cre$.iwidget.iscopeService","_dojoAMDWrapper",arguments);var c=new cre$.promise.Promise("_dojoAMDWrapper");if(window.require){var b=a.replace(/\./g,"/");require([b,"dojo"],function(b,e){var a;cre$.util.isFunction(b)?a=new b:(__logging.log("cre$.iwidget.iscopeService","_dojoAMDWrapper",cre$.LocaleHelper.getLocalizedMessages().ERR_CREATE_ISCOPE),
a={});c.resolve(a)})}else __logging.log("iscopeService.","_dojoAMDWrapper","Dojo is not loaded"),c.resolve({});__trace.exit("cre$.iwidget.iscopeService","_dojoAMDWrapper");return c};cre$.iwidget.iscopeService.prototype.makeInstance=function(a,c){__trace.enter("cre$.iwidget.iscopeService","makeInstance",arguments);var b=new cre$.promise.Promise("makeInstance"),d=cre$.constants.iWidget.ISCOPETYPES[a];d?this[d].call(this,c).then(function(a){b.resolve(a)},function(a){b.reject(a)}):b.resolve({});__trace.exit("cre$.iwidget.iscopeService",
"makeInstance",b);return b}})();cre$.constants.iWidget=cre$.constants.iWidget||{};cre$.constants.iWidget.ISCOPESERVICE="com.ibm.cre.iwidget.iscopeService";getServiceManager().setService(cre$.constants.iWidget.ISCOPESERVICE,cre$.constants.iWidget.ISCOPESERVICE,"cre.iwidget.iscopeService");cre$.iwidget.internalutil=cre$.iwidget.internalutil||{};
(function(){function n(a,b){return-1!==a.indexOf(b,a.length-b.length)}var e=cre$.iwidget.internalutil,q=Object.prototype.hasOwnProperty;e._handleEvent=function(a){__trace.enter("cre$.iwidget.internalutil","_handleEvent",arguments);var b=a.scope;b||(b=this);var c=a.methodname;c&&(b[c]&&cre$.util.isFunction(b[c]))&&b[c].apply(b,a.params||[]);__trace.exit("cre$.iwidget.internalutil","_handleEvent")};e._handleDataSync=function(a){__trace.enter("cre$.iwidget.internalutil","_handleDataSync",arguments);
a.id===this.constants.ATTRIBUTES?(this._syncAttr(a),this.getiWidgetAttributes().commit(null,!0)):a.id===this.constants.IDESCRIPTOR&&(this._synciDescriptor(a),this.getiDescriptor().commit(null,!0));__trace.exit("cre$.iwidget.internalutil","_handleDataSync")};e._syncAttr=function(a){__trace.enter("cre$.iwidget.internalutil","_syncAttr",arguments);var b=this.getiWidgetAttributes()._stateSet,c=null,d=null,f=null,h;for(h in a.sets)if(Object.prototype.hasOwnProperty.call(a.sets,h))for(c in a.sets[h].items)if(Object.prototype.hasOwnProperty.call(a.sets[h].items,
c)){var d=a.sets[h].items[c],e=d.readOnly?d.readOnly:!1;(f=d.value)&&f===cre$.constants.changeType.DELETE_TOKEN?b.removeItem(d.id,h):void 0===f?b.removeItemValue(d.id,h):e||b.setItemValue(d.id,f,h)}__trace.exit("cre$.iwidget.internalutil","_syncAttr")};e._synciDescriptor=function(a){__trace.enter("cre$.iwidget.internalutil","_synciDescriptor",arguments);var b=this.getiDescriptor(),c=null,d=null;for(c in a.items)Object.prototype.hasOwnProperty.call(a.items,c)&&((d=a.items[c])&&d===cre$.constants.changeType.DELETE_TOKEN?
b.removeItem(c):b.setItemValue(c,d));__trace.exit("cre$.iwidget.internalutil","_synciDescriptor")};e._syncCreateWire=function(a){__trace.enter("cre$.iwidget.internalutil","_syncCreateWire",arguments);this._iRuntime.getWires().createWire(a.sourceWidget,a.sourceEvent,a.targetWidget,a.targetEvent);__trace.exit("cre$.iwidget.internalutil","_syncCreateWire")};e._syncRemoveWire=function(a){__trace.enter("cre$.iwidget.internalutil","_syncRemoveWire",arguments);this._iRuntime.getWires().removeWire(a.sourceWidget,
a.sourceEvent,a.targetWidget,a.targetEvent);__trace.exit("cre$.iwidget.internalutil","_syncRemoveWire")};e._syncCreateEvent=function(a){this._isWrapperContext&&this.iEvents.setEvent(a);__trace.exit("cre$.iwidget.internalutil",null)};e._syncCreateEvents=function(a){__trace.enter("cre$.iwidget.internalutil","_syncCreateEvents",arguments);this._isWrapperContext&&this.iEvents.setEvents(a);__trace.exit("cre$.iwidget.internalutil","_syncCreateEvents")};e._syncRemoveEvent=function(a){__trace.enter("cre$.iwidget.internalutil",
"_syncRemoveEvent",arguments);this._isWrapperContext&&this.iEvents.removeEvent(a);__trace.exit("cre$.iwidget.internalutil","_syncRemoveEvent")};e._syncRemoveEvents=function(a){this._isWrapperContext&&this.iEvents.removeEvents(a);__trace.exit("cre$.iwidget.internalutil",null)};e._syncWiresCreated=function(a){__trace.enter("cre$.iwidget.internalutil","_syncWiresCreated",arguments);for(var b=!1,c=this._iRuntime.getWires().wires,d=c.length,f=0;f<d;f++)if(c[f].sourceWidget===a.sourceWidget&&c[f].sourceEvent===
a.sourceEvent&&c[f].targetWidget===a.targetWidget&&c[f].targetEvent===a.targetEvent){b=!0;break}b||this._iRuntime.getWires().wires.push(a);__trace.exit("cre$.iwidget.internalutil","_syncWiresCreated")};e._syncWiresDone=function(a){__trace.enter("cre$.iwidget.internalutil","_suncWiresDone",arguments);this._iRuntime.getWires().invokeOnNewWire(a.sourceWidget,a.sourceEvent,a.targetWidget,a.targetEvent);__trace.exit("cre$.iwidget.internalutil","_suncWiresDone")};e._syncWiresRemoved=function(a){__trace.enter("cre$.iwidget.internalutil",
"_syncWiresRemoved",arguments);var b=this._iRuntime.getWires().wires;if(b&&b.length)for(var c=b.length;c--;){var d=b[c];if(d&&d.sourceWidget===a.sourceWidget&&d.sourceEvent===a.sourceEvent&&d.targetWidget===a.targetWidget&&d.targetEvent===a.targetEvent){b.splice(c,1);break}}__trace.exit("cre$.iwidget.internalutil","_syncWiresRemoved")};e._getIframeUrl=function(){__trace.enter("cre$.iwidget.internalutil","_getIframeUrl",arguments);var a=cre$.config.getCREServerUrl();!0===this._widgetObject.hashedDomain&&
(a=0===a.indexOf("http")?a.replace("://","://"+this._widgetObject.hashedDomainURL+"."):this._widgetObject.hashedDomainURL+"."+a);var b=a+cre$.config.SANDBOXWIDGETS_URL+"?wid\x3d"+this.getWidgetId()+"\x26domId\x3d"+this._widgetObject.domId+"\x26locale\x3d"+cre$.LocaleHelper.getLocale()+"\x26container\x3d"+cre$.config.CONTAINER;"undefined"!==typeof this._widgetObject.hashedDomain&&null!==this._widgetObject.hashedDomain&&(b=b+"\x26hashedDomain\x3d"+this._widgetObject.hashedDomain);var c=this._metadata.resource.length,
d=/dojo(\.xd)?\.js(\W|$)/i,f,h,e;for(f=0;f<c;f++)if(h=this._metadata.resource[f].uri,e=h.match(d)){a=window.encodeURIComponent(a+"/common/proxy/"+this.getWidgetId()+"?url\x3d"+this._buildAbsoluteUrl(h));b=b+"\x26dojouri\x3d"+a;break}cre$.config.isDebug&&(b+="\x26debug\x3d1");__trace.exit("cre$.iwidget.internalutil","_getIframeUrl",b);return b};e._getMarkupByMode=function(a){__trace.enter("cre$.iwidget.internalutil","_getMarkupByMode",arguments);var b=this._metadata.allowInstanceContent?this._instanceData.content&&
this._instanceData.content[0][a]?this._instanceData.content[0][a]:this._metadata.content[0][a]:this._metadata.content[0][a];if("undefined"===typeof b||null===b)b="";b=this.processMarkup(b);__trace.exit("cre$.iwidget.internalutil","_getMarkupByMode",b);return b};e._processScripts=function(a){__trace.enter("cre$.iwidget.internalutil","_processScripts",arguments);var b=a.getElementsByTagName("script"),c;if(null!==b&&"undefined"!==typeof b){c=0;for(l=b.length;c<l;c++){var d=b[c],f=d.getAttribute("id");
(null===f||"undefined"===typeof f||""===f)&&d.setAttribute("id","_scr#"+c);this._processExternalScripts(d)||cre$.util.evalFn(d.innerHTML)}}__trace.exit("cre$.iwidget.internalutil","_processScripts")};e._processExternalScripts=function(a){__trace.enter("cre$.iwidget.internalutil","_processExternalScripts",arguments);var b=this._getScriptUrl(a),c=!1;b&&(cre$.ResourceManager&&(b=cre$.ResourceManager.makeProxyUrl(b)),this._loadExternalScript(b),c=!0);__trace.exit("cre$.iwidget.internalutil","_processExternalScripts",
c);return c};e._getScriptUrl=function(a){__trace.enter("cre$.iwidget.internalutil","_getScriptUrl",arguments);var b=null;if(a.getAttribute)b=a.getAttribute("src");else{var c=a.toLowerCase().indexOf("\x3cscript"),d=a.toLowerCase().indexOf("\x3e"),c=a.substring(c,d),d=c.indexOf("src");if(-1!=d){var b=c.indexOf("'",d),f=c.indexOf('"',d),e='"',d=doubleQuoteSrcAttrContentIndex;if(-1==doubleQuoteSrcAttrContentIndex||-1!=b&&b<f)e="'",d=b;b=c.indexOf(e,d+1);b=c.substring(d+1,b)}}__trace.exit("cre$.iwidget.internalutil",
"_getScriptUrl",b);return b};e._loadExternalScript=function(a){__trace.enter("cre$.iwidget.internalutil","_loadExternalScript",arguments);var b={};b[cre$.constants.request.URL]=a;b[cre$.constants.request.SYNC]=!0;cre$.xhr.xhrGet(b).then(function(a){window.execScript?window.execScript(e._stripHTMLComments(a.data),"JavaScript"):eval.call(self,a.data)},function(a){__logging.log("cre$.iwidget.internalutil","_loadExternalScript",cre$.LocaleHelper.getLocalizedMessages().ERR_ISCOPE_METHOD_NOT_DEFINED)});
__trace.exit("cre$.iwidget.internalutil","_loadExternalScript")};e._stripHTMLComments=function(a){__trace.enter("cre$.iwidget.internalutil","_stripHTMLComments",arguments);for(var b="",c=a.indexOf("\x3c!--"),b=-1!=c?a.substring(0,c):a;0<=c;){c=a.indexOf("--\x3e");if(0>c)throw Error("Unclosed HTML comment found!!");b+=a.substring(c+3);c=a.indexOf("\x3c!--",c+3)}__trace.exit("cre$.iwidget.internalutil","_stripHTMLComments",b);return b};e._getDomByMode=function(a){__trace.enter("cre$.iwidget.internalutil",
"_getDomByMode",arguments);if(this._isWrapperContext)return __trace.exit("cre$.iwidget.internalutil","_getDomByMode",null),null;for(var b=this._instanceData.moduleId+"Content "+a,c=this._rootElement.firstChild;c;){if(b===c.className)return __trace.exit("cre$.iwidget.internalutil","_getDomByMode",c),c;c=c.nextSibling}__trace.exit("cre$.iwidget.internalutil","_getDomByMode",null);return null};e.unload=function(){__trace.enter("cre$.iwidget.internalutil","unload",arguments);var a=this.getWidgetId(),
b="_"+a+"_iContext",c=this._iRuntime.getWires(),d=this._iRuntime.getStateSets(),f=this._iRuntime.getWidgets();this.removeRootElement();this._iRuntime.removeWireLoadedCallbackById(a);c&&(c.removeWireBySourceWidget(a),c.removeWireByTargetWidget(a),c.removeWireDelegator(a));if(d)for(c=d.length;c--;){var e=d[c],g=e.widgetIds.length||0;if(1===g&&a===e.widgetIds[0])delete d[c],d.splice(c,1);else if(1<g)for(;g--;)if(a===e.widgetIds[g]){delete e.widgetIds[g];e.widgetIds.splice(g,1);break}}var k=this;getServiceManager().getService(cre$.services.EVENTSERVICE).then(function(a){var b=
k._subHandlers.length;if(0<b)for(;b--;)a.unsubscribeEvent(k._subHandlers[b])});delete f[a];try{delete window[b]}catch(m){window[b]=void 0}__trace.exit("cre$.iwidget.internalutil","unload")};e._syncGlobalShareableItemSet=function(a,b,c){__trace.enter("cre$.iwidget.internalutil","_syncGlobalShareableItemSet",arguments);var d=null,f=null;if(a!==this.getWidgetId()){f=cre$.iRuntime.getGlobalShareableStateSet(b);for(d in c)c[d]&&c[d]===cre$.constants.changeType.DELETE_TOKEN?f.removeItem(d):c[d]&&f.setItemValue(d,
c[d]);var e=f.getAllItemNames();if(!e)return;var g={};g.itemSetName=f.id;g.changes=[];var k,d=0;for(k=e.length;d<k;d++){var m=e[d],p=f.getItem(m);f._dirty&&(p._dirty&&p._change)&&(g.changes.push(p._change),f._setItemDirty(m,!1))}delete f._dirty;var d={name:cre$.constants.predefinedEvents.onItemSetChanged,type:null,payload:g,source:this._iContext.getWidgetId()},e=f.getListeners(),r;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&e[r].call(f,d)}__trace.exit("cre$.iwidget.internalutil","_syncGlobalShareableItemSet")};
e._syncLocalShareableItemSet=function(a,b){__trace.enter("cre$.iwidget.internalutil","_syncLocalShareableItemSet",arguments);var c=this.getShareableItemSet(a),d=null;for(d in b)b[d]&&b[d]===cre$.constants.changeType.DELETE_TOKEN?c.removeItem(d):b[d]&&c.setItemValue(d,b[d]);c.commit(null,!0);__trace.exit("cre$.iwidget.internalutil","_syncLocalShareableItemSet")};e._getSimpleType=function(a){__trace.enter("cre$.iwidget.internalutil","_getSimpleType",arguments);var b=a.indexOf("?");-1!==b&&(a=a.substring(0,
b));if(n(a,".js"))return __trace.exit("cre$.iwidget.internalutil","_getSimpleType"),cre$.constants.resource.resourceType.JAVASCRIPT;if(n(a,".css"))return __trace.exit("cre$.iwidget.internalutil","_getSimpleType"),cre$.constants.resource.resourceType.CSS;if(n(a,".bmp")||n(a,".jpg")||n(a,".png")||n(a,".gif")||n(a,".tiff")||n(a,".ico"))return __trace.exit("cre$.iwidget.internalutil","_getSimpleType"),cre$.constants.resource.resourceType.IMAGE;__trace.exit("cre$.iwidget.internalutil","_getSimpleType");
return cre$.constants.resource.resourceType.UNKNOW};e._getResourceType=function(a){__trace.enter("cre$.iwidget.internalutil","_getResourceType",arguments);if(void 0===a||null===a)return cre$.constants.resource.resourceType.UNKNOW;if(cre$.constants.resource.mimeType.JAVASCRIPT===a)return cre$.constants.resource.resourceType.JAVASCRIPT;if(cre$.constants.resource.mimeType.CSS===a)return cre$.constants.resource.resourceType.CSS;if(0===a.indexOf(cre$.constants.resource.mimeType.IMAGE))return cre$.constants.resource.resourceType.IMAGE;
__trace.exit("cre$.iwidget.internalutil","_getResourceType",a);return a};e._buildAbsoluteUrl=function(a){__trace.enter("cre$.iwidget.internalutil","_buildAbsoluteUrl",arguments);var b=null,b=cre$.ResourceManager.getOrigin(a)?a:0===a.indexOf("/")?cre$.ResourceManager.getOrigin(this._widgetBaseUri).concat(a):this._widgetBaseUri.concat(a);__trace.exit("cre$.iwidget.internalutil","_buildAbsoluteUrl",b);return b};e._generateIFrResources=function(a){__trace.enter("cre$.iwidget.internalutil","_generateIFrResources",
arguments);var b=0,c,d,f=[],e=a.widgetMetadata.resource;if(e&&0<e.length){c=e.length;for(b=0;b<c;b++){d=e[b];var g={scope:"widget",type:d.mimeType?this._getResourceType(d.mimeType):this._getSimpleType(d.uri),cachetype:"client",uri:this._buildAbsoluteUrl(d.uri)};q.call(d,cre$.constants.resource.resourceType.GLOBALID)&&(g.globalid=d.globalid);q.call(d,cre$.constants.resource.resourceType.SKIPLOAD)?g.skipLoad=d.skipLoad:q.call(d,"@"+cre$.constants.resource.resourceType.SKIPLOAD)&&(g.skipLoad=d["@"+cre$.constants.resource.resourceType.SKIPLOAD]);
f.push(g)}}__trace.exit("cre$.iwidget.internalutil","_generateIFrResources",f);return f};e._processSandboxPageData=function(a){__trace.enter("cre$.iwidget.internalutil","_processSandboxPageData",arguments);var b=this;getServiceManager().getService(cre$.services.EVENTSERVICE).then(function(a){var d=(b._widgetObject.siteResources||[]).concat(b._generateIFrResources(b._widgetObject)),e={userProfile:b._widgetObject.userProfile,widgetMetadata:[b._widgetObject.widgetMetadata],instanceData:[{domId:b._widgetObject.domId,
renderType:b._widgetObject.renderType,definition:b._widgetObject.definition,instanceMetaData:b._widgetObject.instanceMetaData,tokenInfo:b._widgetObject.tokenInfo,componentType:b._widgetObject.componentType}],containerToken:cre$.internalutil.getCREContainerToken()};if(d&&d.length){var h=d.length,g=/dojo(\.xd)?\.js(\W|$)/i,k,m,p=[];for(m=0;m<h;m++)(k=d[m].uri.match(g))||p.push(d[m]);e.resourceList=p}a.publishEvent(cre$.constants.event.topic.PAGE_DATA_+b.getWidgetId(),e)});__trace.exit("cre$.iwidget.internalutil",
"_processSandboxPageData")};e._sendWiresToSandbox=function(){__trace.enter("cre$.iwidget.internalutil","_sendWiresToSandbox",arguments);var a=this;getServiceManager().getService(cre$.services.EVENTSERVICE).then(function(b){var c=cre$.constants.event.topic.STUB_SYNC_WIRES+a.getWidgetId();b.publishEvent(c,a._iRuntime.getWires().wires)});__trace.exit("cre$.iwidget.internalutil","_sendWiresToSandbox")};e._handleSyncWires=function(a){__trace.enter("cre$.iwidget.internalutil","_handleSyncWires",arguments);
for(var b=0,c=a.length;b<c;b++)this._iRuntime.getWires().wires.push(a[b]);__trace.exit("cre$.iwidget.internalutil","_handleSyncWires")};e._initializeWire=function(){__trace.enter("cre$.iwidget.internalutil","_initializeWire",arguments);var a=!0,b=[],c=this._iRuntime.getWires();if(c){var d,e,h;c.registerCreateWireDelegators(this.getWidgetId(),"_createWire",this);if(this._isWrapperContext){if(this._instanceData&&this._instanceData.receivedEvents){d=this._instanceData.receivedEvents.length;for(e=0;e<
d;e++)h=this._instanceData.receivedEvents[e],c.wires.push({sourceWidget:h.sourceWidget,sourceEvent:h.sourceEvent,targetWidget:this.getWidgetId(),targetEvent:h.targetEvent})}}else{var g=this.iEvents.getEvents(),k=g.length;for(d=k;d--;)g[d].onNewWire&&c.registerNewWireCallback(this.getWidgetId(),g[d].name,g[d].onNewWire,this._iScope),g[d].onRemoveWire&&c.registerRemoveWireCallback(this.getWidgetId(),g[d].name,g[d].onRemoveWire,this._iScope);if(this._instanceData&&this._instanceData.receivedEvents)for(e=
d=this._instanceData.receivedEvents.length;e--;)h=this._instanceData.receivedEvents[e],b.push(c.createWire(h.sourceWidget,h.sourceEvent,this.getWidgetId(),h.targetEvent));this._subHandlerGlobalEvents=[];for(e=k;e--;)if(g[e].isHandled&&g[e].handlingFn){var c=g[e].handlingFn,m=null,m="function"===typeof c?c:cre$.util.hitch(this,function(a,b){this._iScope[a].call(this._iScope,b)},c);getServiceManager().getService(cre$.services.EVENTSERVICE).then(this._util.hitch(this,function(a){this._subHandlerGlobalEvents.push(a.subscribeEvent(g[e].name,
null,m))}))}}}else __logging.log("cre$.iwidget.iContext","_initializeWire",cre$.LocaleHelper.getLocalizedMessages().LOG_WIRE_NOT_INIT,null,__logging.logLevel.INFO);0<b.length&&(a=cre$.promise.whenAll.apply(cre$,b));__trace.exit("cre$.iwidget.internalutil","_initializeWire",a);return cre$.promise.when(a)};e._cleanSubscription=function(){__trace.enter("cre$.iwidget.internalutil","_cleanSubscription",arguments);if(this._subHandlerGlobalEvents)for(var a=this._subHandlerGlobalEvents.length,b=0;b<a;b++){var c=
this._subHandlerGlobalEvents[b];getServiceManager().getService(cre$.services.EVENTSERVICE).then(this._util.hitch(this,function(a){a.unsubscribeEvent(c)}))}__trace.exit("cre$.iwidget.internalutil","_cleanSubscription")};e._processIwWidget=function(a){};e._createWire=function(a,b,c,d){__trace.enter("cre$.iwidget.internalutil","_createWire",arguments);var e={};e.sourceWidget=a;e.sourceEvent=b;e.targetWidget=c;e.targetEvent=d;var h=getServiceManager().getService(cre$.services.EVENTSERVICE),g=a+"_"+b+
"_"+c+"_"+d,k=this._util.hitch(this,function(a){if(this._isWrapperContext){var b="_stub_sync_"+this.getWidgetId();a.publishEvent(b,{methodname:"_syncCreateWire",params:[e]})}else{var b="",c=this.iEvents.getEvents({name:d});1===c.length&&(b=c[0].handlingFn);var h=this,c=null,c="function"===typeof b?b:cre$.util.hitch(this,function(a,b){try{this._iScope[a].call(this._iScope,b)}catch(c){__logging.log("cre$.iwidget.iContext","eventCallback",cre$.LocaleHelper.getLocalizedMessages().ERR_ISCOPE_METHOD_NOT_DEFINED)}},
b);cre$.iRuntime.inIFrame?a.subscribeEvent(g,this,c,function(a){e.wireId=a;h._iRuntime.getWires().updateWire(e)}):e.wireId=a.subscribeEvent(g,this,c)}return e}),h=h.then(k);__trace.exit("cre$.iwidget.internalutil","_createWire",h);return h};e._invokeQueuedEvent=function(){__trace.enter("cre$.iwidget.internalutil","_invokeQueuedEvent",arguments);var a=this._iRuntime.getWires()._queuedEvents,b=a.length,c=this,d,e,h=function(a,b){var d=c.iEvents.getEvents({name:a});1===d.length&&(d=d[0].handlingFn,"function"===
typeof d?d(b):c._iScope[d]&&c._iScope[d].call(c._iScope,b))};if(this._instanceData&&this._instanceData.receivedEvents){var g=this._instanceData.receivedEvents.length;for(e=0;e<g;e++){var k=this._instanceData.receivedEvents[e];for(d=0;d<b;d++)if(a[d].widgetId===k.sourceWidget&&a[d].eventId===k.sourceEvent){var m={};m.name=k.targetEvent;m.payload=a[d].payload.payload;m.type=a[d].payload.payloadType;m.source=k.sourceWidget;h(k.targetEvent,m)}}}for(d=0;d<b;d++)"broadcast"===a[d].widgetId&&h(a[d].eventId,
{name:a[d].eventId,payload:a[d].payload.payload,type:a[d].payload.payloadType});__trace.exit("cre$.iwidget.internalutil","_invokeQueuedEvent")};e.clearCookies=function(a){__trace.enter("cre$.iwidget.internalutil","clearCookies",arguments);if(cre$.util.isArray(a))for(var b=0;b<a.length;b++)e.clearCookie(a[b]);else e.clearCookie(a);__trace.exit("cre$.iwidget.internalutil","clearCookies")};e.clearCookie=function(a){__trace.enter("cre$.iwidget.internalutil","clearCookie",arguments);a.value="";a.expires=
new Date(0);e.setCookie(a);__trace.exit("cre$.iwidget.internalutil","clearCookie")};e.getDomainAndPath=function(a){__trace.enter("cre$.iwidget.internalutil","getDomainAndPath",arguments);var b=cre$.iRuntime.getProxyUrl().replace("%host%",document.location.host),b=shindig.uri(b),c=b.getPath()+"/"+a;b.setPath(c);b=b.toString();c=shindig.uri().removePrefix(b);0<c.indexOf("/")?(b=c.substring(0,c.indexOf("/")),c=c.substring(c.indexOf("/"),c.indexOf("?"))):(b=c,c="/");0<b.indexOf(":")&&(b=b.substring(0,
b.indexOf(":")));__trace.exit("cre$.iwidget.internalutil","getDomainAndPath");return{domain:b,path:c}};e.setCookies=function(a){__trace.enter("cre$.iwidget.internalutil","setCookies",arguments);if(cre$.util.isArray(a))for(var b=0;b<a.length;b++)e.setCookie(a[b]);else e.setCookie(a);__trace.exit("cre$.iwidget.internalutil","setCookies")};e.setCookie=function(a){__trace.enter("cre$.iwidget.internalutil","setCookie",arguments);var b=a.name+"\x3d"+a.value+";domain\x3d"+a.domain+";path\x3d"+a.path;a.expires&&
(b+=";expires\x3d"+a.expires);document.cookie=b;__trace.exit("cre$.iwidget.internalutil","setCookie")};e.isUseProxy=function(a){return 0<a.indexOf("/common/proxy?")||0<a.indexOf("%2Fcommon%2Fproxy%3F")};e.constants={mode:{VIEW:cre$.constants.mode.VIEW,EDIT:cre$.constants.mode.EDIT,PERSONALIZE:cre$.constants.mode.PERSONALIZE,CONFIG:cre$.constants.mode.CONFIG,HELP:cre$.constants.mode.HELP},event:{TITLE:cre$.constants.event.TITLE,DESCRIPTION:cre$.constants.event.DESCRIPTION},ATTRIBUTES:cre$.constants.itemSet.ATTRIBUTES,
IDESCRIPTOR:cre$.constants.itemSet.IDESCRIPTOR,USERPROFILE:"userProfile",keys:{SHIFT:cre$.constants.keys.SHIFT,ALT:cre$.constants.keys.ALT,CTRL:cre$.constants.keys.CTRL,META:cre$.constants.keys.META,CAPSLOCK:cre$.constants.keys.CAPSLOCK},windowstate:{NORMAL:cre$.constants.windowstate.NORMAL,MINIMIZE:cre$.constants.windowstate.MINIMIZE,MAXIMIZE:cre$.constants.windowstate.MAXIMIZE},status:{SUCCESS:cre$.constants.status.SUCCESS,TIMEOUT:cre$.constants.status.TIMEOUT,NOTFOUND:cre$.constants.status.NOTFOUND,
INTERROR:cre$.constants.status.INTERROR,OTHER:cre$.constants.status.OTHER},changeType:{CHANGEDVALUE:cre$.constants.changeType.CHANGED_VALUE,NEWITEM:cre$.constants.changeType.NEW_ITEM,REMOVEDITEM:cre$.constants.changeType.REMOVED_ITEM},predefinedEvents:{onLoad:cre$.constants.predefinedEvents.onLoad,onUnLoad:cre$.constants.predefinedEvents.onUnLoad,onModeChanged:cre$.constants.predefinedEvents.onModeChanged,onWindowStateChanged:cre$.constants.predefinedEvents.onWindowStateChanged,onSizeChanged:cre$.constants.predefinedEvents.onSizeChanged,
onNavStateChanged:cre$.constants.predefinedEvents.onNavStateChanged,onItemSetChanged:cre$.constants.predefinedEvents.onItemSetChanged,onRefreshNeeded:cre$.constants.predefinedEvents.onRefreshNeeded,onNewWire:cre$.constants.predefinedEvents.onNewWire,onRemoveWire:cre$.constants.predefinedEvents.onRemoveWire,onIncompleteEventDescription:cre$.constants.predefinedEvents.onIncompleteEventDescription}}})();cre$.iwidget.iContext=function(b,c){this._canNavigateAway=!0;this._widgetObject=b;this._metadata=b.widgetMetadata;this._instanceData=b.instanceMetaData;this._loadInstanceData=b.loadInstanceData;this._iRuntime=cre$.iRuntime;this._util=cre$.util;this._isWrapperContext=!(cre$.iRuntime.inIFrame||this._widgetObject.renderType===cre$.constants.renderType.INLINE);this._widgetBaseUri=b.widgetMetadata.definitionUrl;var a=this._widgetBaseUri.lastIndexOf("/");this._widgetBaseUri=-1===a?"":this._widgetBaseUri.substring(0,
a+1);this._rootElement=c;this._hubContainer=null;this._tokenInfo=b.tokenInfo;this._subHandlers=[];this._proxyCookiePath=this._proxyCookieDomain=null;var d=this,a=cre$.iRuntime.getProxyUrl().replace("%host%",document.location.host),a=shindig.uri(a),e=a.getPath()+"/"+this._instanceData.moduleId;a.setPath(e);a=a.toString();a=shindig.uri().removePrefix(a);0<a.indexOf("/")?(this._proxyCookieDomain=a.substring(0,a.indexOf("/")),this._proxyCookiePath=a.substring(a.indexOf("/"),a.indexOf("?"))):(this._proxyCookieDomain=
a,this._proxyCookiePath="/");0<this._proxyCookieDomain.indexOf(":")&&(this._proxyCookieDomain=this._proxyCookieDomain.substring(0,this._proxyCookieDomain.indexOf(":")));if(b.renderType===cre$.constants.renderType.SANDBOX){a=new Date;a.setTime(a.getTime()+this._tokenInfo.expireTimeMs);var e=[],f={name:"st",value:this._tokenInfo.token,domain:this._proxyCookieDomain,path:this._proxyCookiePath,expires:a};e.push(f);f={name:"widgetid",value:this._instanceData.moduleId,domain:this._proxyCookieDomain,path:this._proxyCookiePath,
expires:a};e.push(f);cre$.iwidget.internalutil.setCookies(e)}a=function(a){d._tokenInfo.expireTimeMs=a.expireTimeMs;d._tokenInfo.token=a.token;d._isWrapperContext||(document.cookie="st\x3d"+d._tokenInfo.token+";domain\x3d"+d._proxyCookieDomain+";path\x3d"+d._proxyCookiePath)};e=function(a){d._tokenRefreshTimer=a};this._tokenInfo.needsTokenRefresh&&cre$.util.scheduleTokenRefresher(this._tokenInfo.token,"widget",a,e)};
cre$.iwidget.iContext.prototype._createiScopeObject=function(b,c){__trace.enter("cre$.iwidget.iContext","_createiScopeObject",arguments);b._iScope={};var a=b._metadata.iScope,d=b._widgetObject.widgetMetadata["cre_ns-sep_iScopeType"];if(a)try{if(d)getServiceManager().getService(cre$.constants.iWidget.ISCOPESERVICE,!0).then(function(e){e.makeInstance(d,a).then(function(a){b._iScope=a;b._iScope.iContext=b;c.resolve()},function(a){__logging.log("cre$.iwidget.iContext","init",cre$.LocaleHelper.getLocalizedMessages().ERR_CREATE_ISCOPE);
b._iScope.iContext=b;c.resolve()})});else{if(-1!=a.indexOf("(")){var e=eval(a);b._iScope=new e}else{var f=b._util.getObject(a,!0);b._iScope="function"===typeof f?new f:b._util.mixin(b._util.mixin(b._iScope,f),f.prototype)}b._iScope.iContext=b;c.resolve()}}catch(g){__logging.log("cre$.iwidget.iContext","init",cre$.LocaleHelper.getLocalizedMessages().ERR_CREATE_ISCOPE),b._iScope.iContext=b,c.resolve()}else __logging.log("cre$.iwidget.iContext","init",cre$.LocaleHelper.getLocalizedMessages().ERR_CREATE_ISCOPE),
b._iScope.iContext=b,c.resolve();__trace.exit("cre$.iwidget.iContext","_createiScopeObject")};
cre$.iwidget.iContext.prototype._determineInitialMode=function(b){__trace.enter("cre$.iwidget.iContext","_determineInitialMode",arguments);var c;if("undefined"!==typeof b._instanceData&&null!==b._instanceData&&"undefined"!==typeof b._instanceData.itemSet&&null!==b._instanceData.itemSet)for(var a=b._instanceData.itemSet,d=a.length;d--;){var e=a[d];if("idescriptor"==e.id){if(e.item){a=e.item;for(d=a.length;d--;)if(e=a[d],"mode"==e.id){c=e.value;break}}break}}var f;if("undefined"!==typeof b._loadInstanceData&&
null!==b._loadInstanceData&&"undefined"!==typeof b._loadInstanceData.itemSet&&null!==b._loadInstanceData.itemSet){a=b._loadInstanceData.itemSet;for(d=a.length;d--;)if(e=a[d],"idescriptor"==e.id){if(e.item){a=e.item;for(d=a.length;d--;)if(e=a[d],"mode"==e.id){f=e.value;break}}break}}c=f||c||b._metadata.mode||b.constants.mode.VIEW;__trace.exit("cre$.iwidget.iContext","_determineInitialMode",c);return c};cre$.iwidget.iContext.prototype._subscribeEvent=function(b,c,a,d){return c.subscribeEvent(a,b,d)};
cre$.iwidget.iContext.prototype.init=function(){__trace.enter("cre$.iwidget.iContext","init",arguments);__trace.msg("cre$.iwidget.iContext","init","Widget URI: ${0}",[this._widgetObject.widgetMetadata.definitionUrl]);var b=new cre$.promise.Promise("init");if(this._rootElement){var c="_"+this.getWidgetId()+"_iContext",a=window[c]=this,c=new cre$.promise.Promise("iscopePromise");this.widgetId=this.getWidgetId();this._isWrapperContext?c.resolve():this._createiScopeObject(a,c);c.then(function(){a._mode=
a._determineInitialMode(a);a.iEvents=new a.iEventsWrapper(a.widgetId);a.widget=new cre$.iwidget.widgetWrapper(a,a._widgetObject);a.io=new a.io(a,a._widgetBaseUri);a._initializeWire().then(function(b){a._iRuntime.registerWireLoadedCallbacks({id:a.widgetId,callback:"_initializeWire",object:a});return getServiceManager().getService(cre$.services.EVENTSERVICE)}).then(function(c){try{if(a._isWrapperContext){a._initPromise=b;a.getiDescriptor()._setItemValue(cre$.iwidget.iDescriptor.prototype.iDescriptorItems.mode,
a._mode);var e=a._getIframeUrl();a._hubContainer=cre$.oah.managedHub.createIframeHubContainer(a._instanceData.moduleId,e,a._rootElement,a.getiDescriptor().getItemValue("defaultWidth"),a.getiDescriptor().getItemValue("defaultHeight"));a._subHandlers.push(a._subscribeEvent(a,c,"sync_"+a.getWidgetId(),a._handleEvent));a._subHandlers.push(a._subscribeEvent(a,c,"request_pagedata_"+a.getWidgetId(),a._processSandboxPageData));a._subHandlers.push(a._subscribeEvent(a,c,"request_wires_"+a.getWidgetId(),a._sendWiresToSandbox));
a._iRuntime.getWires()&&a._invokeQueuedEvent()}else{var f=a._getMarkupByMode(a._mode);__trace.msg("cre$.iwidget.iContext","init","Mode: ${0}; Markup: ${1}",[a._mode,f]);var g=document.createElement("div");g.innerHTML=f;g.className=a._instanceData.moduleId+" Content "+a._mode;a._rootElement.appendChild(g);__trace.msg("cre$.iwidget.iContext","init","_processScripts: ${0}",[g]);a._processScripts(g);var l=cre$.constants.iDescriptorItems,h=a.getiDescriptor(),m=h?h.getItemValue(l.DEFAULTWIDTH):void 0,n=
h?h.getItemValue(l.DEFAULTHEIGHT):void 0;__trace.msg("cre$.iwidget.iContext","init","iDesc: ${0}; defWidth: ${1}; defHeight: ${1}",[h,m,n]);m&&(a._rootElement.style.width=m);n&&(a._rootElement.style.height=n);h._setItemValue(l.MODE,a._mode);var k=a._iScope;__trace.msg("cre$.iwidget.iContext","init","iScope instance: ${0}",[k]);if(k){__trace.msg("cre$.iwidget.iContext","init","_widgetObject: ${0}",[a._widgetObject]);__trace.msg("cre$.iwidget.iContext","init","metadata: ${0}",[a._widgetObject.widgetMetadata]);
__trace.msg("cre$.iwidget.iContext","init","this._metadata: ${0}",[a._metadata]);__trace.msg("cre$.iwidget.iContext","init","Calling onLoad for: ${0}",[a._widgetObject.widgetMetadata.definitionUrl]);__trace.msg("cre$.iwidget.iContext","init","lookup \x3d\x3e ${0}",[k.onLoad]);if(k.onLoad&&"function"===typeof k.onLoad)try{k.onLoad()}catch(p){console.log("iContext","init",a.widgetId+" had an exception in its onLoad handler:\n"+p)}else __trace.msg("cre$.iwidget.iContext","init","${0} had no handler for onLoad (${1})",
[a.widgetId,a._widgetObject.widgetMetadata.definitionUrl]);a.widget._invokeOnModeMethod(a._mode)}cre$.iRuntime.inIFrame&&(a._subscribeEvent(a,c,"_stub_sync_"+a.getWidgetId(),a._handleEvent),a._subscribeEvent(a,c,"broadcast_shareableitemset_change",a._handleEvent),a._subscribeEvent(a,c,"broadcast_wires_change",a._handleEvent),a._subscribeEvent(a,c,"_stub_sync_wires_"+a.getWidgetId(),a._handleEvent),c.publishEvent("request_wires_"+a.getWidgetId()));a._iRuntime.getWires()&&a._invokeQueuedEvent();a._iRuntime.getWidgets()[a.widgetId]=
a.widget;cre$.iRuntime.inIFrame&&c.publishEvent("sync_"+a.widgetId,{methodname:"_resolveInitPromise"});b.resolve()}}catch(q){b.reject(q)}})},function(a){__logging.log("cre$.iwidget.iContext","init",cre$.LocaleHelper.getLocalizedMessages().ERR_CREATE_ISCOPE+": "+a)})}else b.reject(cre$.LocaleHelper.getLocalizedMessages().ERR_IS_NULL_UNDEFINED+" _RootElement");__trace.exit("cre$.iwidget.iContext","init",b);return b};cre$.util.mixin(cre$.iwidget.iContext.prototype,cre$.iwidget.internalutil);
cre$.iwidget.iContext.prototype.getiWidgetAttributes=function(){__trace.enter("cre$.iwidget.iContext","getiWidgetAttributes",arguments);if(!this._attributes){var b=this._iRuntime.getStateSet(this._instanceData.moduleId,this.constants.ATTRIBUTES,{});this._attributes=new cre$.iwidget.ManagedItemSet(b,this);this._attributes._iContext=this}__trace.exit("cre$.iwidget.iContext","getiWidgetAttributes",this._attributes);return this._attributes};
cre$.iwidget.iContext.prototype.getUserProfile=function(){__trace.enter("cre$.iwidget.iContext","getUserProfile",arguments);if(!this._userProfile){var b=this._iRuntime.getStateSet(this._instanceData.moduleId,this.constants.USERPROFILE,{});this._userProfile=new cre$.iwidget.UserProfile(this._instanceData.moduleId,b);this._userProfile._iContext=this}__trace.exit("cre$.iwidget.iContext","getUserProfile",this._userProfile);return this._userProfile};
cre$.iwidget.iContext.prototype.getiDescriptor=function(){__trace.enter("cre$.iwidget.iContext","getiDescriptor",arguments);if(!this._iDescriptor){var b=this._iRuntime.getStateSet(this._instanceData.moduleId,this.constants.IDESCRIPTOR,{});this._iDescriptor=new cre$.iwidget.iDescriptor(this._widgetObject,b);this._iDescriptor._iContext=this}__trace.exit("cre$.iwidget.iContext","getiDescriptor",this._iDescriptor);return this._iDescriptor};
cre$.iwidget.iContext.prototype.changeMode=function(b){__trace.enter("cre$.iwidget.iContext","changeMode",arguments);if(b!==this._mode){var c=this.getiDescriptor();c.setItemValue(c.iDescriptorItems.mode,b)}__trace.exit("cre$.iwidget.iContext","changeMode",this.mode)};
cre$.iwidget.iContext.prototype.getItemSet=function(b,c){__trace.enter("cre$.iwidget.iContext","getItemSet",arguments);if(!this._itemSets){var a=this;cre$.iRuntime.loadFeatures(["cre.iwidget.itemset"],!0).then(function(){a._itemSets={}},function(){__logging.log("cre$.iwidget.iContext","getItemSet",cre$.LocaleHelper.getLocalizedMessages().ERR_LOAD_ITEMSET_SRC)})}if(!this._itemSets[b]){var d=this._iRuntime.getStateSet(this._instanceData.moduleId,b,{}),d=new cre$.iwidget.ItemSet(d);this._itemSets[b]=
d}try{console.log("Invalid variable for exit tracing: this._itemSets[name]")}catch(e){console.log("Error tracing an invalid trace statement.",e)}return this._itemSets[b]};
cre$.iwidget.iContext.prototype.getShareableItemSet=function(b){__trace.enter("cre$.iwidget.iContext","getShareableItemSet",arguments);if(!this._shareableItemSets){var c=this;cre$.iRuntime.loadFeatures(["cre.iwidget.itemset"],!0).then(function(){c._shareableItemSets={}},function(){__logging.log("cre$.iwidget.iContext","getShareableItemSet",cre$.LocaleHelper.getLocalizedMessages().ERR_LOAD_ITEMSET_SRC)})}this._shareableItemSets[b]||(this._shareableItemSets[b]=this._getShareableItemSet(b));try{console.log("Invalid variable for exit tracing: this._shareableItemSets[name]")}catch(a){console.log("Error tracing an invalid trace statement.",
a)}return this._shareableItemSets[b]};cre$.iwidget.iContext.prototype._getShareableItemSet=function(b){__trace.enter("cre$.iwidget.iContext","_getShareableItemSet",arguments);var c=this._iRuntime.getShareableStateSet(this._instanceData.moduleId,b),a=null,a=c?c.alias?this._iRuntime.getGlobalShareableStateSet(c.alias):c:this._iRuntime.getGlobalShareableStateSet(b),c=new cre$.iwidget.ShareableItemSet(this,a,c,b);__trace.exit("cre$.iwidget.iContext","_getShareableItemSet",c);return c};
cre$.iwidget.iContext.prototype.getWidgetId=function(){return this._instanceData.moduleId};cre$.iwidget.iContext.prototype.iScope=function(){return this._iScope};cre$.iwidget.iContext.prototype.processMarkup=function(b){__trace.enter("cre$.iwidget.iContext","processMarkup",arguments);var c=b.replace(/_IWID_/g,"_"+this.getWidgetId()+"_").replace(/iContext(?=\.|\s|\(|\))/g,"_"+this.getWidgetId()+"_iContext");__trace.exit("cre$.iwidget.iContext","processMarkup",c);return c};
function _handleChildWidgets(b,c){__trace.enter("cre$.iwidget.iContext","_handleChildWidgets",arguments);var a=b.length,d=cre$.iRuntime.getWidgetById(c);d.childrenIds||(d.childrenIds=[]);for(;a--;)b[a].widgetObject.state!=cre$.constants.state.ERROR&&(b[a].widgetObject.parentId=c,d.childrenIds.push(b[a].widgetObject.instanceMetaData.moduleId));__trace.exit("cre$.iwidget.iContext","_handleChildWidgets")}
cre$.iwidget.iContext.prototype.processiWidgets=function(b){__trace.enter("cre$.iwidget.iContext","processiWidgets",arguments);var c=!0;if(b){var a=cre$.internalutil.getElementsByClass(b,cre$.constants.others.IW_IWIDGET);if(0<(b?a.length:0))var d=this,c=this._iRuntime.loadWidgets([b]).then(function(a){_handleChildWidgets(a,d.getWidgetId())},function(a){_handleChildWidgets(a,d.getWidgetId())})}__trace.exit("cre$.iwidget.iContext","processiWidgets",c);return cre$.promise.when(c)};
cre$.iwidget.iContext.prototype.getElementById=function(b){__trace.enter("cre$.iwidget.iContext","getElementById",arguments);var c=cre$.internalutil.getElementsByClass(this._rootElement,this._mode),a=null;if(null!==c&&0<c.length)for(var c=c[0].getElementsByTagName("*"),d=c.length,e=0;e<d;e++)if(c[e].id===b){a=c[e];break}__trace.exit("cre$.iwidget.iContext","getElementById",a);return a};
cre$.iwidget.iContext.prototype.getElementByClass=function(b){return cre$.internalutil.getElementsByClass(this._rootElement,b)};cre$.iwidget.iContext.prototype.getRootElement=function(){return this._rootElement};cre$.iwidget.iContext.prototype.removeRootElement=function(){__trace.enter("cre$.iwidget.iContext","removeRootElement",arguments);if(this._rootElement)for(var b=this._rootElement.childNodes,c=b.length-1;0<=c;c--)this._rootElement.removeChild(b[c]);__trace.exit("cre$.iwidget.iContext","removeRootElement")};
cre$.iwidget.iContext.prototype.requires=function(b,c,a,d,e){};
cre$.iwidget.iContext.prototype.canNavigateAway=function(){__trace.enter("cre$.iwidget.iContext","canNavigateAway",arguments);if(this._iScope&&this._iScope.onUnload)try{this._iScope.onUnload()}catch(b){console.log("iContext","canNavigateAway",this.widgetId+" had an exception in its onUnload handler:\n"+b)}cre$.util.unscheduleTokenRefresher(this._tokenRefreshTimer);__trace.exit("cre$.iwidget.iContext","canNavigateAway",this._canNavigateAway);return this._canNavigateAway};
cre$.iwidget.iContext.prototype.getNapromise=function(){__trace.enter("cre$.iwidget.iContext","getNapromise",arguments);this._naPromise=new cre$.promise.Promise("getNapromise");if(this._isWrapperContext){var b="_stub_sync_"+this.getWidgetId();getServiceManager().getService(cre$.services.EVENTSERVICE).then(function(a){a.publishEvent(b,{methodname:"_inframeNapromise",params:[void 0]})})}else{if(this._iScope&&this._iScope.onUnload)try{this._iScope.onUnload()}catch(c){console.log("iContext","canNavigateAway",
this.widgetId+" had an exception in its onUnload handler:\n"+c)}this._tokenRefreshTimer&&cre$.util.unscheduleTokenRefresher(this._tokenRefreshTimer);this._canNavigateAway?this._naPromise.resolve(!0):this._naPromise.reject(!1)}__trace.exit("cre$.iwidget.iContext","getNapromise",this._naPromise);return this._naPromise};
cre$.iwidget.iContext.prototype._inframeNapromise=function(){__trace.enter("cre$.iwidget.iContext","_inframeNapromise",arguments);if(this._iScope&&this._iScope.onUnload)try{this._iScope.onUnload()}catch(b){console.log("iContext","getNapromise",this.widgetId+" had an exception in its onUnload handler:\n"+b)}this._tokenRefreshTimer&&cre$.util.unscheduleTokenRefresher(this._tokenRefreshTimer);var c="sync_"+this.getWidgetId(),a=getServiceManager().getService(cre$.services.EVENTSERVICE),d=[cre$.util.clone(this._canNavigateAway)];
a.then(function(a){a.publishEvent(c,{methodname:"_wrapperNapromise",params:d})});__trace.exit("cre$.iwidget.iContext","_inframeNapromise")};cre$.iwidget.iContext.prototype._wrapperNapromise=function(b){__trace.enter("cre$.iwidget.iContext","_wrapperNapromise",arguments);(this._canNavigateAway=b)?this._naPromise.resolve(!0):this._naPromise.reject(!1);__trace.exit("cre$.iwidget.iContext","_wrapperNapromise",this._canNavigateAway)};
cre$.iwidget.iContext.prototype._resolveInitPromise=function(){__trace.enter("cre$.iwidget.iContext","_resolveInitPromise",arguments);this._iRuntime.getWidgets()[this.widgetId]=this.widget;this._initPromise.resolve();__trace.exit("cre$.iwidget.iContext","_resolveInitPromise",this.widgetId)};cre$.iwidget.iContext.prototype.cancelNavigateAway=function(){__trace.enter("cre$.iwidget.iContext","cancelNavigateAway",arguments);this._canNavigateAway=!1;__trace.exit("cre$.iwidget.iContext","cancelNavigateAway")};
cre$.iwidget.iContext.prototype.enableNavigateAway=function(){__trace.enter("cre$.iwidget.iContext","enableNavigateAway",arguments);this._canNavigateAway=!0;__trace.exit("cre$.iwidget.iContext","enableNavigateAway")};
cre$.iwidget.iContext.prototype._initiEvents=function(){__trace.enter("cre$.iwidget.iContext","_initiEvents",arguments);if(!this._iEvents){var b=this;cre$.iRuntime.loadFeatures(["cre.iwidget.event"],!0).then(function(){b._iEvents=new cre$.iwidget.iEvents(b.widget,b.getWidgetId())},function(){__logging.log("cre$.iwidget.iContext","_initiEvents",cre$.LocaleHelper.getLocalizedMessages().ERR_LOAD_EVENT_SRC)})}__trace.exit("cre$.iwidget.iContext","_initiEvents")};
cre$.iwidget.iContext.prototype.iEventsWrapper=function(b){__trace.enter("cre$.iwidget.iContext","iEventsWrapper",arguments);this.widgetObjName="_"+b+"_iContext";this.esp=getServiceManager().getService(cre$.services.EVENTSERVICE);this.syncTopic="sync_"+b;__trace.exit("cre$.iwidget.iContext","iEventsWrapper")};
cre$.iwidget.iContext.prototype.iEventsWrapper.prototype={fireEvent:function(b,c,a){__trace.enter("cre$.iwidget.iContext","fireEvent",arguments);if("string"===typeof a){var d=cre$.internalutil.parseToJson(a);!1!==d&&(a=d)}window[this.widgetObjName]._initiEvents();0<this.getEvents({name:b}).length?window[this.widgetObjName]._iEvents.fireEvent(b,c,a):window[this.widgetObjName].widget.handleEvent(b,c,a)||window[this.widgetObjName]._iEvents.fireEvent(b,c,a);__trace.exit("cre$.iwidget.iContext","fireEvent")},
setEvent:function(b){__trace.enter("cre$.iwidget.iContext","setEvent",arguments);window[this.widgetObjName]._initiEvents();var c=!1;if(window[this.widgetObjName]._iEvents.setEvent(b)){if(!window[this.widgetObjName]._isWrapperContext){var a=this;this.esp.then(function(c){c.publishEvent(a.syncTopic,{methodname:"_syncCreateEvent",params:[b]})})}c=!0}__trace.exit("cre$.iwidget.iContext","setEvent",c);return c},setEvents:function(b){window[this.widgetObjName]._initiEvents();var c=!1;if(window[this.widgetObjName]._iEvents.setEvents(b)){if(!window[this.widgetObjName]._isWrapperContext){var a=
this;this.esp.then(function(c){c.publishEvent(a.syncTopic,{methodname:"_syncCreateEvents",params:[b]})})}c=!0}__trace.exit("cre$.iwidget.iContext",null,c);return c},removeEvent:function(b){__trace.enter("cre$.iwidget.iContext","removeEvent",arguments);window[this.widgetObjName]._initiEvents();var c=!1;if(window[this.widgetObjName]._iEvents.removeEvent(b)){if(!window[this.widgetObjName]._isWrapperContext){var a=this;this.esp.then(function(c){c.publishEvent(a.syncTopic,{methodname:"_syncRemoveEvent",
params:[b]})})}c=!0}__trace.exit("cre$.iwidget.iContext","removeEvent",c);return c},removeEvents:function(b){__trace.enter("cre$.iwidget.iContext","removeEvents",arguments);window[this.widgetObjName]._initiEvents();var c=!1;if(window[this.widgetObjName]._iEvents.removeEvents(b)){if(!window[this.widgetObjName]._isWrapperContext){var a=this;this.esp.then(function(c){c.publishEvent(a.syncTopic,{methodname:"_syncRemoveEvents",params:[b]})})}c=!0}__trace.exit("cre$.iwidget.iContext","removeEvents",c);
return c},getEvents:function(b){__trace.enter("cre$.iwidget.iContext","getEvents",arguments);window[this.widgetObjName]._initiEvents();var c=window[this.widgetObjName]._iEvents.getEvents(b);__trace.exit("cre$.iwidget.iContext","getEvents",c);return c},createEventDescription:function(b){__trace.enter("cre$.iwidget.iContext","createEventDescription",arguments);window[this.widgetObjName]._initiEvents();var c=window[this.widgetObjName]._iEvents.createEventDescription(b);__trace.exit("cre$.iwidget.iContext",
"createEventDescription",c);return c},publishEvent:function(b,c,a){__trace.enter("cre$.iwidget.iContext","publishEvent",arguments);window[this.widgetObjName]._initiEvents();window[this.widgetObjName]._iEvents.publishEvent(b,c,a);__trace.exit("cre$.iwidget.iContext","publishEvent")},_getDynamicEvents:function(){__trace.enter("cre$.iwidget.iContext","_getDynamicEvents",arguments);window[this.widgetObjName]._initiEvents();return window[this.widgetObjName]._iEvents._getDynamicEvents()}};
cre$.iwidget.iContext.prototype.io=function(b,c){__trace.enter("cre$.iwidget.iContext",".io",arguments);this._iContext=b;this._widgetBaseUri=c;__trace.exit("cre$.iwidget.iContext",".io")};
cre$.iwidget.iContext.prototype.io.prototype={XMLHttpRequest:function(){__trace.enter("cre$.iwidget.iContext",".io.XMLHttpRequest",arguments);__trace.exit("cre$.iwidget.iContext",".io.XMLHttpRequest");return cre$.xhr.makeXhr()},rewriteURI:function(b,c){__trace.enter("cre$.iwidget.iContext",".io.rewriteURI",arguments);var a=cre$.ResourceManager.makeProxyUrl(b,{isXhr:c,widgetBaseUri:this._widgetBaseUri});if(cre$.iwidget.internalutil.isUseProxy(a)){var d=new Date;d.setTime(d.getTime()+this._iContext._tokenInfo.expireTimeMs);
var e=[],f={name:"st",value:this._iContext._tokenInfo.token,domain:this._iContext._proxyCookieDomain,path:this._iContext._proxyCookiePath,expires:d.toGMTString()};e.push(f);f={name:"widgetid",value:this._iContext._instanceData.moduleId,domain:this._iContext._proxyCookieDomain,path:this._iContext._proxyCookiePath,expires:d.toGMTString()};e.push(f);cre$.iwidget.internalutil.setCookies(e)}if(-1===b.indexOf(":/"))return cre$.iwidget.internalutil.isUseProxy(a)&&(a=shindig.uri(a),d=a.getPath()+"/"+this._iContext._instanceData.moduleId,
a.setPath(d),a=a.toString()),__trace.exit("cre$.iwidget.iContext",".io.rewriteURI",a),a;__trace.exit("cre$.iwidget.iContext",".io.rewriteURI",a);return cre$.util.applyTokenToUrl(a,this._iContext._tokenInfo.token,this._iContext._instanceData.moduleId)},request:function(b,c,a,d,e){__trace.enter("cre$.iwidget.iContext",".io.request",arguments);var f={requestVerb:b,url:c,handleAs:"text",sync:a?!1:!0,handle:a,msgData:d,headers:cre$.util.mixin({},e)};__trace.exit("cre$.iwidget.iContext",".io.request",f);
return this.xhrReq(f)},xhrReq:function(b){__trace.enter("cre$.iwidget.iContext",".io.xhrReq",arguments);var c=cre$.constants.request;b.requestVerb=b.requestVerb.toUpperCase();if(b.requestVerb!=(c.method.GET||c.method.PUT||c.method.POST||c.method.DELETE))b.requestVerb=c.method.GET;b.url=cre$.util.applyTokenToUrl(b.url,this._iContext._tokenInfo.token);var a=null;if(b.headers)for(var d=b.headers.length;d--;){var e=b.headers[d];if(e.headerName===c.header.CONTENT_TYPE){a=e.value;break}}if(b.content){b.url+=
"?";for(var f in b.content)b.url+=f+"\x3d"+b.content[f]+"\x26";b.url=b.url.slice(0,b.url.length-1)}b.preventCache&&!0===b.preventCache&&(b.url=b.content?b.url+("\x26preventCache\x3d"+(new Date).getTime()):b.url+("?preventCache\x3d"+(new Date).getTime()));c=cre$.xhr.xhr(b.requestVerb,{url:b.url,headers:{"X-Shindig-ST":this._iContext._tokenInfo.token},paramData:b.msgData,contentType:a,sync:b.sync,timeout:b.timeout,user:b.user,password:b.password,form:b.form});b.handle&&c.then(function(a){b.handle(a.xhr,
b)},function(a){b.handle(a.xhr,b)});b.load&&c.then(function(a){b.load(a.xhr,b)},null);b.error&&c.then(null,function(a){b.error(a.xhr,b)});__trace.exit("cre$.iwidget.iContext",".io.xhrReq",c);return c.xhr}};cre$.iwidget.iContext.prototype.xml={};cre$.iwidget.widgetWrapper=function(b,d){__trace.enter("cre$.iwidget.widgetWrapper","constructor method",arguments);this._iContext=b;this._widgetObject=d;this._metadata=d.widgetMetadata;this._instanceData=d.instanceMetaData;this._rootElement=this._iContext._rootElement;this._windowManager={};__trace.exit("cre$.iwidget.widgetWrapper","constructor method")};
cre$.iwidget.widgetWrapper.prototype={handleEvent:function(b,d,c){__trace.enter("cre$.iwidget.widgetWrapper","handleEvent",arguments);var a=!1;"undefined"!==typeof b&&null!=b&&(b===this._iContext.constants.predefinedEvents.onModeChanged?a=this._handleModeChange(c.newMode):c&&c.newMode&&this._isOnModeEvent(b,d,c)?(this._invokeOnModeMethod(c.newMode),a=!0):a=this._handleEventInternal(b,d,c));__trace.exit("cre$.iwidget.widgetWrapper","handleEvent",a);return a},_isOnModeEvent:function(b,d,c){__trace.enter("cre$.iwidget.widgetWrapper",
"_isOnModeEvent",arguments);var a=!1;0===b.indexOf("on")&&this._isSupportedMode(c.newMode)&&(a=!0);__trace.exit("cre$.iwidget.widgetWrapper","_isOnModeEvent",a);return a},_isSupportedMode:function(b){__trace.enter("cre$.iwidget.widgetWrapper","_isSupportedMode",arguments);if("undefined"===typeof this._supportedModes||null===this._supportedModes)this._supportedModes=this._metadata.supportedModes?this._metadata.supportedModes.split(" "):["view"];var d=cre$.internalutil.contains(this._supportedModes,
b);__trace.exit("cre$.iwidget.widgetWrapper","_isSupportedMode");return d},_handleModeChange:function(b,d){__trace.enter("cre$.iwidget.widgetWrapper","_handleModeChange",arguments);var c=!1,a=null;if(null===d||"undefined"===typeof d)d=this._iContext.getiDescriptor().getItemValue(cre$.iwidget.iDescriptor.prototype.iDescriptorItems.mode);if(null===b||"undefined"===typeof b||null!==b&&b===d)return __trace.exit("cre$.iwidget.widgetWrapper","_handleModeChange",!1),!1;var e=this._metadata.defaultMode;e||
(e=this._iContext.constants.mode.View);var a=this._windowManager[b]||null,f=null,e=!1;"undefined"!==typeof a&&null!==a&&(a=a.root,null!==a&&(f=a,c=e=!0,a.style.display=""));if(!e){if(null===f||"undefined"===typeof f)c=document.createElement("div"),c.className=this._instanceData.moduleId+"Content "+b,this._rootElement.appendChild(c),f=this._rootElement.lastChild;c=this._updateMarkup(b,f)}if(c){var g=this._windowManager[d];null===g||"undefined"===typeof g?(a=cre$.internalutil.getElementsByClass(this._rootElement,
d),null!==a&&0<a.length&&(a=a[0],this._windowManager[d]={id:d,root:a,active:!1},a.style.display="none")):(a=g.root,g.active=!1,a.style.display="none");this._iContext._mode=b;this._iContext.getiDescriptor()._setItemValue(cre$.iwidget.iDescriptor.prototype.iDescriptorItems.mode,b);this._windowManager[b]={id:b,root:f,active:!0};e||this._evalScripts(f);this._invokeOnModeMethod(b);var h={moduleId:this._instanceData.moduleId,newMode:b,oldMode:d};getServiceManager().serviceLoaded(cre$.services.EVENTSERVICE)&&
getServiceManager().getService(cre$.services.EVENTSERVICE).then(function(a){a.publishEvent(cre$.constants.event.topic.WIDGET_MODECHANGED,h)})}__trace.exit("cre$.iwidget.widgetWrapper","_handleModeChange",c);return c},_invokeOnModeMethod:function(b){__trace.enter("cre$.iwidget.widgetWrapper","_invokeOnModeMethod",arguments);var d=!1,c=this._iContext._iScope;if(c){var a="on"+b;c[a]&&"function"===typeof c[a]?d=!0:(a="on"+b.substr(0,1).toUpperCase()+b.substr(1),c[a]&&"function"===typeof c[a]?d=!0:(a=
"on"+b.substr(0,1).toLowerCase()+b.substr(1),c[a]&&"function"===typeof c[a]&&(d=!0)));if(d)try{__trace.msg("cre$.iwidget.widgetWrapper","_invokeOnModeMethod","Calling ${0} for: ${1} ",[a,this._widgetObject.widgetMetadata.definitionUrl]),c[a].call(c)}catch(e){console.log("widgetWrapper","_invokeOnModeMethod",this.widgetId+" had an exception in its "+a+" function:\n"+e)}else __trace.msg("cre$.iwidget.widgetWrapper","_invokeOnModeMethod","_invokeOnModeMethod: ${0} had no handler for mode: ${1} (${2})",
[this.widgetId,b,this._widgetObject.widgetMetadata.definitionUrl])}__trace.exit("cre$.iwidget.widgetWrapper","_invokeOnModeMethod",d);return d},_handleEventInternal:function(b,d,c){__trace.enter("cre$.iwidget.widgetWrapper","_handleEventInternal",arguments);var a=!1,e=this._iContext._iScope;e&&(e[b]&&"function"===typeof e[b])&&(e[b].call(e,{name:b,type:d,payload:c}),a=!0);__trace.exit("cre$.iwidget.widgetWrapper","_handleEventInternal",a);return a},_updateMarkup:function(b,d){__trace.enter("cre$.iwidget.widgetWrapper",
"_updateMarkup",arguments);var c=this._iContext._getMarkupByMode(b);if("undefined"===typeof c||null===c)return __trace.exit("cre$.iwidget.widgetWrapper","_updateMarkup",null),null;0===c.indexOf("\x3cscript")&&(c="\x26nbsp;"+c);var a=document.createElement("DIV");a.innerHTML=c;this._iContext._processScripts(a);d.innerHTML=a.innerHTML;cre$.internalutil.destroyNode(a);__trace.exit("cre$.iwidget.widgetWrapper","_updateMarkup",!0);return!0},_evalScripts:function(b){},predefinedevents:{onLoad:"onLoad",
onUnLoad:"onUnload",onModeChanged:"onModeChanged",onWindowStateChanged:"onWindowStateChanged",onSizeChanged:"onSizeChanged",onNavStateChanged:"onNavStateChanged",onItemSetChanged:"onItemSetChanged",onRefreshNeeded:"onRefreshNeeded",onNewWire:"onNewWire",onRemoveWire:"onRemoveWire",onIncompleteEventDescription:"onIncompleteEventDescription"}};cre$.iwidget.UserProfile=function(a,b){this.widgetId=a;this.user=b.getItemValue("viewer");this._stateSet=b};cre$.iwidget.UserProfile.prototype.getItemValue=function(a){if(!a)return null;var b;Object.prototype.hasOwnProperty.call(this.user,a)&&(b=this.user[a]);"undefined"==typeof b&&(b=null);return b};cre$.iwidget.UserProfile.prototype.setItemValue=function(a,b){if(!a||!b||this.isReadOnly(a))return null;this.user[a]=b;return this};
cre$.iwidget.UserProfile.prototype.isReadOnly=function(a){return this.user.readOnly&&"true"==this.user.readOnly?!0:!1};cre$.iwidget.UserProfile.prototype.getAllNames=function(){var a=[],b;for(b in this.user)Object.prototype.hasOwnProperty.call(this.user,b)&&a.push(b);return a};cre$.iwidget.UserProfile.prototype.removeItem=function(a){return!a||this.isReadOnly(a)?null:Object.prototype.hasOwnProperty.call(this.user,a)?(delete this.user[a],this):null};cre$.iwidget.UserProfile.prototype.save=function(a){return this.commit(a)};
cre$.iwidget.UserProfile.prototype.commit=function(a){};cre$.iwidget.UserProfile.prototype.addListener=function(a){return this._stateSet.addListener(a,this.widgetId)};cre$.iwidget.UserProfile.prototype.removeListener=function(a){return this._stateSet.removeListener(a)};(function(){function m(c){var e=new cre$.promise.Promise("iwService: _render"),b=c.widgetObject;if(cre$.iRuntime.getWidgetById(b.instanceMetaData.moduleId)&&!b.error)e.resolve(c);else{var d=b.domId,a=b.domnode?b.domnode:document.getElementById(d);if(a)if(b.error){for(var d=b.error,a=d.length,f="";a--;)f+=d[a].definitionUrl+" : "+d[a].message+"\n";b.error={message:f};e.reject(c)}else(new cre$.iwidget.iContext(b,a)).init().then(function(){e.resolve(c)},function(a){b.error={message:"There was a problem rendering the iWidget. Check that the referenced Javascript for this iWidget is correct. The following Javascript error occurred: "+
a};e.reject(c)});else b.error={message:"Can't find root element. Dom id is: "+d},e.reject(c)}return e}function k(c){__trace.enter("cre$.iwidget.iwidgetService","_getAlliWidgetIds",arguments);var e=[],b,d;if((b=cre$.iRuntime.getWidgetById(c))&&(d=b.childrenIds)&&0<d.length)for(b=d.length;b--;)e=e.concat(k(d[b]));e=e.concat([c]);__trace.exit("cre$.iwidget.iwidgetService","_getAlliWidgetIds",e);return e}function n(c,e){var b,d,a=cre$.iRuntime.getWidgetObjects(),f;for(d in a)if(Object.prototype.hasOwnProperty.call(a,
d)&&c===cre$.iRuntime.getWidgetIdByDomId(d)){b=a[d];break}if(b){if(a=cre$.iRuntime.getWidgetById(c))a=a._iContext,a._hubContainer&&(cre$.oah.managedHub.getManagedHubInstance().removeContainer(a._hubContainer),a._hubContainer=null),a._cleanSubscription(),a.unload(),a._tokenRefreshTimer&&cre$.util.unscheduleTokenRefresher(a._tokenRefreshTimer);if(!e){if(a=b.parentId){a=cre$.iRuntime.getWidgetById(a).childrenIds;for(f=a.length;f--;)if(a[f]===c){a.splice(f,1);break}}a=b.definition;f=cre$.iRuntime.getMetadata();
a&&f[a]&&(1===f[a].instanceNum?delete f[a]:f[a].instanceNum--);delete cre$.iRuntime.getWidgetObjects()[d]}d=e?cre$.constants.state.PRELOADED:cre$.constants.state.INITIAL;b.widgetRef._changeState(d);d=[];d.push(l("st",c));d.push(l("widgetid",c));cre$.iwidget.internalutil.clearCookies(d);return b.widgetRef}}function l(c,e){var b=cre$.iwidget.internalutil.getDomainAndPath(e);return{name:c,domain:b.domain,path:b.path}}function p(c){__trace.enter("cre$.iwidget.iwidgetService","_findWidgetRoot",arguments);
var e=null,b=c.iScope.replace(/\./g,"/"),d=c.resource;if(d&&b)for(var a=d.length;a--;){var f=d[a].fullUri,g=f.indexOf(b);if(-1!=g){e=f.substring(0,g);break}}__trace.exit("cre$.iwidget.iwidgetService","_findWidgetRoot",e);return e}cre$.iwidget.iwidgetService=function(){};cre$.iwidget.iwidgetService.prototype.render=function(c){return m(c)};cre$.iwidget.iwidgetService.prototype.unload=function(c,e){for(var b=k(c),d=b.length,a=[];d--;)a.push(n(b[d],e));return a};cre$.iwidget.iwidgetService.prototype.getEvents=
function(c,e){for(var b=c._iRuntime.getWidgetIdByDomId(c.widgetObject.domId),b=cre$.iRuntime.getWidgetById(b)._iContext.iEvents.getEvents(e),d=b.length,a=[],f=null,g=0;g<d;g++)f=b[g],f=new cre$.WidgetEvent({name:f.name,type:f.type,isHandled:f.isHandled,isPublished:f.isPublished,description:f.getDescription()}),a.push(f);return a};cre$.iwidget.iwidgetService.prototype.changeMode=function(c,e){cre$.iRuntime.getWidgetById(c)._iContext.changeMode(e)};cre$.iwidget.iwidgetService.prototype.canUnload=function(c){var e=
[];c=k(c);for(var b=c.length,d=null;b--;)(d=cre$.iRuntime.getWidgetById(c[b]))&&e.push(d._iContext.getNapromise());return cre$.promise.join(e)};cre$.iwidget.iwidgetService.prototype.preload=function(c){return{widgetArr:c,errorArr:[]}};cre$.iwidget.iwidgetService.prototype.augmentResource=function(c,e,b){__trace.enter("cre$.iwidget.iwidgetService","augmentResource",arguments);var d=null;if(e&&"dojoAMD"==e["cre_ns-sep_iScopeType"]&&c.type===cre$.ResourceManager.constants.resourceType.JAVASCRIPT)if(c.isDojoAMD=
!0,c.iScope=e.iScope,c.modules={},d=p(e))for(var a=e.resource,f=a?a.length:0;f--;){var g=a[f].fullUri,h=g.indexOf(".js",g.length-3);-1!=h&&(h=g.substring(d.length,h),c.modules[g]=h)}else c.error={message:"No widgetRoot found"};b.resolve();__trace.exit("cre$.iwidget.iwidgetService","augmentResource",d)};cre$.iwidget.iwidgetService.prototype.getMetadata=function(c){var e=new cre$.promise.Promise("iwService: getMetadata"),b=cre$.iRuntime.getWidgetObjects(),d=null,a;for(a in b)if(Object.prototype.hasOwnProperty.call(b,
a)&&b[a].definition===c){d=b[a];break}d?e.resolve(d):e.reject("Can not get widget metadata of "+c);return e}})();cre$.iwidget.ItemSet=function(a){this._stateSet=a};
cre$.iwidget.ItemSet.prototype={setLocalizedItemValue:function(a,b,c){return this._stateSet.setLocalizedItemValue(a,b,c)},setItemValue:function(a,b,c,d){return c?null:this._stateSet.setLocalizedItemValue(a,b,d)},setItemValue:function(a,b){return this._stateSet.setItemValue(a,b)},getLocalizedItemValue:function(a,b){return this._stateSet.getLocalizedItemValue(a,b)},getItemValue:function(a){return this._stateSet.getItemValue(a)},getItemValue:function(a,b){return this._stateSet.getItemValue(a,b)},removeItem:function(a){return this._stateSet.removeItem(a)},
removeItemValue:function(a,b){return this._stateSet.removeLocalizedItemValue(a,b)},removeItemValue:function(a){return this._stateSet.removeItemValue(a)},removeLocalizedItemValue:function(a,b){return this._stateSet.removeLocalizedItemValue(a,b)},getAllNames:function(){return this._stateSet.getAllItemNames()},getLocalesWithValues:function(a){return(a=this._stateSet.getItem(a))?a.getLocalsWithValues():null}};cre$.iwidget.ManagedItemSet=function(a,b){this._stateSet=a;this._iContext=b};cre$.iwidget.ManagedItemSet.prototype.setItemValue=function(a,b,f){return this._stateSet.setItemValue(a,b,this._iContext._mode)};cre$.iwidget.ManagedItemSet.prototype.getItemValue=function(a,b){return this._iContext._mode===cre$.constants.mode.VIEW?this._stateSet.getItemValue(a):this._stateSet.getItemValue(a,this._iContext._mode,b)};cre$.iwidget.ManagedItemSet.prototype.getAllNames=function(){return this._stateSet.getAllItemNames()};
cre$.iwidget.ManagedItemSet.prototype.removeItem=function(a){return this._stateSet.removeItem(a,this._iContext._mode)};cre$.iwidget.ManagedItemSet.prototype.isReadOnly=function(a){if(null!==this._stateSet.getItem(a))return this._stateSet.getItem(a).isReadOnly();__logging.log("cre$.iwidget.ManagedItemSet","isReadOnly",cre$.LocaleHelper.getLocalizedMessages().LOG_NO_MANAGEDIS,[a],__logging.logLevel.INFO);return!1};
cre$.iwidget.ManagedItemSet.prototype.addListener=function(a){return this._stateSet.addListener(a,this._iContext.getWidgetId())};cre$.iwidget.ManagedItemSet.prototype.removeListener=function(a){return this._stateSet.removeListener(a)};cre$.iwidget.ManagedItemSet.prototype.save=function(a){return this.commit(a)};
cre$.iwidget.ManagedItemSet.prototype.commit=function(a,b){var f=this._stateSet.id,c=this._iContext._mode,c=c===cre$.constants.mode.VIEW?cre$.constants.mode.PERSONALIZE:c;if(c===cre$.constants.mode.CONFIG)for(var d=this._iContext._iRuntime.getStateSets(),e=d.length;e--;)d[e].definitionUrl===this._stateSet.definitionUrl&&(this._iContext._iRuntime.getStateSets()[e].sets.config=this._stateSet.sets.config);if(this._iContext._widgetObject.renderType===cre$.constants.renderType.SANDBOX&&!b){var k=cre$.iRuntime.inIFrame?
cre$.constants.event.topic.SYNC+this._iContext.getWidgetId():cre$.constants.event.topic.STUB_SYNC+this._iContext.getWidgetId(),e=getServiceManager().getService(cre$.services.EVENTSERVICE),g=[cre$.util.clone(this._stateSet)];e.then(function(a){a.publishEvent(k,{methodname:"_handleDataSync",params:g})})}if(!cre$.iRuntime.inIFrame){var m=this._iContext._widgetObject.instanceMetaData.moduleId;this.notifyOnItemSetChanged(this._stateSet);if(f===cre$.constants.itemSet.ATTRIBUTES){d=getServiceManager().getService(cre$.services.ITEMSETPERSISTENCE);
if(this._stateSet.levelDef){var e,l=this._stateSet.levelDef.length;for(e=0;e<l&&c!==this._stateSet.levelDef[e];e++);e===l&&(c=this._stateSet.levelDef[l-1])}var h=this;d.then(function(b){b.getItemSets(m,f,c).then(function(e){e.mode=c;var d={name:cre$.constants.itemSet.ONPERSISTENCERESPONSE,type:null,payload:!1,source:h._iContext.getWidgetId()};b.update(m,e).then(function(b){"function"===typeof a&&a(f,!0);d.payload=!0;h.notifyListeners(h._stateSet,d)},function(b){"function"===typeof a&&a(f,!1);h.notifyListeners(h._stateSet,
d)})})})}}};
cre$.iwidget.ManagedItemSet.prototype.notifyOnItemSetChanged=function(a){a.hasOwnProperty("computed")&&(a=a.computed);var b=a.getAllItemNames();if(b){var f={itemSetName:a.id,changes:[]},c=null;a.parent&&(c=a.parent.changes=a.parent.changes?a.parent.changes:[]);for(var d=0,e=b.length;d<e;d++){var k=b[d],g=a.getItem(k);a._dirty&&(g._dirty&&g._change)&&(f.changes.push(g._change),c&&c.push(g._change),a._setItemDirty(k,!1))}delete a._dirty;b={name:cre$.constants.itemSet.ONITEMSETCHANGED,type:null,payload:f,
source:this._iContext.getWidgetId()};this.notifyListeners(a,b)}};cre$.iwidget.ManagedItemSet.prototype.notifyListeners=function(a,b){var f=a.parent&&a.parent.computed===a?a.parent:a,c=f.getListeners(),d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&c[d].call(f,b)};cre$.iwidget.ShareableItemSet=function(b,c,a,e){e&&(this.id=e);a&&(this.id=a.id,this.alias=a.alias?a.alias:this.id,this.defData=a);this.mapping={};this.items={};if(a){e=a.items;var d;a:{for(d in e)if(Object.prototype.hasOwnProperty.call(e,d)){d=!1;break a}d=!0}d&&(e=a.computed.items);for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(hasMapping=!0,a=f,d=e[f].alias?e[f].alias:null,this.items[f]={id:a},d&&(this.mapping[d]=a,this.items[f].alias=d))}this._iContext=b;this._stateSet=c;this._isDirty=
!1};
cre$.iwidget.ShareableItemSet.prototype={DELETE_TOKEN:cre$.constants.changeType.DELETE_TOKEN,setItemValue:function(b,c){__trace.enter("cre$.iwidget.ShareableItemSet","setItemValue",arguments);if(!b||!c)return __trace.exit("cre$.iwidget.ShareableItemSet","setItemValue",null),null;"undefined"!==typeof this._isDirty&&!this._isDirty&&(this._isDirty=!0,this._changedItems={});var a=this._resolveMapping(b);a||(a=b);this._changedItems=this._changedItems?this._changedItems:{};this._changedItems[a]=c;__trace.exit("cre$.iwidget.ShareableItemSet","setItemValue",
this);return this},getItemValue:function(b){__trace.enter("cre$.iwidget.ShareableItemSet","getItemValue",arguments);var c=this._resolveMapping(b),a=null;c||(c=b);if(this._isDirty&&this._changedItems){if(this._changedItems[c]&&this._changedItems[c]!==this.DELETE_TOKEN){try{console.log("Invalid variable for exit tracing: this._changedItems[id]")}catch(e){console.log("Error tracing an invalid trace statement.",e)}return this._changedItems[c]}if(this._changedItems[c]&&this._changedItems[c]===this.DELETE_TOKEN)return __trace.exit("cre$.iwidget.ShareableItemSet",
"getItemValue",null),null}a=this._stateSet.getItemValue(c);__trace.exit("cre$.iwidget.ShareableItemSet","getItemValue",a);return a},removeItem:function(b){__trace.enter("cre$.iwidget.ShareableItemSet","removeItemValue",arguments);"undefined"!==typeof this._isDirty&&!this._isDirty&&(this._isDirty=!0,this._changedItems={});var c=this.getAllNames();if(null===c)return __trace.exit("cre$.iwidget.ShareableItemSet","removeItemValue",null),null;for(var a=!1,e=0;e<c.length;e++)c[e]===b&&(a=!0);if(!a)return __trace.exit("cre$.iwidget.ShareableItemSet",
"removeItemValue",null),null;(c=this._resolveMapping(b))||(c=b);this._changedItems=this._changedItems?this._changedItems:{};this._changedItems[c]=this.DELETE_TOKEN;__trace.exit("cre$.iwidget.ShareableItemSet","removeItemValue",!0);return this},addListener:function(b){__trace.enter("cre$.iwidget.ShareableItemSet","addListener",arguments);var c=this,a=this._stateSet.addListener(function(a){var d=a.payload;if(d=d.changes?d.changes:null)for(var f=0;f<d.length;f++)d[f].id=c._convertToLocal(d[f].id);b(a)},
this._iContext.getWidgetId());__trace.exit("cre$.iwidget.ShareableItemSet","addListener",a);return a},removeListener:function(b){__trace.enter("cre$.iwidget.ShareableItemSet","removeListener",arguments);var c=this._stateSet.removeListener(b);__trace.exit("cre$.iwidget.ShareableItemSet","removeListener",c);return c},getAllNames:function(){__trace.enter("cre$.iwidget.ShareableItemSet","getAllNames",arguments);var b=this._stateSet.getAllItemNames();if(this._isDirty){for(var c={},a=0;a<b.length;a++){var e=
b[a];c[e]=e}if(this._changedItems)for(var d in this._changedItems)this._changedItems[d]&&this._changedItems[d]===this.DELETE_TOKEN&&c[d]?c[d]=null:this._changedItems[d]&&!c[d]&&(c[d]=d);var b=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&b.push(f)}for(c=0;c<b.length;c++)f=b[c],this.mapping[f]&&(b[c]=this.mapping[f]);if(0===b.length)return __trace.exit("cre$.iwidget.ShareableItemSet","getAllNames",null),null;__trace.exit("cre$.iwidget.ShareableItemSet","getAllNames",b);return b},commit:function(b,
c){__trace.enter("cre$.iwidget.ShareableItemSet","commit",arguments);var a;if(this._isDirty){for(a in this._changedItems)this._changedItems[a]&&this._changedItems[a]===this.DELETE_TOKEN?this._stateSet.removeItem(a):this._changedItems[a]&&this._stateSet.setItemValue(a,this._changedItems[a]);a=getServiceManager().getService(cre$.services.EVENTSERVICE);var e=null,d=null;cre$.iRuntime.inIFrame?c||(e=cre$.constants.event.topic.SYNC+this._iContext.getWidgetId(),d=[this._stateSet.id,cre$.util.clone(this._changedItems)],
a.then(function(a){a.publishEvent(e,{methodname:"_syncLocalShareableItemSet",params:d})})):(this._iContext._isWrapperContext&&!c&&(e=cre$.constants.event.topic.STUB_SYNC+this._iContext.getWidgetId(),d=[this._stateSet.id,cre$.util.clone(this._changedItems)],a.then(cre$.util.partial(function(a,b,c){c.publishEvent(a,{methodname:"_syncLocalShareableItemSet",params:b})},e,d))),e=cre$.constants.event.topic.BROADCAST_SHAREABLEITEMSET_CHANGE,d=[this._iContext.getWidgetId(),this._stateSet.id,cre$.util.clone(this._changedItems)],
a.then(cre$.util.partial(function(a,b,c){c.publishEvent(a,{methodname:"_syncGlobalShareableItemSet",params:b})},e,d)));this._invokeListeners(this._stateSet)}b&&b(this.alias,!0);this._changedItems=null;this._isDirty=!1;__trace.exit("cre$.iwidget.ShareableItemSet","commit")},_resolveMapping:function(b){return!b||!this.items?null:this.items[b]&&this.items[b].alias?this.items[b].alias:null},_convertToLocal:function(b){return b&&this.mapping&&this.mapping[b]?this.mapping[b]:b},_invokeListeners:function(b){var c=
b.getAllItemNames();if(c){var a={};a.itemSetName=b.id;a.changes=[];for(var e=0,d=c.length;e<d;e++){var f=c[e],g=b.getItem(f);b._dirty&&(g._dirty&&g._change)&&(a.changes.push(g._change),b._setItemDirty(f,!1))}delete b._dirty;var c={name:cre$.constants.predefinedEvents.onItemSetChanged,type:null,payload:a,source:this._iContext.getWidgetId()},a=b.getListeners(),h;for(h in a)Object.prototype.hasOwnProperty.call(a,h)&&a[h].call(b,c)}}};cre$.iwidget.iDescriptor=function(a,b){cre$.iwidget.ManagedItemSet.call(this,b);this._widgetObject=a};cre$.iwidget.iDescriptor.prototype=new cre$.iwidget.ManagedItemSet;
cre$.iwidget.iDescriptor.prototype.iDescriptorItems={title:cre$.constants.iDescriptorItems.TITLE,name:cre$.constants.iDescriptorItems.NAME,description:cre$.constants.iDescriptorItems.DESCRIPTION,defaultHeight:cre$.constants.iDescriptorItems.DEFAULTHEIGHT,defaultWidth:cre$.constants.iDescriptorItems.DEFAULTWIDTH,displayLocale:cre$.constants.iDescriptorItems.DISPLAYLOCALE,mode:cre$.constants.iDescriptorItems.MODE,author:cre$.constants.iDescriptorItems.AUTHOR,email:cre$.constants.iDescriptorItems.EMAIL,
website:cre$.constants.iDescriptorItems.WEBSITE,version:cre$.constants.iDescriptorItems.VERSION,icon:cre$.constants.iDescriptorItems.ICON,windowState:cre$.constants.iDescriptorItems.WINDOWSTATE,messageLocale:cre$.constants.iDescriptorItems.MESSAGELOCALE,availableMessageLocales:cre$.constants.iDescriptorItems.AVAILABLEMESSAGELOCALES,thumbnail:cre$.constants.iDescriptorItems.THUMBNAIL};
cre$.iwidget.iDescriptor.prototype.readOnlyItems={defaultHeight:cre$.constants.iDescriptorItems.DEFAULTHEIGHT,defaultWidth:cre$.constants.iDescriptorItems.DEFAULTWIDTH,displayLocale:cre$.constants.iDescriptorItems.DISPLAYLOCALE,messageLocale:cre$.constants.iDescriptorItems.MESSAGELOCALE,author:cre$.constants.iDescriptorItems.AUTHOR,email:cre$.constants.iDescriptorItems.EMAIL,website:cre$.constants.iDescriptorItems.WEBSITE,version:cre$.constants.iDescriptorItems.VERSION,icon:cre$.constants.iDescriptorItems.ICON};
cre$.iwidget.iDescriptor.prototype.writableItems={title:cre$.constants.iDescriptorItems.TITLE,name:cre$.constants.iDescriptorItems.NAME,description:cre$.constants.iDescriptorItems.DESCRIPTION,availableMessageLocales:cre$.constants.iDescriptorItems.AVAILABLEMESSAGELOCALES,mode:cre$.constants.iDescriptorItems.MODE,windowState:cre$.constants.iDescriptorItems.WINDOWSTATE};
cre$.iwidget.iDescriptor.prototype.localizedItems={title:cre$.constants.iDescriptorItems.TITLE,name:cre$.constants.iDescriptorItems.NAME,description:cre$.constants.iDescriptorItems.DESCRIPTION};cre$.iwidget.iDescriptor.prototype.isReadOnly=function(a){__trace.enter("cre$.iwidget.iDescriptor","isReadOnly",arguments);var b=!1,b="undefined"===typeof a||null===a?!1:this.readOnlyItems[a]?!0:!1;__trace.exit("cre$.iwidget.iDescriptor","isReadOnly",b);return b};
cre$.iwidget.iDescriptor.prototype.removeItem=function(a){return null};
cre$.iwidget.iDescriptor.prototype.getItemValue=function(a){__trace.enter("cre$.iwidget.iDescriptor","getItemValue",arguments);var b=null;"undefined"===typeof a||null===a?b=null:a===this.iDescriptorItems.displayLocale?b=this._stateSet.getItemValue(a):a===this.iDescriptorItems.messageLocale?b=this._getMessageLocale():a===this.iDescriptorItems.windowState?b=this._getWindowState():this.localizedItems[a]?(b=this._getMessageLocale(),b=this._stateSet.getLocalizedItemValue(a,b)):b=this._stateSet.getItemValue(a);
__trace.exit("cre$.iwidget.iDescriptor","getItemValue",b);return b};cre$.iwidget.iDescriptor.prototype._getLocalizedItemValue=function(a,b){if("undefined"===typeof a||null===a||"undefined"===typeof b||null===b)return null;var c=null;this.localizedItems[a]&&(c=this._stateSet.getLocalizedItemValue(a,b));return c};
cre$.iwidget.iDescriptor.prototype.setItemValue=function(a,b){__trace.enter("cre$.iwidget.iDescriptor","setItemValue",arguments);var c=this;if("undefined"===typeof a||null===a||"undefined"===typeof b||null===b)c=null;else if(a===this.iDescriptorItems.mode){var d=this._widgetObject.widgetMetadata.supportedModes.split(" ");if(cre$.internalutil.contains(d,b))!cre$.iRuntime.inIFrame&&this._widgetObject.renderType===cre$.constants.renderType.SANDBOX?(this._iContext._mode=b,this._iContext.getiDescriptor()._setItemValue(cre$.iwidget.iDescriptor.prototype.iDescriptorItems.mode,
b)):this._iContext.widget._handleModeChange(b,this.getItemValue(this.iDescriptorItems.mode));else throw"The specified mode ["+b+"] is not supported!";}else if(a===this.iDescriptorItems.windowState){if(d=this._widgetObject.widgetMetadata.supportedWindowStates,void 0!==d)if(d=d.split(" "),cre$.internalutil.contains(d,b))this._iContext.iEvents.fireEvent(this._iContext.constants.predefinedEvents.onWindowStateChanged,null,b);else throw"The specified widow state ["+b+"] is not supported!";}else c=this._setItemValue(a,
b);__trace.exit("cre$.iwidget.iDescriptor","setItemValue",c);return c};cre$.iwidget.iDescriptor.prototype._setItemValue=function(a,b){if("undefined"===typeof a||(null===a||"undefined"===typeof b||null===b)||this.readOnlyItems[a])return null;if(this.localizedItems[a]){var c=this._getMessageLocale();this._stateSet.setLocalizedItemValue(a,b,c)}else this._stateSet.setItemValue(a,b);return this};
cre$.iwidget.iDescriptor.prototype._setLocalizedItemValue=function(a,b,c){if(!("undefined"===typeof a||null===a)&&!("undefined"===typeof b||null===b)&&!("undefined"===typeof c||null===c)&&this.localizedItems[a])this._stateSet.setLocalizedItemValue(a,b,c);else return null};
cre$.iwidget.iDescriptor.prototype._getMessageLocale=function(){__trace.enter(null,"_getMessageLocale",arguments);if(!this.messageLocale){var a=null,a=this._stateSet.getItemValue(this.iDescriptorItems.availableMessageLocales),b=[];a&&(b=a.split(" "));this.messageLocale=a=this._getLocale(b,"en","en")}__trace.exit(null,"_getMessageLocale",this.messageLocale);return this.messageLocale};
cre$.iwidget.iDescriptor.prototype._getLocale=function(a,b,c){switch(a.length){case 0:return c;case 1:return a[0];default:return cre$.internalutil.contains(a,b)?b:cre$.internalutil.contains(a,c)?c:a[0]}};cre$.iwidget.iDescriptor.prototype._getWindowState=function(){return this._iContext.windowState?this._iContext.windowState:cre$.constants.windowstate.NORMAL};
cre$.iwidget.iDescriptor.prototype.commit=function(a,b){__trace.enter("cre$.iwidget.iDescriptor","commit",arguments);if(this._iContext._widgetObject.renderType===cre$.constants.renderType.SANDBOX&&!b){var c=getServiceManager().getService(cre$.services.EVENTSERVICE),d=cre$.iRuntime.inIFrame?cre$.constants.event.topic.SYNC+this._iContext.getWidgetId():cre$.constants.event.topic.STUB_SYNC+this._iContext.getWidgetId(),f={id:cre$.constants.itemSet.IDESCRIPTOR,items:{}},e;for(e in this.writableItems)Object.prototype.hasOwnProperty.call(this.writableItems,
e)&&(f.items[this.writableItems[e]]=this.getItemValue(this.writableItems[e]));c.then(function(a){a.publishEvent(d,{methodname:"_handleDataSync",params:[f]})})}this.notifyOnItemSetChanged(this._stateSet);__trace.exit("cre$.iwidget.iDescriptor","commit")};(function(){var c=cre$.util,a=window.dojo;c.trim=a?a.trim:String.prototype.trim?function(b){return b.trim()}:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};var d=/\{([^\}]+)\}/g;c.replace=a?a.replace:function(b,a,e){return b.replace(e||d,c.isFunction(a)?a:function(b,d){return c.getObject(d,!1,a)})}})();dojo.require("com.ibm.social.gadget.people._vcard_utils");(function(b){var a=cre$.people_container={};a.getVcard=function(a,c,d,e){return b.generateVcard(a,c,d,e)};gadgets.rpc.register("_ic_cre_people_request_vcard",a.getVcard)})(com.ibm.social.gadget.people._vcard_utils);cre$.osgadget=cre$.osgadget||{};
(function(){function u(a){__trace.enter("cre$.osgadget","_render",arguments);v(a);w(a);var b;b=cre$.iRuntime.getCommonContainer().then(function(b){var c=a.widgetObject,d=new cre$.promise.Promise("navPromise"),f=c.definition,l=c.domId,k,g=c.domnode?c.domnode:document.getElementById(l);k=c.url?b.newUrlSite(g):c.renderParams&&c.renderParams.gadgetSiteId?b.sites_[c.renderParams.gadgetSiteId]:0===l.indexOf(cre$.constants.others.GADGET_SITE)?b.newGadgetSite(g):null;var q=c.viewParams||{},h=c.renderParams||
{},m=null;if(!k){k=(new Date).getTime()+"";7<k.length&&(k=k.substr(k.length-7,7));k=k+""+r;r++;var n=document.createElement("div");n.setAttribute(cre$.constants.resource.resourceType.ID,cre$.constants.others.GADGET_SITE+k);g.innerHTML="";g.appendChild(n);k=b.newGadgetSite(n)}c.callback&&window[c.callback]?m=window[c.callback]:cre$.iRuntime._getGadgetLoadedCallbacks()[l]&&(m=cre$.iRuntime._getGadgetLoadedCallbacks()[l]);try{if(h.renderType=h.renderType||c.renderType||"default",c.url)b.navigateUrl(k,
c.url,h),d.resolve("navigated to Url");else if(c.eeDataModel){var p=c.eeDataModel;p.url?h.urlRenderParams||(h.urlRenderParams=s(h)):(p.gadget=f,h.gadgetRenderParams||(h.gadgetRenderParams=s(h)));h.gadgetViewParams||(h.gadgetViewParams=q);b.ee.navigate(k.el_,p,h,function(a,b){m=m||function(){};m(a,b);var c={site:a,data:b};null===b||null!==b&&b.error?d.reject(c):d.resolve(c)})}else b.navigateGadget(k,f,q,h,function(a){m=m||function(){};m(a);d.resolve(a)})}catch(t){__logging.log("cre$.osgadget","_render",
t),d.reject(t)}return d.then(function(b){return a},function(b){a.widgetObject.error={message:"render gadget error."};return a})});__trace.exit("cre$.osgadget","_render",b);return b}function v(a){var b=a.widgetObject.loadInstanceData;b&&(delete a.widgetObject.loadInstanceData,cre$.util.mixin(a.widgetObject,b))}function w(a){var b=cre$.iRuntime.getWidgetObjects()[a.widgetObject.domId];if(b&&(b.widgetMetadata&&!(b.widgetMetadata.topics&&0<b.widgetMetadata.topics.length))&&(a.widgetObject&&a.widgetObject.response)&&
(a=a.widgetObject.response,a.modulePrefs&&(a.modulePrefs.features&&a.modulePrefs.features["pubsub-2"])&&(a=a.modulePrefs.features["pubsub-2"],a.params&&a.params.topics))){var e=a.params.topics;a=e.length;var c=0,d=document.createElement("div");d.style.display="none";document.body.appendChild(d);for(c=0;c<a;c++){var f=document.createElement("span");f.innerHTML=e[c];d.appendChild(f)}e=document.getElementsByTagName(cre$.constants.osgadgetItems.TOPIC);a=e.length;if(0<a){b.widgetMetadata.topics=[];for(c=
0;c<a;c++){var f={},l=e[c].parentNode;l&&(l.parentNode&&l.parentNode===d)&&(f.name=e[c].getAttribute(cre$.constants.osgadgetItems.NAME),f.title=e[c].getAttribute(cre$.constants.osgadgetItems.TITLE),f.type=e[c].getAttribute(cre$.constants.osgadgetItems.TYPE),e[c].getAttribute(cre$.constants.osgadgetItems.SUBSCRIBE)?f.subscribe=Boolean(e[c].getAttribute(cre$.constants.osgadgetItems.SUBSCRIBE)):f.subscribe=!1,e[c].getAttribute(cre$.constants.osgadgetItems.PUBLISH)?f.publish=Boolean(e[c].getAttribute(cre$.constants.osgadgetItems.PUBLISH)):
f.publish=!1,f.description=e[c].getAttribute(cre$.constants.osgadgetItems.DESCRIPTION),f.aboutUrl=e[c].getAttribute(cre$.constants.osgadgetItems.ABOUTURL),b.widgetMetadata.topics.push(f))}}cre$.internalutil.destroyNode(d)}}function s(a){var b={},e;for(e in a)Object.prototype.hasOwnProperty.call(a,e)&&(b[e]=a[e]);return b}function x(a,b,e){__trace.enter("cre$.osgadget","_preloadGadgetInternal",arguments);for(var c=new cre$.promise.Promise("osgService: _preload"),d=[],f=b.length;f--;)b[f].definition&&
("inline"!==b[f].renderType?d.push(b[f].definition):e&&d.push(b[f].definition));a.preloadGadgets(d,function(a){for(var e=[],d=[],f=b.length,h;f--;)(h=b[f].definition)?a[h]?a[h].error?(b[f].error=a[h].error,b[f].state=cre$.constants.state.ERROR,d.push(b[f])):b[f].domId&&(b[f].response=a[h],e.push(b[f])):(b[f].error={message:"No response from preloadGadgets"},b[f].state=cre$.constants.state.ERROR,d.push(b[f])):e.push(b[f]);a={widgetArr:e,errorArr:d};0<d.length?c.reject(a):c.resolve(a)});__trace.exit("cre$.osgadget",
"_preloadGadgetInternal",c);return c}function y(a,b){var e=null,c,d;d=cre$.iRuntime.getWidgetObjects();for(c in d)if(Object.prototype.hasOwnProperty.call(d,c)&&a===cre$.iRuntime.getWidgetIdByDomId(c)){e=d[c];break}if(null!==e)return d=cre$.iRuntime.getCommonContainer().then(function(f){var d=f.sites_;cre$.iRuntime._getGadgetLoadedCallbacks()[e.domId]&&delete cre$.iRuntime._getGadgetLoadedCallbacks()[e.domId];e.eeContext?f.ee.close(d[a]):f.closeGadget(d[a]);b||(f.unloadGadget(e.definition),f=e.definition,
d=cre$.iRuntime.getMetadata(),f&&d[f]&&(1===d[f].instanceNum?delete d[f]:d[f].instanceNum--),delete cre$.iRuntime.getWidgetObjects()[c]);e.widgetRef._changeState(cre$.constants.state.PRELOADED);return[e.widgetRef]})}function n(a,b,e){return a&&"undefined"!==typeof a[b]?a[b]:e}var g=cre$.osgadget,r=0;g.gadgetService=function(){};g.gadgetService.prototype.render=function(a){return u(a)};g.gadgetService.prototype.unload=function(a,b){return y(a,b)};g.gadgetService.prototype.augmentResource=function(a,
b,e){e.resolve()};g.gadgetService.prototype.getEvents=function(a,b){var e=cre$.iRuntime.getWidgetObjects()[a.widgetObject.domId].widgetMetadata.topics,c=[],d=null;if(e&&0<e.length)for(var f=e.length,g=0;g<f;g++){d=e[g];if(b){if(b.name&&d.name!==b.name)break;if(b.type&&d.type!==b.type)break;if("undefined"!==typeof b.isHandled&&d.subscribe!==b.isHandled)break;if("undefined"!==typeof b.isPublished&&d.publish!==b.isPublished)break}d=new cre$.WidgetEvent({name:d.name,type:d.type,isHandled:d.subscribe,
isPublished:d.publish,description:d.description});c.push(d)}return c};g.gadgetService.prototype.canUnload=function(a){return cre$.promise.resolved(!0)};g.gadgetService.prototype.preload=function(a,b){return cre$.iRuntime.getCommonContainer().then(function(e){return x(e,a,b)},function(){for(var b=a.length,c=[];b--;)c.push({domId:a[b].domId,error:{message:"Can't get common container."}});return{widgetArr:[],errorArr:c}})};g.gadgetService.prototype.getMetadata=function(a){var b=new cre$.promise.Promise("osgService: getMetadata");
cre$.iRuntime.getCommonContainer().then(function(e){e.getGadgetMetadata(a,function(a){b.resolve(a)})});return b};g._containerName="container";g.gadgetService.prototype.configCommonContainer=function(a,b){var e=cre$.promise.resolved(a);cre$.commoncontainer=a;a.managedHub=cre$.oah.managedHub.getManagedHubInstance();gadgets.pubsub2router.init({hub:a.managedHub});if(n(b,"configInlineOAH",!0))try{a.managedHub.getContainer(g._containerName)||(a.inlineClient=new OpenAjax.hub.InlineContainer(a.managedHub,
g._containerName,{Container:{onSecurityAlert:function(a,b){},onConnect:function(a){},onDisconnect:function(a){}}}),a.inlineClient.connect())}catch(c){__logging.log("cre$.osgadget","_getCommonContainer",c)}n(b,"configSecurityToken",!0)&&(e=cre$.internalutil.checkContainerToken().then(function(b){a.updateContainerSecurityToken(null,cre$.internalutil.getCREContainerToken().token,cre$.config.MAX_TOKEN_TTL);return a}));var d=n(b,"commonContainerViewOverrides",!1);d&&a.views&&(d.createElementForGadget&&
(a.views.createElementForGadget=d.createElementForGadget),d.createElementForUrl&&(a.views.createElementForUrl=d.createElementForUrl),d.createElementForEmbeddedExperience&&(a.views.createElementForEmbeddedExperience=d.createElementForEmbeddedExperience),d.destroyElement&&(a.views.destroyElement=d.destroyElement));return e}})();osapi.container.Container.addMixin("SharedScriptFrame",function(e){var g={},h=function(a,c){var b,d={};d[a.toLowerCase()]=1;if(c&&c.params&&(b=c.params.participant))if("string"==typeof b)d[b.toLowerCase()]=1;else for(var f=0,e;e=b[f];f++)d[e.toLowerCase()]=1;b=[];for(f in d)b.push(f);return b.sort().join("")},k={};k[osapi.container.CallbackType.ON_BEFORE_RENDER]=function(a){var c=a.url;try{var b=a.modulePrefs.features["shared-script-frame"],d=a.modulePrefs.features["locked-domain"]}catch(f){}b&&(a=
b,b=h(c,d),g[b]||(d=osapi.container.GadgetSite.DEFAULT_VIEW_,a.params&&a.params.view&&(d=a.params.view[0]),a=document.createElement("div"),a.style.display="none",document.body.appendChild(a),a=g[b]=e.newGadgetSite(a),b={},b[osapi.container.RenderParam.VIEW]=d,e.navigateGadget(a,c,void 0,b)))};e.addGadgetLifecycleCallback("shared-script-frame-setup",k);e.rpcRegister("get_script_frame_name",function(a){a=a.gs.getActiveSiteHolder().getGadgetInfo();a=h(a.url,a.modulePrefs.features["locked-domain"]);var c;
(a=g[a])&&(c=a.getActiveSiteHolder().getIframeId());return c});return{}});osapi.container.Container.prototype.setupNonGadgetRpcEndpoint=function(){var a=this;gadgets.rpc.setUpRpcIdsForNonGadgetIframe=function(c,d,b,e){a.sites_[d]={getActiveSiteHolder:function(){return{getUrl:function(){return b},getIframeId:function(){return c}}}};a.service_.cachedMetadatas_[b]={rpcServiceIds:e}}};cre$.iwidget.iEvents=function(a,d){this._widgetId=d;this._widgetObjName="_"+this._widgetId+"_iContext";this._events=[];this._widget=a;for(var b=window[this._widgetObjName]._widgetObject.widgetMetadata.event||[],c=window[this._widgetObjName]._widgetObject.widgetMetadata.eventDescription||[],k=b.length,m=c.length,l=0;l<k;l++){var f={},e=b[l];f.name=e.id;f.alias=e.id;cre$.util.isString(e.handled)&&(f.isHandled="true"===e.handled?!0:!1);cre$.util.isString(e.published)&&(f.isPublished="true"===e.published?
!0:!1);e.onNewWire&&(f.onNewWire=e.onNewWire);e.onRemoveWire&&(f.onRemoveWire=e.onRemoveWire);e.onEvent&&(f.handlingFn=e.onEvent);for(var g=0;g<m;g++){var h=c[g];if(h.id===e.eventDescName){f.type=h.payloadType;f._attr={};f._attr[h.lang]={};f._attr[h.lang][window[this._widgetObjName].constants.event.TITLE]=h.title;f._attr[h.lang][window[this._widgetObjName].constants.event.DESCRIPTION]=h.description;if(h.alt){e=h.alt.length;for(g=0;g<e;g++)f._attr[h.alt[g].lang]={},f._attr[h.alt[g].lang][window[this._widgetObjName].constants.event.TITLE]=
h.alt[g].title,f._attr[h.alt[g].lang][window[this._widgetObjName].constants.event.DESCRIPTION]=h.alt[g].description}break}}f=new cre$.iwidget.iEventDescription(f);this._events.push(f)}};
cre$.iwidget.iEvents.prototype={fireEvent:function(a,d,b){if("string"===typeof b){var c=cre$.internalutil.parseToJson(b);!1!==c&&(b=c)}cre$.config.BROADCASTALLEVENTS?getServiceManager().getService(cre$.services.EVENTSERVICE).then(cre$.util.hitch(this,function(a,c){c.broadcastEvent(a,b,d);this.publishEvent(a,b,d)},a)):this.publishEvent(a,b,d)},_findEventDesc:function(a,d){if(cre$.util.isArray(a)&&0<a.length)for(var b=0;b<a.length;b++){var c=a[b];if(c.name===d)return c}return null},setEvent:function(a){if(!a.name||
!a.type)return __logging.log("cre$.iwidget.iEvents","setEvent",cre$.LocaleHelper.getLocalizedMessages().ERR_EVENT_NAME_TYPE_MISSING),!1;"function"!==typeof a.getDescription&&(a=new cre$.iwidget.iEventDescription(a));var d=this._events.length;if(0===d)this._events.push(a),this._createEventInWidgetInstance(a);else{for(var b=!1,c=0;c<d;c++)if(this._events[c].name===a.name){this._events[c]=a;b=!0;break}!1===b&&(this._events.push(a),this._createEventInWidgetInstance(a))}return!0},setEvents:function(a){for(var d=
a.length,b=0;b<d;b++)if(!this.setEvent(a[b]))return __logging.log("cre$.iwidget.iEvents","setEvents",cre$.LocaleHelper.getLocalizedMessages().ERR_EVENT_FORMAT),!1;return!0},removeEvent:function(a){if(!a||""===a)return __logging.log("cre$.iwidget.iEvents","removeEvent",cre$.LocaleHelper.getLocalizedMessages().ERR_REMOVE_EVENT_EMPTY_NAME),!1;var d=this._events.length;if(0===d)return __logging.log("cre$.iwidget.iEvents","removeEvent",cre$.LocaleHelper.getLocalizedMessages().ERR_REMOVE_EVENT_NO_EVENT),
!1;for(var b=!1;d--;)if(this._events[d].name===a){b=!0;this._removeEventFromWidgetInstance(this._events[d]);delete this._events[d];this._events.splice(d,1);break}return!b?(__logging.log("cre$.iwidget.iEvents","removeEvent",cre$.LocaleHelper.getLocalizedMessages().ERR_REMOVE_EVENT_NOT_EXIST,[a]),!1):!0},removeEvents:function(a){for(var d=a.length,b=0;b<d;b++)if(!this.removeEvent(a[b]))return __logging.log("cre$.iwidget.iEvents","removeEvents",cre$.LocaleHelper.getLocalizedMessages().ERR_REMOVE_EVENT),
!1;return!0},getEvents:function(a){var d=this._events.length;if(0===d)return[];for(var b=[],c=0;c<d;c++){var k=!0,m;for(m in a)Object.prototype.hasOwnProperty.call(a,m)&&this._events[c][m]!==a[m]&&(k=!1);k&&b.push(this._events[c])}return b},createEventDescription:function(a){if(!a.name&&!a.type)return __logging.log("cre$.iwidget.iEvents","createEventDescription",cre$.LocaleHelper.getLocalizedMessages().ERR_EVENT_NAME_TYPE_REQUIRED_DESCITEM),null;for(var d=this._events.length,b=0;b<d;b++)if(this._events[b].name===
a.name)return __logging.log("cre$.iwidget.iEvents","createEventDescription",cre$.LocaleHelper.getLocalizedMessages().ERR_EVENT_ALREADY_EXISTED),null;a._attr={};var c;if(a.localizedAttributes)if(d=a.localizedAttributes.length)for(b=0;b<d;b++){var k=a.localizedAttributes[b];for(c in k)Object.prototype.hasOwnProperty.call(k,c)&&(a._attr[c]=k[c])}else for(c in a.localizedAttributes)Object.prototype.hasOwnProperty.call(a.localizedAttributes,c)&&(a._attr[c]=a.localizedAttributes[c]);if(a.attributes)for(c in a.attributes)Object.prototype.hasOwnProperty.call(a.attributes,
c)&&(a._attr[c]=a.attributes[c]);return new cre$.iwidget.iEventDescription(a)},publishEvent:function(a,d,b){getServiceManager().getService(cre$.services.EVENTSERVICE).then(cre$.util.hitch(this,function(a,c){for(var l=cre$.iRuntime.getWires().wires,f=l.length,e=0;e<f;e++)if(l[e].sourceWidget===this._widgetId&&l[e].sourceEvent===a){var g={};g.name=l[e].targetEvent;g.payload=d;g.type=b;g.source=this._widgetId;c.publishEvent(this._widgetId+"_"+a+"_"+l[e].targetWidget+"_"+l[e].targetEvent,g)}},a));var c=
{payload:d,payloadType:b};cre$.iRuntime.getWires().addQueuedEvent(this._widgetId,a,c)},_removeEventFromWidgetInstance:function(a){var d=cre$.iRuntime.getWidgetObjects()[window[this._widgetObjName]._widgetObject.domId].instanceMetaData;if(d.dynamicEvents)for(var d=d.dynamicEvents,b=d.length;b--;)if(d[b].name===a.name){delete d[b];d.splice(b,1);break}},_createEventInWidgetInstance:function(a){var d=cre$.iRuntime.getWidgetObjects()[window[this._widgetObjName]._widgetObject.domId].instanceMetaData;d.dynamicEvents||
(d.dynamicEvents=[]);for(var b=d.dynamicEvents.length,c=0;c<b;c++)if(d.dynamicEvents[c].name===a.name)return __logging.log("cre$.iwidget.iEvents","_createEventInWidgetInstance",cre$.LocaleHelper.getLocalizedMessages().ERR_DYN_EVENT_ALREADY_EXIST),!1;d.dynamicEvents.push({name:a.name,type:a.type});return!0},_getDynamicEvents:function(){for(var a=this._events.length,d=[],b=0;b<a;b++){var c;a:{if((c=window[this._widgetObjName]._widgetObject.widgetMetadata.event)&&0<c.length)for(var k=0;k<c.length;k++)if(c[k].name===
this._events[b].name){c=!0;break a}c=!1}c||d.push(this._events[b])}return d}};cre$.iwidget.iEventDescription=function(a){this.name=a.name;this.alias=a.alias||null;this.type=a.type;this.lang=a.lang||"en";this.handlingFn=a.handlingFn||"";this.isHandled=!1;this.isPublished=!0;"undefined"!==typeof a.isHandled&&(this.isHandled=a.isHandled,this.isPublished=!1);"undefined"!==typeof a.isPublished&&(this.isPublished=a.isPublished);""!==this.handlingFn&&(this.isHandled=!0);this.onNewWire=a.onNewWire||null;this.onRemoveWire=a.onRemoveWire||null;this._attr=a._attr||{}};
cre$.iwidget.iEventDescription.prototype={getDescription:function(a){return a&&this._attr[a]?this._attr[a].description:this._attr.en&&this._attr.en.description?this._attr.en.description:null},setAttribute:function(a,b,c){c?(this._attr[c]||(this._attr[c]={}),this._attr[c][a]=b):this._attr[a]=b},getAttribute:function(a,b){if(b&&this._attr[b]&&this._attr[b][a])return this._attr[b][a];if(this._attr.en&&this._attr.en[a])return this._attr.en[a];if(this._attr[a])return this._attr[a];if(a===cre$.constants.event.DESCRIPTION)return this.name;
__logging.log("cre$.iwidget.iEventDescription","getAttribute",cre$.LocaleHelper.getLocalizedMessages().ERR_NOT_FIND_ATTRIBUTE,[a]);return null}};cre$.iwidget.iEvent=function(a,b,c,d){this.name=a;this.type=b||null;this.payload=c||null;this.source=d||""};gadgets.window=gadgets.window||{};
(function(){function h(c,d){var e=navigator,a=e.appVersion,e=parseFloat(e.userAgent.split("WebKit/")[1])||void 0,a=parseFloat(a.split("MSIE ")[1])||void 0,a=(e?function(a){var b;if(a.nodeType==DOM_ELEMENT_NODE){var c=a.ownerDocument.defaultView;b=c.getComputedStyle(a,null);!b&&a.style&&(a.style.display="",b=c.getComputedStyle(a,null))}return b||{}}:a&&!window.getComputedStyle?function(a){return a.nodeType==DOM_ELEMENT_NODE?a.currentStyle:{}}:function(a){return a.nodeType==DOM_ELEMENT_NODE?a.ownerDocument.defaultView.getComputedStyle(a,
null):{}})(c);return d&&a?a[d]:a}function k(c,d){var e=h(c,d);if(e)return e.match(/^([0-9]+)/),parseInt(RegExp.$1,10)}gadgets.window.getDimen=function(c){for(var d=0,e=[document.body];0<e.length;){var a=e.shift(),l=a.childNodes;if("undefined"!==typeof a.style&&a!==document.body){var b=a.style[c?"overflowY":"overflowX"];b||(b=h(a,c?"overflowY":"overflowX"));if("visible"!=b&&"inherit"!=b&&((b=a.style[c?"height":"width"])||(b=h(a,c?"height":"width")),b&&0<b.length&&"auto"!=b))continue}for(a=0;a<l.length;a++){var f=
l[a];if("undefined"!=typeof f.style){var g=f.offsetTop,m="marginBottom",b=f.offsetHeight,n=h(f,"direction");c||(g=f.offsetLeft,m="marginRight",b=f.offsetWidth,"rtl"==n&&("undefined"!=typeof g&&"undefined"!=typeof b&&f.offsetParent)&&(g=f.offsetParent.offsetWidth-g-b));"undefined"!=typeof g&&"undefined"!=typeof b&&(b=g+b+(k(f,m)||0),d=Math.max(d,b))}e.push(f)}}return d+(k(document.body,c?"borderBottom":"borderRight")||0)+(k(document.body,c?"marginBottom":"marginRight")||0)+(k(document.body,c?"paddingBottom":
"paddingRight")||0)};gadgets.window.getViewportDimensions=function(){var c=0,d=0;self.innerHeight?(c=self.innerWidth,d=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight):document.body&&(c=document.body.clientWidth,d=document.body.clientHeight);return{width:c,height:d}}})();gadgets.window=gadgets.window||{};(function(){gadgets.window.getHeight=function(){return gadgets.window.getDimen(1)}})();dojo.require("com.ibm.social.sharebox._dialog_utils");
(function(b){var c={};osapi.container.Container.addMixin("ibm.connections.sharedialog",function(a){a.rpcRegister("_sharedialog_register",function(a){c[a.f]=1});b.onClose=function(){for(var b in c)a.getGadgetSiteByIframeId_(b)?gadgets.rpc.call(b,"_sharedialog_onClose"):delete c[b]};b.onForceResize=function(b){var e,d;for(d in c)(e=a.getGadgetSiteByIframeId_(d))&&e.id_==b&&gadgets.rpc.call(d,"_sharedialog_onForceResize")}});gadgets.rpc.register("_sharedialog_addActivityEntry",function(a){a&&a.itemId&&
b.shareAddActivityEntry(a.itemId)});gadgets.rpc.register("_sharedialog_close",function(){b.close()});gadgets.rpc.register("_sharedialog_displayMessage",function(a){a&&(dojo.isString(a.message)&&0<a.message.length)&&b.displayMessage(a.type||"info",a.message)});gadgets.rpc.register("_sharedialog_setDirty",function(a){a&&b.setDirty(a.actionId,!0===a.isDirty)});gadgets.rpc.register("_sharedialog_setSubmitState",function(a){b.setSubmitState(a.inProgress)})})(com.ibm.social.sharebox._dialog_utils.getInstance());dojo.require("com.ibm.social.sharebox._dialog_utils");(function(b){gadgets.rpc.register("_sharedialog_displayMessageNode",function(a){a&&a.messageHtml&&b.displayMessageHtml(a.type,a.messageHtml)})})(com.ibm.social.sharebox._dialog_utils.getInstance());gadgets.pubsub2router=function(){return{init:function(a){this.hub=a.hub?a.hub:new OpenAjax.hub.ManagedHub({onPublish:a.onPublish,onSubscribe:a.onSubscribe,onUnsubscribe:a.onUnsubscribe})}}}();(function(){function h(a){"function"===typeof a&&d.push(a)}function k(a){for(var b=0,c;c=d[b];b++)if(c===a){d.splice(b,1);break}}var e,d=[],f={};osapi.container.Container.addMixin("selection",function(a){function b(c){e=c;for(var b=0;d[b];b++)d[b](c);for(var g in f)a.getGadgetSiteByIframeId_(g)?gadgets.rpc.call(g,"gadgets.selection.selectionChanged",null,c):delete f[g]}a.rpcRegister("gadgets.selection.set",function(c,a){b(a)});a.rpcRegister("gadgets.selection.register",function(a){f[a.f]=1;return e});
return{setSelection:b,getSelection:function(){return e},addListener:h,removeListener:k}})})();osapi.container.actions={};osapi.container.actions.OptParam={};osapi.container.actions.OptParam.VIEW="view";osapi.container.actions.OptParam.VIEW_TARGET="viewTarget";(function(){function r(a){var c=!0;if(a){var b=a.path,d=a.dataType;if(!a.id||!b&&!d)c=!1}else c=!1;return c}function s(a,c){if(r(a)){g.addAction(a,c);t([a]);for(var b in k)k.hasOwnProperty(b)&&(f.getGadgetSiteByIframeId_(b)?gadgets.rpc.call(b,"actions.onActionShow",null,[a]):delete k[b])}}function u(a){var c=g.getItemById(a);g.removeAction(a);v([c]);for(var b in l)l.hasOwnProperty(b)&&(f.getGadgetSiteByIframeId_(b)?gadgets.rpc.call(b,"actions.onActionHide",null,[c]):delete l[b])}function w(a,c){!c&&
(f&&f.selection)&&(c=f.selection.getSelection());var b=m[a],d;if(b)for(d=0;d<b.length;d++){var e=b[d];e.call(null,a,c)}for(d=0;d<n.length;d++)e=n[d],e.call(null,a,c);if(b=g.getGadgetSites(a))for(d=0;d<b.length;d++)(e=b[d].getActiveSiteHolder())&&gadgets.rpc.call(e.getIframeId(),"actions.runAction",null,a,c)}var m={},n=[],h={};h[osapi.container.CallbackType.ON_PRELOADED]=function(a){for(var c in a)if(a.hasOwnProperty(c)){var b=a[c];if(!b.error&&b.modulePrefs&&(b=(b=b.modulePrefs.features.actions)&&
b.params?b.params["action-contributions"]:null)){"string"!==typeof b&&(b=b.toString());b=b.replace(/\n/g,"");b=b.replace(/\s+</g,"\x3c");b=b.replace(/>\s+/g,"\x3e");-1===b.indexOf("\x3cactions\x3e")&&(b="\x3cactions\x3e"+b+"\x3c/actions\x3e");var d;try{d=opensocial.xmlutil.parseXML(b)}catch(e){}if(d&&(b=gadgets.json.xml.convertXmlToJson(d).actions))for(var b=[].concat(b.action),f=0;f<b.length;f++){var p=b[f],h={},k;for(k in p)p.hasOwnProperty(k)&&(h[k.substring(1)]=p[k]);g.getItemById(h.id)?gadgets.warn(["Duplicated gadget action [",
h.id,"] detected, make sure the gadget actions have unique ids."].join("")):s(h,c)}}}};h[osapi.container.CallbackType.ON_NAVIGATED]=function(a){var c=a.getActiveSiteHolder();c&&(c=c.getUrl(),g.addGadgetSite(c,a))};h[osapi.container.CallbackType.ON_BEFORE_CLOSE]=function(a){a=a.getId();g.removeGadgetSite(a)};h[osapi.container.CallbackType.ON_UNLOADED]=function(a){a=g.getActionsByUrl(a);for(var c=0;c<a.length;c++)u(a[c].id)};var t=function(a){},k={},v=function(a){},l={},x=function(a,c){},g=new function(){this.registryById=
{};this.registryByPath={};this.registryByDataType={};this.registryByUrl={};this.urlToSite={};this.actionToUrl={};this.addAction=function(a,c){if(r(a)){var b=a.id,d=a.path,e=a.dataType;if(d){for(var e=d.split("/"),d=this.registryByPath,f=0;f<e.length;f++){var g=e[f];d[g]||(d[g]={});d=d[g]}e=d["@actions"];d["@actions"]=e?e.concat(a):[a]}else e&&(this.registryByDataType[e]=this.registryByDataType[e]?this.registryByDataType[e].concat(a):[a]);this.registryById[b]=a;c&&(this.actionToUrl[b]=c,this.registryByUrl[c]=
this.registryByUrl[c]?this.registryByUrl[c].concat(a):[a])}};this.removeAction=function(a){var c=this.registryById[a];delete this.registryById[a];var b=c.path;if(b){var b=this.getActionsByPath(b),d=b.indexOf(c);-1!=d&&b.splice(d,1)}else{var d=c.dataType,e=this.registryByDataType[d],b=e.indexOf(c);e.splice(b,1);0==e.length&&delete this.registryByDataType[d]}if(d=this.actionToUrl[a])delete this.actionToUrl[a],a=this.registryByUrl[d],b=a.indexOf(c),a.splice(b,1),0==a.length&&delete this.registryByUrl[d]};
this.getItemById=function(a){return(this.registryById?this.registryById:{})[a]};this.getAllActions=function(){var a=[];for(actionId in this.registryById)this.registryById.hasOwnProperty(actionId)&&(a=a.concat(this.registryById[actionId]));return a};this.getActionsByPath=function(a){var c=[];a=a.split("/");for(var b=this.registryByPath?this.registryByPath:{},d=0;d<a.length;d++){var e=a[d];if(b[e])b=b[e];else return c}b&&(c=b["@actions"]);return c};this.getActionsByDataType=function(a){var c=[];this.registryByDataType[a]&&
(c=this.registryByDataType[a]);return c};this.getActionsByUrl=function(a){var c=[];this.registryByUrl[a]&&(c=c.concat(this.registryByUrl[a]));return c};this.addGadgetSite=function(a,c){var b=this.urlToSite[a];this.urlToSite[a]=b?b.concat(c):[c]};this.removeGadgetSite=function(a){for(var c in this.urlToSite)if(this.urlToSite.hasOwnProperty(c)){var b=this.urlToSite[c];if(b)for(var d=0;d<b.length;d++){var e=b[d];e&&e.getId()==a&&(b.splice(d,1),0==b.length&&delete this.urlToSite[c])}}};this.getGadgetSites=
function(a){var c=this.getItemById(a),b=[];if(a=this.urlToSite[this.actionToUrl[a]])for(var d=0;d<a.length;d++){var e=a[d],f=e.getActiveSiteHolder();(!c.view||f&&f.getView()===c.view)&&b.push(e)}return b};this.getUrl=function(a){return this.actionToUrl[a]}},q={},f=null;osapi.container.Container.addMixin("actions",function(a){f=a;f.rpcRegister("actions.registerHideCallback",function(c){l[c.f]=1});f.rpcRegister("actions.registerShowCallback",function(c){k[c.f]=1});f.rpcRegister("actions.bindAction",
function(c,b){var a=b.id;if(g.getItemById(a)){var e=q[a];e&&(w(a,e.selection),delete q[a])}else s(b)});f.rpcRegister("actions.get_actions_by_type",function(c,a){return[].concat(g.getActionsByDataType(a))});f.rpcRegister("actions.get_actions_by_path",function(c,a){return[].concat(g.getActionsByPath(a))});f.rpcRegister("actions.removeAction",function(c,a){return u(a)});f.rpcRegister("actions.runAction",function(a,b,d){f.actions.runAction(b,d)});f.addGadgetLifecycleCallback&&f.addGadgetLifecycleCallback("actions",
h);return{registerShowActionsHandler:function(a){"function"===typeof a&&(t=a)},registerHideActionsHandler:function(a){"function"===typeof a&&(v=a)},registerNavigateGadgetHandler:function(a){"function"===typeof a&&(x=a)},runAction:function(a,b){var d=g.getItemById(a);if(d){var e=g.getGadgetSites(a);if(!e||0===e.length){e=g.getUrl(a);q[a]={selection:b||f.selection.getSelection()};var h={};d.view&&(h[osapi.container.actions.OptParam.VIEW]=d.view);d.viewTarget&&(h[osapi.container.actions.OptParam.VIEW_TARGET]=
d.viewTarget);x(e,h)}else w(a,b)}},getAction:function(a){return g.getItemById(a)},getAllActions:function(){return g.getAllActions()},getActionsByPath:function(a){return g.getActionsByPath(a)},getActionsByDataType:function(a){return g.getActionsByDataType(a)},addListener:function(a,b){if(a&&"function"!=typeof a)throw Error("listener param must be a function");b?(m[b]=m[b]||[]).push(a):n.push(a)},removeListener:function(a){a=listeners.indexOf(a);-1!=a&&listeners.splice(a,1)}}})})();(function(){gadgets.rpc.register("_conn_ee_close_popup",function(){dojo.publish("com/ibm/social/ee/event/closePopup",[])})})();(function(){gadgets.rpc.register("_conn_ee_activityentry_update",function(a,b){dojo.publish("com/ibm/social/ee/event/updateActivityEntry",[a,b])});gadgets.rpc.register("_conn_ee_setdirty",function(a){dojo.publish("com/ibm/social/ee/event/setDirty",[a])});gadgets.rpc.register("_conn_ee_scrollTop",function(){dojo.publish("com/ibm/social/ee/event/scrollTop",[])});gadgets.rpc.register("_conn_ee_scrollBottom",function(){dojo.publish("com/ibm/social/ee/event/scrollBottom",[])})})();cre$.messages={ERR_CC_NOT_LOADED:"The common container for the gadget cannot load properly.",ERR_WIDGET_NOT_EXIST:"A widget associated with the Document Object Model (DOM) ID cannot be found.",ERR_LOAD_ITEMSET_SRC:"An error occurred when loading a script for the ItemSet API.",ERR_LOAD_EVENT_SRC:"An error occurred when loading a script for an API that supports events.",ERR_ISCOPE_METHOD_NOT_DEFINED:"An error occurred when the iScope object attempted to invoke a method that is defined by the widget.",
LOG_WIRE_NOT_INIT:"A wire required for the page has not been created yet.",ERR_EVENT_NAME_TYPE_MISSING:"An error occurred because the event name and type parameters are missing when calling the iEvents.setEvent API.",ERR_EVENT_FORMAT:"An error occurred because the event format parameter is missing when calling the iEvents.setEvent API.",ERR_REMOVE_EVENT:"An error occurred when attempting to remove an event.",ERR_REMOVE_EVENT_EMPTY_NAME:"The value of the eventName parameter that is passed to the iEvents.removeEvent API cannot be empty.",
ERR_REMOVE_EVENT_NO_EVENT:"The event cannot be removed because it does not exist.",ERR_REMOVE_EVENT_NOT_EXIST:"The following event cannot be removed because the name is not valid: ${0}.",ERR_EVENT_NAME_TYPE_REQUIRED_DESCITEM:"The values of the event name and type are missing for the descriptionItems JSON parameter.",ERR_EVENT_ALREADY_EXISTED:"The event name is already being used for this widget.",ERR_DYN_EVENT_ALREADY_EXIST:"The name of the dynamic event is already being used for this widget.",ERR_NOT_FIND_ATTRIBUTE:"The following attribute cannot be found because the name is wrong: ${0}.",
LOG_NO_MANAGEDIS:"The name provided for the ItemSet API cannot be found: ${0}.",EXCEPTION_CREATE_IFR_CONTAINER:"The following exception occurred when attempting to render a sandboxed iWidget: ${0},",ERR_MISSING_EE_CTX:"The gadget for the embedded experience cannot render because the context is missing.",ERR_CREATE_SERVICEMGR:"A severe error occurred when attempting to the create the service manager.",ERR_INVALID_RENDER_TYPE:"The following value of the render type parameter is not recognized:",ERR_CANT_LOAD_WIRE:"An error occurred when loading a wire from the server.",
ERR_INVALID_TYPE:"The value of the type parameter is not valid.",ERR_CANT_PRELOAD_WIDGET:"The following error occurred when preloading the widget:",ERR_CANT_LOAD_WIDGET:"The following error occurred when loading the widget:",ERR_INVALID_PARAM_OBJ:"The widget cannot load because the parameter object is not an array.",ERR_CANT_SET_USERPROFILE:"The following error occurred when setting the user profile:",ERR_INVALID_PARAM_TYPE:"The widget cannot load because the parameter type is invalid.",ERR_INVALID_COMPONENT_TYPE:"The widget or gadget cannot load because the component type is invalid.",
ERR_CANT_LOAD_CC_FEATURE:"An error occurred when loading a script for the common container.",ERR_CANT_INIT_CC:"An error occurred when attempting to initialize the common container for the gadget.",ERR_PROMISE_ALREADY_RESOLVED:"The Promise object is already resolved.",ERR_NOT_A_FUNC:"The parameter must be a function.",ERR_IS_NULL_UNDEFINED:"The following value is null or undefined:",ERR_INVALID_PARAM:"The parameter name is invalid.",ERR_CANT_SUPPORT_TYPE:"An error occurred because the following resource type is not supported:",
ERR_RESOURCE_NOT_ARRAY:"The parameter must be an array.",ERR_CANT_LOAD_SERVICE:"An error occurred when loading the service:",ERR_LOADING_XML:"An error occurred when passing the following XML string:",ERR_REQ_URL_UNDEFINED:"An internal error occurred when sending a request to the CRE server to load the widget.",LOG_NO_GADGETS_TO_PRELOAD:"No gadgets exist on the page for preloading.",ERR_CANT_LOAD_IMAGE_SYNC:"The image cannot be loaded synchronously.",ERR_CREATE_ISCOPE:"The iScope object for the widget cannot be created.",
ERR_CANT_CHANGE_MODE:"${0} can't switch mode.",LOG_EVALUATION_RESULT_IS_UNDEFINED:"The evaluation result of the eval'ed js is undefined, the resource url is ${0}.",LOG_NAVAIGATE_AWAY:"Navigate Away from the current page?",WARN_DATA_NOT_SAVED:"Data you have entered may not be saved.\nPress OK to continue, or Cancel to stay on the current page.",ERR_LOAD_EXTERNAL_JS:"Failed to load external javascript file."};gadgets.config.init({container:{relayPath:"/developerworks/community/connections/opensocial/gadgets/files/container/rpc_relay.html",enableRpcArbitration:!0},rpc:{passReferrer:"c2p:query",commSwf:"/developerworks/community/connections/opensocial/xpc.swf",useLegacyProtocol:!1,parentRelayUrl:"/container/rpc_relay.html",rpcDelay:1},"core.io":{unparseableCruft:"throw 1; \x3c 'invalid javascript' \x3e",nonceUrl:"//%host%/developerworks/community/connections/opensocial/gadgets/nonceRequest",proxyUrl:"//www.ibm.com/developerworks/community/connections/opensocial/gadgets/proxy%filename%?container\x3d%container%\x26refresh\x3d%refresh%\x26url\x3d%url%\x26stream\x3d%stream%%authz%%rewriteMime%",
jsonProxyUrl:"//%host%/developerworks/community/connections/opensocial/gadgets/makeRequest",appendTokenAlways:!0},"osapi.services":{"gadgets.rpc":["container.listMethods"],"//%host%/developerworks/community/connections/opensocial/rpc":"gadgets.supportedFields gadgets.cajole http.head http.post people.update http.delete activitystreams.delete gadgets.metadata activitystreams.supportedFields gadgets.proxySupportedFields ublog.delete activitystreams.create gadgets.proxy cache.invalidate people.supportedFields http.put gadgets.cajaSupportedFields activitystreams.get gadgets.js http.get gadgets.token ublog.create activitystreams.update system.listMethods gadgets.tokenSupportedFields gadgets.jsSupportedFields people.get ublog.get".split(" ")},
osapi:{endPoints:["//%host%/developerworks/community/connections/opensocial/rpc"]},opensocial:{invalidatePath:"http://%host%/developerworks/community/connections/opensocial/rpc",domain:"shindig",path:"http://%host%/developerworks/community/connections/opensocial/rpc",supportedFields:{activityEntry:"actor content generator icon id object published provider target title updated url verb".split(" "),person:["id",{name:["familyName","givenName","unstructured"]},"thumbnailUrl","profileUrl"],activity:"appId body bodyId externalId id mediaItems postedTime priority streamFaviconUrl streamSourceUrl streamTitle streamUrl templateParams title url userId".split(" ")},
enableCaja:!1},"shindig-container":{serverBase:"/developerworks/community/connections/opensocial/gadgets/"},views:{"default":{urlTemplate:"http://localhost/developerworks/community/connections/opensocial/gadgets/default?{var}",isOnlyVisible:!1,aliases:["home","profile","canvas"]},canvas:{urlTemplate:"http://localhost/developerworks/community/connections/opensocial/gadgets/canvas?{var}",isOnlyVisible:!0,aliases:["FULL_PAGE"]},profile:{urlTemplate:"http://localhost/developerworks/community/connections/opensocial/gadgets/profile?{var}",
isOnlyVisible:!1,aliases:["DASHBOARD","default"]}}});window['___jsl']['l'] = (window['___jsl']['l'] || []).concat(['actions','com.ibm.connections.ee','com.ibm.connections.sharedialog','container','container.nongadget','core','cre.iruntime','cre.iwidget','cre.iwidget.event','cre.iwidget.itemset','cre.messages.en','cre.osgadget','cre.service.event','cre.service.people','cre.wire','embedded-experiences','ibm.connections.ee','ibm.connections.sharedialog','open-views','pubsub-2','rpc','selection','shared-script-frame','shindig.sha1','views']);